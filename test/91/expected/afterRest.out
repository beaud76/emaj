-- afterRest.sql: Test emaj environment restored from a dump taken at the end of schedule reg tests
--                All operations are executed by super-user
--
-----------------------------
-- Checking restore
-----------------------------
select relname,relkind from pg_class where relname like 'emaj_%';
           relname           | relkind 
-----------------------------+---------
 emaj_detailed_log_stat_type | c
 emaj_fk                     | r
 emaj_fk_pkey                | i
 emaj_global_seq             | S
 emaj_group                  | r
 emaj_group_def              | r
 emaj_group_def_pkey         | i
 emaj_group_pkey             | i
 emaj_hist                   | r
 emaj_hist_hist_id_seq       | S
 emaj_hist_pkey              | i
 emaj_log_stat_type          | c
 emaj_mark                   | r
 emaj_mark_mark_id_seq       | S
 emaj_mark_pkey              | i
 emaj_param                  | r
 emaj_param_pkey             | i
 emaj_relation               | r
 emaj_relation_idx1          | i
 emaj_relation_idx2          | i
 emaj_relation_pkey          | i
 emaj_rlbk_stat              | r
 emaj_rlbk_stat_pkey         | i
 emaj_seq_hole               | r
 emaj_seq_hole_pkey          | i
 emaj_seq_hole_sqhl_id_seq   | S
 emaj_sequence               | r
 emaj_sequence_pkey          | i
 emaj_sequence_sequ_id_seq   | S
(29 rows)

select * from emaj.emaj_global_seq;
  sequence_name  | last_value | start_value | increment_by |      max_value      | min_value | cache_value | log_cnt | is_cycled | is_called 
-----------------+------------+-------------+--------------+---------------------+-----------+-------------+---------+-----------+-----------
 emaj_global_seq |      12252 |           1 |            1 | 9223372036854775807 |         1 |           1 |       0 | f         | t
(1 row)

-----------------------------
-- Step 1 : for myGroup2, update tables and set a mark 
-----------------------------
set search_path=myschema2;
SET
insert into myTbl1 select 100+i, 'KLM', E'\\000\\014'::bytea from generate_series (1,11) as i;
INSERT 0 11
update myTbl1 set col13=E'\\000\\034'::bytea where col11 >105;
UPDATE 6
insert into myTbl2 values (100,'KLM','2012-12-31');
INSERT 0 1
delete from myTbl1 where col11 > 110;
DELETE 1
select nextval('myschema2.myseq1');
 nextval 
---------
    9999
(1 row)

--
select emaj.emaj_set_mark_group('myGroup2','After restore mark');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

--
-----------------------------
-- Checking step 1
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    |        regexp_replace        | mark_state |     mark_comment     | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------------+------------------------------+------------+----------------------+-----------------------+-----------------------+---------------------------
     606 | myGroup2         | M3                           | DELETED    | This mark is deleted |                   599 |                  6045 |                         0
     611 | myGroup1         | M4                           | DELETED    |                      |                   601 |                  6083 |                        10
     612 | myGroup1         | M5                           | DELETED    |                      |                   601 |                  6089 |                         3
     616 | myGroup1         | Before logged rollback to M4 | DELETED    |                      |                   606 |                  6117 |                        18
     618 | myGroup1         | STOP_%                       | DELETED    |                      |                   606 |                  6137 |                         0
     619 | myGroup2         | STOP_%                       | DELETED    |                      |                   606 |                  6137 |                         0
     628 | myGroup1         | Stop after rollback          | DELETED    |                      |                   606 |                  6207 |                         0
     629 | myGroup2         | Stop after rollback          | DELETED    |                      |                   606 |                  6207 |                         0
     630 | myGroup1         | Multi-1                      | ACTIVE     |                      |                   606 |                  6221 |                          
     631 | myGroup2         | Multi-1                      | ACTIVE     |                      |                   606 |                  6221 |                        97
     636 | phil's group#3", | M1_rollbackable              | ACTIVE     |                      |                   606 |                  6247 |                        52
     637 | phil's group#3", | M2_rollbackable              | ACTIVE     |                      |                   606 |                  6251 |                         3
     639 | phil's group#3", | phil's mark #3               | ACTIVE     | Third mark set       |                   606 |                  6259 |                          
    1000 | myGroup2         | After restore mark           | ACTIVE     |                      |                   999 |                  1007 |                          
(14 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id |  sequ_schema   |             sequ_name              |        regexp_replace        | sequ_last_val | sequ_is_called 
---------+----------------+------------------------------------+------------------------------+---------------+----------------
    1000 | myschema2      | myseq1                             | After restore mark           |          9999 | t
    1001 | myschema2      | myTbl3_col31_seq                   | After restore mark           |            21 | f
    1002 | emaj           | myschema2_mytbl1_log_seq           | After restore mark           |            43 | t
    1003 | emaj           | myschema2_mytbl2_log_seq           | After restore mark           |             5 | t
    1004 | emajC          | myschema2_myTbl3_log_seq           | After restore mark           |            20 | t
    1005 | emaj           | myschema2_mytbl4_log_seq           | After restore mark           |            26 | t
    1006 | emaj           | myschema2_mytbl5_log_seq           | After restore mark           |            18 | t
    1007 | emaj           | myschema2_mytbl6_log_seq           | After restore mark           |            74 | t
    6025 | emajC          | myschema1_myTbl3_log_seq           | M3                           |            10 | t
    6028 | emaj           | myschema1_mytbl2_log_seq           | M3                           |             2 | t
    6029 | emajb          | myschema1_mytbl2b_log_seq          | M3                           |             1 | f
    6038 | myschema2      | myseq1                             | M3                           |          1003 | t
    6039 | myschema2      | myTbl3_col31_seq                   | M3                           |            20 | t
    6040 | emaj           | myschema2_mytbl1_log_seq           | M3                           |            15 | t
    6041 | emaj           | myschema2_mytbl2_log_seq           | M3                           |             2 | t
    6042 | emajC          | myschema2_myTbl3_log_seq           | M3                           |            10 | t
    6043 | emaj           | myschema2_mytbl4_log_seq           | M3                           |             4 | t
    6044 | emaj           | myschema2_mytbl5_log_seq           | M3                           |             4 | t
    6045 | emaj           | myschema2_mytbl6_log_seq           | M3                           |            14 | t
    6048 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M2_%_START              |            15 | t
    6049 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M2_%_START              |             2 | t
    6050 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M2_%_START              |            10 | t
    6056 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M2_%_DONE               |            15 | t
    6057 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M2_%_DONE               |             2 | t
    6058 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M2_%_DONE               |            10 | t
    6064 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M3_%_START              |            15 | t
    6065 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M3_%_START              |             2 | t
    6066 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M3_%_START              |            10 | t
    6072 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M3_%_DONE               |            15 | t
    6073 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M3_%_DONE               |             2 | t
    6074 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M3_%_DONE               |            10 | t
    6078 | myschema1      | myTbl3_col31_seq                   | M4                           |            20 | t
    6079 | emajC          | myschema1_myTbl3_log_seq           | M4                           |            10 | t
    6080 | emaj           | myschema1_mytbl1_log_seq           | M4                           |            30 | t
    6081 | emaj           | myschema1_mytbl4_log_seq           | M4                           |             8 | t
    6082 | emaj           | myschema1_mytbl2_log_seq           | M4                           |             3 | t
    6083 | emajb          | myschema1_mytbl2b_log_seq          | M4                           |             1 | f
    6084 | myschema1      | myTbl3_col31_seq                   | M5                           |            20 | t
    6085 | emajC          | myschema1_myTbl3_log_seq           | M5                           |            20 | t
    6086 | emaj           | myschema1_mytbl1_log_seq           | M5                           |            30 | t
    6087 | emaj           | myschema1_mytbl4_log_seq           | M5                           |             8 | t
    6088 | emaj           | myschema1_mytbl2_log_seq           | M5                           |             3 | t
    6089 | emajb          | myschema1_mytbl2b_log_seq          | M5                           |             1 | f
    6091 | emajC          | myschema1_myTbl3_log_seq           | M6                           |            20 | t
    6094 | emaj           | myschema1_mytbl2_log_seq           | M6                           |             3 | t
    6095 | emajb          | myschema1_mytbl2b_log_seq          | M6                           |             1 | f
    6098 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M2_%_START              |            15 | t
    6099 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M2_%_START              |             2 | t
    6100 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M2_%_START              |            10 | t
    6106 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M2_%_DONE               |            15 | t
    6107 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M2_%_DONE               |             2 | t
    6108 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M2_%_DONE               |            10 | t
    6112 | myschema1      | myTbl3_col31_seq                   | Before logged rollback to M4 |            20 | t
    6113 | emajC          | myschema1_myTbl3_log_seq           | Before logged rollback to M4 |            20 | t
    6114 | emaj           | myschema1_mytbl1_log_seq           | Before logged rollback to M4 |            32 | t
    6115 | emaj           | myschema1_mytbl4_log_seq           | Before logged rollback to M4 |            12 | t
    6116 | emaj           | myschema1_mytbl2_log_seq           | Before logged rollback to M4 |             3 | t
    6117 | emajb          | myschema1_mytbl2b_log_seq          | Before logged rollback to M4 |             1 | f
    6124 | myschema1      | myTbl3_col31_seq                   | STOP_%                       |            20 | t
    6125 | myschema2      | myseq1                             | STOP_%                       |          1004 | f
    6126 | myschema2      | myTbl3_col31_seq                   | STOP_%                       |            20 | t
    6127 | emajC          | myschema1_myTbl3_log_seq           | STOP_%                       |            35 | t
    6128 | emaj           | myschema1_mytbl1_log_seq           | STOP_%                       |            33 | t
    6129 | emaj           | myschema1_mytbl4_log_seq           | STOP_%                       |            14 | t
    6130 | emaj           | myschema1_mytbl2_log_seq           | STOP_%                       |             3 | t
    6131 | emajb          | myschema1_mytbl2b_log_seq          | STOP_%                       |             1 | f
    6132 | emaj           | myschema2_mytbl1_log_seq           | STOP_%                       |            15 | t
    6133 | emaj           | myschema2_mytbl2_log_seq           | STOP_%                       |             2 | t
    6134 | emajC          | myschema2_myTbl3_log_seq           | STOP_%                       |            10 | t
    6135 | emaj           | myschema2_mytbl4_log_seq           | STOP_%                       |            24 | t
    6136 | emaj           | myschema2_mytbl5_log_seq           | STOP_%                       |             9 | t
    6137 | emaj           | myschema2_mytbl6_log_seq           | STOP_%                       |            29 | t
    6155 | emajC          | myschema1_myTbl3_log_seq           | Multi-2                      |            35 | t
    6156 | emaj           | myschema1_mytbl1_log_seq           | Multi-2                      |            33 | t
    6157 | emaj           | myschema1_mytbl4_log_seq           | Multi-2                      |            14 | t
    6158 | emaj           | myschema1_mytbl2_log_seq           | Multi-2                      |             3 | t
    6159 | emajb          | myschema1_mytbl2b_log_seq          | Multi-2                      |             1 | f
    6160 | emaj           | myschema2_mytbl1_log_seq           | Multi-2                      |            15 | t
    6161 | emaj           | myschema2_mytbl2_log_seq           | Multi-2                      |             2 | t
    6162 | emajC          | myschema2_myTbl3_log_seq           | Multi-2                      |            10 | t
    6163 | emaj           | myschema2_mytbl4_log_seq           | Multi-2                      |            24 | t
    6164 | emaj           | myschema2_mytbl5_log_seq           | Multi-2                      |             9 | t
    6165 | emaj           | myschema2_mytbl6_log_seq           | Multi-2                      |            29 | t
    6169 | emajC          | myschema1_myTbl3_log_seq           | RLBK_Multi-1_%_START         |            35 | t
    6170 | emaj           | myschema1_mytbl1_log_seq           | RLBK_Multi-1_%_START         |            33 | t
    6171 | emaj           | myschema1_mytbl4_log_seq           | RLBK_Multi-1_%_START         |            14 | t
    6172 | emaj           | myschema1_mytbl2_log_seq           | RLBK_Multi-1_%_START         |             3 | t
    6173 | emajb          | myschema1_mytbl2b_log_seq          | RLBK_Multi-1_%_START         |             1 | f
    6174 | emaj           | myschema2_mytbl1_log_seq           | RLBK_Multi-1_%_START         |            15 | t
    6175 | emaj           | myschema2_mytbl2_log_seq           | RLBK_Multi-1_%_START         |             2 | t
    6176 | emajC          | myschema2_myTbl3_log_seq           | RLBK_Multi-1_%_START         |            10 | t
    6177 | emaj           | myschema2_mytbl4_log_seq           | RLBK_Multi-1_%_START         |            24 | t
    6178 | emaj           | myschema2_mytbl5_log_seq           | RLBK_Multi-1_%_START         |             9 | t
    6179 | emaj           | myschema2_mytbl6_log_seq           | RLBK_Multi-1_%_START         |            29 | t
    6183 | emajC          | myschema1_myTbl3_log_seq           | RLBK_Multi-1_%_DONE          |            35 | t
    6184 | emaj           | myschema1_mytbl1_log_seq           | RLBK_Multi-1_%_DONE          |            33 | t
    6185 | emaj           | myschema1_mytbl4_log_seq           | RLBK_Multi-1_%_DONE          |            14 | t
    6186 | emaj           | myschema1_mytbl2_log_seq           | RLBK_Multi-1_%_DONE          |             3 | t
    6187 | emajb          | myschema1_mytbl2b_log_seq          | RLBK_Multi-1_%_DONE          |             1 | f
    6188 | emaj           | myschema2_mytbl1_log_seq           | RLBK_Multi-1_%_DONE          |            15 | t
    6189 | emaj           | myschema2_mytbl2_log_seq           | RLBK_Multi-1_%_DONE          |             2 | t
    6190 | emajC          | myschema2_myTbl3_log_seq           | RLBK_Multi-1_%_DONE          |            10 | t
    6191 | emaj           | myschema2_mytbl4_log_seq           | RLBK_Multi-1_%_DONE          |            24 | t
    6192 | emaj           | myschema2_mytbl5_log_seq           | RLBK_Multi-1_%_DONE          |             9 | t
    6193 | emaj           | myschema2_mytbl6_log_seq           | RLBK_Multi-1_%_DONE          |            29 | t
    6194 | myschema1      | myTbl3_col31_seq                   | Stop after rollback          |            20 | t
    6195 | myschema2      | myseq1                             | Stop after rollback          |          1004 | f
    6196 | myschema2      | myTbl3_col31_seq                   | Stop after rollback          |            20 | t
    6197 | emajC          | myschema1_myTbl3_log_seq           | Stop after rollback          |            35 | t
    6198 | emaj           | myschema1_mytbl1_log_seq           | Stop after rollback          |            33 | t
    6199 | emaj           | myschema1_mytbl4_log_seq           | Stop after rollback          |            14 | t
    6200 | emaj           | myschema1_mytbl2_log_seq           | Stop after rollback          |             3 | t
    6201 | emajb          | myschema1_mytbl2b_log_seq          | Stop after rollback          |             1 | f
    6202 | emaj           | myschema2_mytbl1_log_seq           | Stop after rollback          |            15 | t
    6203 | emaj           | myschema2_mytbl2_log_seq           | Stop after rollback          |             2 | t
    6204 | emajC          | myschema2_myTbl3_log_seq           | Stop after rollback          |            10 | t
    6205 | emaj           | myschema2_mytbl4_log_seq           | Stop after rollback          |            24 | t
    6206 | emaj           | myschema2_mytbl5_log_seq           | Stop after rollback          |             9 | t
    6207 | emaj           | myschema2_mytbl6_log_seq           | Stop after rollback          |            29 | t
    6208 | myschema1      | myTbl3_col31_seq                   | Multi-1                      |            20 | t
    6209 | myschema2      | myseq1                             | Multi-1                      |          1004 | f
    6210 | myschema2      | myTbl3_col31_seq                   | Multi-1                      |            20 | t
    6211 | emajC          | myschema1_myTbl3_log_seq           | Multi-1                      |            35 | t
    6212 | emaj           | myschema1_mytbl1_log_seq           | Multi-1                      |            33 | t
    6213 | emaj           | myschema1_mytbl4_log_seq           | Multi-1                      |            14 | t
    6214 | emaj           | myschema1_mytbl2_log_seq           | Multi-1                      |             3 | t
    6215 | emajb          | myschema1_mytbl2b_log_seq          | Multi-1                      |             1 | f
    6216 | emaj           | myschema2_mytbl1_log_seq           | Multi-1                      |            15 | t
    6217 | emaj           | myschema2_mytbl2_log_seq           | Multi-1                      |             2 | t
    6218 | emajC          | myschema2_myTbl3_log_seq           | Multi-1                      |            10 | t
    6219 | emaj           | myschema2_mytbl4_log_seq           | Multi-1                      |            24 | t
    6220 | emaj           | myschema2_mytbl5_log_seq           | Multi-1                      |             9 | t
    6221 | emaj           | myschema2_mytbl6_log_seq           | Multi-1                      |            29 | t
    6244 | phil's schema3 | myTbl2\_col21_seq                  | M1_rollbackable              |             1 | f
    6245 | phil's schema3 | phil's seq\1                       | M1_rollbackable              |          1000 | f
    6246 | emaj           | phil's schema3_myTbl2\_log_seq     | M1_rollbackable              |             1 | f
    6247 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | M1_rollbackable              |             1 | f
    6248 | phil's schema3 | myTbl2\_col21_seq                  | M2_rollbackable              |             1 | f
    6249 | phil's schema3 | phil's seq\1                       | M2_rollbackable              |          1000 | t
    6250 | emaj           | phil's schema3_myTbl2\_log_seq     | M2_rollbackable              |             2 | t
    6251 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | M2_rollbackable              |            50 | t
    6256 | phil's schema3 | myTbl2\_col21_seq                  | phil's mark #3               |             1 | f
    6257 | phil's schema3 | phil's seq\1                       | phil's mark #3               |          1001 | t
    6258 | emaj           | phil's schema3_myTbl2\_log_seq     | phil's mark #3               |             2 | t
    6259 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | phil's mark #3               |            53 | t
    6262 | emaj           | phil's schema3_myTbl2\_log_seq     | RLBK_phil's mark #3_%_START  |             2 | t
    6263 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | RLBK_phil's mark #3_%_START  |            53 | t
    6266 | emaj           | phil's schema3_myTbl2\_log_seq     | RLBK_phil's mark #3_%_DONE   |             2 | t
    6267 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | RLBK_phil's mark #3_%_DONE   |            53 | t
(149 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13  
-------+------------+--------
   101 | KLM        | \x000c
   102 | KLM        | \x000c
   103 | KLM        | \x000c
   104 | KLM        | \x000c
   105 | KLM        | \x000c
   106 | KLM        | \x001c
   107 | KLM        | \x001c
   108 | KLM        | \x001c
   109 | KLM        | \x001c
   110 | KLM        | \x001c
(10 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
   100 | KLM   | 2012-12-31
(1 row)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
(0 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13  | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+--------+-----------+------------+----------
     4 | ABC        | \x0c   | DEL       | OLD        |    12215
     5 | ABC        | \x0c   | DEL       | OLD        |    12216
     6 | ABC        | \x0c   | DEL       | OLD        |    12217
     7 | ABC        | \x0c   | DEL       | OLD        |    12218
     8 | ABC        | \x0c   | DEL       | OLD        |    12219
     9 | ABC        | \x0c   | DEL       | OLD        |    12220
    10 | ABC        | \x0c   | DEL       | OLD        |    12221
     1 | ABC        | \x1c   | DEL       | OLD        |    12222
     2 | ABC        | \x1c   | DEL       | OLD        |    12223
     3 | ABC        | \x1c   | DEL       | OLD        |    12224
   101 | KLM        | \x000c | INS       | NEW        |    12253
   102 | KLM        | \x000c | INS       | NEW        |    12254
   103 | KLM        | \x000c | INS       | NEW        |    12255
   104 | KLM        | \x000c | INS       | NEW        |    12256
   105 | KLM        | \x000c | INS       | NEW        |    12257
   106 | KLM        | \x000c | INS       | NEW        |    12258
   107 | KLM        | \x000c | INS       | NEW        |    12259
   108 | KLM        | \x000c | INS       | NEW        |    12260
   109 | KLM        | \x000c | INS       | NEW        |    12261
   110 | KLM        | \x000c | INS       | NEW        |    12262
   111 | KLM        | \x000c | INS       | NEW        |    12263
   106 | KLM        | \x000c | UPD       | OLD        |    12264
   106 | KLM        | \x001c | UPD       | NEW        |    12264
   107 | KLM        | \x000c | UPD       | OLD        |    12265
   107 | KLM        | \x001c | UPD       | NEW        |    12265
   108 | KLM        | \x000c | UPD       | OLD        |    12266
   108 | KLM        | \x001c | UPD       | NEW        |    12266
   109 | KLM        | \x000c | UPD       | OLD        |    12267
   109 | KLM        | \x001c | UPD       | NEW        |    12267
   110 | KLM        | \x000c | UPD       | OLD        |    12268
   110 | KLM        | \x001c | UPD       | NEW        |    12268
   111 | KLM        | \x000c | UPD       | OLD        |    12269
   111 | KLM        | \x001c | UPD       | NEW        |    12269
   111 | KLM        | \x001c | DEL       | OLD        |    12271
(34 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 2010-01-01 | DEL       | OLD        |    12225
     2 | DEF   |            | DEL       | OLD        |    12226
   100 | KLM   | 2012-12-31 | INS       | NEW        |    12270
(3 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | DEL       | OLD        |    12227
    12 | 10.00 | DEL       | OLD        |    12228
    13 | 10.00 | DEL       | OLD        |    12229
    14 | 10.00 | DEL       | OLD        |    12230
    15 | 10.00 | DEL       | OLD        |    12231
    16 | 10.00 | DEL       | OLD        |    12232
    17 | 10.00 | DEL       | OLD        |    12233
    18 | 10.00 | DEL       | OLD        |    12234
    19 | 10.00 | DEL       | OLD        |    12235
    20 | 10.00 | DEL       | OLD        |    12236
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     2 |     1 | ABC        | DEL       | OLD        |    12213
     2 | FK... |     2 |     1 | ABC        | DEL       | OLD        |    12214
(2 rows)

--
-----------------------------
-- Step 2 : for myGroup2, rollback to mark Multi-1 (set before dump/restore) 
-----------------------------
select * from emaj.emaj_log_stat_group('myGroup2','Multi-1',NULL);
 stat_group | stat_schema | stat_table | stat_rows 
------------+-------------+------------+-----------
 myGroup2   | myschema2   | mytbl1     |        28
 myGroup2   | myschema2   | mytbl2     |         3
 myGroup2   | myschema2   | myTbl3     |        10
 myGroup2   | myschema2   | mytbl4     |         2
 myGroup2   | myschema2   | mytbl5     |         9
 myGroup2   | myschema2   | mytbl6     |        45
(6 rows)

select emaj.emaj_rollback_group('myGroup2','Multi-1');
 emaj_rollback_group 
---------------------
                   8
(1 row)

--
-----------------------------
-- Checking step 2
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    |        regexp_replace        | mark_state |     mark_comment     | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------------+------------------------------+------------+----------------------+-----------------------+-----------------------+---------------------------
     606 | myGroup2         | M3                           | DELETED    | This mark is deleted |                   599 |                  6045 |                         0
     611 | myGroup1         | M4                           | DELETED    |                      |                   601 |                  6083 |                        10
     612 | myGroup1         | M5                           | DELETED    |                      |                   601 |                  6089 |                         3
     616 | myGroup1         | Before logged rollback to M4 | DELETED    |                      |                   606 |                  6117 |                        18
     618 | myGroup1         | STOP_%                       | DELETED    |                      |                   606 |                  6137 |                         0
     619 | myGroup2         | STOP_%                       | DELETED    |                      |                   606 |                  6137 |                         0
     628 | myGroup1         | Stop after rollback          | DELETED    |                      |                   606 |                  6207 |                         0
     629 | myGroup2         | Stop after rollback          | DELETED    |                      |                   606 |                  6207 |                         0
     630 | myGroup1         | Multi-1                      | ACTIVE     |                      |                   606 |                  6221 |                          
     631 | myGroup2         | Multi-1                      | ACTIVE     |                      |                   606 |                  6221 |                          
     636 | phil's group#3", | M1_rollbackable              | ACTIVE     |                      |                   606 |                  6247 |                        52
     637 | phil's group#3", | M2_rollbackable              | ACTIVE     |                      |                   606 |                  6251 |                         3
     639 | phil's group#3", | phil's mark #3               | ACTIVE     | Third mark set       |                   606 |                  6259 |                          
(13 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id |  sequ_schema   |             sequ_name              |        regexp_replace        | sequ_last_val | sequ_is_called 
---------+----------------+------------------------------------+------------------------------+---------------+----------------
    1000 | myschema2      | myseq1                             | After restore mark           |          9999 | t
    1001 | myschema2      | myTbl3_col31_seq                   | After restore mark           |            21 | f
    1002 | emaj           | myschema2_mytbl1_log_seq           | After restore mark           |            43 | t
    1003 | emaj           | myschema2_mytbl2_log_seq           | After restore mark           |             5 | t
    1004 | emajC          | myschema2_myTbl3_log_seq           | After restore mark           |            20 | t
    1005 | emaj           | myschema2_mytbl4_log_seq           | After restore mark           |            26 | t
    1006 | emaj           | myschema2_mytbl5_log_seq           | After restore mark           |            18 | t
    1007 | emaj           | myschema2_mytbl6_log_seq           | After restore mark           |            74 | t
    6025 | emajC          | myschema1_myTbl3_log_seq           | M3                           |            10 | t
    6028 | emaj           | myschema1_mytbl2_log_seq           | M3                           |             2 | t
    6029 | emajb          | myschema1_mytbl2b_log_seq          | M3                           |             1 | f
    6038 | myschema2      | myseq1                             | M3                           |          1003 | t
    6039 | myschema2      | myTbl3_col31_seq                   | M3                           |            20 | t
    6040 | emaj           | myschema2_mytbl1_log_seq           | M3                           |            15 | t
    6041 | emaj           | myschema2_mytbl2_log_seq           | M3                           |             2 | t
    6042 | emajC          | myschema2_myTbl3_log_seq           | M3                           |            10 | t
    6043 | emaj           | myschema2_mytbl4_log_seq           | M3                           |             4 | t
    6044 | emaj           | myschema2_mytbl5_log_seq           | M3                           |             4 | t
    6045 | emaj           | myschema2_mytbl6_log_seq           | M3                           |            14 | t
    6048 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M2_%_START              |            15 | t
    6049 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M2_%_START              |             2 | t
    6050 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M2_%_START              |            10 | t
    6056 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M2_%_DONE               |            15 | t
    6057 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M2_%_DONE               |             2 | t
    6058 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M2_%_DONE               |            10 | t
    6064 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M3_%_START              |            15 | t
    6065 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M3_%_START              |             2 | t
    6066 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M3_%_START              |            10 | t
    6072 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M3_%_DONE               |            15 | t
    6073 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M3_%_DONE               |             2 | t
    6074 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M3_%_DONE               |            10 | t
    6078 | myschema1      | myTbl3_col31_seq                   | M4                           |            20 | t
    6079 | emajC          | myschema1_myTbl3_log_seq           | M4                           |            10 | t
    6080 | emaj           | myschema1_mytbl1_log_seq           | M4                           |            30 | t
    6081 | emaj           | myschema1_mytbl4_log_seq           | M4                           |             8 | t
    6082 | emaj           | myschema1_mytbl2_log_seq           | M4                           |             3 | t
    6083 | emajb          | myschema1_mytbl2b_log_seq          | M4                           |             1 | f
    6084 | myschema1      | myTbl3_col31_seq                   | M5                           |            20 | t
    6085 | emajC          | myschema1_myTbl3_log_seq           | M5                           |            20 | t
    6086 | emaj           | myschema1_mytbl1_log_seq           | M5                           |            30 | t
    6087 | emaj           | myschema1_mytbl4_log_seq           | M5                           |             8 | t
    6088 | emaj           | myschema1_mytbl2_log_seq           | M5                           |             3 | t
    6089 | emajb          | myschema1_mytbl2b_log_seq          | M5                           |             1 | f
    6091 | emajC          | myschema1_myTbl3_log_seq           | M6                           |            20 | t
    6094 | emaj           | myschema1_mytbl2_log_seq           | M6                           |             3 | t
    6095 | emajb          | myschema1_mytbl2b_log_seq          | M6                           |             1 | f
    6098 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M2_%_START              |            15 | t
    6099 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M2_%_START              |             2 | t
    6100 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M2_%_START              |            10 | t
    6106 | emaj           | myschema2_mytbl1_log_seq           | RLBK_M2_%_DONE               |            15 | t
    6107 | emaj           | myschema2_mytbl2_log_seq           | RLBK_M2_%_DONE               |             2 | t
    6108 | emajC          | myschema2_myTbl3_log_seq           | RLBK_M2_%_DONE               |            10 | t
    6112 | myschema1      | myTbl3_col31_seq                   | Before logged rollback to M4 |            20 | t
    6113 | emajC          | myschema1_myTbl3_log_seq           | Before logged rollback to M4 |            20 | t
    6114 | emaj           | myschema1_mytbl1_log_seq           | Before logged rollback to M4 |            32 | t
    6115 | emaj           | myschema1_mytbl4_log_seq           | Before logged rollback to M4 |            12 | t
    6116 | emaj           | myschema1_mytbl2_log_seq           | Before logged rollback to M4 |             3 | t
    6117 | emajb          | myschema1_mytbl2b_log_seq          | Before logged rollback to M4 |             1 | f
    6124 | myschema1      | myTbl3_col31_seq                   | STOP_%                       |            20 | t
    6125 | myschema2      | myseq1                             | STOP_%                       |          1004 | f
    6126 | myschema2      | myTbl3_col31_seq                   | STOP_%                       |            20 | t
    6127 | emajC          | myschema1_myTbl3_log_seq           | STOP_%                       |            35 | t
    6128 | emaj           | myschema1_mytbl1_log_seq           | STOP_%                       |            33 | t
    6129 | emaj           | myschema1_mytbl4_log_seq           | STOP_%                       |            14 | t
    6130 | emaj           | myschema1_mytbl2_log_seq           | STOP_%                       |             3 | t
    6131 | emajb          | myschema1_mytbl2b_log_seq          | STOP_%                       |             1 | f
    6132 | emaj           | myschema2_mytbl1_log_seq           | STOP_%                       |            15 | t
    6133 | emaj           | myschema2_mytbl2_log_seq           | STOP_%                       |             2 | t
    6134 | emajC          | myschema2_myTbl3_log_seq           | STOP_%                       |            10 | t
    6135 | emaj           | myschema2_mytbl4_log_seq           | STOP_%                       |            24 | t
    6136 | emaj           | myschema2_mytbl5_log_seq           | STOP_%                       |             9 | t
    6137 | emaj           | myschema2_mytbl6_log_seq           | STOP_%                       |            29 | t
    6155 | emajC          | myschema1_myTbl3_log_seq           | Multi-2                      |            35 | t
    6156 | emaj           | myschema1_mytbl1_log_seq           | Multi-2                      |            33 | t
    6157 | emaj           | myschema1_mytbl4_log_seq           | Multi-2                      |            14 | t
    6158 | emaj           | myschema1_mytbl2_log_seq           | Multi-2                      |             3 | t
    6159 | emajb          | myschema1_mytbl2b_log_seq          | Multi-2                      |             1 | f
    6160 | emaj           | myschema2_mytbl1_log_seq           | Multi-2                      |            15 | t
    6161 | emaj           | myschema2_mytbl2_log_seq           | Multi-2                      |             2 | t
    6162 | emajC          | myschema2_myTbl3_log_seq           | Multi-2                      |            10 | t
    6163 | emaj           | myschema2_mytbl4_log_seq           | Multi-2                      |            24 | t
    6164 | emaj           | myschema2_mytbl5_log_seq           | Multi-2                      |             9 | t
    6165 | emaj           | myschema2_mytbl6_log_seq           | Multi-2                      |            29 | t
    6169 | emajC          | myschema1_myTbl3_log_seq           | RLBK_Multi-1_%_START         |            35 | t
    6170 | emaj           | myschema1_mytbl1_log_seq           | RLBK_Multi-1_%_START         |            33 | t
    6171 | emaj           | myschema1_mytbl4_log_seq           | RLBK_Multi-1_%_START         |            14 | t
    6172 | emaj           | myschema1_mytbl2_log_seq           | RLBK_Multi-1_%_START         |             3 | t
    6173 | emajb          | myschema1_mytbl2b_log_seq          | RLBK_Multi-1_%_START         |             1 | f
    6174 | emaj           | myschema2_mytbl1_log_seq           | RLBK_Multi-1_%_START         |            15 | t
    6175 | emaj           | myschema2_mytbl2_log_seq           | RLBK_Multi-1_%_START         |             2 | t
    6176 | emajC          | myschema2_myTbl3_log_seq           | RLBK_Multi-1_%_START         |            10 | t
    6177 | emaj           | myschema2_mytbl4_log_seq           | RLBK_Multi-1_%_START         |            24 | t
    6178 | emaj           | myschema2_mytbl5_log_seq           | RLBK_Multi-1_%_START         |             9 | t
    6179 | emaj           | myschema2_mytbl6_log_seq           | RLBK_Multi-1_%_START         |            29 | t
    6183 | emajC          | myschema1_myTbl3_log_seq           | RLBK_Multi-1_%_DONE          |            35 | t
    6184 | emaj           | myschema1_mytbl1_log_seq           | RLBK_Multi-1_%_DONE          |            33 | t
    6185 | emaj           | myschema1_mytbl4_log_seq           | RLBK_Multi-1_%_DONE          |            14 | t
    6186 | emaj           | myschema1_mytbl2_log_seq           | RLBK_Multi-1_%_DONE          |             3 | t
    6187 | emajb          | myschema1_mytbl2b_log_seq          | RLBK_Multi-1_%_DONE          |             1 | f
    6188 | emaj           | myschema2_mytbl1_log_seq           | RLBK_Multi-1_%_DONE          |            15 | t
    6189 | emaj           | myschema2_mytbl2_log_seq           | RLBK_Multi-1_%_DONE          |             2 | t
    6190 | emajC          | myschema2_myTbl3_log_seq           | RLBK_Multi-1_%_DONE          |            10 | t
    6191 | emaj           | myschema2_mytbl4_log_seq           | RLBK_Multi-1_%_DONE          |            24 | t
    6192 | emaj           | myschema2_mytbl5_log_seq           | RLBK_Multi-1_%_DONE          |             9 | t
    6193 | emaj           | myschema2_mytbl6_log_seq           | RLBK_Multi-1_%_DONE          |            29 | t
    6194 | myschema1      | myTbl3_col31_seq                   | Stop after rollback          |            20 | t
    6195 | myschema2      | myseq1                             | Stop after rollback          |          1004 | f
    6196 | myschema2      | myTbl3_col31_seq                   | Stop after rollback          |            20 | t
    6197 | emajC          | myschema1_myTbl3_log_seq           | Stop after rollback          |            35 | t
    6198 | emaj           | myschema1_mytbl1_log_seq           | Stop after rollback          |            33 | t
    6199 | emaj           | myschema1_mytbl4_log_seq           | Stop after rollback          |            14 | t
    6200 | emaj           | myschema1_mytbl2_log_seq           | Stop after rollback          |             3 | t
    6201 | emajb          | myschema1_mytbl2b_log_seq          | Stop after rollback          |             1 | f
    6202 | emaj           | myschema2_mytbl1_log_seq           | Stop after rollback          |            15 | t
    6203 | emaj           | myschema2_mytbl2_log_seq           | Stop after rollback          |             2 | t
    6204 | emajC          | myschema2_myTbl3_log_seq           | Stop after rollback          |            10 | t
    6205 | emaj           | myschema2_mytbl4_log_seq           | Stop after rollback          |            24 | t
    6206 | emaj           | myschema2_mytbl5_log_seq           | Stop after rollback          |             9 | t
    6207 | emaj           | myschema2_mytbl6_log_seq           | Stop after rollback          |            29 | t
    6208 | myschema1      | myTbl3_col31_seq                   | Multi-1                      |            20 | t
    6209 | myschema2      | myseq1                             | Multi-1                      |          1004 | f
    6210 | myschema2      | myTbl3_col31_seq                   | Multi-1                      |            20 | t
    6211 | emajC          | myschema1_myTbl3_log_seq           | Multi-1                      |            35 | t
    6212 | emaj           | myschema1_mytbl1_log_seq           | Multi-1                      |            33 | t
    6213 | emaj           | myschema1_mytbl4_log_seq           | Multi-1                      |            14 | t
    6214 | emaj           | myschema1_mytbl2_log_seq           | Multi-1                      |             3 | t
    6215 | emajb          | myschema1_mytbl2b_log_seq          | Multi-1                      |             1 | f
    6216 | emaj           | myschema2_mytbl1_log_seq           | Multi-1                      |            15 | t
    6217 | emaj           | myschema2_mytbl2_log_seq           | Multi-1                      |             2 | t
    6218 | emajC          | myschema2_myTbl3_log_seq           | Multi-1                      |            10 | t
    6219 | emaj           | myschema2_mytbl4_log_seq           | Multi-1                      |            24 | t
    6220 | emaj           | myschema2_mytbl5_log_seq           | Multi-1                      |             9 | t
    6221 | emaj           | myschema2_mytbl6_log_seq           | Multi-1                      |            29 | t
    6244 | phil's schema3 | myTbl2\_col21_seq                  | M1_rollbackable              |             1 | f
    6245 | phil's schema3 | phil's seq\1                       | M1_rollbackable              |          1000 | f
    6246 | emaj           | phil's schema3_myTbl2\_log_seq     | M1_rollbackable              |             1 | f
    6247 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | M1_rollbackable              |             1 | f
    6248 | phil's schema3 | myTbl2\_col21_seq                  | M2_rollbackable              |             1 | f
    6249 | phil's schema3 | phil's seq\1                       | M2_rollbackable              |          1000 | t
    6250 | emaj           | phil's schema3_myTbl2\_log_seq     | M2_rollbackable              |             2 | t
    6251 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | M2_rollbackable              |            50 | t
    6256 | phil's schema3 | myTbl2\_col21_seq                  | phil's mark #3               |             1 | f
    6257 | phil's schema3 | phil's seq\1                       | phil's mark #3               |          1001 | t
    6258 | emaj           | phil's schema3_myTbl2\_log_seq     | phil's mark #3               |             2 | t
    6259 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | phil's mark #3               |            53 | t
    6262 | emaj           | phil's schema3_myTbl2\_log_seq     | RLBK_phil's mark #3_%_START  |             2 | t
    6263 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | RLBK_phil's mark #3_%_START  |            53 | t
    6266 | emaj           | phil's schema3_myTbl2\_log_seq     | RLBK_phil's mark #3_%_DONE   |             2 | t
    6267 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | RLBK_phil's mark #3_%_DONE   |            53 | t
(149 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 2010-01-01
     2 | DEF   | 
(2 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 | col12 | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------+------------+----------
(0 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | col23 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------+------------+----------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 | col45 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-------+-----------+------------+----------
(0 rows)

--
-----------------------------
-- Step 3 : stop myGroup2
-----------------------------
select emaj.emaj_stop_group('myGroup2');
 emaj_stop_group 
-----------------
               8
(1 row)

--
-----------------------------
-- test end: check and reset history
-----------------------------
select hist_id, hist_function, hist_event, hist_object, regexp_replace(regexp_replace(hist_wording,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'),E'\\[.+\\]','(timestamp)','g'), hist_user from 
  (select * from emaj.emaj_hist order by hist_id) as t;
 hist_id |   hist_function   |  hist_event  |         hist_object          |                 regexp_replace                 | hist_user 
---------+-------------------+--------------+------------------------------+------------------------------------------------+-----------
   10000 | SET_MARK_GROUP    | BEGIN        | myGroup2                     |                                                | postgres
   10001 | LOCK_GROUP        | BEGIN        | myGroup2                     |                                                | postgres
   10002 | LOCK_GROUP        | END          | myGroup2                     | 6 tables locked, 0 deadlock(s)                 | postgres
   10003 | SET_MARK_GROUP    | END          | myGroup2                     | After restore mark                             | postgres
   10004 | ROLLBACK_GROUP    | BEGIN        | myGroup2                     | Unlogged rollback to mark Multi-1 (timestamp)  | postgres
   10005 | LOCK_SESSION      | BEGIN        | myGroup2                     | Session #1                                     | postgres
   10006 | LOCK_SESSION      | END          | myGroup2                     | Session #1 : 6 tables locked, 0 deadlock(s)    | postgres
   10007 | ROLLBACK_TABLE    | BEGIN        | myschema2.mytbl1             | All log rows with emaj_gid > 12016             | postgres
   10008 | ROLLBACK_TABLE    | END          | myschema2.mytbl1             | 28 rollbacked rows                             | postgres
   10009 | ROLLBACK_TABLE    | BEGIN        | myschema2.mytbl2             | All log rows with emaj_gid > 12016             | postgres
   10010 | ROLLBACK_TABLE    | END          | myschema2.mytbl2             | 3 rollbacked rows                              | postgres
   10011 | ROLLBACK_TABLE    | BEGIN        | myschema2."myTbl3"           | All log rows with emaj_gid > 12016             | postgres
   10012 | ROLLBACK_TABLE    | END          | myschema2."myTbl3"           | 10 rollbacked rows                             | postgres
   10013 | ROLLBACK_TABLE    | BEGIN        | myschema2.mytbl4             | All log rows with emaj_gid > 12016             | postgres
   10014 | ROLLBACK_TABLE    | END          | myschema2.mytbl4             | 2 rollbacked rows                              | postgres
   10015 | ROLLBACK_TABLE    | BEGIN        | myschema2.mytbl5             | All log rows with emaj_gid > 12016             | postgres
   10016 | ROLLBACK_TABLE    | END          | myschema2.mytbl5             | 6 rollbacked rows                              | postgres
   10017 | ROLLBACK_TABLE    | BEGIN        | myschema2.mytbl6             | All log rows with emaj_gid > 12016             | postgres
   10018 | ROLLBACK_TABLE    | END          | myschema2.mytbl6             | 29 rollbacked rows                             | postgres
   10019 | ROLLBACK_GROUP    | MARK DELETED | myGroup2                     | mark After restore mark has been deleted       | postgres
   10020 | ROLLBACK_SEQUENCE |              | myschema2.myseq1             | RESTART 1004                                   | postgres
   10021 | ROLLBACK_SEQUENCE |              | myschema2."myTbl3_col31_seq" | RESTART 21                                     | postgres
   10022 | ROLLBACK_GROUP    | END          | myGroup2                     | 6 tables and 2 sequences effectively processed | postgres
   10023 | STOP_GROUP        | BEGIN        | myGroup2                     |                                                | postgres
   10024 | LOCK_GROUP        | BEGIN        | myGroup2                     |                                                | postgres
   10025 | LOCK_GROUP        | END          | myGroup2                     | 6 tables locked, 0 deadlock(s)                 | postgres
   10026 | SET_MARK_GROUP    | BEGIN        | myGroup2                     | STOP_%                                         | postgres
   10027 | SET_MARK_GROUP    | END          | myGroup2                     | STOP_%                                         | postgres
   10028 | STOP_GROUP        | END          | myGroup2                     | 8 tables/sequences processed                   | postgres
(29 rows)

--
truncate emaj.emaj_hist;
TRUNCATE TABLE
alter sequence emaj.emaj_hist_hist_id_seq restart 10000;
ALTER SEQUENCE
