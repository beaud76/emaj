-- adm1.sql : complex scenario executed by an emaj_adm role
--            playing with both myGroup1 and myGroup2 tables groups
--
SET datestyle TO ymd;
-----------------------------
-- grant emaj_adm role 
-----------------------------
grant emaj_adm to emaj_regression_tests_adm_user;
--
set role emaj_regression_tests_adm_user;
-----------------------------
-- authorized table accesses
-----------------------------
select count(*) from emaj.emaj_param;
 count 
-------
     3
(1 row)

select count(*) from emaj.emaj_hist;
 count 
-------
     0
(1 row)

select count(*) from emaj.emaj_group_def;
 count 
-------
    25
(1 row)

select count(*) from emaj.emaj_group;
 count 
-------
     4
(1 row)

select count(*) from emaj.emaj_relation;
 count 
-------
    21
(1 row)

select count(*) from emaj.emaj_mark;
 count 
-------
     7
(1 row)

select count(*) from emaj.emaj_sequence;
 count 
-------
    43
(1 row)

select count(*) from emaj.emaj_seq_hole;
 count 
-------
     3
(1 row)

select count(*) from emaj.emaj_rlbk_stat;
 count 
-------
     0
(1 row)

select count(*) from emaj.emaj_fk;
 count 
-------
     2
(1 row)

select count(*) from emaj.mySchema1_myTbl1_log;
 count 
-------
     0
(1 row)

-----------------------------
-- stop, reset and drop groups
-----------------------------
select emaj.emaj_stop_group('myGroup1');
WARNING:  _stop_group: Group myGroup1 cannot be stopped because it is not in logging state.
CONTEXT:  SQL statement "SELECT emaj._stop_groups(array[v_groupName], 'STOP_%', false, false)"
PL/pgSQL function "emaj_stop_group" line 13 at SQL statement
 emaj_stop_group 
-----------------
               0
(1 row)

select emaj.emaj_reset_group('myGroup1');
 emaj_reset_group 
------------------
                6
(1 row)

select emaj.emaj_drop_group('myGroup1');
 emaj_drop_group 
-----------------
               6
(1 row)

select emaj.emaj_force_drop_group('myGroup2');
 emaj_force_drop_group 
-----------------------
                     8
(1 row)

select emaj.emaj_stop_group('phil''s group#3",','Simple stop mark');
 emaj_stop_group 
-----------------
               4
(1 row)

select emaj.emaj_drop_group('phil''s group#3",');
 emaj_drop_group 
-----------------
               4
(1 row)

select emaj.emaj_force_stop_group('myGroup4');
 emaj_force_stop_group 
-----------------------
                     3
(1 row)

select emaj.emaj_drop_group('myGroup4');
 emaj_drop_group 
-----------------
               3
(1 row)

-- emaj tables
select * from emaj.emaj_group;
 group_name | group_state | group_nb_table | group_nb_sequence | group_is_rollbackable | group_creation_datetime | group_last_alter_datetime | group_pg_version | group_comment 
------------+-------------+----------------+-------------------+-----------------------+-------------------------+---------------------------+------------------+---------------
(0 rows)

select * from emaj.emaj_relation;
 rel_schema | rel_tblseq | rel_group | rel_priority | rel_log_schema | rel_log_dat_tsp | rel_log_idx_tsp | rel_kind | rel_session | rel_rows 
------------+------------+-----------+--------------+----------------+-----------------+-----------------+----------+-------------+----------
(0 rows)

select * from emaj.emaj_mark;
 mark_group | mark_name | mark_id | mark_datetime | mark_global_seq | mark_state | mark_comment | mark_txid | mark_last_sequence_id | mark_last_seq_hole_id | mark_log_rows_before_next 
------------+-----------+---------+---------------+-----------------+------------+--------------+-----------+-----------------------+-----------------------+---------------------------
(0 rows)

select * from emaj.emaj_sequence;
 sequ_id | sequ_schema | sequ_name | sequ_datetime | sequ_mark | sequ_last_val | sequ_start_val | sequ_increment | sequ_max_val | sequ_min_val | sequ_cache_val | sequ_is_cycled | sequ_is_called 
---------+-------------+-----------+---------------+-----------+---------------+----------------+----------------+--------------+--------------+----------------+----------------+----------------
(0 rows)

select * from emaj.emaj_fk;
 fk_groups | fk_session | fk_name | fk_schema | fk_table | fk_action | fk_def 
-----------+------------+---------+-----------+----------+-----------+--------
(0 rows)

select * from emaj.emaj_seq_hole;
 sqhl_id | sqhl_schema | sqhl_table | sqhl_datetime | sqhl_hole_size 
---------+-------------+------------+---------------+----------------
(0 rows)

select count(*) from emaj.emaj_rlbk_stat;
 count 
-------
     0
(1 row)

-----------------------------
-- cleanup application tables
-----------------------------
reset role;
truncate mySchema1.myTbl1, mySchema1.myTbl2, mySchema1."myTbl3", mySchema1.myTbl4, mySchema1.myTbl2b; 
truncate mySchema2.myTbl1, mySchema2.myTbl2, mySchema2."myTbl3", mySchema2.myTbl4, mySchema2.myTbl5, mySchema2.myTbl6, mySchema2.myTbl7, mySchema2.myTbl8;
insert into myschema2.myTbl7 select i from generate_series(0,100,1) i;
insert into myschema2.myTbl6 (col61) values (0);
insert into myschema2.myTbl8 (col81) values (0);
alter sequence mySchema2.mySeq1 restart 1000;
truncate mySchema4.myTblM, mySchema4.myTblC1, mySchema4.myTblC2;
-- starting from this point, disable the trigger on myTbl2
alter table mySchema1.myTbl2 disable trigger myTbl2trg;
set role emaj_regression_tests_adm_user;
-----------------------------
-- recreate and start groups
-----------------------------
select emaj.emaj_create_group('myGroup1');
NOTICE:  table "myschema1_myTbl3_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS "emajC"."myschema1_myTbl3_log""
PL/pgSQL function "_create_tbl" line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  trigger "myschema1_myTbl3_emaj_log_trg" for table "myTbl3" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS "myschema1_myTbl3_emaj_log_trg" ON myschema1."myTbl3""
PL/pgSQL function "_create_tbl" line 142 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  trigger "myschema1_myTbl3_emaj_trunc_trg" for table "myTbl3" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS "myschema1_myTbl3_emaj_trunc_trg" ON myschema1."myTbl3""
PL/pgSQL function "_create_tbl" line 150 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  table "myschema1_mytbl1_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema1_mytbl1_log"
PL/pgSQL function "_create_tbl" line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl1_emaj_log_trg" for table "mytbl1" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl1_emaj_log_trg ON myschema1.mytbl1"
PL/pgSQL function "_create_tbl" line 142 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl1_emaj_trunc_trg" for table "mytbl1" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl1_emaj_trunc_trg ON myschema1.mytbl1"
PL/pgSQL function "_create_tbl" line 150 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  table "myschema1_mytbl4_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema1_mytbl4_log"
PL/pgSQL function "_create_tbl" line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl4_emaj_log_trg" for table "mytbl4" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl4_emaj_log_trg ON myschema1.mytbl4"
PL/pgSQL function "_create_tbl" line 142 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl4_emaj_trunc_trg" for table "mytbl4" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl4_emaj_trunc_trg ON myschema1.mytbl4"
PL/pgSQL function "_create_tbl" line 150 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  table "myschema1_mytbl2_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema1_mytbl2_log"
PL/pgSQL function "_create_tbl" line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl2_emaj_log_trg" for table "mytbl2" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl2_emaj_log_trg ON myschema1.mytbl2"
PL/pgSQL function "_create_tbl" line 142 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl2_emaj_trunc_trg" for table "mytbl2" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl2_emaj_trunc_trg ON myschema1.mytbl2"
PL/pgSQL function "_create_tbl" line 150 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
WARNING:  _create_tbl: table myschema1.mytbl2 has triggers (mytbl2trg). Verify the compatibility with emaj rollback operations (in particular if triggers update one or several other tables). Triggers may have to be manualy disabled before rollback.
CONTEXT:  SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  table "myschema1_mytbl2b_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emajb.myschema1_mytbl2b_log"
PL/pgSQL function "_create_tbl" line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl2b_emaj_log_trg" for table "mytbl2b" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl2b_emaj_log_trg ON myschema1.mytbl2b"
PL/pgSQL function "_create_tbl" line 142 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl2b_emaj_trunc_trg" for table "mytbl2b" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl2b_emaj_trunc_trg ON myschema1.mytbl2b"
PL/pgSQL function "_create_tbl" line 150 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
PL/pgSQL function "emaj_create_group" line 7 at RETURN
 emaj_create_group 
-------------------
                 6
(1 row)

select emaj.emaj_comment_group('myGroup1','This is group #1');
 emaj_comment_group 
--------------------
 
(1 row)

select emaj.emaj_create_group('myGroup2',true);
NOTICE:  table "myschema2_mytbl1_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema2_mytbl1_log"
PL/pgSQL function "_create_tbl" line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl1_emaj_log_trg" for table "mytbl1" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl1_emaj_log_trg ON myschema2.mytbl1"
PL/pgSQL function "_create_tbl" line 142 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl1_emaj_trunc_trg" for table "mytbl1" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl1_emaj_trunc_trg ON myschema2.mytbl1"
PL/pgSQL function "_create_tbl" line 150 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  table "myschema2_mytbl2_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema2_mytbl2_log"
PL/pgSQL function "_create_tbl" line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl2_emaj_log_trg" for table "mytbl2" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl2_emaj_log_trg ON myschema2.mytbl2"
PL/pgSQL function "_create_tbl" line 142 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl2_emaj_trunc_trg" for table "mytbl2" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl2_emaj_trunc_trg ON myschema2.mytbl2"
PL/pgSQL function "_create_tbl" line 150 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  table "myschema2_myTbl3_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS "emajC"."myschema2_myTbl3_log""
PL/pgSQL function "_create_tbl" line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_myTbl3_emaj_log_trg" for table "myTbl3" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS "myschema2_myTbl3_emaj_log_trg" ON myschema2."myTbl3""
PL/pgSQL function "_create_tbl" line 142 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_myTbl3_emaj_trunc_trg" for table "myTbl3" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS "myschema2_myTbl3_emaj_trunc_trg" ON myschema2."myTbl3""
PL/pgSQL function "_create_tbl" line 150 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  table "myschema2_mytbl4_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema2_mytbl4_log"
PL/pgSQL function "_create_tbl" line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl4_emaj_log_trg" for table "mytbl4" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl4_emaj_log_trg ON myschema2.mytbl4"
PL/pgSQL function "_create_tbl" line 142 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl4_emaj_trunc_trg" for table "mytbl4" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl4_emaj_trunc_trg ON myschema2.mytbl4"
PL/pgSQL function "_create_tbl" line 150 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  table "myschema2_mytbl5_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema2_mytbl5_log"
PL/pgSQL function "_create_tbl" line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl5_emaj_log_trg" for table "mytbl5" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl5_emaj_log_trg ON myschema2.mytbl5"
PL/pgSQL function "_create_tbl" line 142 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl5_emaj_trunc_trg" for table "mytbl5" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl5_emaj_trunc_trg ON myschema2.mytbl5"
PL/pgSQL function "_create_tbl" line 150 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  table "myschema2_mytbl6_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema2_mytbl6_log"
PL/pgSQL function "_create_tbl" line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl6_emaj_log_trg" for table "mytbl6" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl6_emaj_log_trg ON myschema2.mytbl6"
PL/pgSQL function "_create_tbl" line 142 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl6_emaj_trunc_trg" for table "mytbl6" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl6_emaj_trunc_trg ON myschema2.mytbl6"
PL/pgSQL function "_create_tbl" line 150 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function "emaj_create_group" line 88 at PERFORM
WARNING:  _check_fk_groups: Foreign key mytbl6_col61_fkey, from table myschema2.mytbl6, references myschema2.mytbl7 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups (array[v_groupName])"
PL/pgSQL function "emaj_create_group" line 114 at PERFORM
WARNING:  _check_fk_groups: table myschema2.mytbl6 is referenced by foreign key mytbl8_col81_fkey from table myschema2.mytbl8 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups (array[v_groupName])"
PL/pgSQL function "emaj_create_group" line 114 at PERFORM
 emaj_create_group 
-------------------
                 8
(1 row)

select emaj.emaj_start_group('myGroup1','M1');
 emaj_start_group 
------------------
                6
(1 row)

select emaj.emaj_start_group('myGroup2','M1');
WARNING:  _check_fk_groups: Foreign key mytbl6_col61_fkey, from table myschema2.mytbl6, references myschema2.mytbl7 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(array[v_groupNames[v_i]])"
PL/pgSQL function "_start_groups" line 46 at PERFORM
SQL statement "SELECT emaj._start_groups(array[v_groupName], v_mark, false, v_resetLog)"
PL/pgSQL function "emaj_start_group" line 17 at SQL statement
PL/pgSQL function "emaj_start_group" line 6 at RETURN
WARNING:  _check_fk_groups: table myschema2.mytbl6 is referenced by foreign key mytbl8_col81_fkey from table myschema2.mytbl8 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(array[v_groupNames[v_i]])"
PL/pgSQL function "_start_groups" line 46 at PERFORM
SQL statement "SELECT emaj._start_groups(array[v_groupName], v_mark, false, v_resetLog)"
PL/pgSQL function "emaj_start_group" line 17 at SQL statement
PL/pgSQL function "emaj_start_group" line 6 at RETURN
 emaj_start_group 
------------------
                8
(1 row)

-----------------------------
-- Step 1 : for myGroup1, update tables and set 2 marks
-----------------------------
-- check how truncate reacts (must be blocked in pg 8.4+) - tables are empty anyway
truncate myschema1.mytbl1 cascade;
NOTICE:  truncate cascades to table "mytbl4"
ERROR:  emaj._forbid_truncate_fnct: TRUNCATE is not allowed while updates on this table (myschema1.mytbl1) are currently protected by E-Maj. Consider stopping the group before issuing a TRUNCATE.
-- 
set search_path=myschema1;
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
insert into myTbl2 values (1,'ABC','2010-12-31');
delete from myTbl1 where col11 > 10;
insert into myTbl2 values (2,'DEF',NULL);
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
--
select emaj.emaj_set_mark_group('myGroup1','M2');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

--
set search_path=myschema1;
insert into myTbl4 values (1,'FK...',1,1,'ABC');
insert into myTbl4 values (2,'FK...',1,1,'ABC');
update myTbl4 set col43 = 2;
insert into myTbl4 values (3,'FK...',1,10,'ABC');
-- the 2 next statements activate fkey on delete and on update clauses 
delete from myTbl1 where col11 = 10;
update myTbl1 set col12='DEF' where col11 <= 2;
--
select emaj.emaj_set_mark_group('myGroup1','M3');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

select emaj.emaj_comment_mark_group('myGroup1','M3','Third mark set');
 emaj_comment_mark_group 
-------------------------
 
(1 row)

-----------------------------
-- Checking step 1
-----------------------------
-- emaj tables
select group_name, group_state, group_nb_table, group_nb_sequence, group_is_rollbackable, group_comment 
from emaj.emaj_group order by group_nb_table;
 group_name | group_state | group_nb_table | group_nb_sequence | group_is_rollbackable |  group_comment   
------------+-------------+----------------+-------------------+-----------------------+------------------
 myGroup1   | LOGGING     |              5 |                 1 | t                     | This is group #1
 myGroup2   | LOGGING     |              6 |                 2 | t                     | 
(2 rows)

select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace | mark_global_seq | mark_state |  mark_comment  | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+----------------+-----------------+------------+----------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1             |           11842 | ACTIVE     |                |                   599 |                  6009 |                        27
     602 | myGroup2   | M1             |           11842 | ACTIVE     |                |                   599 |                  6017 |                          
     603 | myGroup1   | M2             |           11869 | ACTIVE     |                |                   599 |                  6023 |                        11
     604 | myGroup1   | M3             |           11880 | ACTIVE     | Third mark set |                   599 |                  6029 |                          
(4 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+----------------+---------------+----------------
    6004 | myschema1   | myTbl3_col31_seq          | M1             |            11 | f
    6005 | emajC       | myschema1_myTbl3_log_seq  | M1             |             1 | f
    6006 | emaj        | myschema1_mytbl1_log_seq  | M1             |             1 | f
    6007 | emaj        | myschema1_mytbl4_log_seq  | M1             |             1 | f
    6008 | emaj        | myschema1_mytbl2_log_seq  | M1             |             1 | f
    6009 | emajb       | myschema1_mytbl2b_log_seq | M1             |             1 | f
    6010 | myschema2   | myseq1                    | M1             |          1000 | f
    6011 | myschema2   | myTbl3_col31_seq          | M1             |            10 | t
    6012 | emaj        | myschema2_mytbl1_log_seq  | M1             |             1 | f
    6013 | emaj        | myschema2_mytbl2_log_seq  | M1             |             1 | f
    6014 | emajC       | myschema2_myTbl3_log_seq  | M1             |             1 | f
    6015 | emaj        | myschema2_mytbl4_log_seq  | M1             |             1 | f
    6016 | emaj        | myschema2_mytbl5_log_seq  | M1             |             1 | f
    6017 | emaj        | myschema2_mytbl6_log_seq  | M1             |             1 | f
    6018 | myschema1   | myTbl3_col31_seq          | M2             |            20 | t
    6019 | emajC       | myschema1_myTbl3_log_seq  | M2             |            10 | t
    6020 | emaj        | myschema1_mytbl1_log_seq  | M2             |            15 | t
    6021 | emaj        | myschema1_mytbl4_log_seq  | M2             |             1 | f
    6022 | emaj        | myschema1_mytbl2_log_seq  | M2             |             2 | t
    6023 | emajb       | myschema1_mytbl2b_log_seq | M2             |             1 | f
    6024 | myschema1   | myTbl3_col31_seq          | M3             |            20 | t
    6025 | emajC       | myschema1_myTbl3_log_seq  | M3             |            10 | t
    6026 | emaj        | myschema1_mytbl1_log_seq  | M3             |            18 | t
    6027 | emaj        | myschema1_mytbl4_log_seq  | M3             |             8 | t
    6028 | emaj        | myschema1_mytbl2_log_seq  | M3             |             2 | t
    6029 | emajb       | myschema1_mytbl2b_log_seq | M3             |             1 | f
(26 rows)

-- user tables
select * from mySchema1.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | DEF        | \x1c
     2 | DEF        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
(9 rows)

select * from mySchema1.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 12-31-2010
     2 | DEF   | 
(2 rows)

select * from mySchema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

select col31,col33 from mySchema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
     1 | FK... |     2 |     1 | 
     2 | FK... |     2 |     1 | 
(2 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid, emaj_user, emaj_user_ip from emaj.mySchema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid | emaj_user | emaj_user_ip 
-------+------------+-------+-----------+------------+----------+-----------+--------------
     1 | ABC        | \x0c  | INS       | NEW        |    11843 | postgres  | 
     2 | ABC        | \x0c  | INS       | NEW        |    11844 | postgres  | 
     3 | ABC        | \x0c  | INS       | NEW        |    11845 | postgres  | 
     4 | ABC        | \x0c  | INS       | NEW        |    11846 | postgres  | 
     5 | ABC        | \x0c  | INS       | NEW        |    11847 | postgres  | 
     6 | ABC        | \x0c  | INS       | NEW        |    11848 | postgres  | 
     7 | ABC        | \x0c  | INS       | NEW        |    11849 | postgres  | 
     8 | ABC        | \x0c  | INS       | NEW        |    11850 | postgres  | 
     9 | ABC        | \x0c  | INS       | NEW        |    11851 | postgres  | 
    10 | ABC        | \x0c  | INS       | NEW        |    11852 | postgres  | 
    11 | ABC        | \x0c  | INS       | NEW        |    11853 | postgres  | 
     1 | ABC        | \x0c  | UPD       | OLD        |    11854 | postgres  | 
     1 | ABC        | \x1c  | UPD       | NEW        |    11854 | postgres  | 
     2 | ABC        | \x0c  | UPD       | OLD        |    11855 | postgres  | 
     2 | ABC        | \x1c  | UPD       | NEW        |    11855 | postgres  | 
     3 | ABC        | \x0c  | UPD       | OLD        |    11856 | postgres  | 
     3 | ABC        | \x1c  | UPD       | NEW        |    11856 | postgres  | 
    11 | ABC        | \x0c  | DEL       | OLD        |    11858 | postgres  | 
    10 | ABC        | \x0c  | DEL       | OLD        |    11875 | postgres  | 
     1 | ABC        | \x1c  | UPD       | OLD        |    11877 | postgres  | 
     1 | DEF        | \x1c  | UPD       | NEW        |    11877 | postgres  | 
     2 | ABC        | \x1c  | UPD       | OLD        |    11878 | postgres  | 
     2 | DEF        | \x1c  | UPD       | NEW        |    11878 | postgres  | 
(23 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid, emaj_user, emaj_user_ip from emaj.mySchema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid | emaj_user | emaj_user_ip 
-------+-------+------------+-----------+------------+----------+-----------+--------------
     1 | ABC   | 12-31-2010 | INS       | NEW        |    11857 | postgres  | 
     2 | DEF   |            | INS       | NEW        |    11859 | postgres  | 
(2 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid, emaj_user, emaj_user_ip from emajb.mySchema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid | emaj_user | emaj_user_ip 
-------+-------+-----------+------------+----------+-----------+--------------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid, emaj_user, emaj_user_ip from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid | emaj_user | emaj_user_ip 
-------+-------+-----------+------------+----------+-----------+--------------
    11 | 10.00 | INS       | NEW        |    11860 | postgres  | 
    12 | 10.00 | INS       | NEW        |    11861 | postgres  | 
    13 | 10.00 | INS       | NEW        |    11862 | postgres  | 
    14 | 10.00 | INS       | NEW        |    11863 | postgres  | 
    15 | 10.00 | INS       | NEW        |    11864 | postgres  | 
    16 | 10.00 | INS       | NEW        |    11865 | postgres  | 
    17 | 10.00 | INS       | NEW        |    11866 | postgres  | 
    18 | 10.00 | INS       | NEW        |    11867 | postgres  | 
    19 | 10.00 | INS       | NEW        |    11868 | postgres  | 
    20 | 10.00 | INS       | NEW        |    11869 | postgres  | 
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid, emaj_user, emaj_user_ip from emaj.mySchema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid | emaj_user | emaj_user_ip 
-------+-------+-------+-------+------------+-----------+------------+----------+-----------+--------------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11870 | postgres  | 
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11871 | postgres  | 
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11872 | postgres  | 
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11872 | postgres  | 
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11873 | postgres  | 
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11873 | postgres  | 
     3 | FK... |     1 |    10 | ABC        | INS       | NEW        |    11874 | postgres  | 
     3 | FK... |     1 |    10 | ABC        | DEL       | OLD        |    11876 | postgres  | 
     1 | FK... |     2 |     1 | ABC        | UPD       | OLD        |    11879 | postgres  | 
     1 | FK... |     2 |     1 |            | UPD       | NEW        |    11879 | postgres  | 
     2 | FK... |     2 |     1 | ABC        | UPD       | OLD        |    11880 | postgres  | 
     2 | FK... |     2 |     1 |            | UPD       | NEW        |    11880 | postgres  | 
(12 rows)

-----------------------------
-- Step 2 : for myGroup2, start, update tables and set 2 marks 
-----------------------------
set search_path=myschema2;
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
insert into myTbl2 values (1,'ABC','2010-01-01');
delete from myTbl1 where col11 > 10;
select nextval('myschema2.myseq1');
 nextval 
---------
    1000
(1 row)

insert into myTbl2 values (2,'DEF',NULL);
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
insert into myTbl5 values (1,'{"abc","def","ghi"}','{1,2,3}',NULL);
insert into myTbl5 values (2,array['abc','def','ghi'],array[3,4,5],array['2000/02/01'::date,'2000/02/28'::date]);
update myTbl5 set col54 = '{"2010/11/28","2010/12/03"}' where col54 is null;
insert into myTbl6 select i, point(i,1.3), '((0,0),(2,2))', circle(point(5,5),i),'((-2,-2),(3,0),(1,4))','10.20.30.40/27' from generate_series (1,8) as i;
update myTbl6 set col64 = '<(5,6),3.5>', col65 = null where col61 between 1 and 3;
--
select emaj.emaj_set_mark_group('myGroup2','M2');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

--
set search_path=myschema2;
select nextval('myschema2.myseq1');
 nextval 
---------
    1001
(1 row)

select nextval('myschema2.myseq1');
 nextval 
---------
    1002
(1 row)

select nextval('myschema2.myseq1');
 nextval 
---------
    1003
(1 row)

--
reset role;
alter sequence mySeq1 NO MAXVALUE NO CYCLE;
set role emaj_regression_tests_adm_user;
--
insert into myTbl4 values (1,'FK...',1,1,'ABC');
insert into myTbl4 values (2,'FK...',1,1,'ABC');
update myTbl4 set col43 = 2;
delete from mytbl5 where 4 = any(col53);
delete from myTbl6 where col65 is null and col61 <> 0;
--
select emaj.emaj_set_mark_group('myGroup2','M3');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

-----------------------------
-- Checking step 2
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace | mark_global_seq | mark_state |  mark_comment  | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+----------------+-----------------+------------+----------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1             |           11842 | ACTIVE     |                |                   599 |                  6009 |                        27
     602 | myGroup2   | M1             |           11842 | ACTIVE     |                |                   599 |                  6017 |                        41
     603 | myGroup1   | M2             |           11869 | ACTIVE     |                |                   599 |                  6023 |                        11
     604 | myGroup1   | M3             |           11880 | ACTIVE     | Third mark set |                   599 |                  6029 |                          
     605 | myGroup2   | M2             |           11921 | ACTIVE     |                |                   599 |                  6037 |                         8
     606 | myGroup2   | M3             |           11929 | ACTIVE     |                |                   599 |                  6045 |                          
(6 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+----------------+---------------+----------------
    6004 | myschema1   | myTbl3_col31_seq          | M1             |            11 | f
    6005 | emajC       | myschema1_myTbl3_log_seq  | M1             |             1 | f
    6006 | emaj        | myschema1_mytbl1_log_seq  | M1             |             1 | f
    6007 | emaj        | myschema1_mytbl4_log_seq  | M1             |             1 | f
    6008 | emaj        | myschema1_mytbl2_log_seq  | M1             |             1 | f
    6009 | emajb       | myschema1_mytbl2b_log_seq | M1             |             1 | f
    6010 | myschema2   | myseq1                    | M1             |          1000 | f
    6011 | myschema2   | myTbl3_col31_seq          | M1             |            10 | t
    6012 | emaj        | myschema2_mytbl1_log_seq  | M1             |             1 | f
    6013 | emaj        | myschema2_mytbl2_log_seq  | M1             |             1 | f
    6014 | emajC       | myschema2_myTbl3_log_seq  | M1             |             1 | f
    6015 | emaj        | myschema2_mytbl4_log_seq  | M1             |             1 | f
    6016 | emaj        | myschema2_mytbl5_log_seq  | M1             |             1 | f
    6017 | emaj        | myschema2_mytbl6_log_seq  | M1             |             1 | f
    6018 | myschema1   | myTbl3_col31_seq          | M2             |            20 | t
    6019 | emajC       | myschema1_myTbl3_log_seq  | M2             |            10 | t
    6020 | emaj        | myschema1_mytbl1_log_seq  | M2             |            15 | t
    6021 | emaj        | myschema1_mytbl4_log_seq  | M2             |             1 | f
    6022 | emaj        | myschema1_mytbl2_log_seq  | M2             |             2 | t
    6023 | emajb       | myschema1_mytbl2b_log_seq | M2             |             1 | f
    6024 | myschema1   | myTbl3_col31_seq          | M3             |            20 | t
    6025 | emajC       | myschema1_myTbl3_log_seq  | M3             |            10 | t
    6026 | emaj        | myschema1_mytbl1_log_seq  | M3             |            18 | t
    6027 | emaj        | myschema1_mytbl4_log_seq  | M3             |             8 | t
    6028 | emaj        | myschema1_mytbl2_log_seq  | M3             |             2 | t
    6029 | emajb       | myschema1_mytbl2b_log_seq | M3             |             1 | f
    6030 | myschema2   | myseq1                    | M2             |          1000 | t
    6031 | myschema2   | myTbl3_col31_seq          | M2             |            20 | t
    6032 | emaj        | myschema2_mytbl1_log_seq  | M2             |            15 | t
    6033 | emaj        | myschema2_mytbl2_log_seq  | M2             |             2 | t
    6034 | emajC       | myschema2_myTbl3_log_seq  | M2             |            10 | t
    6035 | emaj        | myschema2_mytbl4_log_seq  | M2             |             1 | f
    6036 | emaj        | myschema2_mytbl5_log_seq  | M2             |             3 | t
    6037 | emaj        | myschema2_mytbl6_log_seq  | M2             |            11 | t
    6038 | myschema2   | myseq1                    | M3             |          1003 | t
    6039 | myschema2   | myTbl3_col31_seq          | M3             |            20 | t
    6040 | emaj        | myschema2_mytbl1_log_seq  | M3             |            15 | t
    6041 | emaj        | myschema2_mytbl2_log_seq  | M3             |             2 | t
    6042 | emajC       | myschema2_myTbl3_log_seq  | M3             |            10 | t
    6043 | emaj        | myschema2_mytbl4_log_seq  | M3             |             4 | t
    6044 | emaj        | myschema2_mytbl5_log_seq  | M3             |             4 | t
    6045 | emaj        | myschema2_mytbl6_log_seq  | M3             |            14 | t
(42 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 01-01-2010
     2 | DEF   | 
(2 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

select * from mySchema2.myTbl5 order by col51;
 col51 |     col52     |  col53  |          col54          
-------+---------------+---------+-------------------------
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010}
(1 row)

select * from mySchema2.myTbl6 order by col61;
 col61 |  col62  |    col63    |   col64   |         col65         |     col66      
-------+---------+-------------+-----------+-----------------------+----------------
     0 |         |             |           |                       | 
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
(6 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    11881
     2 | ABC        | \x0c  | INS       | NEW        |    11882
     3 | ABC        | \x0c  | INS       | NEW        |    11883
     4 | ABC        | \x0c  | INS       | NEW        |    11884
     5 | ABC        | \x0c  | INS       | NEW        |    11885
     6 | ABC        | \x0c  | INS       | NEW        |    11886
     7 | ABC        | \x0c  | INS       | NEW        |    11887
     8 | ABC        | \x0c  | INS       | NEW        |    11888
     9 | ABC        | \x0c  | INS       | NEW        |    11889
    10 | ABC        | \x0c  | INS       | NEW        |    11890
    11 | ABC        | \x0c  | INS       | NEW        |    11891
     1 | ABC        | \x0c  | UPD       | OLD        |    11892
     1 | ABC        | \x1c  | UPD       | NEW        |    11892
     2 | ABC        | \x0c  | UPD       | OLD        |    11893
     2 | ABC        | \x1c  | UPD       | NEW        |    11893
     3 | ABC        | \x0c  | UPD       | OLD        |    11894
     3 | ABC        | \x1c  | UPD       | NEW        |    11894
    11 | ABC        | \x0c  | DEL       | OLD        |    11896
(18 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 01-01-2010 | INS       | NEW        |    11895
     2 | DEF   |            | INS       | NEW        |    11897
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | INS       | NEW        |    11898
    12 | 10.00 | INS       | NEW        |    11899
    13 | 10.00 | INS       | NEW        |    11900
    14 | 10.00 | INS       | NEW        |    11901
    15 | 10.00 | INS       | NEW        |    11902
    16 | 10.00 | INS       | NEW        |    11903
    17 | 10.00 | INS       | NEW        |    11904
    18 | 10.00 | INS       | NEW        |    11905
    19 | 10.00 | INS       | NEW        |    11906
    20 | 10.00 | INS       | NEW        |    11907
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11922
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11923
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11924
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11924
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11925
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11925
(6 rows)

select col51, col52, col53, col54, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl5_log order by emaj_gid, emaj_tuple desc;
 col51 |     col52     |  col53  |          col54          | emaj_verb | emaj_tuple | emaj_gid 
-------+---------------+---------+-------------------------+-----------+------------+----------
     1 | {abc,def,ghi} | {1,2,3} |                         | INS       | NEW        |    11908
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | INS       | NEW        |    11909
     1 | {abc,def,ghi} | {1,2,3} |                         | UPD       | OLD        |    11910
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010} | UPD       | NEW        |    11910
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | DEL       | OLD        |    11926
(5 rows)

select col61, col62, col63, col64, col65, col66, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl6_log order by emaj_gid, emaj_tuple desc;
 col61 |  col62  |    col63    |    col64    |         col65         |     col66      | emaj_verb | emaj_tuple | emaj_gid 
-------+---------+-------------+-------------+-----------------------+----------------+-----------+------------+----------
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11911
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11912
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11913
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11914
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11915
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11916
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11917
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11918
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11919
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11919
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11920
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11920
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11921
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11921
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11927
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11928
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11929
(17 rows)

-----------------------------
-- Step 3 : for myGroup2, double logged rollback then delete first mark 
-----------------------------
reset role;
analyze mytbl4;
set role emaj_regression_tests_adm_user;
select emaj.emaj_logged_rollback_group('myGroup2','M2');
WARNING:  _check_fk_groups: Foreign key mytbl6_col61_fkey, from table myschema2.mytbl6, references myschema2.mytbl7 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_groups_step1" line 74 at PERFORM
SQL statement "SELECT emaj._rlbk_groups_step1(v_groupNames, v_mark, v_unloggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 12 at RETURN
WARNING:  _check_fk_groups: table myschema2.mytbl6 is referenced by foreign key mytbl8_col81_fkey from table myschema2.mytbl8 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_groups_step1" line 74 at PERFORM
SQL statement "SELECT emaj._rlbk_groups_step1(v_groupNames, v_mark, v_unloggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 12 at RETURN
 emaj_logged_rollback_group 
----------------------------
                          5
(1 row)

select emaj.emaj_logged_rollback_group('myGroup2','M3');
WARNING:  _check_fk_groups: Foreign key mytbl6_col61_fkey, from table myschema2.mytbl6, references myschema2.mytbl7 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_groups_step1" line 74 at PERFORM
SQL statement "SELECT emaj._rlbk_groups_step1(v_groupNames, v_mark, v_unloggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 12 at RETURN
WARNING:  _check_fk_groups: table myschema2.mytbl6 is referenced by foreign key mytbl8_col81_fkey from table myschema2.mytbl8 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_groups_step1" line 74 at PERFORM
SQL statement "SELECT emaj._rlbk_groups_step1(v_groupNames, v_mark, v_unloggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 12 at RETURN
 emaj_logged_rollback_group 
----------------------------
                          5
(1 row)

-----------------------------
-- Checking step 3
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace  | mark_global_seq | mark_state |  mark_comment  | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+-----------------+-----------------+------------+----------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1              |           11842 | ACTIVE     |                |                   599 |                  6009 |                        27
     602 | myGroup2   | M1              |           11842 | ACTIVE     |                |                   599 |                  6017 |                        41
     603 | myGroup1   | M2              |           11869 | ACTIVE     |                |                   599 |                  6023 |                        11
     604 | myGroup1   | M3              |           11880 | ACTIVE     | Third mark set |                   599 |                  6029 |                          
     605 | myGroup2   | M2              |           11921 | ACTIVE     |                |                   599 |                  6037 |                         8
     606 | myGroup2   | M3              |           11929 | ACTIVE     |                |                   599 |                  6045 |                         0
     607 | myGroup2   | RLBK_M2_%_START |           11929 | ACTIVE     |                |                   599 |                  6053 |                         8
     608 | myGroup2   | RLBK_M2_%_DONE  |           11937 | ACTIVE     |                |                   599 |                  6061 |                         0
     609 | myGroup2   | RLBK_M3_%_START |           11937 | ACTIVE     |                |                   599 |                  6069 |                         8
     610 | myGroup2   | RLBK_M3_%_DONE  |           11945 | ACTIVE     |                |                   599 |                  6077 |                          
(10 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace  | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+-----------------+---------------+----------------
    6004 | myschema1   | myTbl3_col31_seq          | M1              |            11 | f
    6005 | emajC       | myschema1_myTbl3_log_seq  | M1              |             1 | f
    6006 | emaj        | myschema1_mytbl1_log_seq  | M1              |             1 | f
    6007 | emaj        | myschema1_mytbl4_log_seq  | M1              |             1 | f
    6008 | emaj        | myschema1_mytbl2_log_seq  | M1              |             1 | f
    6009 | emajb       | myschema1_mytbl2b_log_seq | M1              |             1 | f
    6010 | myschema2   | myseq1                    | M1              |          1000 | f
    6011 | myschema2   | myTbl3_col31_seq          | M1              |            10 | t
    6012 | emaj        | myschema2_mytbl1_log_seq  | M1              |             1 | f
    6013 | emaj        | myschema2_mytbl2_log_seq  | M1              |             1 | f
    6014 | emajC       | myschema2_myTbl3_log_seq  | M1              |             1 | f
    6015 | emaj        | myschema2_mytbl4_log_seq  | M1              |             1 | f
    6016 | emaj        | myschema2_mytbl5_log_seq  | M1              |             1 | f
    6017 | emaj        | myschema2_mytbl6_log_seq  | M1              |             1 | f
    6018 | myschema1   | myTbl3_col31_seq          | M2              |            20 | t
    6019 | emajC       | myschema1_myTbl3_log_seq  | M2              |            10 | t
    6020 | emaj        | myschema1_mytbl1_log_seq  | M2              |            15 | t
    6021 | emaj        | myschema1_mytbl4_log_seq  | M2              |             1 | f
    6022 | emaj        | myschema1_mytbl2_log_seq  | M2              |             2 | t
    6023 | emajb       | myschema1_mytbl2b_log_seq | M2              |             1 | f
    6024 | myschema1   | myTbl3_col31_seq          | M3              |            20 | t
    6025 | emajC       | myschema1_myTbl3_log_seq  | M3              |            10 | t
    6026 | emaj        | myschema1_mytbl1_log_seq  | M3              |            18 | t
    6027 | emaj        | myschema1_mytbl4_log_seq  | M3              |             8 | t
    6028 | emaj        | myschema1_mytbl2_log_seq  | M3              |             2 | t
    6029 | emajb       | myschema1_mytbl2b_log_seq | M3              |             1 | f
    6030 | myschema2   | myseq1                    | M2              |          1000 | t
    6031 | myschema2   | myTbl3_col31_seq          | M2              |            20 | t
    6032 | emaj        | myschema2_mytbl1_log_seq  | M2              |            15 | t
    6033 | emaj        | myschema2_mytbl2_log_seq  | M2              |             2 | t
    6034 | emajC       | myschema2_myTbl3_log_seq  | M2              |            10 | t
    6035 | emaj        | myschema2_mytbl4_log_seq  | M2              |             1 | f
    6036 | emaj        | myschema2_mytbl5_log_seq  | M2              |             3 | t
    6037 | emaj        | myschema2_mytbl6_log_seq  | M2              |            11 | t
    6038 | myschema2   | myseq1                    | M3              |          1003 | t
    6039 | myschema2   | myTbl3_col31_seq          | M3              |            20 | t
    6040 | emaj        | myschema2_mytbl1_log_seq  | M3              |            15 | t
    6041 | emaj        | myschema2_mytbl2_log_seq  | M3              |             2 | t
    6042 | emajC       | myschema2_myTbl3_log_seq  | M3              |            10 | t
    6043 | emaj        | myschema2_mytbl4_log_seq  | M3              |             4 | t
    6044 | emaj        | myschema2_mytbl5_log_seq  | M3              |             4 | t
    6045 | emaj        | myschema2_mytbl6_log_seq  | M3              |            14 | t
    6046 | myschema2   | myseq1                    | RLBK_M2_%_START |          1003 | t
    6047 | myschema2   | myTbl3_col31_seq          | RLBK_M2_%_START |            20 | t
    6048 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
    6049 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
    6050 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
    6051 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M2_%_START |             4 | t
    6052 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M2_%_START |             4 | t
    6053 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M2_%_START |            14 | t
    6054 | myschema2   | myseq1                    | RLBK_M2_%_DONE  |          1001 | f
    6055 | myschema2   | myTbl3_col31_seq          | RLBK_M2_%_DONE  |            20 | t
    6056 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
    6057 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
    6058 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
    6059 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M2_%_DONE  |             8 | t
    6060 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M2_%_DONE  |             5 | t
    6061 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M2_%_DONE  |            17 | t
    6062 | myschema2   | myseq1                    | RLBK_M3_%_START |          1001 | f
    6063 | myschema2   | myTbl3_col31_seq          | RLBK_M3_%_START |            20 | t
    6064 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_START |            15 | t
    6065 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_START |             2 | t
    6066 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_START |            10 | t
    6067 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M3_%_START |             8 | t
    6068 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M3_%_START |             5 | t
    6069 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M3_%_START |            17 | t
    6070 | myschema2   | myseq1                    | RLBK_M3_%_DONE  |          1004 | f
    6071 | myschema2   | myTbl3_col31_seq          | RLBK_M3_%_DONE  |            20 | t
    6072 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_DONE  |            15 | t
    6073 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_DONE  |             2 | t
    6074 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_DONE  |            10 | t
    6075 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M3_%_DONE  |            12 | t
    6076 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M3_%_DONE  |             6 | t
    6077 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M3_%_DONE  |            20 | t
(74 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 01-01-2010
     2 | DEF   | 
(2 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

select * from mySchema2.myTbl5 order by col51;
 col51 |     col52     |  col53  |          col54          
-------+---------------+---------+-------------------------
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010}
(1 row)

select * from mySchema2.myTbl6 order by col61;
 col61 |  col62  |    col63    |   col64   |         col65         |     col66      
-------+---------+-------------+-----------+-----------------------+----------------
     0 |         |             |           |                       | 
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
(6 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    11881
     2 | ABC        | \x0c  | INS       | NEW        |    11882
     3 | ABC        | \x0c  | INS       | NEW        |    11883
     4 | ABC        | \x0c  | INS       | NEW        |    11884
     5 | ABC        | \x0c  | INS       | NEW        |    11885
     6 | ABC        | \x0c  | INS       | NEW        |    11886
     7 | ABC        | \x0c  | INS       | NEW        |    11887
     8 | ABC        | \x0c  | INS       | NEW        |    11888
     9 | ABC        | \x0c  | INS       | NEW        |    11889
    10 | ABC        | \x0c  | INS       | NEW        |    11890
    11 | ABC        | \x0c  | INS       | NEW        |    11891
     1 | ABC        | \x0c  | UPD       | OLD        |    11892
     1 | ABC        | \x1c  | UPD       | NEW        |    11892
     2 | ABC        | \x0c  | UPD       | OLD        |    11893
     2 | ABC        | \x1c  | UPD       | NEW        |    11893
     3 | ABC        | \x0c  | UPD       | OLD        |    11894
     3 | ABC        | \x1c  | UPD       | NEW        |    11894
    11 | ABC        | \x0c  | DEL       | OLD        |    11896
(18 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 01-01-2010 | INS       | NEW        |    11895
     2 | DEF   |            | INS       | NEW        |    11897
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | INS       | NEW        |    11898
    12 | 10.00 | INS       | NEW        |    11899
    13 | 10.00 | INS       | NEW        |    11900
    14 | 10.00 | INS       | NEW        |    11901
    15 | 10.00 | INS       | NEW        |    11902
    16 | 10.00 | INS       | NEW        |    11903
    17 | 10.00 | INS       | NEW        |    11904
    18 | 10.00 | INS       | NEW        |    11905
    19 | 10.00 | INS       | NEW        |    11906
    20 | 10.00 | INS       | NEW        |    11907
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11922
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11923
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11924
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11924
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11925
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11925
     2 | FK... |     2 |     1 | ABC        | UPD       | OLD        |    11930
     2 | FK... |     1 |     1 | ABC        | UPD       | NEW        |    11930
     1 | FK... |     2 |     1 | ABC        | UPD       | OLD        |    11931
     1 | FK... |     1 |     1 | ABC        | UPD       | NEW        |    11931
     2 | FK... |     1 |     1 | ABC        | DEL       | OLD        |    11932
     1 | FK... |     1 |     1 | ABC        | DEL       | OLD        |    11933
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11938
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11939
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11940
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11940
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11941
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11941
(18 rows)

select col51, col52, col53, col54, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl5_log order by emaj_gid, emaj_tuple desc;
 col51 |     col52     |  col53  |          col54          | emaj_verb | emaj_tuple | emaj_gid 
-------+---------------+---------+-------------------------+-----------+------------+----------
     1 | {abc,def,ghi} | {1,2,3} |                         | INS       | NEW        |    11908
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | INS       | NEW        |    11909
     1 | {abc,def,ghi} | {1,2,3} |                         | UPD       | OLD        |    11910
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010} | UPD       | NEW        |    11910
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | DEL       | OLD        |    11926
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | INS       | NEW        |    11934
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | DEL       | OLD        |    11942
(7 rows)

select col61, col62, col63, col64, col65, col66, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl6_log order by emaj_gid, emaj_tuple desc;
 col61 |  col62  |    col63    |    col64    |         col65         |     col66      | emaj_verb | emaj_tuple | emaj_gid 
-------+---------+-------------+-------------+-----------------------+----------------+-----------+------------+----------
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11911
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11912
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11913
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11914
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11915
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11916
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11917
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11918
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11919
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11919
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11920
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11920
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11921
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11921
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11927
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11928
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11929
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | INS       | NEW        |    11935
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | INS       | NEW        |    11936
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | INS       | NEW        |    11937
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11943
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11944
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11945
(23 rows)

-----------------------------
-- Step 4 : for myGroup1, rollback then update tables then set 3 marks
-----------------------------
select emaj.emaj_rollback_group('myGroup1','M2');
 emaj_rollback_group 
---------------------
                   3
(1 row)

--
set search_path=myschema1;
insert into myTbl1 select i, 'DEF', E'\\000'::bytea from generate_series (100,110) as i;
insert into myTbl2 values (3,'GHI','2010-01-02');
delete from myTbl1 where col11 = 1;
--
select emaj.emaj_set_mark_group('myGroup1','M4');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

--
update "myTbl3" set col33 = col33 / 2;
--
select emaj.emaj_set_mark_group('myGroup1','M5');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

--
update myTbl1 set col11 = 99 where col11 = 1;
--
select emaj.emaj_set_mark_group('myGroup1','M6');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

-----------------------------
-- Checking step 4
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace  | mark_global_seq | mark_state | mark_comment | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+-----------------+-----------------+------------+--------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1              |           11842 | ACTIVE     |              |                   599 |                  6009 |                        27
     602 | myGroup2   | M1              |           11842 | ACTIVE     |              |                   599 |                  6017 |                        41
     603 | myGroup1   | M2              |           11869 | ACTIVE     |              |                   599 |                  6023 |                        13
     605 | myGroup2   | M2              |           11921 | ACTIVE     |              |                   599 |                  6037 |                         8
     606 | myGroup2   | M3              |           11929 | ACTIVE     |              |                   599 |                  6045 |                         0
     607 | myGroup2   | RLBK_M2_%_START |           11929 | ACTIVE     |              |                   599 |                  6053 |                         8
     608 | myGroup2   | RLBK_M2_%_DONE  |           11937 | ACTIVE     |              |                   599 |                  6061 |                         0
     609 | myGroup2   | RLBK_M3_%_START |           11937 | ACTIVE     |              |                   599 |                  6069 |                         8
     610 | myGroup2   | RLBK_M3_%_DONE  |           11945 | ACTIVE     |              |                   599 |                  6077 |                          
     611 | myGroup1   | M4              |           11958 | ACTIVE     |              |                   601 |                  6083 |                        10
     612 | myGroup1   | M5              |           11968 | ACTIVE     |              |                   601 |                  6089 |                         0
     613 | myGroup1   | M6              |           11968 | ACTIVE     |              |                   601 |                  6095 |                          
(12 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace  | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+-----------------+---------------+----------------
    6004 | myschema1   | myTbl3_col31_seq          | M1              |            11 | f
    6005 | emajC       | myschema1_myTbl3_log_seq  | M1              |             1 | f
    6006 | emaj        | myschema1_mytbl1_log_seq  | M1              |             1 | f
    6007 | emaj        | myschema1_mytbl4_log_seq  | M1              |             1 | f
    6008 | emaj        | myschema1_mytbl2_log_seq  | M1              |             1 | f
    6009 | emajb       | myschema1_mytbl2b_log_seq | M1              |             1 | f
    6010 | myschema2   | myseq1                    | M1              |          1000 | f
    6011 | myschema2   | myTbl3_col31_seq          | M1              |            10 | t
    6012 | emaj        | myschema2_mytbl1_log_seq  | M1              |             1 | f
    6013 | emaj        | myschema2_mytbl2_log_seq  | M1              |             1 | f
    6014 | emajC       | myschema2_myTbl3_log_seq  | M1              |             1 | f
    6015 | emaj        | myschema2_mytbl4_log_seq  | M1              |             1 | f
    6016 | emaj        | myschema2_mytbl5_log_seq  | M1              |             1 | f
    6017 | emaj        | myschema2_mytbl6_log_seq  | M1              |             1 | f
    6018 | myschema1   | myTbl3_col31_seq          | M2              |            20 | t
    6019 | emajC       | myschema1_myTbl3_log_seq  | M2              |            10 | t
    6020 | emaj        | myschema1_mytbl1_log_seq  | M2              |            15 | t
    6021 | emaj        | myschema1_mytbl4_log_seq  | M2              |             1 | f
    6022 | emaj        | myschema1_mytbl2_log_seq  | M2              |             2 | t
    6023 | emajb       | myschema1_mytbl2b_log_seq | M2              |             1 | f
    6025 | emajC       | myschema1_myTbl3_log_seq  | M3              |            10 | t
    6028 | emaj        | myschema1_mytbl2_log_seq  | M3              |             2 | t
    6029 | emajb       | myschema1_mytbl2b_log_seq | M3              |             1 | f
    6030 | myschema2   | myseq1                    | M2              |          1000 | t
    6031 | myschema2   | myTbl3_col31_seq          | M2              |            20 | t
    6032 | emaj        | myschema2_mytbl1_log_seq  | M2              |            15 | t
    6033 | emaj        | myschema2_mytbl2_log_seq  | M2              |             2 | t
    6034 | emajC       | myschema2_myTbl3_log_seq  | M2              |            10 | t
    6035 | emaj        | myschema2_mytbl4_log_seq  | M2              |             1 | f
    6036 | emaj        | myschema2_mytbl5_log_seq  | M2              |             3 | t
    6037 | emaj        | myschema2_mytbl6_log_seq  | M2              |            11 | t
    6038 | myschema2   | myseq1                    | M3              |          1003 | t
    6039 | myschema2   | myTbl3_col31_seq          | M3              |            20 | t
    6040 | emaj        | myschema2_mytbl1_log_seq  | M3              |            15 | t
    6041 | emaj        | myschema2_mytbl2_log_seq  | M3              |             2 | t
    6042 | emajC       | myschema2_myTbl3_log_seq  | M3              |            10 | t
    6043 | emaj        | myschema2_mytbl4_log_seq  | M3              |             4 | t
    6044 | emaj        | myschema2_mytbl5_log_seq  | M3              |             4 | t
    6045 | emaj        | myschema2_mytbl6_log_seq  | M3              |            14 | t
    6046 | myschema2   | myseq1                    | RLBK_M2_%_START |          1003 | t
    6047 | myschema2   | myTbl3_col31_seq          | RLBK_M2_%_START |            20 | t
    6048 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
    6049 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
    6050 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
    6051 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M2_%_START |             4 | t
    6052 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M2_%_START |             4 | t
    6053 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M2_%_START |            14 | t
    6054 | myschema2   | myseq1                    | RLBK_M2_%_DONE  |          1001 | f
    6055 | myschema2   | myTbl3_col31_seq          | RLBK_M2_%_DONE  |            20 | t
    6056 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
    6057 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
    6058 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
    6059 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M2_%_DONE  |             8 | t
    6060 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M2_%_DONE  |             5 | t
    6061 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M2_%_DONE  |            17 | t
    6062 | myschema2   | myseq1                    | RLBK_M3_%_START |          1001 | f
    6063 | myschema2   | myTbl3_col31_seq          | RLBK_M3_%_START |            20 | t
    6064 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_START |            15 | t
    6065 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_START |             2 | t
    6066 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_START |            10 | t
    6067 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M3_%_START |             8 | t
    6068 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M3_%_START |             5 | t
    6069 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M3_%_START |            17 | t
    6070 | myschema2   | myseq1                    | RLBK_M3_%_DONE  |          1004 | f
    6071 | myschema2   | myTbl3_col31_seq          | RLBK_M3_%_DONE  |            20 | t
    6072 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_DONE  |            15 | t
    6073 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_DONE  |             2 | t
    6074 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_DONE  |            10 | t
    6075 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M3_%_DONE  |            12 | t
    6076 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M3_%_DONE  |             6 | t
    6077 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M3_%_DONE  |            20 | t
    6078 | myschema1   | myTbl3_col31_seq          | M4              |            20 | t
    6079 | emajC       | myschema1_myTbl3_log_seq  | M4              |            10 | t
    6080 | emaj        | myschema1_mytbl1_log_seq  | M4              |            30 | t
    6081 | emaj        | myschema1_mytbl4_log_seq  | M4              |             8 | t
    6082 | emaj        | myschema1_mytbl2_log_seq  | M4              |             3 | t
    6083 | emajb       | myschema1_mytbl2b_log_seq | M4              |             1 | f
    6084 | myschema1   | myTbl3_col31_seq          | M5              |            20 | t
    6085 | emajC       | myschema1_myTbl3_log_seq  | M5              |            20 | t
    6086 | emaj        | myschema1_mytbl1_log_seq  | M5              |            30 | t
    6087 | emaj        | myschema1_mytbl4_log_seq  | M5              |             8 | t
    6088 | emaj        | myschema1_mytbl2_log_seq  | M5              |             3 | t
    6089 | emajb       | myschema1_mytbl2b_log_seq | M5              |             1 | f
    6090 | myschema1   | myTbl3_col31_seq          | M6              |            20 | t
    6091 | emajC       | myschema1_myTbl3_log_seq  | M6              |            20 | t
    6092 | emaj        | myschema1_mytbl1_log_seq  | M6              |            30 | t
    6093 | emaj        | myschema1_mytbl4_log_seq  | M6              |             8 | t
    6094 | emaj        | myschema1_mytbl2_log_seq  | M6              |             3 | t
    6095 | emajb       | myschema1_mytbl2b_log_seq | M6              |             1 | f
(89 rows)

-- user tables
select * from mySchema1.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
   100 | DEF        | \x00
   101 | DEF        | \x00
   102 | DEF        | \x00
   103 | DEF        | \x00
   104 | DEF        | \x00
   105 | DEF        | \x00
   106 | DEF        | \x00
   107 | DEF        | \x00
   108 | DEF        | \x00
   109 | DEF        | \x00
   110 | DEF        | \x00
(20 rows)

select * from mySchema1.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 12-31-2010
     2 | DEF   | 
     3 | GHI   | 01-02-2010
(3 rows)

select * from mySchema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

select col31,col33 from mySchema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 |  5.00
    12 |  5.00
    13 |  5.00
    14 |  5.00
    15 |  5.00
    16 |  5.00
    17 |  5.00
    18 |  5.00
    19 |  5.00
    20 |  5.00
(10 rows)

select * from mySchema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    11843
     2 | ABC        | \x0c  | INS       | NEW        |    11844
     3 | ABC        | \x0c  | INS       | NEW        |    11845
     4 | ABC        | \x0c  | INS       | NEW        |    11846
     5 | ABC        | \x0c  | INS       | NEW        |    11847
     6 | ABC        | \x0c  | INS       | NEW        |    11848
     7 | ABC        | \x0c  | INS       | NEW        |    11849
     8 | ABC        | \x0c  | INS       | NEW        |    11850
     9 | ABC        | \x0c  | INS       | NEW        |    11851
    10 | ABC        | \x0c  | INS       | NEW        |    11852
    11 | ABC        | \x0c  | INS       | NEW        |    11853
     1 | ABC        | \x0c  | UPD       | OLD        |    11854
     1 | ABC        | \x1c  | UPD       | NEW        |    11854
     2 | ABC        | \x0c  | UPD       | OLD        |    11855
     2 | ABC        | \x1c  | UPD       | NEW        |    11855
     3 | ABC        | \x0c  | UPD       | OLD        |    11856
     3 | ABC        | \x1c  | UPD       | NEW        |    11856
    11 | ABC        | \x0c  | DEL       | OLD        |    11858
   100 | DEF        | \x00  | INS       | NEW        |    11946
   101 | DEF        | \x00  | INS       | NEW        |    11947
   102 | DEF        | \x00  | INS       | NEW        |    11948
   103 | DEF        | \x00  | INS       | NEW        |    11949
   104 | DEF        | \x00  | INS       | NEW        |    11950
   105 | DEF        | \x00  | INS       | NEW        |    11951
   106 | DEF        | \x00  | INS       | NEW        |    11952
   107 | DEF        | \x00  | INS       | NEW        |    11953
   108 | DEF        | \x00  | INS       | NEW        |    11954
   109 | DEF        | \x00  | INS       | NEW        |    11955
   110 | DEF        | \x00  | INS       | NEW        |    11956
     1 | ABC        | \x1c  | DEL       | OLD        |    11958
(30 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 12-31-2010 | INS       | NEW        |    11857
     2 | DEF   |            | INS       | NEW        |    11859
     3 | GHI   | 01-02-2010 | INS       | NEW        |    11957
(3 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.mySchema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | INS       | NEW        |    11860
    12 | 10.00 | INS       | NEW        |    11861
    13 | 10.00 | INS       | NEW        |    11862
    14 | 10.00 | INS       | NEW        |    11863
    15 | 10.00 | INS       | NEW        |    11864
    16 | 10.00 | INS       | NEW        |    11865
    17 | 10.00 | INS       | NEW        |    11866
    18 | 10.00 | INS       | NEW        |    11867
    19 | 10.00 | INS       | NEW        |    11868
    20 | 10.00 | INS       | NEW        |    11869
    11 | 10.00 | UPD       | OLD        |    11959
    11 |  5.00 | UPD       | NEW        |    11959
    12 | 10.00 | UPD       | OLD        |    11960
    12 |  5.00 | UPD       | NEW        |    11960
    13 | 10.00 | UPD       | OLD        |    11961
    13 |  5.00 | UPD       | NEW        |    11961
    14 | 10.00 | UPD       | OLD        |    11962
    14 |  5.00 | UPD       | NEW        |    11962
    15 | 10.00 | UPD       | OLD        |    11963
    15 |  5.00 | UPD       | NEW        |    11963
    16 | 10.00 | UPD       | OLD        |    11964
    16 |  5.00 | UPD       | NEW        |    11964
    17 | 10.00 | UPD       | OLD        |    11965
    17 |  5.00 | UPD       | NEW        |    11965
    18 | 10.00 | UPD       | OLD        |    11966
    18 |  5.00 | UPD       | NEW        |    11966
    19 | 10.00 | UPD       | OLD        |    11967
    19 |  5.00 | UPD       | NEW        |    11967
    20 | 10.00 | UPD       | OLD        |    11968
    20 |  5.00 | UPD       | NEW        |    11968
(30 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 | col45 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-------+-----------+------------+----------
(0 rows)

-----------------------------
-- Step 5 : for myGroup2, logged rollback again then unlogged rollback 
-----------------------------
select emaj.emaj_logged_rollback_group('myGroup2','M2');
WARNING:  _check_fk_groups: Foreign key mytbl6_col61_fkey, from table myschema2.mytbl6, references myschema2.mytbl7 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_groups_step1" line 74 at PERFORM
SQL statement "SELECT emaj._rlbk_groups_step1(v_groupNames, v_mark, v_unloggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 12 at RETURN
WARNING:  _check_fk_groups: table myschema2.mytbl6 is referenced by foreign key mytbl8_col81_fkey from table myschema2.mytbl8 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_groups_step1" line 74 at PERFORM
SQL statement "SELECT emaj._rlbk_groups_step1(v_groupNames, v_mark, v_unloggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 12 at RETURN
 emaj_logged_rollback_group 
----------------------------
                          5
(1 row)

--
select emaj.emaj_rollback_group('myGroup2','M3');
WARNING:  _check_fk_groups: Foreign key mytbl6_col61_fkey, from table myschema2.mytbl6, references myschema2.mytbl7 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_groups_step1" line 74 at PERFORM
SQL statement "SELECT emaj._rlbk_groups_step1(v_groupNames, v_mark, v_unloggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 8 at RETURN
WARNING:  _check_fk_groups: table myschema2.mytbl6 is referenced by foreign key mytbl8_col81_fkey from table myschema2.mytbl8 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_groups_step1" line 74 at PERFORM
SQL statement "SELECT emaj._rlbk_groups_step1(v_groupNames, v_mark, v_unloggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 8 at RETURN
 emaj_rollback_group 
---------------------
                   5
(1 row)

-----------------------------
-- Checking step 5
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace | mark_global_seq | mark_state | mark_comment | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+----------------+-----------------+------------+--------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1             |           11842 | ACTIVE     |              |                   599 |                  6009 |                        27
     602 | myGroup2   | M1             |           11842 | ACTIVE     |              |                   599 |                  6017 |                        41
     603 | myGroup1   | M2             |           11869 | ACTIVE     |              |                   599 |                  6023 |                        13
     605 | myGroup2   | M2             |           11921 | ACTIVE     |              |                   599 |                  6037 |                         8
     606 | myGroup2   | M3             |           11929 | ACTIVE     |              |                   599 |                  6045 |                          
     611 | myGroup1   | M4             |           11958 | ACTIVE     |              |                   601 |                  6083 |                        10
     612 | myGroup1   | M5             |           11968 | ACTIVE     |              |                   601 |                  6089 |                         0
     613 | myGroup1   | M6             |           11968 | ACTIVE     |              |                   601 |                  6095 |                          
(8 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace  | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+-----------------+---------------+----------------
    6004 | myschema1   | myTbl3_col31_seq          | M1              |            11 | f
    6005 | emajC       | myschema1_myTbl3_log_seq  | M1              |             1 | f
    6006 | emaj        | myschema1_mytbl1_log_seq  | M1              |             1 | f
    6007 | emaj        | myschema1_mytbl4_log_seq  | M1              |             1 | f
    6008 | emaj        | myschema1_mytbl2_log_seq  | M1              |             1 | f
    6009 | emajb       | myschema1_mytbl2b_log_seq | M1              |             1 | f
    6010 | myschema2   | myseq1                    | M1              |          1000 | f
    6011 | myschema2   | myTbl3_col31_seq          | M1              |            10 | t
    6012 | emaj        | myschema2_mytbl1_log_seq  | M1              |             1 | f
    6013 | emaj        | myschema2_mytbl2_log_seq  | M1              |             1 | f
    6014 | emajC       | myschema2_myTbl3_log_seq  | M1              |             1 | f
    6015 | emaj        | myschema2_mytbl4_log_seq  | M1              |             1 | f
    6016 | emaj        | myschema2_mytbl5_log_seq  | M1              |             1 | f
    6017 | emaj        | myschema2_mytbl6_log_seq  | M1              |             1 | f
    6018 | myschema1   | myTbl3_col31_seq          | M2              |            20 | t
    6019 | emajC       | myschema1_myTbl3_log_seq  | M2              |            10 | t
    6020 | emaj        | myschema1_mytbl1_log_seq  | M2              |            15 | t
    6021 | emaj        | myschema1_mytbl4_log_seq  | M2              |             1 | f
    6022 | emaj        | myschema1_mytbl2_log_seq  | M2              |             2 | t
    6023 | emajb       | myschema1_mytbl2b_log_seq | M2              |             1 | f
    6025 | emajC       | myschema1_myTbl3_log_seq  | M3              |            10 | t
    6028 | emaj        | myschema1_mytbl2_log_seq  | M3              |             2 | t
    6029 | emajb       | myschema1_mytbl2b_log_seq | M3              |             1 | f
    6030 | myschema2   | myseq1                    | M2              |          1000 | t
    6031 | myschema2   | myTbl3_col31_seq          | M2              |            20 | t
    6032 | emaj        | myschema2_mytbl1_log_seq  | M2              |            15 | t
    6033 | emaj        | myschema2_mytbl2_log_seq  | M2              |             2 | t
    6034 | emajC       | myschema2_myTbl3_log_seq  | M2              |            10 | t
    6035 | emaj        | myschema2_mytbl4_log_seq  | M2              |             1 | f
    6036 | emaj        | myschema2_mytbl5_log_seq  | M2              |             3 | t
    6037 | emaj        | myschema2_mytbl6_log_seq  | M2              |            11 | t
    6038 | myschema2   | myseq1                    | M3              |          1003 | t
    6039 | myschema2   | myTbl3_col31_seq          | M3              |            20 | t
    6040 | emaj        | myschema2_mytbl1_log_seq  | M3              |            15 | t
    6041 | emaj        | myschema2_mytbl2_log_seq  | M3              |             2 | t
    6042 | emajC       | myschema2_myTbl3_log_seq  | M3              |            10 | t
    6043 | emaj        | myschema2_mytbl4_log_seq  | M3              |             4 | t
    6044 | emaj        | myschema2_mytbl5_log_seq  | M3              |             4 | t
    6045 | emaj        | myschema2_mytbl6_log_seq  | M3              |            14 | t
    6048 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
    6049 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
    6050 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
    6056 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
    6057 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
    6058 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
    6064 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_START |            15 | t
    6065 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_START |             2 | t
    6066 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_START |            10 | t
    6072 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_DONE  |            15 | t
    6073 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_DONE  |             2 | t
    6074 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_DONE  |            10 | t
    6078 | myschema1   | myTbl3_col31_seq          | M4              |            20 | t
    6079 | emajC       | myschema1_myTbl3_log_seq  | M4              |            10 | t
    6080 | emaj        | myschema1_mytbl1_log_seq  | M4              |            30 | t
    6081 | emaj        | myschema1_mytbl4_log_seq  | M4              |             8 | t
    6082 | emaj        | myschema1_mytbl2_log_seq  | M4              |             3 | t
    6083 | emajb       | myschema1_mytbl2b_log_seq | M4              |             1 | f
    6084 | myschema1   | myTbl3_col31_seq          | M5              |            20 | t
    6085 | emajC       | myschema1_myTbl3_log_seq  | M5              |            20 | t
    6086 | emaj        | myschema1_mytbl1_log_seq  | M5              |            30 | t
    6087 | emaj        | myschema1_mytbl4_log_seq  | M5              |             8 | t
    6088 | emaj        | myschema1_mytbl2_log_seq  | M5              |             3 | t
    6089 | emajb       | myschema1_mytbl2b_log_seq | M5              |             1 | f
    6090 | myschema1   | myTbl3_col31_seq          | M6              |            20 | t
    6091 | emajC       | myschema1_myTbl3_log_seq  | M6              |            20 | t
    6092 | emaj        | myschema1_mytbl1_log_seq  | M6              |            30 | t
    6093 | emaj        | myschema1_mytbl4_log_seq  | M6              |             8 | t
    6094 | emaj        | myschema1_mytbl2_log_seq  | M6              |             3 | t
    6095 | emajb       | myschema1_mytbl2b_log_seq | M6              |             1 | f
    6098 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
    6099 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
    6100 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
    6106 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
    6107 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
    6108 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
(75 rows)

select * from emaj.emaj_fk order by fk_groups, fk_session, fk_name;
 fk_groups  | fk_session |      fk_name      | fk_schema | fk_table |    fk_action     |                                                                 fk_def                                                                  
------------+------------+-------------------+-----------+----------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------
 {myGroup1} |          1 | mytbl4_col43_fkey | myschema1 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES myschema1.mytbl2(col21) DEFERRABLE
 {myGroup1} |          1 | mytbl4_col44_fkey | myschema1 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col43_fkey | myschema2 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES myschema2.mytbl2(col21) DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col44_fkey | myschema2 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES myschema2.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE
 {myGroup2} |          1 | mytbl6_col61_fkey | myschema2 | mytbl6   | set_fk_immediate | FOREIGN KEY (col61) REFERENCES myschema2.mytbl7(col71) DEFERRABLE
 {myGroup2} |          1 | mytbl8_col81_fkey | myschema2 | mytbl8   | set_fk_immediate | FOREIGN KEY (col81) REFERENCES myschema2.mytbl6(col61) DEFERRABLE
(6 rows)

select sqhl_id, sqhl_schema, sqhl_table, sqhl_hole_size from emaj.emaj_seq_hole order by sqhl_id;
 sqhl_id | sqhl_schema | sqhl_table | sqhl_hole_size 
---------+-------------+------------+----------------
     600 | myschema1   | mytbl1     |              3
     601 | myschema1   | mytbl4     |              8
     602 | myschema2   | mytbl4     |             20
     603 | myschema2   | mytbl5     |              5
     604 | myschema2   | mytbl6     |             15
(5 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 01-01-2010
     2 | DEF   | 
(2 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

select * from mySchema2.myTbl5 order by col51;
 col51 |     col52     |  col53  |          col54          
-------+---------------+---------+-------------------------
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010}
(1 row)

select * from mySchema2.myTbl6 order by col61;
 col61 |  col62  |    col63    |   col64   |         col65         |     col66      
-------+---------+-------------+-----------+-----------------------+----------------
     0 |         |             |           |                       | 
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
(6 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    11881
     2 | ABC        | \x0c  | INS       | NEW        |    11882
     3 | ABC        | \x0c  | INS       | NEW        |    11883
     4 | ABC        | \x0c  | INS       | NEW        |    11884
     5 | ABC        | \x0c  | INS       | NEW        |    11885
     6 | ABC        | \x0c  | INS       | NEW        |    11886
     7 | ABC        | \x0c  | INS       | NEW        |    11887
     8 | ABC        | \x0c  | INS       | NEW        |    11888
     9 | ABC        | \x0c  | INS       | NEW        |    11889
    10 | ABC        | \x0c  | INS       | NEW        |    11890
    11 | ABC        | \x0c  | INS       | NEW        |    11891
     1 | ABC        | \x0c  | UPD       | OLD        |    11892
     1 | ABC        | \x1c  | UPD       | NEW        |    11892
     2 | ABC        | \x0c  | UPD       | OLD        |    11893
     2 | ABC        | \x1c  | UPD       | NEW        |    11893
     3 | ABC        | \x0c  | UPD       | OLD        |    11894
     3 | ABC        | \x1c  | UPD       | NEW        |    11894
    11 | ABC        | \x0c  | DEL       | OLD        |    11896
(18 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 01-01-2010 | INS       | NEW        |    11895
     2 | DEF   |            | INS       | NEW        |    11897
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | INS       | NEW        |    11898
    12 | 10.00 | INS       | NEW        |    11899
    13 | 10.00 | INS       | NEW        |    11900
    14 | 10.00 | INS       | NEW        |    11901
    15 | 10.00 | INS       | NEW        |    11902
    16 | 10.00 | INS       | NEW        |    11903
    17 | 10.00 | INS       | NEW        |    11904
    18 | 10.00 | INS       | NEW        |    11905
    19 | 10.00 | INS       | NEW        |    11906
    20 | 10.00 | INS       | NEW        |    11907
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11922
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11923
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11924
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11924
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11925
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11925
(6 rows)

select col51, col52, col53, col54, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl5_log order by emaj_gid, emaj_tuple desc;
 col51 |     col52     |  col53  |          col54          | emaj_verb | emaj_tuple | emaj_gid 
-------+---------------+---------+-------------------------+-----------+------------+----------
     1 | {abc,def,ghi} | {1,2,3} |                         | INS       | NEW        |    11908
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | INS       | NEW        |    11909
     1 | {abc,def,ghi} | {1,2,3} |                         | UPD       | OLD        |    11910
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010} | UPD       | NEW        |    11910
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | DEL       | OLD        |    11926
(5 rows)

select col61, col62, col63, col64, col65, col66, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl6_log order by emaj_gid, emaj_tuple desc;
 col61 |  col62  |    col63    |    col64    |         col65         |     col66      | emaj_verb | emaj_tuple | emaj_gid 
-------+---------+-------------+-------------+-----------------------+----------------+-----------+------------+----------
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11911
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11912
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11913
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11914
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11915
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11916
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11917
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11918
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11919
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11919
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11920
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11920
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11921
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11921
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11927
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11928
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11929
(17 rows)

-----------------------------
-- Step 6 : for myGroup1, update tables, rollback, other updates, then logged rollback
-----------------------------
set search_path=myschema1;
--
insert into myTbl1 values (1, 'Step 6', E'\\000'::bytea);
insert into myTbl4 values (11,'FK...',1,1,'Step 6');
insert into myTbl4 values (12,'FK...',1,1,'Step 6');
--
select emaj.emaj_rollback_group('myGroup1','M5');
 emaj_rollback_group 
---------------------
                   3
(1 row)

--
insert into myTbl1 values (1, 'Step 6', E'\\001'::bytea);
insert into myTbl4 values (11,'',1,1,'Step 6');
insert into myTbl4 values (12,'',1,1,'Step 6');
--
select emaj.emaj_logged_rollback_group('myGroup1','M4');
 emaj_logged_rollback_group 
----------------------------
                          4
(1 row)

-----------------------------
-- Checking step 6
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace  | mark_global_seq | mark_state | mark_comment | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+-----------------+-----------------+------------+--------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1              |           11842 | ACTIVE     |              |                   599 |                  6009 |                        27
     602 | myGroup2   | M1              |           11842 | ACTIVE     |              |                   599 |                  6017 |                        41
     603 | myGroup1   | M2              |           11869 | ACTIVE     |              |                   599 |                  6023 |                        13
     605 | myGroup2   | M2              |           11921 | ACTIVE     |              |                   599 |                  6037 |                         8
     606 | myGroup2   | M3              |           11929 | ACTIVE     |              |                   599 |                  6045 |                          
     611 | myGroup1   | M4              |           11958 | ACTIVE     |              |                   601 |                  6083 |                        10
     612 | myGroup1   | M5              |           11968 | ACTIVE     |              |                   601 |                  6089 |                         3
     616 | myGroup1   | RLBK_M4_%_START |           11998 | ACTIVE     |              |                   606 |                  6117 |                        13
     617 | myGroup1   | RLBK_M4_%_DONE  |           12011 | ACTIVE     |              |                   606 |                  6123 |                          
(9 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace  | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+-----------------+---------------+----------------
    6004 | myschema1   | myTbl3_col31_seq          | M1              |            11 | f
    6005 | emajC       | myschema1_myTbl3_log_seq  | M1              |             1 | f
    6006 | emaj        | myschema1_mytbl1_log_seq  | M1              |             1 | f
    6007 | emaj        | myschema1_mytbl4_log_seq  | M1              |             1 | f
    6008 | emaj        | myschema1_mytbl2_log_seq  | M1              |             1 | f
    6009 | emajb       | myschema1_mytbl2b_log_seq | M1              |             1 | f
    6010 | myschema2   | myseq1                    | M1              |          1000 | f
    6011 | myschema2   | myTbl3_col31_seq          | M1              |            10 | t
    6012 | emaj        | myschema2_mytbl1_log_seq  | M1              |             1 | f
    6013 | emaj        | myschema2_mytbl2_log_seq  | M1              |             1 | f
    6014 | emajC       | myschema2_myTbl3_log_seq  | M1              |             1 | f
    6015 | emaj        | myschema2_mytbl4_log_seq  | M1              |             1 | f
    6016 | emaj        | myschema2_mytbl5_log_seq  | M1              |             1 | f
    6017 | emaj        | myschema2_mytbl6_log_seq  | M1              |             1 | f
    6018 | myschema1   | myTbl3_col31_seq          | M2              |            20 | t
    6019 | emajC       | myschema1_myTbl3_log_seq  | M2              |            10 | t
    6020 | emaj        | myschema1_mytbl1_log_seq  | M2              |            15 | t
    6021 | emaj        | myschema1_mytbl4_log_seq  | M2              |             1 | f
    6022 | emaj        | myschema1_mytbl2_log_seq  | M2              |             2 | t
    6023 | emajb       | myschema1_mytbl2b_log_seq | M2              |             1 | f
    6025 | emajC       | myschema1_myTbl3_log_seq  | M3              |            10 | t
    6028 | emaj        | myschema1_mytbl2_log_seq  | M3              |             2 | t
    6029 | emajb       | myschema1_mytbl2b_log_seq | M3              |             1 | f
    6030 | myschema2   | myseq1                    | M2              |          1000 | t
    6031 | myschema2   | myTbl3_col31_seq          | M2              |            20 | t
    6032 | emaj        | myschema2_mytbl1_log_seq  | M2              |            15 | t
    6033 | emaj        | myschema2_mytbl2_log_seq  | M2              |             2 | t
    6034 | emajC       | myschema2_myTbl3_log_seq  | M2              |            10 | t
    6035 | emaj        | myschema2_mytbl4_log_seq  | M2              |             1 | f
    6036 | emaj        | myschema2_mytbl5_log_seq  | M2              |             3 | t
    6037 | emaj        | myschema2_mytbl6_log_seq  | M2              |            11 | t
    6038 | myschema2   | myseq1                    | M3              |          1003 | t
    6039 | myschema2   | myTbl3_col31_seq          | M3              |            20 | t
    6040 | emaj        | myschema2_mytbl1_log_seq  | M3              |            15 | t
    6041 | emaj        | myschema2_mytbl2_log_seq  | M3              |             2 | t
    6042 | emajC       | myschema2_myTbl3_log_seq  | M3              |            10 | t
    6043 | emaj        | myschema2_mytbl4_log_seq  | M3              |             4 | t
    6044 | emaj        | myschema2_mytbl5_log_seq  | M3              |             4 | t
    6045 | emaj        | myschema2_mytbl6_log_seq  | M3              |            14 | t
    6048 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
    6049 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
    6050 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
    6056 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
    6057 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
    6058 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
    6064 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_START |            15 | t
    6065 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_START |             2 | t
    6066 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_START |            10 | t
    6072 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_DONE  |            15 | t
    6073 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_DONE  |             2 | t
    6074 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_DONE  |            10 | t
    6078 | myschema1   | myTbl3_col31_seq          | M4              |            20 | t
    6079 | emajC       | myschema1_myTbl3_log_seq  | M4              |            10 | t
    6080 | emaj        | myschema1_mytbl1_log_seq  | M4              |            30 | t
    6081 | emaj        | myschema1_mytbl4_log_seq  | M4              |             8 | t
    6082 | emaj        | myschema1_mytbl2_log_seq  | M4              |             3 | t
    6083 | emajb       | myschema1_mytbl2b_log_seq | M4              |             1 | f
    6084 | myschema1   | myTbl3_col31_seq          | M5              |            20 | t
    6085 | emajC       | myschema1_myTbl3_log_seq  | M5              |            20 | t
    6086 | emaj        | myschema1_mytbl1_log_seq  | M5              |            30 | t
    6087 | emaj        | myschema1_mytbl4_log_seq  | M5              |             8 | t
    6088 | emaj        | myschema1_mytbl2_log_seq  | M5              |             3 | t
    6089 | emajb       | myschema1_mytbl2b_log_seq | M5              |             1 | f
    6091 | emajC       | myschema1_myTbl3_log_seq  | M6              |            20 | t
    6094 | emaj        | myschema1_mytbl2_log_seq  | M6              |             3 | t
    6095 | emajb       | myschema1_mytbl2b_log_seq | M6              |             1 | f
    6098 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
    6099 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
    6100 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
    6106 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
    6107 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
    6108 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
    6112 | myschema1   | myTbl3_col31_seq          | RLBK_M4_%_START |            20 | t
    6113 | emajC       | myschema1_myTbl3_log_seq  | RLBK_M4_%_START |            20 | t
    6114 | emaj        | myschema1_mytbl1_log_seq  | RLBK_M4_%_START |            32 | t
    6115 | emaj        | myschema1_mytbl4_log_seq  | RLBK_M4_%_START |            12 | t
    6116 | emaj        | myschema1_mytbl2_log_seq  | RLBK_M4_%_START |             3 | t
    6117 | emajb       | myschema1_mytbl2b_log_seq | RLBK_M4_%_START |             1 | f
    6118 | myschema1   | myTbl3_col31_seq          | RLBK_M4_%_DONE  |            20 | t
    6119 | emajC       | myschema1_myTbl3_log_seq  | RLBK_M4_%_DONE  |            30 | t
    6120 | emaj        | myschema1_mytbl1_log_seq  | RLBK_M4_%_DONE  |            33 | t
    6121 | emaj        | myschema1_mytbl4_log_seq  | RLBK_M4_%_DONE  |            14 | t
    6122 | emaj        | myschema1_mytbl2_log_seq  | RLBK_M4_%_DONE  |             3 | t
    6123 | emajb       | myschema1_mytbl2b_log_seq | RLBK_M4_%_DONE  |             1 | f
(84 rows)

-- check that mark_log_stat_before_next column is always equal to either NULL or the emaj_log_stat_rows() function's result
-- this should always return 0 row
select * from 
  (select mark_id, mark_group, mark_name, mark_log_rows_before_next - 
    (select sum(stat_rows) from emaj.emaj_log_stat_group(mark_group, mark_name, 
      (select mark_name from emaj.emaj_mark m2 where m2.mark_group = m1.mark_group and m2.mark_id > m1.mark_id order by mark_id limit 1))
    ) as checked_stat_rows from emaj.emaj_mark m1 where mark_log_rows_before_next is not null
  ) as t 
  where checked_stat_rows <> 0;
 mark_id | mark_group | mark_name | checked_stat_rows 
---------+------------+-----------+-------------------
(0 rows)

--
select * from emaj.emaj_fk order by fk_groups, fk_session, fk_name;
 fk_groups  | fk_session |      fk_name      | fk_schema | fk_table |    fk_action     |                                                            fk_def                                                             
------------+------------+-------------------+-----------+----------+------------------+-------------------------------------------------------------------------------------------------------------------------------
 {myGroup1} |          1 | mytbl4_col43_fkey | myschema1 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES mytbl2(col21) DEFERRABLE
 {myGroup1} |          1 | mytbl4_col44_fkey | myschema1 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col43_fkey | myschema2 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES myschema2.mytbl2(col21) DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col44_fkey | myschema2 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES myschema2.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE
 {myGroup2} |          1 | mytbl6_col61_fkey | myschema2 | mytbl6   | set_fk_immediate | FOREIGN KEY (col61) REFERENCES myschema2.mytbl7(col71) DEFERRABLE
 {myGroup2} |          1 | mytbl8_col81_fkey | myschema2 | mytbl8   | set_fk_immediate | FOREIGN KEY (col81) REFERENCES myschema2.mytbl6(col61) DEFERRABLE
(6 rows)

select sqhl_id, sqhl_schema, sqhl_table, sqhl_hole_size from emaj.emaj_seq_hole order by sqhl_id;
 sqhl_id | sqhl_schema | sqhl_table | sqhl_hole_size 
---------+-------------+------------+----------------
     600 | myschema1   | mytbl1     |              3
     601 | myschema1   | mytbl4     |              8
     602 | myschema2   | mytbl4     |             20
     603 | myschema2   | mytbl5     |              5
     604 | myschema2   | mytbl6     |             15
     605 | myschema1   | mytbl1     |              1
     606 | myschema1   | mytbl4     |              2
(7 rows)

-- user tables
select * from mySchema1.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
   100 | DEF        | \x00
   101 | DEF        | \x00
   102 | DEF        | \x00
   103 | DEF        | \x00
   104 | DEF        | \x00
   105 | DEF        | \x00
   106 | DEF        | \x00
   107 | DEF        | \x00
   108 | DEF        | \x00
   109 | DEF        | \x00
   110 | DEF        | \x00
(20 rows)

select * from mySchema1.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 12-31-2010
     2 | DEF   | 
     3 | GHI   | 01-02-2010
(3 rows)

select * from mySchema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

select col31,col33 from mySchema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    11843
     2 | ABC        | \x0c  | INS       | NEW        |    11844
     3 | ABC        | \x0c  | INS       | NEW        |    11845
     4 | ABC        | \x0c  | INS       | NEW        |    11846
     5 | ABC        | \x0c  | INS       | NEW        |    11847
     6 | ABC        | \x0c  | INS       | NEW        |    11848
     7 | ABC        | \x0c  | INS       | NEW        |    11849
     8 | ABC        | \x0c  | INS       | NEW        |    11850
     9 | ABC        | \x0c  | INS       | NEW        |    11851
    10 | ABC        | \x0c  | INS       | NEW        |    11852
    11 | ABC        | \x0c  | INS       | NEW        |    11853
     1 | ABC        | \x0c  | UPD       | OLD        |    11854
     1 | ABC        | \x1c  | UPD       | NEW        |    11854
     2 | ABC        | \x0c  | UPD       | OLD        |    11855
     2 | ABC        | \x1c  | UPD       | NEW        |    11855
     3 | ABC        | \x0c  | UPD       | OLD        |    11856
     3 | ABC        | \x1c  | UPD       | NEW        |    11856
    11 | ABC        | \x0c  | DEL       | OLD        |    11858
   100 | DEF        | \x00  | INS       | NEW        |    11946
   101 | DEF        | \x00  | INS       | NEW        |    11947
   102 | DEF        | \x00  | INS       | NEW        |    11948
   103 | DEF        | \x00  | INS       | NEW        |    11949
   104 | DEF        | \x00  | INS       | NEW        |    11950
   105 | DEF        | \x00  | INS       | NEW        |    11951
   106 | DEF        | \x00  | INS       | NEW        |    11952
   107 | DEF        | \x00  | INS       | NEW        |    11953
   108 | DEF        | \x00  | INS       | NEW        |    11954
   109 | DEF        | \x00  | INS       | NEW        |    11955
   110 | DEF        | \x00  | INS       | NEW        |    11956
     1 | ABC        | \x1c  | DEL       | OLD        |    11958
     1 | Step 6     | \x01  | INS       | NEW        |    11996
     1 | Step 6     | \x01  | DEL       | OLD        |    12009
(32 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 12-31-2010 | INS       | NEW        |    11857
     2 | DEF   |            | INS       | NEW        |    11859
     3 | GHI   | 01-02-2010 | INS       | NEW        |    11957
(3 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.mySchema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | INS       | NEW        |    11860
    12 | 10.00 | INS       | NEW        |    11861
    13 | 10.00 | INS       | NEW        |    11862
    14 | 10.00 | INS       | NEW        |    11863
    15 | 10.00 | INS       | NEW        |    11864
    16 | 10.00 | INS       | NEW        |    11865
    17 | 10.00 | INS       | NEW        |    11866
    18 | 10.00 | INS       | NEW        |    11867
    19 | 10.00 | INS       | NEW        |    11868
    20 | 10.00 | INS       | NEW        |    11869
    11 | 10.00 | UPD       | OLD        |    11959
    11 |  5.00 | UPD       | NEW        |    11959
    12 | 10.00 | UPD       | OLD        |    11960
    12 |  5.00 | UPD       | NEW        |    11960
    13 | 10.00 | UPD       | OLD        |    11961
    13 |  5.00 | UPD       | NEW        |    11961
    14 | 10.00 | UPD       | OLD        |    11962
    14 |  5.00 | UPD       | NEW        |    11962
    15 | 10.00 | UPD       | OLD        |    11963
    15 |  5.00 | UPD       | NEW        |    11963
    16 | 10.00 | UPD       | OLD        |    11964
    16 |  5.00 | UPD       | NEW        |    11964
    17 | 10.00 | UPD       | OLD        |    11965
    17 |  5.00 | UPD       | NEW        |    11965
    18 | 10.00 | UPD       | OLD        |    11966
    18 |  5.00 | UPD       | NEW        |    11966
    19 | 10.00 | UPD       | OLD        |    11967
    19 |  5.00 | UPD       | NEW        |    11967
    20 | 10.00 | UPD       | OLD        |    11968
    20 |  5.00 | UPD       | NEW        |    11968
    20 |  5.00 | UPD       | OLD        |    11999
    20 | 10.00 | UPD       | NEW        |    11999
    19 |  5.00 | UPD       | OLD        |    12000
    19 | 10.00 | UPD       | NEW        |    12000
    18 |  5.00 | UPD       | OLD        |    12001
    18 | 10.00 | UPD       | NEW        |    12001
    17 |  5.00 | UPD       | OLD        |    12002
    17 | 10.00 | UPD       | NEW        |    12002
    16 |  5.00 | UPD       | OLD        |    12003
    16 | 10.00 | UPD       | NEW        |    12003
    15 |  5.00 | UPD       | OLD        |    12004
    15 | 10.00 | UPD       | NEW        |    12004
    14 |  5.00 | UPD       | OLD        |    12005
    14 | 10.00 | UPD       | NEW        |    12005
    13 |  5.00 | UPD       | OLD        |    12006
    13 | 10.00 | UPD       | NEW        |    12006
    12 |  5.00 | UPD       | OLD        |    12007
    12 | 10.00 | UPD       | NEW        |    12007
    11 |  5.00 | UPD       | OLD        |    12008
    11 | 10.00 | UPD       | NEW        |    12008
(50 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
    11 |       |     1 |     1 | Step 6     | INS       | NEW        |    11997
    12 |       |     1 |     1 | Step 6     | INS       | NEW        |    11998
    12 |       |     1 |     1 | Step 6     | DEL       | OLD        |    12010
    11 |       |     1 |     1 | Step 6     | DEL       | OLD        |    12011
(4 rows)

-----------------------------
-- Step 7 : for myGroup1, update tables, rename a mark, then delete 2 marks then delete all before a mark 
-----------------------------
set search_path=myschema1;
--
delete from "myTbl3" where col31 = 14;
delete from "myTbl3" where col31 = 15;
delete from "myTbl3" where col31 = 16;
delete from "myTbl3" where col31 = 17;
delete from "myTbl3" where col31 = 18;
--
select emaj.emaj_rename_mark_group('myGroup1',mark_name,'Before logged rollback to M4') from emaj.emaj_mark where mark_name like 'RLBK_M4_%_START';
 emaj_rename_mark_group 
------------------------
 
(1 row)

-- 
select emaj.emaj_delete_mark_group('myGroup1',mark_name) from emaj.emaj_mark where mark_name like 'RLBK_M4_%_DONE';
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

select emaj.emaj_delete_mark_group('myGroup1','M1');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

--
select emaj.emaj_delete_before_mark_group('myGroup1','M4');
 emaj_delete_before_mark_group 
-------------------------------
                             1
(1 row)

-----------------------------
-- Checking step 7
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group |        regexp_replace        | mark_global_seq | mark_state | mark_comment | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+------------------------------+-----------------+------------+--------------+-----------------------+-----------------------+---------------------------
     602 | myGroup2   | M1                           |           11842 | ACTIVE     |              |                   599 |                  6017 |                        41
     605 | myGroup2   | M2                           |           11921 | ACTIVE     |              |                   599 |                  6037 |                         8
     606 | myGroup2   | M3                           |           11929 | ACTIVE     |              |                   599 |                  6045 |                          
     611 | myGroup1   | M4                           |           11958 | ACTIVE     |              |                   601 |                  6083 |                        10
     612 | myGroup1   | M5                           |           11968 | ACTIVE     |              |                   601 |                  6089 |                         3
     616 | myGroup1   | Before logged rollback to M4 |           11998 | ACTIVE     |              |                   606 |                  6117 |                          
(6 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         |        regexp_replace        | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+------------------------------+---------------+----------------
    6010 | myschema2   | myseq1                    | M1                           |          1000 | f
    6011 | myschema2   | myTbl3_col31_seq          | M1                           |            10 | t
    6012 | emaj        | myschema2_mytbl1_log_seq  | M1                           |             1 | f
    6013 | emaj        | myschema2_mytbl2_log_seq  | M1                           |             1 | f
    6014 | emajC       | myschema2_myTbl3_log_seq  | M1                           |             1 | f
    6015 | emaj        | myschema2_mytbl4_log_seq  | M1                           |             1 | f
    6016 | emaj        | myschema2_mytbl5_log_seq  | M1                           |             1 | f
    6017 | emaj        | myschema2_mytbl6_log_seq  | M1                           |             1 | f
    6025 | emajC       | myschema1_myTbl3_log_seq  | M3                           |            10 | t
    6028 | emaj        | myschema1_mytbl2_log_seq  | M3                           |             2 | t
    6029 | emajb       | myschema1_mytbl2b_log_seq | M3                           |             1 | f
    6030 | myschema2   | myseq1                    | M2                           |          1000 | t
    6031 | myschema2   | myTbl3_col31_seq          | M2                           |            20 | t
    6032 | emaj        | myschema2_mytbl1_log_seq  | M2                           |            15 | t
    6033 | emaj        | myschema2_mytbl2_log_seq  | M2                           |             2 | t
    6034 | emajC       | myschema2_myTbl3_log_seq  | M2                           |            10 | t
    6035 | emaj        | myschema2_mytbl4_log_seq  | M2                           |             1 | f
    6036 | emaj        | myschema2_mytbl5_log_seq  | M2                           |             3 | t
    6037 | emaj        | myschema2_mytbl6_log_seq  | M2                           |            11 | t
    6038 | myschema2   | myseq1                    | M3                           |          1003 | t
    6039 | myschema2   | myTbl3_col31_seq          | M3                           |            20 | t
    6040 | emaj        | myschema2_mytbl1_log_seq  | M3                           |            15 | t
    6041 | emaj        | myschema2_mytbl2_log_seq  | M3                           |             2 | t
    6042 | emajC       | myschema2_myTbl3_log_seq  | M3                           |            10 | t
    6043 | emaj        | myschema2_mytbl4_log_seq  | M3                           |             4 | t
    6044 | emaj        | myschema2_mytbl5_log_seq  | M3                           |             4 | t
    6045 | emaj        | myschema2_mytbl6_log_seq  | M3                           |            14 | t
    6048 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START              |            15 | t
    6049 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START              |             2 | t
    6050 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START              |            10 | t
    6056 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE               |            15 | t
    6057 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE               |             2 | t
    6058 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE               |            10 | t
    6064 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_START              |            15 | t
    6065 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_START              |             2 | t
    6066 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_START              |            10 | t
    6072 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_DONE               |            15 | t
    6073 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_DONE               |             2 | t
    6074 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_DONE               |            10 | t
    6078 | myschema1   | myTbl3_col31_seq          | M4                           |            20 | t
    6079 | emajC       | myschema1_myTbl3_log_seq  | M4                           |            10 | t
    6080 | emaj        | myschema1_mytbl1_log_seq  | M4                           |            30 | t
    6081 | emaj        | myschema1_mytbl4_log_seq  | M4                           |             8 | t
    6082 | emaj        | myschema1_mytbl2_log_seq  | M4                           |             3 | t
    6083 | emajb       | myschema1_mytbl2b_log_seq | M4                           |             1 | f
    6084 | myschema1   | myTbl3_col31_seq          | M5                           |            20 | t
    6085 | emajC       | myschema1_myTbl3_log_seq  | M5                           |            20 | t
    6086 | emaj        | myschema1_mytbl1_log_seq  | M5                           |            30 | t
    6087 | emaj        | myschema1_mytbl4_log_seq  | M5                           |             8 | t
    6088 | emaj        | myschema1_mytbl2_log_seq  | M5                           |             3 | t
    6089 | emajb       | myschema1_mytbl2b_log_seq | M5                           |             1 | f
    6091 | emajC       | myschema1_myTbl3_log_seq  | M6                           |            20 | t
    6094 | emaj        | myschema1_mytbl2_log_seq  | M6                           |             3 | t
    6095 | emajb       | myschema1_mytbl2b_log_seq | M6                           |             1 | f
    6098 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START              |            15 | t
    6099 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START              |             2 | t
    6100 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START              |            10 | t
    6106 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE               |            15 | t
    6107 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE               |             2 | t
    6108 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE               |            10 | t
    6112 | myschema1   | myTbl3_col31_seq          | Before logged rollback to M4 |            20 | t
    6113 | emajC       | myschema1_myTbl3_log_seq  | Before logged rollback to M4 |            20 | t
    6114 | emaj        | myschema1_mytbl1_log_seq  | Before logged rollback to M4 |            32 | t
    6115 | emaj        | myschema1_mytbl4_log_seq  | Before logged rollback to M4 |            12 | t
    6116 | emaj        | myschema1_mytbl2_log_seq  | Before logged rollback to M4 |             3 | t
    6117 | emajb       | myschema1_mytbl2b_log_seq | Before logged rollback to M4 |             1 | f
(66 rows)

select * from emaj.emaj_fk order by fk_groups, fk_session, fk_name;
 fk_groups  | fk_session |      fk_name      | fk_schema | fk_table |    fk_action     |                                                            fk_def                                                             
------------+------------+-------------------+-----------+----------+------------------+-------------------------------------------------------------------------------------------------------------------------------
 {myGroup1} |          1 | mytbl4_col43_fkey | myschema1 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES mytbl2(col21) DEFERRABLE
 {myGroup1} |          1 | mytbl4_col44_fkey | myschema1 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col43_fkey | myschema2 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES myschema2.mytbl2(col21) DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col44_fkey | myschema2 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES myschema2.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE
 {myGroup2} |          1 | mytbl6_col61_fkey | myschema2 | mytbl6   | set_fk_immediate | FOREIGN KEY (col61) REFERENCES myschema2.mytbl7(col71) DEFERRABLE
 {myGroup2} |          1 | mytbl8_col81_fkey | myschema2 | mytbl8   | set_fk_immediate | FOREIGN KEY (col81) REFERENCES myschema2.mytbl6(col61) DEFERRABLE
(6 rows)

select sqhl_id, sqhl_schema, sqhl_table, sqhl_hole_size from emaj.emaj_seq_hole order by sqhl_id;
 sqhl_id | sqhl_schema | sqhl_table | sqhl_hole_size 
---------+-------------+------------+----------------
     602 | myschema2   | mytbl4     |             20
     603 | myschema2   | mytbl5     |              5
     604 | myschema2   | mytbl6     |             15
     605 | myschema1   | mytbl1     |              1
     606 | myschema1   | mytbl4     |              2
(5 rows)

select rlbk_operation, rlbk_schema, rlbk_tbl_fk, rlbk_nb_rows from emaj.emaj_rlbk_stat 
  order by rlbk_schema, rlbk_tbl_fk, rlbk_datetime, rlbk_operation;
  rlbk_operation  | rlbk_schema |    rlbk_tbl_fk    | rlbk_nb_rows 
------------------+-------------+-------------------+--------------
 del_log          | myschema1   | mytbl1            |            3
 rlbk             | myschema1   | mytbl1            |            3
 del_log          | myschema1   | mytbl1            |            1
 rlbk             | myschema1   | mytbl1            |            1
 rlbk             | myschema1   | mytbl1            |            1
 rlbk             | myschema1   | myTbl3            |           10
 del_log          | myschema1   | mytbl4            |            8
 rlbk             | myschema1   | mytbl4            |            8
 del_log          | myschema1   | mytbl4            |            2
 rlbk             | myschema1   | mytbl4            |            2
 rlbk             | myschema1   | mytbl4            |            2
 set_fk_immediate | myschema1   | mytbl4_col43_fkey |            8
 set_fk_immediate | myschema1   | mytbl4_col43_fkey |            2
 set_fk_immediate | myschema1   | mytbl4_col43_fkey |            2
 add_fk           | myschema1   | mytbl4_col44_fkey |            0
 add_fk           | myschema1   | mytbl4_col44_fkey |            0
 add_fk           | myschema1   | mytbl4_col44_fkey |            0
 rlbk             | myschema2   | mytbl4            |            4
 rlbk             | myschema2   | mytbl4            |            4
 rlbk             | myschema2   | mytbl4            |           12
 del_log          | myschema2   | mytbl4            |           20
 rlbk             | myschema2   | mytbl4            |           20
 set_fk_immediate | myschema2   | mytbl4_col43_fkey |            4
 set_fk_immediate | myschema2   | mytbl4_col43_fkey |            4
 set_fk_immediate | myschema2   | mytbl4_col43_fkey |           12
 set_fk_immediate | myschema2   | mytbl4_col43_fkey |           20
 add_fk           | myschema2   | mytbl4_col44_fkey |            2
 add_fk           | myschema2   | mytbl4_col44_fkey |            2
 add_fk           | myschema2   | mytbl4_col44_fkey |            2
 add_fk           | myschema2   | mytbl4_col44_fkey |            2
 rlbk             | myschema2   | mytbl5            |            1
 rlbk             | myschema2   | mytbl5            |            1
 rlbk             | myschema2   | mytbl5            |            3
 del_log          | myschema2   | mytbl5            |            5
 rlbk             | myschema2   | mytbl5            |            5
 rlbk             | myschema2   | mytbl6            |            3
 rlbk             | myschema2   | mytbl6            |            3
 rlbk             | myschema2   | mytbl6            |            9
 del_log          | myschema2   | mytbl6            |           15
 rlbk             | myschema2   | mytbl6            |           15
 set_fk_immediate | myschema2   | mytbl6_col61_fkey |            3
 set_fk_immediate | myschema2   | mytbl6_col61_fkey |            3
 set_fk_immediate | myschema2   | mytbl6_col61_fkey |            9
 set_fk_immediate | myschema2   | mytbl6_col61_fkey |           15
 set_fk_immediate | myschema2   | mytbl8_col81_fkey |            3
 set_fk_immediate | myschema2   | mytbl8_col81_fkey |            3
 set_fk_immediate | myschema2   | mytbl8_col81_fkey |            9
 set_fk_immediate | myschema2   | mytbl8_col81_fkey |           15
(48 rows)

-- user tables
select * from mySchema1.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
   100 | DEF        | \x00
   101 | DEF        | \x00
   102 | DEF        | \x00
   103 | DEF        | \x00
   104 | DEF        | \x00
   105 | DEF        | \x00
   106 | DEF        | \x00
   107 | DEF        | \x00
   108 | DEF        | \x00
   109 | DEF        | \x00
   110 | DEF        | \x00
(20 rows)

select * from mySchema1.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 12-31-2010
     2 | DEF   | 
     3 | GHI   | 01-02-2010
(3 rows)

select * from mySchema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

select col31,col33 from mySchema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    19 | 10.00
    20 | 10.00
(5 rows)

select * from mySchema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | Step 6     | \x01  | INS       | NEW        |    11996
     1 | Step 6     | \x01  | DEL       | OLD        |    12009
(2 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | col23 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------+------------+----------
(0 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.mySchema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | UPD       | OLD        |    11959
    11 |  5.00 | UPD       | NEW        |    11959
    12 | 10.00 | UPD       | OLD        |    11960
    12 |  5.00 | UPD       | NEW        |    11960
    13 | 10.00 | UPD       | OLD        |    11961
    13 |  5.00 | UPD       | NEW        |    11961
    14 | 10.00 | UPD       | OLD        |    11962
    14 |  5.00 | UPD       | NEW        |    11962
    15 | 10.00 | UPD       | OLD        |    11963
    15 |  5.00 | UPD       | NEW        |    11963
    16 | 10.00 | UPD       | OLD        |    11964
    16 |  5.00 | UPD       | NEW        |    11964
    17 | 10.00 | UPD       | OLD        |    11965
    17 |  5.00 | UPD       | NEW        |    11965
    18 | 10.00 | UPD       | OLD        |    11966
    18 |  5.00 | UPD       | NEW        |    11966
    19 | 10.00 | UPD       | OLD        |    11967
    19 |  5.00 | UPD       | NEW        |    11967
    20 | 10.00 | UPD       | OLD        |    11968
    20 |  5.00 | UPD       | NEW        |    11968
    20 |  5.00 | UPD       | OLD        |    11999
    20 | 10.00 | UPD       | NEW        |    11999
    19 |  5.00 | UPD       | OLD        |    12000
    19 | 10.00 | UPD       | NEW        |    12000
    18 |  5.00 | UPD       | OLD        |    12001
    18 | 10.00 | UPD       | NEW        |    12001
    17 |  5.00 | UPD       | OLD        |    12002
    17 | 10.00 | UPD       | NEW        |    12002
    16 |  5.00 | UPD       | OLD        |    12003
    16 | 10.00 | UPD       | NEW        |    12003
    15 |  5.00 | UPD       | OLD        |    12004
    15 | 10.00 | UPD       | NEW        |    12004
    14 |  5.00 | UPD       | OLD        |    12005
    14 | 10.00 | UPD       | NEW        |    12005
    13 |  5.00 | UPD       | OLD        |    12006
    13 | 10.00 | UPD       | NEW        |    12006
    12 |  5.00 | UPD       | OLD        |    12007
    12 | 10.00 | UPD       | NEW        |    12007
    11 |  5.00 | UPD       | OLD        |    12008
    11 | 10.00 | UPD       | NEW        |    12008
    14 | 10.00 | DEL       | OLD        |    12012
    15 | 10.00 | DEL       | OLD        |    12013
    16 | 10.00 | DEL       | OLD        |    12014
    17 | 10.00 | DEL       | OLD        |    12015
    18 | 10.00 | DEL       | OLD        |    12016
(45 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
    11 |       |     1 |     1 | Step 6     | INS       | NEW        |    11997
    12 |       |     1 |     1 | Step 6     | INS       | NEW        |    11998
    12 |       |     1 |     1 | Step 6     | DEL       | OLD        |    12010
    11 |       |     1 |     1 | Step 6     | DEL       | OLD        |    12011
(4 rows)

--
--		grp1									grp2
--1	M1 up M2 up M3 
--2											M1 up M2 up M3
--3											LR-M2 (->M2%S+M2%E) LR-M3 (->M3%S+M3%E)
--4	R-M2 up M4 up M5 up M6
--5											LR-M2 (->M2%S+M2%E) R-M3
--6	up R-M5 up LR-M4(->M4S+M4E)
--7	up M7 REN-M4S DEL-M4E DEL-M1 DELBEF-M4
--
-----------------------------
-- check grants on other functions to emaj_adm role
-----------------------------
select * from emaj.emaj_verify_all();
  emaj_verify_all  
-------------------
 No error detected
(1 row)

select emaj.emaj_create_group('dummyGroup');
ERROR:  emaj_create_group: Group dummyGroup is unknown in emaj_group_def table.
CONTEXT:  PL/pgSQL function "emaj_create_group" line 7 at RETURN
select emaj.emaj_drop_group('dummyGroup');
ERROR:  _drop_group: group dummyGroup has not been created.
CONTEXT:  SQL statement "SELECT emaj._drop_group(v_groupName, FALSE)"
PL/pgSQL function "emaj_drop_group" line 12 at SQL statement
select emaj.emaj_force_drop_group('dummyGroup');
ERROR:  _drop_group: group dummyGroup has not been created.
CONTEXT:  SQL statement "SELECT emaj._drop_group(v_groupName, TRUE)"
PL/pgSQL function "emaj_force_drop_group" line 17 at SQL statement
select emaj.emaj_get_previous_mark_group('dummyGroup', '2010-01-01');
ERROR:  emaj_get_previous_mark_group: group dummyGroup has not been created.
select emaj.emaj_get_previous_mark_group('dummyGroup', 'EMAJ_LAST_MARK');
ERROR:  emaj_get_previous_mark_group: group dummyGroup has not been created.
select * from emaj.emaj_log_stat_group('dummyGroup', 'dummyMark', NULL); 
ERROR:  emaj_log_stat_group: group dummyGroup has not been created.
select * from emaj.emaj_detailed_log_stat_group('dummyGroup', 'dummyMark', NULL);
ERROR:  emaj_detailed_log_stat_group: group dummyGroup has not been created.
select emaj.emaj_estimate_rollback_duration('dummyGroup', 'dummyMark');
ERROR:  emaj_estimate_rollback_duration: group dummyGroup has not been created or is not in LOGGING state.
select substr(pg_size_pretty(pg_database_size(current_database())),1,0);
 substr 
--------
 
(1 row)

