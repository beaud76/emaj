-- migExtLoggingGroup.sql : Migrate from E-Maj 1.3. to next_version while groups are in logging state.
--
-----------------------------
-- emaj update to next_version
-----------------------------
--\! cp /usr/local/pg912/share/postgresql/extension/emaj.control.0.12.0 /usr/local/pg912/share/postgresql/extension/emaj.control
-- check the extension is available
select * from pg_available_extension_versions where name = 'emaj';
 name |   version    | installed | superuser | relocatable | schema | requires |                                            comment                                             
------+--------------+-----------+-----------+-------------+--------+----------+------------------------------------------------------------------------------------------------
 emaj | next_version | f         | t         | f           | emaj   | {dblink} | E-Maj extension enables fine-grained write logging and time travel on subsets of the database.
(1 row)

--TODO debug
--select * from emaj.emaj_seq_hole order by sqhl_schema, sqhl_table;
--select mark_group, mark_name, mark_id, mark_time_id, mark_datetime, mark_last_seq_hole_id from emaj.emaj_mark order by mark_id;
--select * from emaj.emaj_rlbk order by rlbk_id;
--select mark_group, mark_name, mark_id, mark_datetime, mark_global_seq, mark_last_sequence_id from emaj.emaj_mark order by mark_id;
-- process the extension migration
ALTER EXTENSION emaj UPDATE TO 'next_version';
NOTICE:  CREATE TABLE will create implicit sequence "emaj_time_stamp_time_id_seq" for serial column "emaj_time_stamp.time_id"
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "emaj_time_stamp_pkey" for table "emaj_time_stamp"
NOTICE:  drop cascades to 2 other objects
DETAIL:  drop cascades to constraint emaj_relation_rel_group_fkey on table emaj_relation
drop cascades to constraint emaj_mark_mark_group_fkey on table emaj_mark
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "emaj_group_pkey" for table "emaj_group"
NOTICE:  CREATE TABLE will create implicit sequence "emaj_mark_mark_id_seq" for serial column "emaj_mark.mark_id"
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "emaj_mark_pkey" for table "emaj_mark"
NOTICE:  CREATE TABLE will create implicit sequence "emaj_sequence_sequ_id_seq" for serial column "emaj_sequence.sequ_id"
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "emaj_sequence_pkey" for table "emaj_sequence"
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "emaj_seq_hole_pkey" for table "emaj_seq_hole"
NOTICE:  E-Maj upgrade: internal error, the number of rows in the original emaj_seq_hole (4) doesn't math the number of rows in the new emaj_seq_hole table (0)
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "emaj_rlbk_stat_pkey" for table "emaj_rlbk_stat"
-----------------------------
-- check installation
-----------------------------
-- check impact in catalog
select extname, extversion from pg_extension where extname = 'emaj';
 extname |  extversion  
---------+--------------
 emaj    | next_version
(1 row)

-- check the emaj_param content
SELECT param_value_text FROM emaj.emaj_param WHERE param_key = 'emaj_version';
 param_value_text 
------------------
 2.0.0
(1 row)

-----------------------------
-- Check the tables and sequences after upgrade
-----------------------------
-- emaj tables and sequences
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
       1 |                    | C
       2 |                    | C
       3 |                    | C
       4 |                  0 | M
       5 |                  0 | M
       6 |                  0 | M
       7 |                 29 | M
       8 |                 40 | M
       9 |                    | R
      10 |                    | R
      11 |                 77 | M
      12 |                 81 | M
      13 |                    | R
      14 |                 81 | M
      15 |                 83 | M
      16 |                    | R
      17 |                 83 | M
      18 |                 85 | M
(18 rows)

select last_value, is_called from emaj.emaj_time_stamp_time_id_seq;
 last_value | is_called 
------------+-----------
         18 | t
(1 row)

select group_name, group_is_logging, group_is_rlbk_protected, group_nb_table, group_nb_sequence, group_is_rollbackable, 
       group_creation_time_id, group_last_alter_time_id, group_comment
  from emaj.emaj_group order by group_name;
    group_name    | group_is_logging | group_is_rlbk_protected | group_nb_table | group_nb_sequence | group_is_rollbackable | group_creation_time_id | group_last_alter_time_id | group_comment 
------------------+------------------+-------------------------+----------------+-------------------+-----------------------+------------------------+--------------------------+---------------
 myGroup1         | t                | t                       |              5 |                 1 | t                     |                      1 |                          | 
 myGroup2         | t                | f                       |              4 |                 2 | t                     |                      2 |                          | 
 phil's group#3", | t                | t                       |              2 |                 1 | f                     |                      3 |                          | 
(3 rows)

select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), 
       mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, 
       mark_last_sequence_id, mark_log_rows_before_next, mark_logged_rlbk_target_mark 
  from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    | regexp_replace  | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |  mark_comment  | mark_last_sequence_id | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------------+-----------------+--------------+-----------------+------------------------+----------------+-----------------------+---------------------------+------------------------------
       1 | myGroup1         | M1              |            4 | f               | f                      |                |                     6 |                        29 | 
       2 | myGroup2         | M1              |            5 | f               | f                      |                |                    12 |                        27 | 
       3 | phil's group#3", | M1              |            6 | f               | f                      |                |                    15 |                           | 
       4 | myGroup1         | M2              |            7 | f               | f                      |                |                    21 |                        11 | 
       5 | myGroup1         | M3              |            8 | f               | t                      | Third mark set |                    27 |                           | 
       8 | myGroup2         | M2              |           11 | f               | f                      |                |                    33 |                         4 | 
       9 | myGroup2         | M3              |           12 | f               | f                      |                |                    39 |                         0 | 
      10 | myGroup2         | RLBK_M2_%_START |           14 | f               | f                      |                |                    45 |                         2 | 
      11 | myGroup2         | RLBK_M2_%_DONE  |           15 | f               | f                      |                |                    51 |                         0 | 
      12 | myGroup2         | RLBK_M3_%_START |           17 | f               | f                      |                |                    57 |                         2 | 
      13 | myGroup2         | RLBK_M3_%_DONE  |           18 | f               | f                      |                |                    63 |                           | 
(11 rows)

select last_value, is_called from emaj.emaj_mark_mark_id_seq;
 last_value | is_called 
------------+-----------
         13 | t
(1 row)

select sequ_id, sequ_schema, sequ_name, sequ_time_id, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_start_val, sequ_increment, sequ_max_val, sequ_min_val, sequ_cache_val, sequ_is_cycled, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id |  sequ_schema   |             sequ_name              | sequ_time_id | regexp_replace  | sequ_last_val | sequ_start_val | sequ_increment |    sequ_max_val     | sequ_min_val | sequ_cache_val | sequ_is_cycled | sequ_is_called 
---------+----------------+------------------------------------+--------------+-----------------+---------------+----------------+----------------+---------------------+--------------+----------------+----------------+----------------
       1 | myschema1      | myTbl3_col31_seq                   |            4 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
       2 | emaj           | myschema1_myTbl3_log_seq           |            4 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
       3 | emaj           | myschema1_mytbl1_log_seq           |            4 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
       4 | emaj           | myschema1_mytbl4_log_seq           |            4 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
       5 | emaj           | myschema1_mytbl2_log_seq           |            4 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
       6 | emaj           | myschema1_mytbl2b_log_seq          |            4 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
       7 | myschema2      | myseq1                             |            5 | M1              |          1000 |           1000 |              1 |                2000 |         1000 |              1 | t              | f
       8 | myschema2      | myTbl3_col31_seq                   |            5 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
       9 | emaj           | myschema2_mytbl1_log_seq           |            5 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
      10 | emaj           | myschema2_mytbl2_log_seq           |            5 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
      11 | emaj           | myschema2_myTbl3_log_seq           |            5 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
      12 | emaj           | myschema2_mytbl4_log_seq           |            5 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
      13 | phil's schema3 | phil's seq\1                       |            6 | M1              |          1000 |           1000 |              1 |                2000 |         1000 |              1 | t              | f
      14 | emaj           | phil's schema3_myTbl2\_log_seq     |            6 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
      15 | emaj           | phil's schema3_phil's tbl1_log_seq |            6 | M1              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
      16 | myschema1      | myTbl3_col31_seq                   |            7 | M2              |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      17 | emaj           | myschema1_myTbl3_log_seq           |            7 | M2              |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      18 | emaj           | myschema1_mytbl1_log_seq           |            7 | M2              |            15 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      19 | emaj           | myschema1_mytbl4_log_seq           |            7 | M2              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
      20 | emaj           | myschema1_mytbl2_log_seq           |            7 | M2              |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      21 | emaj           | myschema1_mytbl2b_log_seq          |            7 | M2              |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      22 | myschema1      | myTbl3_col31_seq                   |            8 | M3              |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      23 | emaj           | myschema1_myTbl3_log_seq           |            8 | M3              |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      24 | emaj           | myschema1_mytbl1_log_seq           |            8 | M3              |            18 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      25 | emaj           | myschema1_mytbl4_log_seq           |            8 | M3              |             8 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      26 | emaj           | myschema1_mytbl2_log_seq           |            8 | M3              |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      27 | emaj           | myschema1_mytbl2b_log_seq          |            8 | M3              |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      28 | myschema2      | myseq1                             |           11 | M2              |          1000 |           1000 |              1 |                2000 |         1000 |              1 | t              | t
      29 | myschema2      | myTbl3_col31_seq                   |           11 | M2              |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      30 | emaj           | myschema2_mytbl1_log_seq           |           11 | M2              |            15 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      31 | emaj           | myschema2_mytbl2_log_seq           |           11 | M2              |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      32 | emaj           | myschema2_myTbl3_log_seq           |           11 | M2              |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      33 | emaj           | myschema2_mytbl4_log_seq           |           11 | M2              |             1 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
      34 | myschema2      | myseq1                             |           12 | M3              |          1003 |           1000 |              1 | 9223372036854775807 |         1000 |              1 | f              | t
      35 | myschema2      | myTbl3_col31_seq                   |           12 | M3              |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      36 | emaj           | myschema2_mytbl1_log_seq           |           12 | M3              |            15 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      37 | emaj           | myschema2_mytbl2_log_seq           |           12 | M3              |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      38 | emaj           | myschema2_myTbl3_log_seq           |           12 | M3              |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      39 | emaj           | myschema2_mytbl4_log_seq           |           12 | M3              |             4 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      40 | myschema2      | myseq1                             |           14 | RLBK_M2_%_START |          1003 |           1000 |              1 | 9223372036854775807 |         1000 |              1 | f              | t
      41 | myschema2      | myTbl3_col31_seq                   |           14 | RLBK_M2_%_START |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      42 | emaj           | myschema2_mytbl1_log_seq           |           14 | RLBK_M2_%_START |            15 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      43 | emaj           | myschema2_mytbl2_log_seq           |           14 | RLBK_M2_%_START |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      44 | emaj           | myschema2_myTbl3_log_seq           |           14 | RLBK_M2_%_START |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      45 | emaj           | myschema2_mytbl4_log_seq           |           14 | RLBK_M2_%_START |             4 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      46 | myschema2      | myseq1                             |           15 | RLBK_M2_%_DONE  |          1001 |           1000 |              1 |                2000 |         1000 |              1 | t              | f
      47 | myschema2      | myTbl3_col31_seq                   |           15 | RLBK_M2_%_DONE  |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      48 | emaj           | myschema2_mytbl1_log_seq           |           15 | RLBK_M2_%_DONE  |            15 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      49 | emaj           | myschema2_mytbl2_log_seq           |           15 | RLBK_M2_%_DONE  |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      50 | emaj           | myschema2_myTbl3_log_seq           |           15 | RLBK_M2_%_DONE  |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      51 | emaj           | myschema2_mytbl4_log_seq           |           15 | RLBK_M2_%_DONE  |             6 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      52 | myschema2      | myseq1                             |           17 | RLBK_M3_%_START |          1001 |           1000 |              1 |                2000 |         1000 |              1 | t              | f
      53 | myschema2      | myTbl3_col31_seq                   |           17 | RLBK_M3_%_START |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      54 | emaj           | myschema2_mytbl1_log_seq           |           17 | RLBK_M3_%_START |            15 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      55 | emaj           | myschema2_mytbl2_log_seq           |           17 | RLBK_M3_%_START |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      56 | emaj           | myschema2_myTbl3_log_seq           |           17 | RLBK_M3_%_START |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      57 | emaj           | myschema2_mytbl4_log_seq           |           17 | RLBK_M3_%_START |             6 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      58 | myschema2      | myseq1                             |           18 | RLBK_M3_%_DONE  |          1004 |           1000 |              1 | 9223372036854775807 |         1000 |              1 | f              | f
      59 | myschema2      | myTbl3_col31_seq                   |           18 | RLBK_M3_%_DONE  |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      60 | emaj           | myschema2_mytbl1_log_seq           |           18 | RLBK_M3_%_DONE  |            15 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      61 | emaj           | myschema2_mytbl2_log_seq           |           18 | RLBK_M3_%_DONE  |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      62 | emaj           | myschema2_myTbl3_log_seq           |           18 | RLBK_M3_%_DONE  |            10 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
      63 | emaj           | myschema2_mytbl4_log_seq           |           18 | RLBK_M3_%_DONE  |             8 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
(63 rows)

select last_value, is_called from emaj.emaj_sequence_sequ_id_seq;
 last_value | is_called 
------------+-----------
         63 | t
(1 row)

select sqhl_schema, sqhl_table, sqhl_begin_mark_id, sqhl_end_mark_id, sqhl_hole_size from emaj.emaj_seq_hole order by sqhl_schema, sqhl_table, sqhl_begin_mark_id;
 sqhl_schema | sqhl_table | sqhl_begin_mark_id | sqhl_end_mark_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
(0 rows)

select rlbk_id, rlbk_groups, rlbk_mark, rlbk_is_logged, rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status, rlbk_begin_hist_id, rlbk_is_dblink_used, rlbk_msg from emaj.emaj_rlbk order by rlbk_id;
 rlbk_id | rlbk_groups | rlbk_mark | rlbk_is_logged | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_status | rlbk_begin_hist_id | rlbk_is_dblink_used |                         rlbk_msg                          
---------+-------------+-----------+----------------+-----------------+---------------+------------------+-------------------+-------------+--------------------+---------------------+-----------------------------------------------------------
       1 | {myGroup1}  | M3        | f              |               1 |             5 |                1 |                 1 | COMMITTED   |                 36 | f                   | Completed: 1 tables and 1 sequences effectively processed
       2 | {myGroup1}  | M3        | f              |               1 |             5 |                1 |                 3 | COMMITTED   |                 44 | f                   | Completed: 3 tables and 1 sequences effectively processed
       3 | {myGroup2}  | M2        | t              |               1 |             4 |                2 |                 1 | COMMITTED   |                 66 | f                   | Completed: 1 tables and 2 sequences effectively processed
       4 | {myGroup2}  | M3        | t              |               1 |             4 |                2 |                 1 | COMMITTED   |                 79 | f                   | Completed: 1 tables and 2 sequences effectively processed
(4 rows)

select last_value, is_called from emaj.emaj_rlbk_rlbk_id_seq;
 last_value | is_called 
------------+-----------
          4 | t
(1 row)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |        1
     2 | ABC        | \x0c  | INS       | NEW        |        2
     3 | ABC        | \x0c  | INS       | NEW        |        3
     4 | ABC        | \x0c  | INS       | NEW        |        4
     5 | ABC        | \x0c  | INS       | NEW        |        5
     6 | ABC        | \x0c  | INS       | NEW        |        6
     7 | ABC        | \x0c  | INS       | NEW        |        7
     8 | ABC        | \x0c  | INS       | NEW        |        8
     9 | ABC        | \x0c  | INS       | NEW        |        9
    10 | ABC        | \x0c  | INS       | NEW        |       10
    11 | ABC        | \x0c  | INS       | NEW        |       11
     1 | ABC        | \x0c  | UPD       | OLD        |       12
     1 | ABC        | \x1c  | UPD       | NEW        |       12
     2 | ABC        | \x0c  | UPD       | OLD        |       13
     2 | ABC        | \x1c  | UPD       | NEW        |       13
     3 | ABC        | \x0c  | UPD       | OLD        |       14
     3 | ABC        | \x1c  | UPD       | NEW        |       14
    11 | ABC        | \x0c  | DEL       | OLD        |       17
    10 | ABC        | \x0c  | DEL       | OLD        |       35
     1 | ABC        | \x1c  | UPD       | OLD        |       37
     1 | DEF        | \x1c  | UPD       | NEW        |       37
     2 | ABC        | \x1c  | UPD       | OLD        |       38
     2 | DEF        | \x1c  | UPD       | NEW        |       38
(23 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 12-31-2010 | INS       | NEW        |       15
     2 | DEF   |            | INS       | NEW        |       18
(2 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 |     1 | INS       | NEW        |       16
     2 |     2 | INS       | NEW        |       19
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |       20
     2 | 10.00 | INS       | NEW        |       21
     3 | 10.00 | INS       | NEW        |       22
     4 | 10.00 | INS       | NEW        |       23
     5 | 10.00 | INS       | NEW        |       24
     6 | 10.00 | INS       | NEW        |       25
     7 | 10.00 | INS       | NEW        |       26
     8 | 10.00 | INS       | NEW        |       27
     9 | 10.00 | INS       | NEW        |       28
    10 | 10.00 | INS       | NEW        |       29
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |       30
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |       31
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |       32
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |       32
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |       33
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |       33
     3 | FK... |     1 |    10 | ABC        | INS       | NEW        |       34
     3 | FK... |     1 |    10 | ABC        | DEL       | OLD        |       36
     1 | FK... |     2 |     1 | ABC        | UPD       | OLD        |       39
     1 | FK... |     2 |     1 |            | UPD       | NEW        |       39
     2 | FK... |     2 |     1 | ABC        | UPD       | OLD        |       40
     2 | FK... |     2 |     1 |            | UPD       | NEW        |       40
(12 rows)

--
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |       51
     2 | ABC        | \x0c  | INS       | NEW        |       52
     3 | ABC        | \x0c  | INS       | NEW        |       53
     4 | ABC        | \x0c  | INS       | NEW        |       54
     5 | ABC        | \x0c  | INS       | NEW        |       55
     6 | ABC        | \x0c  | INS       | NEW        |       56
     7 | ABC        | \x0c  | INS       | NEW        |       57
     8 | ABC        | \x0c  | INS       | NEW        |       58
     9 | ABC        | \x0c  | INS       | NEW        |       59
    10 | ABC        | \x0c  | INS       | NEW        |       60
    11 | ABC        | \x0c  | INS       | NEW        |       61
     1 | ABC        | \x0c  | UPD       | OLD        |       62
     1 | ABC        | \x1c  | UPD       | NEW        |       62
     2 | ABC        | \x0c  | UPD       | OLD        |       63
     2 | ABC        | \x1c  | UPD       | NEW        |       63
     3 | ABC        | \x0c  | UPD       | OLD        |       64
     3 | ABC        | \x1c  | UPD       | NEW        |       64
    11 | ABC        | \x0c  | DEL       | OLD        |       66
(18 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 01-01-2010 | INS       | NEW        |       65
     2 | DEF   |            | INS       | NEW        |       67
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |       68
     2 | 10.00 | INS       | NEW        |       69
     3 | 10.00 | INS       | NEW        |       70
     4 | 10.00 | INS       | NEW        |       71
     5 | 10.00 | INS       | NEW        |       72
     6 | 10.00 | INS       | NEW        |       73
     7 | 10.00 | INS       | NEW        |       74
     8 | 10.00 | INS       | NEW        |       75
     9 | 10.00 | INS       | NEW        |       76
    10 | 10.00 | INS       | NEW        |       77
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |       78
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |       79
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |       80
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |       80
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |       81
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |       81
     1 | FK... |     2 |     1 | ABC        | DEL       | OLD        |       82
     2 | FK... |     2 |     1 | ABC        | DEL       | OLD        |       83
     1 | FK... |     2 |     1 | ABC        | INS       | NEW        |       84
     2 | FK... |     2 |     1 | ABC        | INS       | NEW        |       85
(10 rows)

