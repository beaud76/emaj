-- rollback.sql : test updates log, emaj_rollback_group(), emaj_logged_rollback_group(),
--                emaj_rollback_groups(), emaj_logged_rollback_groups(),
--                emaj_cleanup_rollback_state(), emaj_rollback_activity(),
--                emaj_consolidate_rollback_group() and emaj_get_consolidable_rollbacks() functions.
--
-----------------------------
-- rollback nothing tests
-----------------------------
-- group or groups is NULL
select emaj.emaj_rollback_group(NULL,NULL);
ERROR:  _rlbk_check: group "<NULL>" has not been created.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
select emaj.emaj_logged_rollback_group(NULL,NULL);
ERROR:  _rlbk_check: group "<NULL>" has not been created.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 11 at RETURN
select emaj.emaj_rollback_groups(NULL,NULL);
WARNING:  _check_names_array: No group name to process.
CONTEXT:  PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
 emaj_rollback_groups 
----------------------
                    0
(1 row)

select emaj.emaj_logged_rollback_groups(NULL,NULL);
WARNING:  _check_names_array: No group name to process.
CONTEXT:  PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
 emaj_logged_rollback_groups 
-----------------------------
                           0
(1 row)

-- group is unknown in emaj_group_def
select emaj.emaj_rollback_group('unknownGroup',NULL);
ERROR:  _rlbk_check: group "unknownGroup" has not been created.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
select emaj.emaj_logged_rollback_group('unknownGroup',NULL);
ERROR:  _rlbk_check: group "unknownGroup" has not been created.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 11 at RETURN
select emaj.emaj_rollback_groups('{"unknownGroup"}',NULL);
ERROR:  _rlbk_check: group "unknownGroup" has not been created.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
select emaj.emaj_logged_rollback_groups('{"unknownGroup","myGroup1"}',NULL);
ERROR:  _rlbk_check: group "unknownGroup" has not been created.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
begin;
  select emaj.emaj_start_group('myGroup1','');
 emaj_start_group 
------------------
                6
(1 row)

  select emaj.emaj_rollback_groups('{"myGroup1","unknownGroup"}','EMAJ_LAST_MARK');
ERROR:  _rlbk_check: group "unknownGroup" has not been created.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
rollback;
-- group not in logging state
select emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
ERROR:  _rlbk_check: Group "myGroup1" is not in LOGGING state.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
select emaj.emaj_rollback_group('myGroup2','EMAJ_LAST_MARK');
ERROR:  _rlbk_check: Group "myGroup2" is not in LOGGING state.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
select emaj.emaj_logged_rollback_group('myGroup1','EMAJ_LAST_MARK');
ERROR:  _rlbk_check: Group "myGroup1" is not in LOGGING state.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 11 at RETURN
select emaj.emaj_logged_rollback_group('myGroup2','EMAJ_LAST_MARK');
ERROR:  _rlbk_check: Group "myGroup2" is not in LOGGING state.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 11 at RETURN
select emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}',NULL);
ERROR:  _rlbk_check: Group "myGroup1" is not in LOGGING state.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
begin;
  select emaj.emaj_start_group('myGroup1','');
 emaj_start_group 
------------------
                6
(1 row)

  select emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','EMAJ_LAST_MARK');
ERROR:  _rlbk_check: Group "myGroup2" is not in LOGGING state.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
rollback;
-- start groups and set some marks
select emaj.emaj_start_group('myGroup1','Mark11');
 emaj_start_group 
------------------
                6
(1 row)

select emaj.emaj_start_group('myGroup2','Mark21');
WARNING:  _check_fk_groups: Foreign key "mytbl6_col61_fkey", from table "myschema2.mytbl6", references "myschema2.mytbl7" that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_start_groups" line 36 at PERFORM
SQL statement "SELECT emaj._start_groups(array[v_groupName], v_mark, false, v_resetLog)"
PL/pgSQL function "emaj_start_group" line 17 at SQL statement
WARNING:  _check_fk_groups: table "myschema2.mytbl6" is referenced by foreign key "mytbl8_col81_fkey" from table "myschema2.mytbl8" that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_start_groups" line 36 at PERFORM
SQL statement "SELECT emaj._start_groups(array[v_groupName], v_mark, false, v_resetLog)"
PL/pgSQL function "emaj_start_group" line 17 at SQL statement
 emaj_start_group 
------------------
                8
(1 row)

select emaj.emaj_set_mark_group('myGroup1','Different_Mark');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

select emaj.emaj_set_mark_group('myGroup2','Different_Mark');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

-- log tables are empty
select count(*) from emaj.myschema1_mytbl1_log;
 count 
-------
     0
(1 row)

select count(*) from emaj.myschema1_mytbl2_log;
 count 
-------
     0
(1 row)

select count(*) from emajb.myschema1_mytbl2b_log;
 count 
-------
     0
(1 row)

select count(*) from "emajC"."myschema1_myTbl3_log";
 count 
-------
     0
(1 row)

select count(*) from emaj.myschema1_mytbl4_log;
 count 
-------
     0
(1 row)

select count(*) from emaj.myschema2_mytbl1_log;
 count 
-------
     0
(1 row)

select count(*) from emaj.myschema2_mytbl2_log;
 count 
-------
     0
(1 row)

select count(*) from "emajC"."myschema2_myTbl3_log";
 count 
-------
     0
(1 row)

select count(*) from emaj.myschema2_mytbl4_log;
 count 
-------
     0
(1 row)

-- protected group
select emaj.emaj_protect_group('myGroup1');
 emaj_protect_group 
--------------------
                  1
(1 row)

select emaj.emaj_protect_group('myGroup2');
 emaj_protect_group 
--------------------
                  1
(1 row)

select emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
ERROR:  _rlbk_check: Group "myGroup1" is currently protected against rollback.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
select emaj.emaj_logged_rollback_groups('{"myGroup2","myGroup1"}',NULL);
ERROR:  _rlbk_check: Group "myGroup2" is currently protected against rollback.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
select emaj.emaj_unprotect_group('myGroup1');
 emaj_unprotect_group 
----------------------
                    1
(1 row)

select emaj.emaj_unprotect_group('myGroup2');
 emaj_unprotect_group 
----------------------
                    1
(1 row)

select emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
 emaj_rollback_group 
---------------------
                   1
(1 row)

-- unknown mark name
select emaj.emaj_rollback_group('myGroup1',NULL);
ERROR:  _rlbk_check: No mark "<NULL>" exists for group "myGroup1".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
select emaj.emaj_rollback_group('myGroup1','DummyMark');
ERROR:  _rlbk_check: No mark "DummyMark" exists for group "myGroup1".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
select emaj.emaj_logged_rollback_group('myGroup1',NULL);
ERROR:  _rlbk_check: No mark "<NULL>" exists for group "myGroup1".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 11 at RETURN
select emaj.emaj_logged_rollback_group('myGroup1','DummyMark');
ERROR:  _rlbk_check: No mark "DummyMark" exists for group "myGroup1".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 11 at RETURN
select emaj.emaj_rollback_groups('{"myGroup1","myGroup2",""}',NULL);
WARNING:  _check_names_array: a group name is NULL or empty.
CONTEXT:  PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
ERROR:  _rlbk_check: No mark "<NULL>" exists for group "myGroup1".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
select emaj.emaj_rollback_groups('{"myGroup1","myGroup2",NULL}',NULL);
WARNING:  _check_names_array: a group name is NULL or empty.
CONTEXT:  PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
ERROR:  _rlbk_check: No mark "<NULL>" exists for group "myGroup1".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
select emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','DummyMark');
ERROR:  _rlbk_check: No mark "DummyMark" exists for group "myGroup1".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
select emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2","myGroup2"}',NULL);
WARNING:  _check_names_array: duplicate group name "myGroup2".
CONTEXT:  PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
ERROR:  _rlbk_check: No mark "<NULL>" exists for group "myGroup1".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
select emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mark11');
ERROR:  _rlbk_check: No mark "Mark11" exists for group "myGroup2".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
-- mark name referencing different points in time
select emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Different_Mark');
ERROR:  _rlbk_check: Mark "Different_Mark" does not represent the same point in time for all groups.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
-- attempt to rollback an 'audit_only' group
select emaj.emaj_rollback_group('phil''s group#3",','EMAJ_LAST_MARK');
ERROR:  _rlbk_check: Group "phil's group#3"," has been created for audit only purpose.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
select emaj.emaj_logged_rollback_group('phil''s group#3",','M1_audit_only');
ERROR:  _rlbk_check: Group "phil's group#3"," has been created for audit only purpose.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 11 at RETURN
-- attempt to rollback to a stop mark
begin;
  select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               6
(1 row)

  select emaj.emaj_start_group('myGroup1','StartMark',false);
 emaj_start_group 
------------------
                6
(1 row)

  select emaj.emaj_rename_mark_group('myGroup1',(select emaj.emaj_get_previous_mark_group('myGroup1','StartMark')), 'GeneratedStopMark');
 emaj_rename_mark_group 
------------------------
 
(1 row)

  select emaj.emaj_rollback_group('myGroup1','GeneratedStopMark');
ERROR:  _rlbk_check: mark "GeneratedStopMark" for group "myGroup1" is not usable for rollback.
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
rollback;
-- attempt to rollback over protected marks
begin;
  select emaj.emaj_set_mark_group('myGroup1','Protected Mark 1');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

  select emaj.emaj_protect_mark_group('myGroup1','Protected Mark 1');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select emaj.emaj_set_mark_group('myGroup1','Protected Mark 2');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

  select emaj.emaj_protect_mark_group('myGroup1','Protected Mark 2');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select emaj.emaj_rollback_group('myGroup1','Mark11');
ERROR:  _rlbk_check: protected marks (Protected Mark 1, Protected Mark 2) for group "myGroup1" block the rollback to mark "Mark11".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
rollback;
-- attempt to rollback several groups over one single-mark protected marks
begin;
  select emaj.emaj_set_mark_groups('{"myGroup1","myGroup2"}','Common Mark 1');
 emaj_set_mark_groups 
----------------------
                   14
(1 row)

  select emaj.emaj_set_mark_group('myGroup1','Protected Mark 1');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

  select emaj.emaj_protect_mark_group('myGroup1','Protected Mark 1');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Common Mark 1');
ERROR:  _rlbk_check: protected marks (Protected Mark 1) for group "myGroup1" block the rollback to mark "Common Mark 1".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
rollback;
-- attempt to logged-rollback over a protected mark
begin;
  select emaj.emaj_protect_mark_group('myGroup1','EMAJ_LAST_MARK');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select emaj.emaj_logged_rollback_group('myGroup1','Mark11');
ERROR:  _rlbk_check: protected marks (Different_Mark) for group "myGroup1" block the rollback to mark "Mark11".
CONTEXT:  SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark)"
PL/pgSQL function "_rlbk_init" line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 11 at RETURN
rollback;
-- rollback to a protected mark
begin;
  select emaj.emaj_protect_mark_group('myGroup1','EMAJ_LAST_MARK');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
 emaj_rollback_group 
---------------------
                   1
(1 row)

rollback;
-- missing application table and mono-group rollback
begin;
  drop table mySchema2."myTbl3" cascade;
  select emaj.emaj_rollback_group('myGroup2','Mark21');
ERROR:  _verify_group: In group "myGroup2", the table "myschema2"."myTbl3" does not exist any more. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  SQL statement "SELECT 0 FROM emaj._verify_groups(v_groupNames, true)"
PL/pgSQL function "_rlbk_init" line 27 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
rollback;
begin;
  drop table mySchema2."myTbl3" cascade;
  select emaj.emaj_logged_rollback_group('myGroup2','Mark21');
ERROR:  _verify_group: In group "myGroup2", the table "myschema2"."myTbl3" does not exist any more. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  SQL statement "SELECT 0 FROM emaj._verify_groups(v_groupNames, true)"
PL/pgSQL function "_rlbk_init" line 27 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 11 at RETURN
rollback;
-- should be OK, with different cases of dblink status
-- hide dblink_connect functions
alter function public.dblink_connect_u(text,text) rename to renamed_dblink_connect_u;
alter function public.dblink_connect_u(text) rename to renamed_dblink_connect_u;
select emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
 emaj_rollback_group 
---------------------
                   1
(1 row)

select emaj.emaj_rollback_group('myGroup2','Mark21');
WARNING:  _check_fk_groups: Foreign key "mytbl6_col61_fkey", from table "myschema2.mytbl6", references "myschema2.mytbl7" that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
WARNING:  _check_fk_groups: table "myschema2.mytbl6" is referenced by foreign key "mytbl8_col81_fkey" from table "myschema2.mytbl8" that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_group" line 7 at RETURN
 emaj_rollback_group 
---------------------
                   2
(1 row)

alter function public.renamed_dblink_connect_u(text,text) rename to dblink_connect_u;
alter function public.renamed_dblink_connect_u(text) rename to dblink_connect_u;
-- dblink_connect not in path
set search_path='emaj';
select emaj.emaj_logged_rollback_group('myGroup1','EMAJ_LAST_MARK');
 emaj_logged_rollback_group 
----------------------------
                          1
(1 row)

select emaj.emaj_logged_rollback_group('myGroup2','Mark21');
WARNING:  _check_fk_groups: Foreign key "mytbl6_col61_fkey", from table "myschema2.mytbl6", references "myschema2.mytbl7" that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 11 at RETURN
WARNING:  _check_fk_groups: table "myschema2.mytbl6" is referenced by foreign key "mytbl8_col81_fkey" from table "myschema2.mytbl8" that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_group" line 11 at RETURN
 emaj_logged_rollback_group 
----------------------------
                          2
(1 row)

reset search_path;
select emaj.emaj_set_mark_groups('{"myGroup1","myGroup2"}','Mark1B');
 emaj_set_mark_groups 
----------------------
                   14
(1 row)

-- no user/password defined in emaj_param
select emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','EMAJ_LAST_MARK');
WARNING:  _check_fk_groups: Foreign key "mytbl6_col61_fkey", from table "myschema2.mytbl6", references "myschema2.mytbl7" that is outside groups (myGroup1,myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
WARNING:  _check_fk_groups: table "myschema2.mytbl6" is referenced by foreign key "mytbl8_col81_fkey" from table "myschema2.mytbl8" that is outside groups (myGroup1,myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
 emaj_rollback_groups 
----------------------
                    3
(1 row)

-- bad user/password defined in emaj_param
insert into emaj.emaj_param (param_key, param_value_text) 
  values ('dblink_user_password','user=<user> password=<password>');
select emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
WARNING:  _check_fk_groups: Foreign key "mytbl6_col61_fkey", from table "myschema2.mytbl6", references "myschema2.mytbl7" that is outside groups (myGroup1,myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
WARNING:  _check_fk_groups: table "myschema2.mytbl6" is referenced by foreign key "mytbl8_col81_fkey" from table "myschema2.mytbl8" that is outside groups (myGroup1,myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
 emaj_rollback_groups 
----------------------
                    3
(1 row)

-- transaction not in READ COMMITTED isolation level => the dblink connection is not possible
begin;
  set transaction isolation level repeatable read;
  select emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','EMAJ_LAST_MARK');
WARNING:  _check_fk_groups: Foreign key "mytbl6_col61_fkey", from table "myschema2.mytbl6", references "myschema2.mytbl7" that is outside groups (myGroup1,myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
WARNING:  _check_fk_groups: table "myschema2.mytbl6" is referenced by foreign key "mytbl8_col81_fkey" from table "myschema2.mytbl8" that is outside groups (myGroup1,myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
 emaj_logged_rollback_groups 
-----------------------------
                           3
(1 row)

commit;
-- dblink connection should now be ok (missing right on dblink functions is tested in adm1.sql)
update emaj.emaj_param set param_value_text = 'user=postgres password=postgres' 
  where param_key = 'dblink_user_password';
select emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
WARNING:  _check_fk_groups: Foreign key "mytbl6_col61_fkey", from table "myschema2.mytbl6", references "myschema2.mytbl7" that is outside groups (myGroup1,myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
WARNING:  _check_fk_groups: table "myschema2.mytbl6" is referenced by foreign key "mytbl8_col81_fkey" from table "myschema2.mytbl8" that is outside groups (myGroup1,myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_rlbk_init" line 69 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
 emaj_logged_rollback_groups 
-----------------------------
                           3
(1 row)

-- missing application table and multi-groups rollback
begin;
  drop table mySchema2."myTbl3" cascade;
  select emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
ERROR:  _verify_group: In group "myGroup2", the table "myschema2"."myTbl3" does not exist any more. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  SQL statement "SELECT 0 FROM emaj._verify_groups(v_groupNames, true)"
PL/pgSQL function "_rlbk_init" line 27 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_rollback_groups" line 7 at RETURN
rollback;
begin;
  drop table mySchema2."myTbl3" cascade;
  select emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
ERROR:  _verify_group: In group "myGroup2", the table "myschema2"."myTbl3" does not exist any more. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  SQL statement "SELECT 0 FROM emaj._verify_groups(v_groupNames, true)"
PL/pgSQL function "_rlbk_init" line 27 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function "_rlbk_groups" line 20 at SQL statement
PL/pgSQL function "emaj_logged_rollback_groups" line 11 at RETURN
rollback;
-- restart groups
select emaj.emaj_stop_groups('{"myGroup1","myGroup2"}');
 emaj_stop_groups 
------------------
               14
(1 row)

select emaj.emaj_start_group('myGroup1','Mark11');
 emaj_start_group 
------------------
                6
(1 row)

select emaj.emaj_start_group('myGroup2','Mark21');
WARNING:  _check_fk_groups: Foreign key "mytbl6_col61_fkey", from table "myschema2.mytbl6", references "myschema2.mytbl7" that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_start_groups" line 36 at PERFORM
SQL statement "SELECT emaj._start_groups(array[v_groupName], v_mark, false, v_resetLog)"
PL/pgSQL function "emaj_start_group" line 17 at SQL statement
WARNING:  _check_fk_groups: table "myschema2.mytbl6" is referenced by foreign key "mytbl8_col81_fkey" from table "myschema2.mytbl8" that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function "_start_groups" line 36 at PERFORM
SQL statement "SELECT emaj._start_groups(array[v_groupName], v_mark, false, v_resetLog)"
PL/pgSQL function "emaj_start_group" line 17 at SQL statement
 emaj_start_group 
------------------
                8
(1 row)

-----------------------------
-- log phase #1 with 2 unlogged rollbacks
-----------------------------
-- Populate application tables
set search_path=public,myschema1;
-- inserts/updates/deletes in myTbl1, myTbl2 and myTbl2b (via trigger)
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
begin transaction;
  update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
  insert into myTbl2 values (1,'ABC',current_date);
commit;
delete from myTbl1 where col11 > 10;
insert into myTbl2 values (2,'DEF',NULL);
insert into myTbl2 values (3,'GHI',NULL);
update myTbl2 set col22 = NULL WHERE col23 IS NULL;
delete from myTbl2 where col21 = 3 and col22 is NULL;
select count(*) from mytbl1;
 count 
-------
    10
(1 row)

select count(*) from mytbl2;
 count 
-------
     2
(1 row)

select count(*) from mytbl2b;
 count 
-------
     6
(1 row)

select count(*) from "myTbl3";
 count 
-------
     0
(1 row)

select count(*) from myTbl4;
 count 
-------
     0
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark12');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_last_sequence_id, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected | mark_comment | mark_last_sequence_id | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------------+----------------+--------------+-----------------+------------------------+--------------+-----------------------+---------------------------+------------------------------
     319 | phil's group#3", | Mark4          |          314 | f               | f                      |              |                  3137 |                           | 
     435 | myGroup1         | Mark11         |          432 | f               | f                      |              |                  4201 |                        27 | 
     436 | myGroup2         | Mark21         |          433 | f               | f                      |              |                  4209 |                           | 
     437 | myGroup1         | Mark12         |          434 | f               | f                      |              |                  4215 |                           | 
(4 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id |  sequ_schema   |             sequ_name              | regexp_replace | sequ_last_val | sequ_is_called 
---------+----------------+------------------------------------+----------------+---------------+----------------
    3134 | phil's schema3 | myTbl2\_col21_seq                  | Mark4          |             1 | f
    3135 | phil's schema3 | phil's seq\1                       | Mark4          |          1000 | f
    3136 | emaj           | phil's schema3_myTbl2\_log_seq     | Mark4          |             1 | f
    3137 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | Mark4          |             1 | f
    4196 | myschema1      | myTbl3_col31_seq                   | Mark11         |             1 | f
    4197 | emajC          | myschema1_myTbl3_log_seq           | Mark11         |             1 | f
    4198 | emaj           | myschema1_mytbl1_log_seq           | Mark11         |             1 | f
    4199 | emaj           | myschema1_mytbl4_log_seq           | Mark11         |             1 | f
    4200 | emaj           | myschema1_mytbl2_log_seq           | Mark11         |             1 | f
    4201 | emajb          | myschema1_mytbl2b_log_seq          | Mark11         |             1 | f
    4202 | myschema2      | myseq1                             | Mark21         |          1000 | f
    4203 | myschema2      | myTbl3_col31_seq                   | Mark21         |             1 | f
    4204 | emaj           | myschema2_mytbl1_log_seq           | Mark21         |             1 | f
    4205 | emaj           | myschema2_mytbl2_log_seq           | Mark21         |             1 | f
    4206 | emajC          | myschema2_myTbl3_log_seq           | Mark21         |             1 | f
    4207 | emaj           | myschema2_mytbl4_log_seq           | Mark21         |             1 | f
    4208 | emaj           | otherPrefix4mytbl5_log_seq         | Mark21         |             1 | f
    4209 | emaj           | myschema2_mytbl6_log_seq           | Mark21         |             1 | f
    4210 | myschema1      | myTbl3_col31_seq                   | Mark12         |             1 | f
    4211 | emajC          | myschema1_myTbl3_log_seq           | Mark12         |             1 | f
    4212 | emaj           | myschema1_mytbl1_log_seq           | Mark12         |            15 | t
    4213 | emaj           | myschema1_mytbl4_log_seq           | Mark12         |             1 | f
    4214 | emaj           | myschema1_mytbl2_log_seq           | Mark12         |             6 | t
    4215 | emajb          | myschema1_mytbl2b_log_seq          | Mark12         |             6 | t
(24 rows)

-- inserts/updates/deletes in myTbl3 and myTbl4
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
insert into myTbl4 values (1,'FK...',1,1,'ABC');
update myTbl4 set col43 = NULL where col41 = 1;
select count(*) from "myTbl3";
 count 
-------
    10
(1 row)

select count(*) from myTbl4;
 count 
-------
     1
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark13');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_last_sequence_id, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected | mark_comment | mark_last_sequence_id | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------------+----------------+--------------+-----------------+------------------------+--------------+-----------------------+---------------------------+------------------------------
     319 | phil's group#3", | Mark4          |          314 | f               | f                      |              |                  3137 |                           | 
     435 | myGroup1         | Mark11         |          432 | f               | f                      |              |                  4201 |                        27 | 
     436 | myGroup2         | Mark21         |          433 | f               | f                      |              |                  4209 |                           | 
     437 | myGroup1         | Mark12         |          434 | f               | f                      |              |                  4215 |                        12 | 
     438 | myGroup1         | Mark13         |          435 | f               | f                      |              |                  4221 |                           | 
(5 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id |  sequ_schema   |             sequ_name              | regexp_replace | sequ_last_val | sequ_is_called 
---------+----------------+------------------------------------+----------------+---------------+----------------
    3134 | phil's schema3 | myTbl2\_col21_seq                  | Mark4          |             1 | f
    3135 | phil's schema3 | phil's seq\1                       | Mark4          |          1000 | f
    3136 | emaj           | phil's schema3_myTbl2\_log_seq     | Mark4          |             1 | f
    3137 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | Mark4          |             1 | f
    4196 | myschema1      | myTbl3_col31_seq                   | Mark11         |             1 | f
    4197 | emajC          | myschema1_myTbl3_log_seq           | Mark11         |             1 | f
    4198 | emaj           | myschema1_mytbl1_log_seq           | Mark11         |             1 | f
    4199 | emaj           | myschema1_mytbl4_log_seq           | Mark11         |             1 | f
    4200 | emaj           | myschema1_mytbl2_log_seq           | Mark11         |             1 | f
    4201 | emajb          | myschema1_mytbl2b_log_seq          | Mark11         |             1 | f
    4202 | myschema2      | myseq1                             | Mark21         |          1000 | f
    4203 | myschema2      | myTbl3_col31_seq                   | Mark21         |             1 | f
    4204 | emaj           | myschema2_mytbl1_log_seq           | Mark21         |             1 | f
    4205 | emaj           | myschema2_mytbl2_log_seq           | Mark21         |             1 | f
    4206 | emajC          | myschema2_myTbl3_log_seq           | Mark21         |             1 | f
    4207 | emaj           | myschema2_mytbl4_log_seq           | Mark21         |             1 | f
    4208 | emaj           | otherPrefix4mytbl5_log_seq         | Mark21         |             1 | f
    4209 | emaj           | myschema2_mytbl6_log_seq           | Mark21         |             1 | f
    4210 | myschema1      | myTbl3_col31_seq                   | Mark12         |             1 | f
    4211 | emajC          | myschema1_myTbl3_log_seq           | Mark12         |             1 | f
    4212 | emaj           | myschema1_mytbl1_log_seq           | Mark12         |            15 | t
    4213 | emaj           | myschema1_mytbl4_log_seq           | Mark12         |             1 | f
    4214 | emaj           | myschema1_mytbl2_log_seq           | Mark12         |             6 | t
    4215 | emajb          | myschema1_mytbl2b_log_seq          | Mark12         |             6 | t
    4216 | myschema1      | myTbl3_col31_seq                   | Mark13         |            10 | t
    4217 | emajC          | myschema1_myTbl3_log_seq           | Mark13         |            10 | t
    4218 | emaj           | myschema1_mytbl1_log_seq           | Mark13         |            15 | t
    4219 | emaj           | myschema1_mytbl4_log_seq           | Mark13         |             2 | t
    4220 | emaj           | myschema1_mytbl2_log_seq           | Mark13         |             6 | t
    4221 | emajb          | myschema1_mytbl2b_log_seq          | Mark13         |             6 | t
(30 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_mytbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |        3
     2 | ABC        | \x0c  | INS       | NEW        |        4
     3 | ABC        | \x0c  | INS       | NEW        |        5
     4 | ABC        | \x0c  | INS       | NEW        |        6
     5 | ABC        | \x0c  | INS       | NEW        |        7
     6 | ABC        | \x0c  | INS       | NEW        |        8
     7 | ABC        | \x0c  | INS       | NEW        |        9
     8 | ABC        | \x0c  | INS       | NEW        |       10
     9 | ABC        | \x0c  | INS       | NEW        |       11
    10 | ABC        | \x0c  | INS       | NEW        |       12
    11 | ABC        | \x0c  | INS       | NEW        |       13
     1 | ABC        | \x0c  | UPD       | OLD        |       14
     1 | ABC        | \x1c  | UPD       | NEW        |       14
     2 | ABC        | \x0c  | UPD       | OLD        |       15
     2 | ABC        | \x1c  | UPD       | NEW        |       15
     3 | ABC        | \x0c  | UPD       | OLD        |       16
     3 | ABC        | \x1c  | UPD       | NEW        |       16
    11 | ABC        | \x0c  | DEL       | OLD        |       19
(18 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_mytbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |       17
     2 | DEF   | INS       | NEW        |       20
     3 | GHI   | INS       | NEW        |       22
     2 | DEF   | UPD       | OLD        |       24
     2 |       | UPD       | NEW        |       24
     3 | GHI   | UPD       | OLD        |       26
     3 |       | UPD       | NEW        |       26
     3 |       | DEL       | OLD        |       28
(8 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.myschema1_mytbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 |     1 | INS       | NEW        |       18
     2 |     2 | INS       | NEW        |       21
     3 |     3 | INS       | NEW        |       23
     4 |     2 | INS       | NEW        |       25
     5 |     3 | INS       | NEW        |       27
     6 |     3 | INS       | NEW        |       29
(6 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |       30
     2 | 10.00 | INS       | NEW        |       31
     3 | 10.00 | INS       | NEW        |       32
     4 | 10.00 | INS       | NEW        |       33
     5 | 10.00 | INS       | NEW        |       34
     6 | 10.00 | INS       | NEW        |       35
     7 | 10.00 | INS       | NEW        |       36
     8 | 10.00 | INS       | NEW        |       37
     9 | 10.00 | INS       | NEW        |       38
    10 | 10.00 | INS       | NEW        |       39
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |       40
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |       41
     1 | FK... |       |     1 | ABC        | UPD       | NEW        |       41
(3 rows)

-- rollback #1
alter table mySchema1.myTbl2 disable trigger myTbl2trg;
select emaj.emaj_rollback_group('myGroup1','Mark12');
 emaj_rollback_group 
---------------------
                   3
(1 row)

alter table mySchema1.myTbl2 enable trigger myTbl2trg;
-- check impact
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_last_sequence_id, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected | mark_comment | mark_last_sequence_id | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------------+----------------+--------------+-----------------+------------------------+--------------+-----------------------+---------------------------+------------------------------
     319 | phil's group#3", | Mark4          |          314 | f               | f                      |              |                  3137 |                           | 
     435 | myGroup1         | Mark11         |          432 | f               | f                      |              |                  4201 |                        27 | 
     436 | myGroup2         | Mark21         |          433 | f               | f                      |              |                  4209 |                           | 
     437 | myGroup1         | Mark12         |          434 | f               | f                      |              |                  4215 |                           | 
(4 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id |  sequ_schema   |             sequ_name              | regexp_replace | sequ_last_val | sequ_is_called 
---------+----------------+------------------------------------+----------------+---------------+----------------
    3134 | phil's schema3 | myTbl2\_col21_seq                  | Mark4          |             1 | f
    3135 | phil's schema3 | phil's seq\1                       | Mark4          |          1000 | f
    3136 | emaj           | phil's schema3_myTbl2\_log_seq     | Mark4          |             1 | f
    3137 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | Mark4          |             1 | f
    4196 | myschema1      | myTbl3_col31_seq                   | Mark11         |             1 | f
    4197 | emajC          | myschema1_myTbl3_log_seq           | Mark11         |             1 | f
    4198 | emaj           | myschema1_mytbl1_log_seq           | Mark11         |             1 | f
    4199 | emaj           | myschema1_mytbl4_log_seq           | Mark11         |             1 | f
    4200 | emaj           | myschema1_mytbl2_log_seq           | Mark11         |             1 | f
    4201 | emajb          | myschema1_mytbl2b_log_seq          | Mark11         |             1 | f
    4202 | myschema2      | myseq1                             | Mark21         |          1000 | f
    4203 | myschema2      | myTbl3_col31_seq                   | Mark21         |             1 | f
    4204 | emaj           | myschema2_mytbl1_log_seq           | Mark21         |             1 | f
    4205 | emaj           | myschema2_mytbl2_log_seq           | Mark21         |             1 | f
    4206 | emajC          | myschema2_myTbl3_log_seq           | Mark21         |             1 | f
    4207 | emaj           | myschema2_mytbl4_log_seq           | Mark21         |             1 | f
    4208 | emaj           | otherPrefix4mytbl5_log_seq         | Mark21         |             1 | f
    4209 | emaj           | myschema2_mytbl6_log_seq           | Mark21         |             1 | f
    4210 | myschema1      | myTbl3_col31_seq                   | Mark12         |             1 | f
    4211 | emajC          | myschema1_myTbl3_log_seq           | Mark12         |             1 | f
    4212 | emaj           | myschema1_mytbl1_log_seq           | Mark12         |            15 | t
    4213 | emaj           | myschema1_mytbl4_log_seq           | Mark12         |             1 | f
    4214 | emaj           | myschema1_mytbl2_log_seq           | Mark12         |             6 | t
    4215 | emajb          | myschema1_mytbl2b_log_seq          | Mark12         |             6 | t
    4218 | emaj           | myschema1_mytbl1_log_seq           | Mark13         |            15 | t
    4220 | emaj           | myschema1_mytbl2_log_seq           | Mark13         |             6 | t
    4221 | emajb          | myschema1_mytbl2b_log_seq          | Mark13         |             6 | t
(27 rows)

select sqhl_schema, sqhl_table, sqhl_begin_mark_id, sqhl_end_mark_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_mark_id | sqhl_end_mark_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | myTbl3     |                437 |              439 |             10
 myschema1   | mytbl4     |                437 |              439 |              2
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 | col45 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-------+-----------+------------+----------
(0 rows)

select col31, col33 from myschema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
(0 rows)

select col41, col42, col43, col44, col45 from myschema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- rollback #2 (and stop)
alter table mySchema1.myTbl2 disable trigger myTbl2trg;
select emaj.emaj_rollback_group('myGroup1','Mark11');
 emaj_rollback_group 
---------------------
                   4
(1 row)

alter table mySchema1.myTbl2 enable trigger myTbl2trg;
select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               6
(1 row)

-- check impact
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_last_sequence_id, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected | mark_comment | mark_last_sequence_id | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------------+----------------+--------------+-----------------+------------------------+--------------+-----------------------+---------------------------+------------------------------
     319 | phil's group#3", | Mark4          |          314 | f               | f                      |              |                  3137 |                           | 
     435 | myGroup1         | Mark11         |          432 | t               | f                      |              |                  4201 |                         0 | 
     436 | myGroup2         | Mark21         |          433 | f               | f                      |              |                  4209 |                           | 
     441 | myGroup1         | STOP_%         |          438 | t               | f                      |              |                  4227 |                         0 | 
(4 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id |  sequ_schema   |             sequ_name              | regexp_replace | sequ_last_val | sequ_is_called 
---------+----------------+------------------------------------+----------------+---------------+----------------
    3134 | phil's schema3 | myTbl2\_col21_seq                  | Mark4          |             1 | f
    3135 | phil's schema3 | phil's seq\1                       | Mark4          |          1000 | f
    3136 | emaj           | phil's schema3_myTbl2\_log_seq     | Mark4          |             1 | f
    3137 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | Mark4          |             1 | f
    4196 | myschema1      | myTbl3_col31_seq                   | Mark11         |             1 | f
    4197 | emajC          | myschema1_myTbl3_log_seq           | Mark11         |             1 | f
    4198 | emaj           | myschema1_mytbl1_log_seq           | Mark11         |             1 | f
    4199 | emaj           | myschema1_mytbl4_log_seq           | Mark11         |             1 | f
    4200 | emaj           | myschema1_mytbl2_log_seq           | Mark11         |             1 | f
    4201 | emajb          | myschema1_mytbl2b_log_seq          | Mark11         |             1 | f
    4202 | myschema2      | myseq1                             | Mark21         |          1000 | f
    4203 | myschema2      | myTbl3_col31_seq                   | Mark21         |             1 | f
    4204 | emaj           | myschema2_mytbl1_log_seq           | Mark21         |             1 | f
    4205 | emaj           | myschema2_mytbl2_log_seq           | Mark21         |             1 | f
    4206 | emajC          | myschema2_myTbl3_log_seq           | Mark21         |             1 | f
    4207 | emaj           | myschema2_mytbl4_log_seq           | Mark21         |             1 | f
    4208 | emaj           | otherPrefix4mytbl5_log_seq         | Mark21         |             1 | f
    4209 | emaj           | myschema2_mytbl6_log_seq           | Mark21         |             1 | f
    4211 | emajC          | myschema1_myTbl3_log_seq           | Mark12         |             1 | f
    4213 | emaj           | myschema1_mytbl4_log_seq           | Mark12         |             1 | f
    4222 | myschema1      | myTbl3_col31_seq                   | STOP_%         |             1 | f
    4223 | emajC          | myschema1_myTbl3_log_seq           | STOP_%         |            10 | t
    4224 | emaj           | myschema1_mytbl1_log_seq           | STOP_%         |            15 | t
    4225 | emaj           | myschema1_mytbl4_log_seq           | STOP_%         |             2 | t
    4226 | emaj           | myschema1_mytbl2_log_seq           | STOP_%         |             6 | t
    4227 | emajb          | myschema1_mytbl2b_log_seq          | STOP_%         |             6 | t
(26 rows)

select sqhl_schema, sqhl_table, sqhl_begin_mark_id, sqhl_end_mark_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_mark_id | sqhl_end_mark_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | mytbl1     |                435 |              440 |             15
 myschema1   | mytbl2     |                435 |              440 |              6
 myschema1   | mytbl2b    |                435 |              440 |              6
 myschema1   | myTbl3     |                437 |              439 |             10
 myschema1   | mytbl4     |                437 |              439 |              2
(5 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 | col12 | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------+------------+----------
(0 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.myschema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col11, col12, col13 from myschema1.myTbl1 order by col11, col12;
 col11 | col12 | col13 
-------+-------+-------
(0 rows)

select col21, col22 from myschema1.myTbl2 order by col21;
 col21 | col22 
-------+-------
(0 rows)

select col20, col21 from myschema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

-- restart group
select emaj.emaj_start_group('myGroup1','Mark11');
 emaj_start_group 
------------------
                6
(1 row)

-- check the logs are empty again
select count(*) from emaj.myschema1_mytbl1_log;
 count 
-------
     0
(1 row)

select count(*) from emaj.myschema1_mytbl2_log;
 count 
-------
     0
(1 row)

select count(*) from emajb.myschema1_mytbl2b_log;
 count 
-------
     0
(1 row)

select count(*) from "emajC"."myschema1_myTbl3_log";
 count 
-------
     0
(1 row)

select count(*) from emaj.myschema1_mytbl4_log;
 count 
-------
     0
(1 row)

-----------------------------
-- log phase #2 with 2 logged rollbacks
-----------------------------
-- Populate application tables
set search_path=public,myschema1;
-- inserts/updates/deletes in myTbl1, myTbl2 and myTbl2b (via trigger)
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
begin transaction;
  update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
  insert into myTbl2 values (1,'ABC',current_date);
commit;
delete from myTbl1 where col11 > 10;
insert into myTbl2 values (2,'DEF',NULL);
select count(*) from mytbl1;
 count 
-------
    10
(1 row)

select count(*) from mytbl2;
 count 
-------
     2
(1 row)

select count(*) from mytbl2b;
 count 
-------
     2
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark12');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

-- inserts/updates/deletes in myTbl3 and myTbl4
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
insert into myTbl4 values (1,'FK...',1,1,'ABC');
select count(*) from "myTbl3";
 count 
-------
    10
(1 row)

select count(*) from myTbl4;
 count 
-------
     1
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark13');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'),mark_time_id,  mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_last_sequence_id, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected | mark_comment | mark_last_sequence_id | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------------+----------------+--------------+-----------------+------------------------+--------------+-----------------------+---------------------------+------------------------------
     319 | phil's group#3", | Mark4          |          314 | f               | f                      |              |                  3137 |                           | 
     436 | myGroup2         | Mark21         |          433 | f               | f                      |              |                  4209 |                           | 
     442 | myGroup1         | Mark11         |          439 | f               | f                      |              |                  4233 |                        19 | 
     443 | myGroup1         | Mark12         |          440 | f               | f                      |              |                  4239 |                        11 | 
     444 | myGroup1         | Mark13         |          441 | f               | f                      |              |                  4245 |                           | 
(5 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id |  sequ_schema   |             sequ_name              | regexp_replace | sequ_last_val | sequ_is_called 
---------+----------------+------------------------------------+----------------+---------------+----------------
    3134 | phil's schema3 | myTbl2\_col21_seq                  | Mark4          |             1 | f
    3135 | phil's schema3 | phil's seq\1                       | Mark4          |          1000 | f
    3136 | emaj           | phil's schema3_myTbl2\_log_seq     | Mark4          |             1 | f
    3137 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | Mark4          |             1 | f
    4202 | myschema2      | myseq1                             | Mark21         |          1000 | f
    4203 | myschema2      | myTbl3_col31_seq                   | Mark21         |             1 | f
    4204 | emaj           | myschema2_mytbl1_log_seq           | Mark21         |             1 | f
    4205 | emaj           | myschema2_mytbl2_log_seq           | Mark21         |             1 | f
    4206 | emajC          | myschema2_myTbl3_log_seq           | Mark21         |             1 | f
    4207 | emaj           | myschema2_mytbl4_log_seq           | Mark21         |             1 | f
    4208 | emaj           | otherPrefix4mytbl5_log_seq         | Mark21         |             1 | f
    4209 | emaj           | myschema2_mytbl6_log_seq           | Mark21         |             1 | f
    4228 | myschema1      | myTbl3_col31_seq                   | Mark11         |             1 | f
    4229 | emajC          | myschema1_myTbl3_log_seq           | Mark11         |             1 | f
    4230 | emaj           | myschema1_mytbl1_log_seq           | Mark11         |             1 | f
    4231 | emaj           | myschema1_mytbl4_log_seq           | Mark11         |             1 | f
    4232 | emaj           | myschema1_mytbl2_log_seq           | Mark11         |             1 | f
    4233 | emajb          | myschema1_mytbl2b_log_seq          | Mark11         |             1 | f
    4234 | myschema1      | myTbl3_col31_seq                   | Mark12         |             1 | f
    4235 | emajC          | myschema1_myTbl3_log_seq           | Mark12         |             1 | f
    4236 | emaj           | myschema1_mytbl1_log_seq           | Mark12         |            15 | t
    4237 | emaj           | myschema1_mytbl4_log_seq           | Mark12         |             1 | f
    4238 | emaj           | myschema1_mytbl2_log_seq           | Mark12         |             2 | t
    4239 | emajb          | myschema1_mytbl2b_log_seq          | Mark12         |             2 | t
    4240 | myschema1      | myTbl3_col31_seq                   | Mark13         |            10 | t
    4241 | emajC          | myschema1_myTbl3_log_seq           | Mark13         |            10 | t
    4242 | emaj           | myschema1_mytbl1_log_seq           | Mark13         |            15 | t
    4243 | emaj           | myschema1_mytbl4_log_seq           | Mark13         |             1 | t
    4244 | emaj           | myschema1_mytbl2_log_seq           | Mark13         |             2 | t
    4245 | emajb          | myschema1_mytbl2b_log_seq          | Mark13         |             2 | t
(30 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_mytbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |       42
     2 | ABC        | \x0c  | INS       | NEW        |       43
     3 | ABC        | \x0c  | INS       | NEW        |       44
     4 | ABC        | \x0c  | INS       | NEW        |       45
     5 | ABC        | \x0c  | INS       | NEW        |       46
     6 | ABC        | \x0c  | INS       | NEW        |       47
     7 | ABC        | \x0c  | INS       | NEW        |       48
     8 | ABC        | \x0c  | INS       | NEW        |       49
     9 | ABC        | \x0c  | INS       | NEW        |       50
    10 | ABC        | \x0c  | INS       | NEW        |       51
    11 | ABC        | \x0c  | INS       | NEW        |       52
     1 | ABC        | \x0c  | UPD       | OLD        |       53
     1 | ABC        | \x1c  | UPD       | NEW        |       53
     2 | ABC        | \x0c  | UPD       | OLD        |       54
     2 | ABC        | \x1c  | UPD       | NEW        |       54
     3 | ABC        | \x0c  | UPD       | OLD        |       55
     3 | ABC        | \x1c  | UPD       | NEW        |       55
    11 | ABC        | \x0c  | DEL       | OLD        |       58
(18 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_mytbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |       56
     2 | DEF   | INS       | NEW        |       59
(2 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.myschema1_mytbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     7 |     1 | INS       | NEW        |       57
     8 |     2 | INS       | NEW        |       60
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |       61
     2 | 10.00 | INS       | NEW        |       62
     3 | 10.00 | INS       | NEW        |       63
     4 | 10.00 | INS       | NEW        |       64
     5 | 10.00 | INS       | NEW        |       65
     6 | 10.00 | INS       | NEW        |       66
     7 | 10.00 | INS       | NEW        |       67
     8 | 10.00 | INS       | NEW        |       68
     9 | 10.00 | INS       | NEW        |       69
    10 | 10.00 | INS       | NEW        |       70
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |       71
(1 row)

-- logged rollback #1
alter table mySchema1.myTbl2 disable trigger myTbl2trg;
select emaj.emaj_logged_rollback_group('myGroup1','Mark12');
 emaj_logged_rollback_group 
----------------------------
                          3
(1 row)

alter table mySchema1.myTbl2 enable trigger myTbl2trg;
-- check impact
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_last_sequence_id, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    |   regexp_replace    | mark_time_id | mark_is_deleted | mark_is_rlbk_protected | mark_comment | mark_last_sequence_id | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------------+---------------------+--------------+-----------------+------------------------+--------------+-----------------------+---------------------------+------------------------------
     319 | phil's group#3", | Mark4               |          314 | f               | f                      |              |                  3137 |                           | 
     436 | myGroup2         | Mark21              |          433 | f               | f                      |              |                  4209 |                           | 
     442 | myGroup1         | Mark11              |          439 | f               | f                      |              |                  4233 |                        19 | 
     443 | myGroup1         | Mark12              |          440 | f               | f                      |              |                  4239 |                        11 | 
     444 | myGroup1         | Mark13              |          441 | f               | f                      |              |                  4245 |                         0 | 
     445 | myGroup1         | RLBK_Mark12_%_START |          443 | f               | f                      |              |                  4251 |                        11 | 
     446 | myGroup1         | RLBK_Mark12_%_DONE  |          444 | f               | f                      |              |                  4257 |                           | Mark12
(7 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id |  sequ_schema   |             sequ_name              |   regexp_replace    | sequ_last_val | sequ_is_called 
---------+----------------+------------------------------------+---------------------+---------------+----------------
    3134 | phil's schema3 | myTbl2\_col21_seq                  | Mark4               |             1 | f
    3135 | phil's schema3 | phil's seq\1                       | Mark4               |          1000 | f
    3136 | emaj           | phil's schema3_myTbl2\_log_seq     | Mark4               |             1 | f
    3137 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | Mark4               |             1 | f
    4202 | myschema2      | myseq1                             | Mark21              |          1000 | f
    4203 | myschema2      | myTbl3_col31_seq                   | Mark21              |             1 | f
    4204 | emaj           | myschema2_mytbl1_log_seq           | Mark21              |             1 | f
    4205 | emaj           | myschema2_mytbl2_log_seq           | Mark21              |             1 | f
    4206 | emajC          | myschema2_myTbl3_log_seq           | Mark21              |             1 | f
    4207 | emaj           | myschema2_mytbl4_log_seq           | Mark21              |             1 | f
    4208 | emaj           | otherPrefix4mytbl5_log_seq         | Mark21              |             1 | f
    4209 | emaj           | myschema2_mytbl6_log_seq           | Mark21              |             1 | f
    4228 | myschema1      | myTbl3_col31_seq                   | Mark11              |             1 | f
    4229 | emajC          | myschema1_myTbl3_log_seq           | Mark11              |             1 | f
    4230 | emaj           | myschema1_mytbl1_log_seq           | Mark11              |             1 | f
    4231 | emaj           | myschema1_mytbl4_log_seq           | Mark11              |             1 | f
    4232 | emaj           | myschema1_mytbl2_log_seq           | Mark11              |             1 | f
    4233 | emajb          | myschema1_mytbl2b_log_seq          | Mark11              |             1 | f
    4234 | myschema1      | myTbl3_col31_seq                   | Mark12              |             1 | f
    4235 | emajC          | myschema1_myTbl3_log_seq           | Mark12              |             1 | f
    4236 | emaj           | myschema1_mytbl1_log_seq           | Mark12              |            15 | t
    4237 | emaj           | myschema1_mytbl4_log_seq           | Mark12              |             1 | f
    4238 | emaj           | myschema1_mytbl2_log_seq           | Mark12              |             2 | t
    4239 | emajb          | myschema1_mytbl2b_log_seq          | Mark12              |             2 | t
    4240 | myschema1      | myTbl3_col31_seq                   | Mark13              |            10 | t
    4241 | emajC          | myschema1_myTbl3_log_seq           | Mark13              |            10 | t
    4242 | emaj           | myschema1_mytbl1_log_seq           | Mark13              |            15 | t
    4243 | emaj           | myschema1_mytbl4_log_seq           | Mark13              |             1 | t
    4244 | emaj           | myschema1_mytbl2_log_seq           | Mark13              |             2 | t
    4245 | emajb          | myschema1_mytbl2b_log_seq          | Mark13              |             2 | t
    4246 | myschema1      | myTbl3_col31_seq                   | RLBK_Mark12_%_START |            10 | t
    4247 | emajC          | myschema1_myTbl3_log_seq           | RLBK_Mark12_%_START |            10 | t
    4248 | emaj           | myschema1_mytbl1_log_seq           | RLBK_Mark12_%_START |            15 | t
    4249 | emaj           | myschema1_mytbl4_log_seq           | RLBK_Mark12_%_START |             1 | t
    4250 | emaj           | myschema1_mytbl2_log_seq           | RLBK_Mark12_%_START |             2 | t
    4251 | emajb          | myschema1_mytbl2b_log_seq          | RLBK_Mark12_%_START |             2 | t
    4252 | myschema1      | myTbl3_col31_seq                   | RLBK_Mark12_%_DONE  |             1 | f
    4253 | emajC          | myschema1_myTbl3_log_seq           | RLBK_Mark12_%_DONE  |            20 | t
    4254 | emaj           | myschema1_mytbl1_log_seq           | RLBK_Mark12_%_DONE  |            15 | t
    4255 | emaj           | myschema1_mytbl4_log_seq           | RLBK_Mark12_%_DONE  |             2 | t
    4256 | emaj           | myschema1_mytbl2_log_seq           | RLBK_Mark12_%_DONE  |             2 | t
    4257 | emajb          | myschema1_mytbl2b_log_seq          | RLBK_Mark12_%_DONE  |             2 | t
(42 rows)

select sqhl_schema, sqhl_table, sqhl_begin_mark_id, sqhl_end_mark_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_mark_id | sqhl_end_mark_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |       61
     2 | 10.00 | INS       | NEW        |       62
     3 | 10.00 | INS       | NEW        |       63
     4 | 10.00 | INS       | NEW        |       64
     5 | 10.00 | INS       | NEW        |       65
     6 | 10.00 | INS       | NEW        |       66
     7 | 10.00 | INS       | NEW        |       67
     8 | 10.00 | INS       | NEW        |       68
     9 | 10.00 | INS       | NEW        |       69
    10 | 10.00 | INS       | NEW        |       70
     8 | 10.00 | DEL       | OLD        |       72
     3 | 10.00 | DEL       | OLD        |       73
     4 | 10.00 | DEL       | OLD        |       74
     1 | 10.00 | DEL       | OLD        |       75
    10 | 10.00 | DEL       | OLD        |       76
     9 | 10.00 | DEL       | OLD        |       77
     6 | 10.00 | DEL       | OLD        |       78
     2 | 10.00 | DEL       | OLD        |       79
     5 | 10.00 | DEL       | OLD        |       80
     7 | 10.00 | DEL       | OLD        |       81
(20 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |       71
     1 | FK... |     1 |     1 | ABC        | DEL       | OLD        |       82
(2 rows)

select col31, col33 from myschema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
(0 rows)

select col41, col42, col43, col44, col45 from myschema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- logged rollback #2
alter table mySchema1.myTbl2 disable trigger myTbl2trg;
select emaj.emaj_logged_rollback_group('myGroup1','Mark11');
 emaj_logged_rollback_group 
----------------------------
                          6
(1 row)

alter table mySchema1.myTbl2 enable trigger myTbl2trg;
-- check impact
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_last_sequence_id, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    |   regexp_replace    | mark_time_id | mark_is_deleted | mark_is_rlbk_protected | mark_comment | mark_last_sequence_id | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------------+---------------------+--------------+-----------------+------------------------+--------------+-----------------------+---------------------------+------------------------------
     319 | phil's group#3", | Mark4               |          314 | f               | f                      |              |                  3137 |                           | 
     436 | myGroup2         | Mark21              |          433 | f               | f                      |              |                  4209 |                           | 
     442 | myGroup1         | Mark11              |          439 | f               | f                      |              |                  4233 |                        19 | 
     443 | myGroup1         | Mark12              |          440 | f               | f                      |              |                  4239 |                        11 | 
     444 | myGroup1         | Mark13              |          441 | f               | f                      |              |                  4245 |                         0 | 
     445 | myGroup1         | RLBK_Mark12_%_START |          443 | f               | f                      |              |                  4251 |                        11 | 
     446 | myGroup1         | RLBK_Mark12_%_DONE  |          444 | f               | f                      |              |                  4257 |                         0 | Mark12
     447 | myGroup1         | RLBK_Mark11_%_START |          446 | f               | f                      |              |                  4263 |                        14 | 
     448 | myGroup1         | RLBK_Mark11_%_DONE  |          447 | f               | f                      |              |                  4269 |                           | Mark11
(9 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id |  sequ_schema   |             sequ_name              |   regexp_replace    | sequ_last_val | sequ_is_called 
---------+----------------+------------------------------------+---------------------+---------------+----------------
    3134 | phil's schema3 | myTbl2\_col21_seq                  | Mark4               |             1 | f
    3135 | phil's schema3 | phil's seq\1                       | Mark4               |          1000 | f
    3136 | emaj           | phil's schema3_myTbl2\_log_seq     | Mark4               |             1 | f
    3137 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | Mark4               |             1 | f
    4202 | myschema2      | myseq1                             | Mark21              |          1000 | f
    4203 | myschema2      | myTbl3_col31_seq                   | Mark21              |             1 | f
    4204 | emaj           | myschema2_mytbl1_log_seq           | Mark21              |             1 | f
    4205 | emaj           | myschema2_mytbl2_log_seq           | Mark21              |             1 | f
    4206 | emajC          | myschema2_myTbl3_log_seq           | Mark21              |             1 | f
    4207 | emaj           | myschema2_mytbl4_log_seq           | Mark21              |             1 | f
    4208 | emaj           | otherPrefix4mytbl5_log_seq         | Mark21              |             1 | f
    4209 | emaj           | myschema2_mytbl6_log_seq           | Mark21              |             1 | f
    4228 | myschema1      | myTbl3_col31_seq                   | Mark11              |             1 | f
    4229 | emajC          | myschema1_myTbl3_log_seq           | Mark11              |             1 | f
    4230 | emaj           | myschema1_mytbl1_log_seq           | Mark11              |             1 | f
    4231 | emaj           | myschema1_mytbl4_log_seq           | Mark11              |             1 | f
    4232 | emaj           | myschema1_mytbl2_log_seq           | Mark11              |             1 | f
    4233 | emajb          | myschema1_mytbl2b_log_seq          | Mark11              |             1 | f
    4234 | myschema1      | myTbl3_col31_seq                   | Mark12              |             1 | f
    4235 | emajC          | myschema1_myTbl3_log_seq           | Mark12              |             1 | f
    4236 | emaj           | myschema1_mytbl1_log_seq           | Mark12              |            15 | t
    4237 | emaj           | myschema1_mytbl4_log_seq           | Mark12              |             1 | f
    4238 | emaj           | myschema1_mytbl2_log_seq           | Mark12              |             2 | t
    4239 | emajb          | myschema1_mytbl2b_log_seq          | Mark12              |             2 | t
    4240 | myschema1      | myTbl3_col31_seq                   | Mark13              |            10 | t
    4241 | emajC          | myschema1_myTbl3_log_seq           | Mark13              |            10 | t
    4242 | emaj           | myschema1_mytbl1_log_seq           | Mark13              |            15 | t
    4243 | emaj           | myschema1_mytbl4_log_seq           | Mark13              |             1 | t
    4244 | emaj           | myschema1_mytbl2_log_seq           | Mark13              |             2 | t
    4245 | emajb          | myschema1_mytbl2b_log_seq          | Mark13              |             2 | t
    4246 | myschema1      | myTbl3_col31_seq                   | RLBK_Mark12_%_START |            10 | t
    4247 | emajC          | myschema1_myTbl3_log_seq           | RLBK_Mark12_%_START |            10 | t
    4248 | emaj           | myschema1_mytbl1_log_seq           | RLBK_Mark12_%_START |            15 | t
    4249 | emaj           | myschema1_mytbl4_log_seq           | RLBK_Mark12_%_START |             1 | t
    4250 | emaj           | myschema1_mytbl2_log_seq           | RLBK_Mark12_%_START |             2 | t
    4251 | emajb          | myschema1_mytbl2b_log_seq          | RLBK_Mark12_%_START |             2 | t
    4252 | myschema1      | myTbl3_col31_seq                   | RLBK_Mark12_%_DONE  |             1 | f
    4253 | emajC          | myschema1_myTbl3_log_seq           | RLBK_Mark12_%_DONE  |            20 | t
    4254 | emaj           | myschema1_mytbl1_log_seq           | RLBK_Mark12_%_DONE  |            15 | t
    4255 | emaj           | myschema1_mytbl4_log_seq           | RLBK_Mark12_%_DONE  |             2 | t
    4256 | emaj           | myschema1_mytbl2_log_seq           | RLBK_Mark12_%_DONE  |             2 | t
    4257 | emajb          | myschema1_mytbl2b_log_seq          | RLBK_Mark12_%_DONE  |             2 | t
    4258 | myschema1      | myTbl3_col31_seq                   | RLBK_Mark11_%_START |             1 | f
    4259 | emajC          | myschema1_myTbl3_log_seq           | RLBK_Mark11_%_START |            20 | t
    4260 | emaj           | myschema1_mytbl1_log_seq           | RLBK_Mark11_%_START |            15 | t
    4261 | emaj           | myschema1_mytbl4_log_seq           | RLBK_Mark11_%_START |             2 | t
    4262 | emaj           | myschema1_mytbl2_log_seq           | RLBK_Mark11_%_START |             2 | t
    4263 | emajb          | myschema1_mytbl2b_log_seq          | RLBK_Mark11_%_START |             2 | t
    4264 | myschema1      | myTbl3_col31_seq                   | RLBK_Mark11_%_DONE  |             1 | f
    4265 | emajC          | myschema1_myTbl3_log_seq           | RLBK_Mark11_%_DONE  |            20 | t
    4266 | emaj           | myschema1_mytbl1_log_seq           | RLBK_Mark11_%_DONE  |            25 | t
    4267 | emaj           | myschema1_mytbl4_log_seq           | RLBK_Mark11_%_DONE  |             2 | t
    4268 | emaj           | myschema1_mytbl2_log_seq           | RLBK_Mark11_%_DONE  |             4 | t
    4269 | emajb          | myschema1_mytbl2b_log_seq          | RLBK_Mark11_%_DONE  |             4 | t
(54 rows)

select sqhl_schema, sqhl_table, sqhl_begin_mark_id, sqhl_end_mark_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_mark_id | sqhl_end_mark_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
(0 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |       42
     2 | ABC        | \x0c  | INS       | NEW        |       43
     3 | ABC        | \x0c  | INS       | NEW        |       44
     4 | ABC        | \x0c  | INS       | NEW        |       45
     5 | ABC        | \x0c  | INS       | NEW        |       46
     6 | ABC        | \x0c  | INS       | NEW        |       47
     7 | ABC        | \x0c  | INS       | NEW        |       48
     8 | ABC        | \x0c  | INS       | NEW        |       49
     9 | ABC        | \x0c  | INS       | NEW        |       50
    10 | ABC        | \x0c  | INS       | NEW        |       51
    11 | ABC        | \x0c  | INS       | NEW        |       52
     1 | ABC        | \x0c  | UPD       | OLD        |       53
     1 | ABC        | \x1c  | UPD       | NEW        |       53
     2 | ABC        | \x0c  | UPD       | OLD        |       54
     2 | ABC        | \x1c  | UPD       | NEW        |       54
     3 | ABC        | \x0c  | UPD       | OLD        |       55
     3 | ABC        | \x1c  | UPD       | NEW        |       55
    11 | ABC        | \x0c  | DEL       | OLD        |       58
     1 | ABC        | \x1c  | DEL       | OLD        |       83
     2 | ABC        | \x1c  | DEL       | OLD        |       84
     3 | ABC        | \x1c  | DEL       | OLD        |       85
     4 | ABC        | \x0c  | DEL       | OLD        |       86
     5 | ABC        | \x0c  | DEL       | OLD        |       87
     6 | ABC        | \x0c  | DEL       | OLD        |       88
     7 | ABC        | \x0c  | DEL       | OLD        |       89
     8 | ABC        | \x0c  | DEL       | OLD        |       90
     9 | ABC        | \x0c  | DEL       | OLD        |       91
    10 | ABC        | \x0c  | DEL       | OLD        |       92
(28 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |       56
     2 | DEF   | INS       | NEW        |       59
     1 | ABC   | DEL       | OLD        |       93
     2 | DEF   | DEL       | OLD        |       94
(4 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.myschema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     7 |     1 | INS       | NEW        |       57
     8 |     2 | INS       | NEW        |       60
     8 |     2 | DEL       | OLD        |       95
     7 |     1 | DEL       | OLD        |       96
(4 rows)

select col11, col12, col13 from myschema1.myTbl1 order by col11, col12;
 col11 | col12 | col13 
-------+-------+-------
(0 rows)

select col21, col22 from myschema1.myTbl2 order by col21;
 col21 | col22 
-------+-------
(0 rows)

select col20, col21 from myschema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

-----------------------------
-- unlogged rollback of logged rollbacks #3
-----------------------------
alter table mySchema1.myTbl2 disable trigger myTbl2trg;
select emaj.emaj_rollback_group('myGroup1','Mark13');
 emaj_rollback_group 
---------------------
                   6
(1 row)

alter table mySchema1.myTbl2 enable trigger myTbl2trg;
-- check impact
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_last_sequence_id, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected | mark_comment | mark_last_sequence_id | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------------+----------------+--------------+-----------------+------------------------+--------------+-----------------------+---------------------------+------------------------------
     319 | phil's group#3", | Mark4          |          314 | f               | f                      |              |                  3137 |                           | 
     436 | myGroup2         | Mark21         |          433 | f               | f                      |              |                  4209 |                           | 
     442 | myGroup1         | Mark11         |          439 | f               | f                      |              |                  4233 |                        19 | 
     443 | myGroup1         | Mark12         |          440 | f               | f                      |              |                  4239 |                        11 | 
     444 | myGroup1         | Mark13         |          441 | f               | f                      |              |                  4245 |                           | 
(5 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id |  sequ_schema   |             sequ_name              | regexp_replace | sequ_last_val | sequ_is_called 
---------+----------------+------------------------------------+----------------+---------------+----------------
    3134 | phil's schema3 | myTbl2\_col21_seq                  | Mark4          |             1 | f
    3135 | phil's schema3 | phil's seq\1                       | Mark4          |          1000 | f
    3136 | emaj           | phil's schema3_myTbl2\_log_seq     | Mark4          |             1 | f
    3137 | emaj #'3       | phil's schema3_phil's tbl1_log_seq | Mark4          |             1 | f
    4202 | myschema2      | myseq1                             | Mark21         |          1000 | f
    4203 | myschema2      | myTbl3_col31_seq                   | Mark21         |             1 | f
    4204 | emaj           | myschema2_mytbl1_log_seq           | Mark21         |             1 | f
    4205 | emaj           | myschema2_mytbl2_log_seq           | Mark21         |             1 | f
    4206 | emajC          | myschema2_myTbl3_log_seq           | Mark21         |             1 | f
    4207 | emaj           | myschema2_mytbl4_log_seq           | Mark21         |             1 | f
    4208 | emaj           | otherPrefix4mytbl5_log_seq         | Mark21         |             1 | f
    4209 | emaj           | myschema2_mytbl6_log_seq           | Mark21         |             1 | f
    4228 | myschema1      | myTbl3_col31_seq                   | Mark11         |             1 | f
    4229 | emajC          | myschema1_myTbl3_log_seq           | Mark11         |             1 | f
    4230 | emaj           | myschema1_mytbl1_log_seq           | Mark11         |             1 | f
    4231 | emaj           | myschema1_mytbl4_log_seq           | Mark11         |             1 | f
    4232 | emaj           | myschema1_mytbl2_log_seq           | Mark11         |             1 | f
    4233 | emajb          | myschema1_mytbl2b_log_seq          | Mark11         |             1 | f
    4234 | myschema1      | myTbl3_col31_seq                   | Mark12         |             1 | f
    4235 | emajC          | myschema1_myTbl3_log_seq           | Mark12         |             1 | f
    4236 | emaj           | myschema1_mytbl1_log_seq           | Mark12         |            15 | t
    4237 | emaj           | myschema1_mytbl4_log_seq           | Mark12         |             1 | f
    4238 | emaj           | myschema1_mytbl2_log_seq           | Mark12         |             2 | t
    4239 | emajb          | myschema1_mytbl2b_log_seq          | Mark12         |             2 | t
    4240 | myschema1      | myTbl3_col31_seq                   | Mark13         |            10 | t
    4241 | emajC          | myschema1_myTbl3_log_seq           | Mark13         |            10 | t
    4242 | emaj           | myschema1_mytbl1_log_seq           | Mark13         |            15 | t
    4243 | emaj           | myschema1_mytbl4_log_seq           | Mark13         |             1 | t
    4244 | emaj           | myschema1_mytbl2_log_seq           | Mark13         |             2 | t
    4245 | emajb          | myschema1_mytbl2b_log_seq          | Mark13         |             2 | t
(30 rows)

select sqhl_schema, sqhl_table, sqhl_begin_mark_id, sqhl_end_mark_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_mark_id | sqhl_end_mark_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | mytbl1     |                444 |              449 |             10
 myschema1   | mytbl2     |                444 |              449 |              2
 myschema1   | mytbl2b    |                444 |              449 |              2
 myschema1   | myTbl3     |                444 |              449 |             10
 myschema1   | mytbl4     |                444 |              449 |              1
(5 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |       42
     2 | ABC        | \x0c  | INS       | NEW        |       43
     3 | ABC        | \x0c  | INS       | NEW        |       44
     4 | ABC        | \x0c  | INS       | NEW        |       45
     5 | ABC        | \x0c  | INS       | NEW        |       46
     6 | ABC        | \x0c  | INS       | NEW        |       47
     7 | ABC        | \x0c  | INS       | NEW        |       48
     8 | ABC        | \x0c  | INS       | NEW        |       49
     9 | ABC        | \x0c  | INS       | NEW        |       50
    10 | ABC        | \x0c  | INS       | NEW        |       51
    11 | ABC        | \x0c  | INS       | NEW        |       52
     1 | ABC        | \x0c  | UPD       | OLD        |       53
     1 | ABC        | \x1c  | UPD       | NEW        |       53
     2 | ABC        | \x0c  | UPD       | OLD        |       54
     2 | ABC        | \x1c  | UPD       | NEW        |       54
     3 | ABC        | \x0c  | UPD       | OLD        |       55
     3 | ABC        | \x1c  | UPD       | NEW        |       55
    11 | ABC        | \x0c  | DEL       | OLD        |       58
(18 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |       56
     2 | DEF   | INS       | NEW        |       59
(2 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.myschema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     7 |     1 | INS       | NEW        |       57
     8 |     2 | INS       | NEW        |       60
(2 rows)

select col11, col12, col13 from myschema1.myTbl1 order by col11, col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select col21, col22 from myschema1.myTbl2 order by col21;
 col21 | col22 
-------+-------
     1 | ABC
     2 | DEF
(2 rows)

select col20, col21 from myschema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
     7 |     1
     8 |     2
(2 rows)

-----------------------------
-- test use of partitionned tables
-----------------------------
select emaj.emaj_start_group('myGroup4','myGroup4_start');
 emaj_start_group 
------------------
                3
(1 row)

insert into myschema4.myTblM values ('2001-09-11',0,'abc'),('2011-09-11',10,'def'),('2021-09-11',20,'ghi');
select emaj.emaj_set_mark_group('myGroup4','mark1');
 emaj_set_mark_group 
---------------------
                   3
(1 row)

delete from myschema4.myTblM;
select emaj.emaj_logged_rollback_group('myGroup4','mark1');
 emaj_logged_rollback_group 
----------------------------
                          3
(1 row)

select col1, col2, col3, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema4_mytblm_log;
    col1    | col2 | col3 | emaj_verb | emaj_tuple | emaj_gid 
------------+------+------+-----------+------------+----------
 09-11-2021 |   20 | ghi  | INS       | NEW        |       99
 09-11-2021 |   20 | ghi  | DEL       | OLD        |      100
 09-11-2021 |   20 | ghi  | INS       | NEW        |      105
(3 rows)

select col1, col2, col3, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema4_mytblc1_log;
    col1    | col2 | col3 | emaj_verb | emaj_tuple | emaj_gid 
------------+------+------+-----------+------------+----------
 09-11-2001 |    0 | abc  | INS       | NEW        |       97
 09-11-2001 |    0 | abc  | DEL       | OLD        |      101
 09-11-2001 |    0 | abc  | INS       | NEW        |      103
(3 rows)

select col1, col2, col3, emaj_verb, emaj_tuple, emaj_gid from emaj.myschema4_mytblc2_log;
    col1    | col2 | col3 | emaj_verb | emaj_tuple | emaj_gid 
------------+------+------+-----------+------------+----------
 09-11-2011 |   10 | def  | INS       | NEW        |       98
 09-11-2011 |   10 | def  | DEL       | OLD        |      102
 09-11-2011 |   10 | def  | INS       | NEW        |      104
(3 rows)

-- use the functions dedicated to the ppa plugin
-- for an equivalent of "select emaj.emaj_rollback_group('myGroup4','myGroup4_start');"
select emaj._rlbk_async(emaj._rlbk_init(array['myGroup4'], 'myGroup4_start', false, 1, false), false);
 _rlbk_async 
-------------
           3
(1 row)

-- and check the result
select rlbk_id, rlbk_groups, rlbk_mark, rlbk_is_logged, rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence, 
       rlbk_eff_nb_table, rlbk_status, rlbk_msg
 from emaj.emaj_rlbk order by rlbk_id desc limit 1; 
 rlbk_id | rlbk_groups |   rlbk_mark    | rlbk_is_logged | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_status |                         rlbk_msg                          
---------+-------------+----------------+----------------+-----------------+---------------+------------------+-------------------+-------------+-----------------------------------------------------------
      17 | {myGroup4}  | myGroup4_start | f              |               1 |             3 |                0 |                 3 | COMPLETED   | Completed: 3 tables and 0 sequences effectively processed
(1 row)

-----------------------------
-- test emaj_rollback_activity()
-----------------------------
-- insert necessary rows into rollback tables in order to test various cases of emaj_rollback_activity() reports.
-- these tests ares performed inside transactions that are then rolled back.
begin;
-- 1 rollback operation in EXECUTING state, but no rollback steps have started yet
  insert into emaj.emaj_rlbk (rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_datetime, rlbk_is_logged, rlbk_nb_session, 
             rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status, rlbk_start_datetime)
    values (1232,array['group1232'],'mark1232','2000-01-01 01:00:00',true,1,
             5,4,3,'EXECUTING',now()-'0.1 seconds'::interval);
  insert into emaj.emaj_rlbk_plan (rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_fkey,
             rlbp_estimated_duration, rlbp_estimated_quantity, rlbp_start_datetime, rlbp_duration)
    values (1232, 'RLBK_TABLE','schema','t1','','50 seconds'::interval,null,null,null),
           (1232, 'RLBK_TABLE','schema','t2','','30 seconds'::interval,null,null,null),
           (1232, 'RLBK_TABLE','schema','t3','','20 seconds'::interval,null,null,null),
           (1232, 'CTRL+DBLINK','',     '',  '','0.3 second'::interval,3,   null,null);
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status |  rlbk_remaining   | rlbk_completion_pct 
---------+-------------+-------------------+---------------------
    1232 | EXECUTING   | @ 1 min 40.3 secs |                   0
(1 row)

-- the first RLBK_TABLE has started, but the elapse of the step is not yet > estimated duration 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '11.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '11 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't1';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status |  rlbk_remaining   | rlbk_completion_pct 
---------+-------------+-------------------+---------------------
    1232 | EXECUTING   | @ 1 min 29.2 secs |                  11
(1 row)

  select 1.0 - ((20.0 + 30.0)+(50.0 - 11.0) + 2*0.3/3) / (11.1 + (20.0 + 30.0)+(50.0 - 11.0) + 2*0.3/3); -- the completion % should be 11%
        ?column?        
------------------------
 0.11066799601196410768
(1 row)

-- the first RLBK_TABLE is completed, and the step duration < the estimated duration 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '45.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '45 seconds'::interval,
                                 rlbp_duration = '45 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't1';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 50.2 secs    |                  47
(1 row)

  select 1.0 - (20.0 + 30.0 + 2*0.3/3) / (45.1 + (20.0 + 30.0) + 2*0.3/3);  -- the completion % should be 47%
        ?column?        
------------------------
 0.47324239244491080797
(1 row)

-- the second RLBK_TABLE has started, but the elapse of the step is not yet > estimated duration 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '73.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '28 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 22.1 secs    |                  77
(1 row)

  select 1.0 - (20.0 + (30.0 - 28.0) + 1*0.3/3) / (73.1 + (20.0 + (30.0 - 28.0) + 1*0.3/3));  -- the completion % should be 77%
        ?column?        
------------------------
 0.76785714285714285714
(1 row)

-- the second RLBK_TABLE has started, but the elapse of the step is already > estimated duration 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '85.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '40 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 20.1 secs    |                  81
(1 row)

  select 1.0 - (20.0 + 1*0.3/3) / (85.1 + (20.0 + 1*0.3/3));  -- the completion % should be 81%
        ?column?        
------------------------
 0.80893536121673003802
(1 row)

-- the second RLBK_TABLE has started, but the elapse of the step is already > estimated duration 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '105.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '60 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 20.1 secs    |                  84
(1 row)

  select 1.0 - (20.0 + 1*0.3/3) / (105.1 + (20.0 + 1*0.3/3 ));  -- the completion % should be 84%
        ?column?        
------------------------
 0.83945686900958466454
(1 row)

-- the second RLBK_TABLE is completed, and the step duration > the estimated duration 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '110.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '65 seconds'::interval,
                                 rlbp_duration = '65 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 20.1 secs    |                  85
(1 row)

  select 1.0 - (20.0 + 1*0.3/3) / (110.1 + (20.0 + 1*0.3/3));  -- the completion % should be 85%
        ?column?        
------------------------
 0.84562211981566820276
(1 row)

-- the third RLBK_TABLE has started, and is almost completed 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '124.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '19 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't3';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 1 sec        |                  99
(1 row)

  select 1.0 - ((20.0 - 19.0)) / (124.1 + (20.0 - 19.0));  -- the completion % should be 99%
        ?column?        
------------------------
 0.99200639488409272582
(1 row)

rollback;
begin;
-- 1 rollback operation in LOCKING state and without step other than LOCK_TABLE
  insert into emaj.emaj_rlbk (rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_datetime, rlbk_is_logged, rlbk_nb_session, 
             rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status, rlbk_start_datetime)
    values (1233,array['group1233'],'mark1233','2000-01-01 01:00:00',true,1,
             5,4,3,'LOCKING',now()-'2 minutes'::interval);
  insert into emaj.emaj_rlbk_plan (rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_fkey,
             rlbp_estimated_duration, rlbp_start_datetime, rlbp_duration)
    values (1233, 'LOCK_TABLE','schema','t1','',null,null,null),
           (1233, 'LOCK_TABLE','schema','t2','',null,null,null),
           (1233, 'LOCK_TABLE','schema','t3','',null,null,null);
  select rlbk_id, rlbk_status, rlbk_elapse, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_elapse | rlbk_remaining | rlbk_completion_pct 
---------+-------------+-------------+----------------+---------------------
    1233 | LOCKING     | @ 2 mins    | @ 0            |                   0
(1 row)

-- the rollback operation in LOCKING state now has RLBK_TABLE steps
  insert into emaj.emaj_rlbk_plan (rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_fkey,
             rlbp_estimated_duration, rlbp_start_datetime, rlbp_duration)
    values (1233, 'RLBK_TABLE','schema','t1','','0:20:00'::interval,null,null),
           (1233, 'RLBK_TABLE','schema','t2','','0:02:00'::interval,null,null),
           (1233, 'RLBK_TABLE','schema','t3','','0:00:20'::interval,null,null);
  select rlbk_id, rlbk_status, rlbk_elapse, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_elapse |  rlbk_remaining   | rlbk_completion_pct 
---------+-------------+-------------+-------------------+---------------------
    1233 | LOCKING     | @ 2 mins    | @ 22 mins 20 secs |                   0
(1 row)

-- +1 rollback operation in PLANNING state
  insert into emaj.emaj_rlbk (rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_datetime, rlbk_is_logged, rlbk_nb_session, 
             rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status, rlbk_start_datetime)
    values (1234,array['group1234'],'mark1234','2000-01-01 01:00:00',true,1,
             5,4,3,'PLANNING',now()-'1 minute'::interval);
  select rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_datetime, rlbk_is_logged, rlbk_nb_session, rlbk_nb_table,
         rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status, rlbk_elapse, rlbk_remaining, rlbk_completion_pct 
    from emaj._rollback_activity();
 rlbk_id | rlbk_groups | rlbk_mark |      rlbk_mark_datetime      | rlbk_is_logged | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_status | rlbk_elapse |  rlbk_remaining   | rlbk_completion_pct 
---------+-------------+-----------+------------------------------+----------------+-----------------+---------------+------------------+-------------------+-------------+-------------+-------------------+---------------------
    1233 | {group1233} | mark1233  | Sat Jan 01 01:00:00 2000 PST | t              |               1 |             5 |                4 |                 3 | LOCKING     | @ 2 mins    | @ 22 mins 20 secs |                   0
    1234 | {group1234} | mark1234  | Sat Jan 01 01:00:00 2000 PST | t              |               1 |             5 |                4 |                 3 | PLANNING    | @ 1 min     |                   |                   0
(2 rows)

rollback;
-----------------------------
-- test emaj_consolidate_rollback_group() and emaj_get_consolidable_rollbacks()
-----------------------------
-- group is NULL or unknown
select emaj.emaj_consolidate_rollback_group(NULL,NULL);
ERROR:  emaj_consolidate_rollback_group: group "<NULL>" has not been created.
select emaj.emaj_consolidate_rollback_group('unknownGroup',NULL);
ERROR:  emaj_consolidate_rollback_group: group "unknownGroup" has not been created.
-- mark is unknown
select emaj.emaj_consolidate_rollback_group('myGroup1',NULL);
ERROR:  emaj_consolidate_rollback_group: mark "<NULL>" doesn't exist for group "myGroup1".
select emaj.emaj_consolidate_rollback_group('myGroup1','unknown mark');
ERROR:  emaj_consolidate_rollback_group: mark "unknown mark" doesn't exist for group "myGroup1".
-- mark is known but is not an end rollback mark
select emaj.emaj_consolidate_rollback_group('myGroup1','Mark12');
ERROR:  emaj_consolidate_rollback_group: mark "Mark12" for group "myGroup1" is not an end rollback mark.
-- mark is an end rollback mark but the rollback target mark is invalid
begin;
  update emaj.emaj_mark set mark_logged_rlbk_target_mark = 'dummy' where mark_name = 'Mark12';
  select emaj.emaj_consolidate_rollback_group('myGroup1','Mark12');
ERROR:  emaj_consolidate_rollback_group: rollback target mark "dummy" for group "myGroup1" has not been found.
rollback;
-- should be ok
set search_path=public,myschema1;
-- rollback without log rows to delete
select emaj.emaj_set_mark_group('myGroup1','Conso_M1');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

select emaj.emaj_logged_rollback_group('myGroup1','Conso_M1');
 emaj_logged_rollback_group 
----------------------------
                          1
(1 row)

select emaj.emaj_consolidate_rollback_group('myGroup1','EMAJ_LAST_MARK');
 emaj_consolidate_rollback_group 
---------------------------------
                               1
(1 row)

-- mark Conso_M1, updates, mark Conso_M2, updates, logged rlbk back to Conso_M1, updates, rename both marks, consolidate, check and cancel
select emaj.emaj_set_mark_group('myGroup1','Conso_M2');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

insert into myTbl1 select i, 'Test', 'Conso' from generate_series (1000,1011) as i;
insert into myTbl2 values (1000,'TC1',NULL);
delete from myTbl1 where col11 > 1010;
select emaj.emaj_set_mark_group('myGroup1','Conso_M3');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

update myTbl2 set col22 = 'TC2' WHERE col22 ='TC1';
select emaj.emaj_logged_rollback_group('myGroup1','Conso_M2');
 emaj_logged_rollback_group 
----------------------------
                          4
(1 row)

insert into myTbl2 values (1000,'TC3',NULL);
select emaj.emaj_rename_mark_group('myGroup1','Conso_M2','Renamed_conso_M2');
 emaj_rename_mark_group 
------------------------
 
(1 row)

select emaj.emaj_rename_mark_group('myGroup1','EMAJ_LAST_MARK','Renamed_last_mark');
 emaj_rename_mark_group 
------------------------
 
(1 row)

select cons_group, cons_target_rlbk_mark_name, cons_target_rlbk_mark_id, 
       regexp_replace(cons_end_rlbk_mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), cons_end_rlbk_mark_id, cons_rows 
  from emaj.emaj_get_consolidable_rollbacks();
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_id |    regexp_replace    | cons_end_rlbk_mark_id | cons_rows 
------------+----------------------------+--------------------------+----------------------+-----------------------+-----------
 myGroup1   | Conso_M1                   |                      455 | RLBK_Conso_M1_%_DONE |                   457 |         0
 myGroup1   | Renamed_conso_M2           |                      458 | Renamed_last_mark    |                   461 |        33
(2 rows)

select emaj.emaj_consolidate_rollback_group('myGroup1','Renamed_last_mark');
 emaj_consolidate_rollback_group 
---------------------------------
                               4
(1 row)

select cons_group, cons_target_rlbk_mark_name, cons_target_rlbk_mark_id, 
       regexp_replace(cons_end_rlbk_mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), cons_end_rlbk_mark_id, cons_rows 
  from emaj.emaj_get_consolidable_rollbacks();
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_id |    regexp_replace    | cons_end_rlbk_mark_id | cons_rows 
------------+----------------------------+--------------------------+----------------------+-----------------------+-----------
 myGroup1   | Conso_M1                   |                      455 | RLBK_Conso_M1_%_DONE |                   457 |         0
 myGroup1   | Renamed_conso_M2           |                      458 | Renamed_last_mark    |                   461 |         0
(2 rows)

-- consolidate a rollback already consolidated
select emaj.emaj_consolidate_rollback_group('myGroup1','Renamed_last_mark');
 emaj_consolidate_rollback_group 
---------------------------------
                               1
(1 row)

select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_last_sequence_id, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark where mark_group = 'myGroup1' order by mark_id;
 mark_id | mark_group |    regexp_replace    | mark_time_id | mark_is_deleted | mark_is_rlbk_protected | mark_comment | mark_last_sequence_id | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------+----------------------+--------------+-----------------+------------------------+--------------+-----------------------+---------------------------+------------------------------
     442 | myGroup1   | Mark11               |          439 | f               | f                      |              |                  4233 |                        19 | 
     443 | myGroup1   | Mark12               |          440 | f               | f                      |              |                  4239 |                        11 | 
     444 | myGroup1   | Mark13               |          441 | f               | f                      |              |                  4245 |                         0 | 
     455 | myGroup1   | Conso_M1             |          455 | f               | f                      |              |                  4287 |                         0 | 
     457 | myGroup1   | RLBK_Conso_M1_%_DONE |          458 | f               | f                      |              |                  4299 |                         0 | Conso_M1
     458 | myGroup1   | Renamed_conso_M2     |          459 | f               | f                      |              |                  4305 |                         0 | 
     461 | myGroup1   | Renamed_last_mark    |          463 | f               | f                      |              |                  4323 |                           | Renamed_conso_M2
(7 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence where sequ_name like 'myschema1%' order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         |    regexp_replace    | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+----------------------+---------------+----------------
    4229 | emajC       | myschema1_myTbl3_log_seq  | Mark11               |             1 | f
    4230 | emaj        | myschema1_mytbl1_log_seq  | Mark11               |             1 | f
    4231 | emaj        | myschema1_mytbl4_log_seq  | Mark11               |             1 | f
    4232 | emaj        | myschema1_mytbl2_log_seq  | Mark11               |             1 | f
    4233 | emajb       | myschema1_mytbl2b_log_seq | Mark11               |             1 | f
    4235 | emajC       | myschema1_myTbl3_log_seq  | Mark12               |             1 | f
    4236 | emaj        | myschema1_mytbl1_log_seq  | Mark12               |            15 | t
    4237 | emaj        | myschema1_mytbl4_log_seq  | Mark12               |             1 | f
    4238 | emaj        | myschema1_mytbl2_log_seq  | Mark12               |             2 | t
    4239 | emajb       | myschema1_mytbl2b_log_seq | Mark12               |             2 | t
    4241 | emajC       | myschema1_myTbl3_log_seq  | Mark13               |            10 | t
    4242 | emaj        | myschema1_mytbl1_log_seq  | Mark13               |            15 | t
    4243 | emaj        | myschema1_mytbl4_log_seq  | Mark13               |             1 | t
    4244 | emaj        | myschema1_mytbl2_log_seq  | Mark13               |             2 | t
    4245 | emajb       | myschema1_mytbl2b_log_seq | Mark13               |             2 | t
    4283 | emajC       | myschema1_myTbl3_log_seq  | Conso_M1             |            20 | t
    4284 | emaj        | myschema1_mytbl1_log_seq  | Conso_M1             |            25 | t
    4285 | emaj        | myschema1_mytbl4_log_seq  | Conso_M1             |             2 | t
    4286 | emaj        | myschema1_mytbl2_log_seq  | Conso_M1             |             4 | t
    4287 | emajb       | myschema1_mytbl2b_log_seq | Conso_M1             |             4 | t
    4295 | emajC       | myschema1_myTbl3_log_seq  | RLBK_Conso_M1_%_DONE |            20 | t
    4296 | emaj        | myschema1_mytbl1_log_seq  | RLBK_Conso_M1_%_DONE |            25 | t
    4297 | emaj        | myschema1_mytbl4_log_seq  | RLBK_Conso_M1_%_DONE |             2 | t
    4298 | emaj        | myschema1_mytbl2_log_seq  | RLBK_Conso_M1_%_DONE |             4 | t
    4299 | emajb       | myschema1_mytbl2b_log_seq | RLBK_Conso_M1_%_DONE |             4 | t
    4301 | emajC       | myschema1_myTbl3_log_seq  | Renamed_conso_M2     |            20 | t
    4302 | emaj        | myschema1_mytbl1_log_seq  | Renamed_conso_M2     |            25 | t
    4303 | emaj        | myschema1_mytbl4_log_seq  | Renamed_conso_M2     |             2 | t
    4304 | emaj        | myschema1_mytbl2_log_seq  | Renamed_conso_M2     |             4 | t
    4305 | emajb       | myschema1_mytbl2b_log_seq | Renamed_conso_M2     |             4 | t
    4319 | emajC       | myschema1_myTbl3_log_seq  | Renamed_last_mark    |            20 | t
    4320 | emaj        | myschema1_mytbl1_log_seq  | Renamed_last_mark    |            49 | t
    4321 | emaj        | myschema1_mytbl4_log_seq  | Renamed_last_mark    |             2 | t
    4322 | emaj        | myschema1_mytbl2_log_seq  | Renamed_last_mark    |             7 | t
    4323 | emajb       | myschema1_mytbl2b_log_seq | Renamed_last_mark    |            10 | t
(35 rows)

select sqhl_schema, sqhl_table, sqhl_begin_mark_id, sqhl_end_mark_id, sqhl_hole_size from emaj.emaj_seq_hole where sqhl_schema = 'myschema1' order by sqhl_begin_mark_id, sqhl_schema, sqhl_table;
 sqhl_schema | sqhl_table | sqhl_begin_mark_id | sqhl_end_mark_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | mytbl1     |                444 |              449 |             10
 myschema1   | mytbl2     |                444 |              449 |              2
 myschema1   | mytbl2b    |                444 |              449 |              2
 myschema1   | myTbl3     |                444 |              449 |             10
 myschema1   | mytbl4     |                444 |              449 |              1
 myschema1   | mytbl1     |                458 |              461 |             24
 myschema1   | mytbl2     |                458 |              461 |              3
 myschema1   | mytbl2b    |                458 |              461 |              6
(8 rows)

select emaj.emaj_rollback_group('myGroup1','Conso_M1');
 emaj_rollback_group 
---------------------
                   3
(1 row)

-----------------------------
-- test emaj_cleanup_rollback_state()
-----------------------------
-- rollback a transaction with an E-Maj rollback to generate an ABORTED rollback event
begin;
  select emaj.emaj_rollback_group('myGroup4','myGroup4_start');
 emaj_rollback_group 
---------------------
                   0
(1 row)

rollback;
select rlbk_id, rlbk_status, rlbk_begin_hist_id, rlbk_nb_session from emaj.emaj_rlbk
  where rlbk_status in ('PLANNING', 'LOCKING', 'EXECUTING', 'COMPLETED') order by rlbk_id;
 rlbk_id | rlbk_status | rlbk_begin_hist_id | rlbk_nb_session 
---------+-------------+--------------------+-----------------
      19 | COMPLETED   |               4368 |               1
      20 | COMPLETED   |               4393 |               1
      21 | COMPLETED   |               4407 |               1
(3 rows)

select emaj.emaj_cleanup_rollback_state();
 emaj_cleanup_rollback_state 
-----------------------------
                           3
(1 row)

-----------------------------
-- check rollback tables
-----------------------------
select rlbk_id, rlbk_groups, rlbk_mark, rlbk_is_logged, rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence, 
       rlbk_eff_nb_table, rlbk_status, rlbk_begin_hist_id, rlbk_is_dblink_used,
       case when rlbk_end_datetime is null then 'null' else '[ts]' end as "end_datetime", rlbk_msg
  from emaj.emaj_rlbk order by rlbk_id;
 rlbk_id |     rlbk_groups     |   rlbk_mark    | rlbk_is_logged | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_status | rlbk_begin_hist_id | rlbk_is_dblink_used | end_datetime |                         rlbk_msg                          
---------+---------------------+----------------+----------------+-----------------+---------------+------------------+-------------------+-------------+--------------------+---------------------+--------------+-----------------------------------------------------------
       1 | {myGroup1}          | Different_Mark | f              |               1 |             5 |                1 |                 0 | COMMITTED   |               4036 | f                   | [ts]         | Completed: 0 tables and 1 sequences effectively processed
       3 | {myGroup1}          | Different_Mark | f              |               1 |             5 |                1 |                 0 | COMMITTED   |               4083 | f                   | [ts]         | Completed: 0 tables and 1 sequences effectively processed
       4 | {myGroup2}          | Mark21         | f              |               1 |             6 |                2 |                 0 | COMMITTED   |               4089 | f                   | [ts]         | Completed: 0 tables and 2 sequences effectively processed
       5 | {myGroup1}          | Different_Mark | t              |               1 |             5 |                1 |                 0 | COMMITTED   |               4097 | f                   | [ts]         | Completed: 0 tables and 1 sequences effectively processed
       6 | {myGroup2}          | Mark21         | t              |               1 |             6 |                2 |                 0 | COMMITTED   |               4107 | f                   | [ts]         | Completed: 0 tables and 2 sequences effectively processed
       7 | {myGroup1,myGroup2} | Mark1B         | f              |               1 |            11 |                3 |                 0 | COMMITTED   |               4122 | f                   | [ts]         | Completed: 0 tables and 3 sequences effectively processed
       8 | {myGroup1,myGroup2} | Mark1B         | f              |               1 |            11 |                3 |                 0 | COMMITTED   |               4130 | f                   | [ts]         | Completed: 0 tables and 3 sequences effectively processed
       9 | {myGroup1,myGroup2} | Mark1B         | t              |               1 |            11 |                3 |                 0 | COMMITTED   |               4138 | f                   | [ts]         | Completed: 0 tables and 3 sequences effectively processed
      10 | {myGroup1,myGroup2} | Mark1B         | t              |               1 |            11 |                3 |                 0 | COMMITTED   |               4150 | t                   | [ts]         | Completed: 0 tables and 3 sequences effectively processed
      11 | {myGroup1}          | Mark12         | f              |               1 |             5 |                1 |                 2 | COMMITTED   |               4190 | t                   | [ts]         | Completed: 2 tables and 1 sequences effectively processed
      12 | {myGroup1}          | Mark11         | f              |               1 |             5 |                1 |                 3 | COMMITTED   |               4202 | t                   | [ts]         | Completed: 3 tables and 1 sequences effectively processed
      13 | {myGroup1}          | Mark12         | t              |               1 |             5 |                1 |                 2 | COMMITTED   |               4238 | t                   | [ts]         | Completed: 2 tables and 1 sequences effectively processed
      14 | {myGroup1}          | Mark11         | t              |               1 |             5 |                1 |                 5 | COMMITTED   |               4253 | t                   | [ts]         | Completed: 5 tables and 1 sequences effectively processed
      15 | {myGroup1}          | Mark13         | f              |               1 |             5 |                1 |                 5 | COMMITTED   |               4275 | t                   | [ts]         | Completed: 5 tables and 1 sequences effectively processed
      16 | {myGroup4}          | mark1          | t              |               1 |             3 |                0 |                 3 | COMMITTED   |               4308 | t                   | [ts]         | Completed: 3 tables and 0 sequences effectively processed
      17 | {myGroup4}          | myGroup4_start | f              |               1 |             3 |                0 |                 3 | COMMITTED   |               4324 | t                   | [ts]         | Completed: 3 tables and 0 sequences effectively processed
      18 | {myGroup1}          | Conso_M1       | t              |               1 |             5 |                1 |                 0 | COMMITTED   |               4346 | t                   | [ts]         | Completed: 0 tables and 1 sequences effectively processed
      19 | {myGroup1}          | Conso_M2       | t              |               1 |             5 |                1 |                 3 | COMMITTED   |               4368 | t                   | [ts]         | Completed: 3 tables and 1 sequences effectively processed
      20 | {myGroup1}          | Conso_M1       | f              |               1 |             5 |                1 |                 2 | COMMITTED   |               4393 | t                   | [ts]         | Completed: 2 tables and 1 sequences effectively processed
      21 | {myGroup4}          | myGroup4_start | f              |               1 |             3 |                0 |                 0 | ABORTED     |               4407 | t                   | [ts]         | Completed: 0 tables and 0 sequences effectively processed
(20 rows)

select rlbs_rlbk_id, rlbs_session, 
       case when rlbs_end_datetime is null then 'null' else '[ts]' end as "end_datetime"
  from emaj.emaj_rlbk_session order by rlbs_rlbk_id, rlbs_session;
 rlbs_rlbk_id | rlbs_session | end_datetime 
--------------+--------------+--------------
            1 |            1 | [ts]
            3 |            1 | [ts]
            4 |            1 | [ts]
            5 |            1 | [ts]
            6 |            1 | [ts]
            7 |            1 | [ts]
            8 |            1 | [ts]
            9 |            1 | [ts]
           10 |            1 | [ts]
           11 |            1 | [ts]
           12 |            1 | [ts]
           13 |            1 | [ts]
           14 |            1 | [ts]
           15 |            1 | [ts]
           16 |            1 | [ts]
           17 |            1 | [ts]
           18 |            1 | [ts]
           19 |            1 | [ts]
           20 |            1 | [ts]
           21 |            1 | [ts]
(20 rows)

select rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_fkey, rlbp_batch_number, rlbp_session,
       rlbp_fkey_def, rlbp_estimated_quantity, rlbp_estimate_method, rlbp_quantity
  from emaj.emaj_rlbk_plan order by rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_fkey;
 rlbp_rlbk_id |  rlbp_step  | rlbp_schema | rlbp_table |     rlbp_fkey     | rlbp_batch_number | rlbp_session |                                                              rlbp_fkey_def                                                              | rlbp_estimated_quantity | rlbp_estimate_method | rlbp_quantity 
--------------+-------------+-------------+------------+-------------------+-------------------+--------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------------------+----------------------+---------------
           11 | DIS_LOG_TRG | myschema1   | myTbl3     |                   |                 1 |            1 |                                                                                                                                         |                         |                    3 |              
           11 | DIS_LOG_TRG | myschema1   | mytbl4     |                   |                 2 |            1 |                                                                                                                                         |                         |                    3 |              
           11 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey |                 2 |            1 |                                                                                                                                         |                         |                    3 |              
           11 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 2 |            1 |                                                                                                                                         |                         |                    3 |              
           11 | RLBK_TABLE  | myschema1   | myTbl3     |                   |                 1 |            1 |                                                                                                                                         |                      10 |                    3 |            10
           11 | RLBK_TABLE  | myschema1   | mytbl4     |                   |                 2 |            1 |                                                                                                                                         |                       2 |                    3 |             1
           11 | DELETE_LOG  | myschema1   | myTbl3     |                   |                 1 |            1 |                                                                                                                                         |                      10 |                    3 |            10
           11 | DELETE_LOG  | myschema1   | mytbl4     |                   |                 2 |            1 |                                                                                                                                         |                       2 |                    3 |             3
           11 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 2 |            1 |                                                                                                                                         |                       2 |                    3 |              
           11 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |                 2 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           11 | ENA_LOG_TRG | myschema1   | myTbl3     |                   |                 1 |            1 |                                                                                                                                         |                         |                    3 |              
           11 | ENA_LOG_TRG | myschema1   | mytbl4     |                   |                 2 |            1 |                                                                                                                                         |                         |                    3 |              
           11 | CTRL+DBLINK |             |            |                   |                   |              |                                                                                                                                         |                      12 |                    3 |              
           12 | DIS_LOG_TRG | myschema1   | mytbl1     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           12 | DIS_LOG_TRG | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           12 | DIS_LOG_TRG | myschema1   | mytbl2b    |                   |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           12 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           12 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           12 | RLBK_TABLE  | myschema1   | mytbl1     |                   |                 1 |            1 |                                                                                                                                         |                      15 |                    3 |            11
           12 | RLBK_TABLE  | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                       6 |                    3 |             3
           12 | RLBK_TABLE  | myschema1   | mytbl2b    |                   |                 2 |            1 |                                                                                                                                         |                       6 |                    3 |             6
           12 | DELETE_LOG  | myschema1   | mytbl1     |                   |                 1 |            1 |                                                                                                                                         |                      15 |                    3 |            18
           12 | DELETE_LOG  | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                       6 |                    3 |             8
           12 | DELETE_LOG  | myschema1   | mytbl2b    |                   |                 2 |            1 |                                                                                                                                         |                       6 |                    3 |             6
           12 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 1 |            1 |                                                                                                                                         |                       6 |                    2 |              
           12 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |                 1 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           12 | ENA_LOG_TRG | myschema1   | mytbl1     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           12 | ENA_LOG_TRG | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           12 | ENA_LOG_TRG | myschema1   | mytbl2b    |                   |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           12 | CTRL+DBLINK |             |            |                   |                   |              |                                                                                                                                         |                      16 |                    2 |              
           13 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           13 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           13 | RLBK_TABLE  | myschema1   | myTbl3     |                   |                 1 |            1 |                                                                                                                                         |                      10 |                    1 |            10
           13 | RLBK_TABLE  | myschema1   | mytbl4     |                   |                 2 |            1 |                                                                                                                                         |                       1 |                    1 |             1
           13 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 2 |            1 |                                                                                                                                         |                       1 |                    2 |              
           13 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |                 2 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           13 | CTRL+DBLINK |             |            |                   |                   |              |                                                                                                                                         |                       6 |                    2 |              
           14 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | RLBK_TABLE  | myschema1   | mytbl1     |                   |                 2 |            1 |                                                                                                                                         |                      15 |                    1 |            11
           14 | RLBK_TABLE  | myschema1   | mytbl2     |                   |                 2 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           14 | RLBK_TABLE  | myschema1   | mytbl2b    |                   |                 3 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           14 | RLBK_TABLE  | myschema1   | myTbl3     |                   |                 1 |            1 |                                                                                                                                         |                      20 |                    1 |            10
           14 | RLBK_TABLE  | myschema1   | mytbl4     |                   |                 2 |            1 |                                                                                                                                         |                       2 |                    1 |             1
           14 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 2 |            1 |                                                                                                                                         |                       4 |                    2 |              
           14 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |                 2 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           14 | CTRL+DBLINK |             |            |                   |                   |              |                                                                                                                                         |                       9 |                    2 |              
           15 | DIS_LOG_TRG | myschema1   | mytbl1     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | DIS_LOG_TRG | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | DIS_LOG_TRG | myschema1   | mytbl2b    |                   |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | DIS_LOG_TRG | myschema1   | myTbl3     |                   |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | DIS_LOG_TRG | myschema1   | mytbl4     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | RLBK_TABLE  | myschema1   | mytbl1     |                   |                 1 |            1 |                                                                                                                                         |                      10 |                    1 |            10
           15 | RLBK_TABLE  | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           15 | RLBK_TABLE  | myschema1   | mytbl2b    |                   |                 3 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           15 | RLBK_TABLE  | myschema1   | myTbl3     |                   |                 2 |            1 |                                                                                                                                         |                      10 |                    1 |            10
           15 | RLBK_TABLE  | myschema1   | mytbl4     |                   |                 1 |            1 |                                                                                                                                         |                       1 |                    1 |             1
           15 | DELETE_LOG  | myschema1   | mytbl1     |                   |                 1 |            1 |                                                                                                                                         |                      10 |                    1 |            10
           15 | DELETE_LOG  | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           15 | DELETE_LOG  | myschema1   | mytbl2b    |                   |                 3 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           15 | DELETE_LOG  | myschema1   | myTbl3     |                   |                 2 |            1 |                                                                                                                                         |                      10 |                    1 |            10
           15 | DELETE_LOG  | myschema1   | mytbl4     |                   |                 1 |            1 |                                                                                                                                         |                       1 |                    1 |             1
           15 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 1 |            1 |                                                                                                                                         |                       3 |                    2 |              
           15 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |                 1 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           15 | ENA_LOG_TRG | myschema1   | mytbl1     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | ENA_LOG_TRG | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | ENA_LOG_TRG | myschema1   | mytbl2b    |                   |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | ENA_LOG_TRG | myschema1   | myTbl3     |                   |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | ENA_LOG_TRG | myschema1   | mytbl4     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           15 | CTRL+DBLINK |             |            |                   |                   |              |                                                                                                                                         |                      24 |                    2 |              
           16 | RLBK_TABLE  | myschema4   | mytblc1    |                   |                 1 |            1 |                                                                                                                                         |                       1 |                    3 |             1
           16 | RLBK_TABLE  | myschema4   | mytblc2    |                   |                 2 |            1 |                                                                                                                                         |                       1 |                    3 |             1
           16 | RLBK_TABLE  | myschema4   | mytblm     |                   |                 3 |            1 |                                                                                                                                         |                       1 |                    3 |             1
           16 | CTRL+DBLINK |             |            |                   |                   |              |                                                                                                                                         |                       3 |                    2 |              
           17 | DIS_LOG_TRG | myschema4   | mytblc1    |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           17 | DIS_LOG_TRG | myschema4   | mytblc2    |                   |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           17 | DIS_LOG_TRG | myschema4   | mytblm     |                   |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           17 | RLBK_TABLE  | myschema4   | mytblc1    |                   |                 1 |            1 |                                                                                                                                         |                       3 |                    1 |             1
           17 | RLBK_TABLE  | myschema4   | mytblc2    |                   |                 2 |            1 |                                                                                                                                         |                       3 |                    1 |             1
           17 | RLBK_TABLE  | myschema4   | mytblm     |                   |                 3 |            1 |                                                                                                                                         |                       3 |                    1 |             1
           17 | DELETE_LOG  | myschema4   | mytblc1    |                   |                 1 |            1 |                                                                                                                                         |                       3 |                    3 |             3
           17 | DELETE_LOG  | myschema4   | mytblc2    |                   |                 2 |            1 |                                                                                                                                         |                       3 |                    3 |             3
           17 | DELETE_LOG  | myschema4   | mytblm     |                   |                 3 |            1 |                                                                                                                                         |                       3 |                    3 |             3
           17 | ENA_LOG_TRG | myschema4   | mytblc1    |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           17 | ENA_LOG_TRG | myschema4   | mytblc2    |                   |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           17 | ENA_LOG_TRG | myschema4   | mytblm     |                   |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           17 | CTRL+DBLINK |             |            |                   |                   |              |                                                                                                                                         |                      12 |                    2 |              
           19 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           19 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           19 | RLBK_TABLE  | myschema1   | mytbl1     |                   |                 1 |            1 |                                                                                                                                         |                      13 |                    1 |            12
           19 | RLBK_TABLE  | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                       2 |                    1 |             1
           19 | RLBK_TABLE  | myschema1   | mytbl2b    |                   |                 2 |            1 |                                                                                                                                         |                       2 |                    1 |             3
           19 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 1 |            1 |                                                                                                                                         |                       2 |                    2 |              
           19 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |                 1 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           19 | CTRL+DBLINK |             |            |                   |                   |              |                                                                                                                                         |                       7 |                    2 |              
           20 | DIS_LOG_TRG | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           20 | DIS_LOG_TRG | myschema1   | mytbl2b    |                   |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           20 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           20 | RLBK_TABLE  | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                       1 |                    1 |             1
           20 | RLBK_TABLE  | myschema1   | mytbl2b    |                   |                 2 |            1 |                                                                                                                                         |                       1 |                    1 |             2
           20 | DELETE_LOG  | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                       1 |                    1 |             1
           20 | DELETE_LOG  | myschema1   | mytbl2b    |                   |                 2 |            1 |                                                                                                                                         |                       1 |                    1 |             2
           20 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |                 1 |            1 |                                                                                                                                         |                       1 |                    2 |              
           20 | ENA_LOG_TRG | myschema1   | mytbl2     |                   |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           20 | ENA_LOG_TRG | myschema1   | mytbl2b    |                   |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           20 | CTRL+DBLINK |             |            |                   |                   |              |                                                                                                                                         |                      10 |                    2 |              
(108 rows)

select rlbt_step, rlbt_schema, rlbt_table, rlbt_fkey, rlbt_rlbk_id, rlbt_quantity from emaj.emaj_rlbk_stat
  order by rlbt_rlbk_id, rlbt_step, rlbt_schema, rlbt_table, rlbt_fkey;
  rlbt_step  | rlbt_schema | rlbt_table |     rlbt_fkey     | rlbt_rlbk_id | rlbt_quantity 
-------------+-------------+------------+-------------------+--------------+---------------
 DIS_LOG_TRG |             |            |                   |           11 |             2
 DROP_FK     |             |            |                   |           11 |             1
 SET_FK_DEF  |             |            |                   |           11 |             1
 RLBK_TABLE  | myschema1   | myTbl3     |                   |           11 |            10
 RLBK_TABLE  | myschema1   | mytbl4     |                   |           11 |             2
 DELETE_LOG  | myschema1   | myTbl3     |                   |           11 |            10
 DELETE_LOG  | myschema1   | mytbl4     |                   |           11 |             2
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           11 |             2
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           11 |             0
 ENA_LOG_TRG |             |            |                   |           11 |             2
 CTRL+DBLINK |             |            |                   |           11 |            12
 DIS_LOG_TRG |             |            |                   |           12 |             3
 DROP_FK     |             |            |                   |           12 |             1
 SET_FK_DEF  |             |            |                   |           12 |             1
 RLBK_TABLE  | myschema1   | mytbl1     |                   |           12 |            15
 RLBK_TABLE  | myschema1   | mytbl2     |                   |           12 |             6
 RLBK_TABLE  | myschema1   | mytbl2b    |                   |           12 |             6
 DELETE_LOG  | myschema1   | mytbl1     |                   |           12 |            15
 DELETE_LOG  | myschema1   | mytbl2     |                   |           12 |             6
 DELETE_LOG  | myschema1   | mytbl2b    |                   |           12 |             6
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           12 |             6
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           12 |             0
 ENA_LOG_TRG |             |            |                   |           12 |             3
 CTRL+DBLINK |             |            |                   |           12 |            16
 DROP_FK     |             |            |                   |           13 |             1
 SET_FK_DEF  |             |            |                   |           13 |             1
 RLBK_TABLE  | myschema1   | myTbl3     |                   |           13 |            10
 RLBK_TABLE  | myschema1   | mytbl4     |                   |           13 |             1
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           13 |             1
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           13 |             0
 CTRL+DBLINK |             |            |                   |           13 |             6
 DROP_FK     |             |            |                   |           14 |             1
 SET_FK_DEF  |             |            |                   |           14 |             1
 RLBK_TABLE  | myschema1   | mytbl1     |                   |           14 |            15
 RLBK_TABLE  | myschema1   | mytbl2     |                   |           14 |             2
 RLBK_TABLE  | myschema1   | mytbl2b    |                   |           14 |             2
 RLBK_TABLE  | myschema1   | myTbl3     |                   |           14 |            20
 RLBK_TABLE  | myschema1   | mytbl4     |                   |           14 |             2
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           14 |             4
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           14 |             0
 CTRL+DBLINK |             |            |                   |           14 |             9
 DIS_LOG_TRG |             |            |                   |           15 |             5
 DROP_FK     |             |            |                   |           15 |             1
 SET_FK_DEF  |             |            |                   |           15 |             1
 RLBK_TABLE  | myschema1   | mytbl1     |                   |           15 |            10
 RLBK_TABLE  | myschema1   | mytbl2     |                   |           15 |             2
 RLBK_TABLE  | myschema1   | mytbl2b    |                   |           15 |             2
 RLBK_TABLE  | myschema1   | myTbl3     |                   |           15 |            10
 RLBK_TABLE  | myschema1   | mytbl4     |                   |           15 |             1
 DELETE_LOG  | myschema1   | mytbl1     |                   |           15 |            10
 DELETE_LOG  | myschema1   | mytbl2     |                   |           15 |             2
 DELETE_LOG  | myschema1   | mytbl2b    |                   |           15 |             2
 DELETE_LOG  | myschema1   | myTbl3     |                   |           15 |            10
 DELETE_LOG  | myschema1   | mytbl4     |                   |           15 |             1
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           15 |             3
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           15 |             0
 ENA_LOG_TRG |             |            |                   |           15 |             5
 CTRL+DBLINK |             |            |                   |           15 |            24
 RLBK_TABLE  | myschema4   | mytblc1    |                   |           16 |             1
 RLBK_TABLE  | myschema4   | mytblc2    |                   |           16 |             1
 RLBK_TABLE  | myschema4   | mytblm     |                   |           16 |             1
 CTRL+DBLINK |             |            |                   |           16 |             3
 DIS_LOG_TRG |             |            |                   |           17 |             3
 RLBK_TABLE  | myschema4   | mytblc1    |                   |           17 |             3
 RLBK_TABLE  | myschema4   | mytblc2    |                   |           17 |             3
 RLBK_TABLE  | myschema4   | mytblm     |                   |           17 |             3
 DELETE_LOG  | myschema4   | mytblc1    |                   |           17 |             3
 DELETE_LOG  | myschema4   | mytblc2    |                   |           17 |             3
 DELETE_LOG  | myschema4   | mytblm     |                   |           17 |             3
 ENA_LOG_TRG |             |            |                   |           17 |             3
 CTRL+DBLINK |             |            |                   |           17 |            12
 DROP_FK     |             |            |                   |           19 |             1
 SET_FK_DEF  |             |            |                   |           19 |             1
 RLBK_TABLE  | myschema1   | mytbl1     |                   |           19 |            13
 RLBK_TABLE  | myschema1   | mytbl2     |                   |           19 |             2
 RLBK_TABLE  | myschema1   | mytbl2b    |                   |           19 |             2
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           19 |             2
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           19 |             0
 CTRL+DBLINK |             |            |                   |           19 |             7
 DIS_LOG_TRG |             |            |                   |           20 |             2
 SET_FK_DEF  |             |            |                   |           20 |             1
 RLBK_TABLE  | myschema1   | mytbl2     |                   |           20 |             1
 RLBK_TABLE  | myschema1   | mytbl2b    |                   |           20 |             1
 DELETE_LOG  | myschema1   | mytbl2     |                   |           20 |             1
 DELETE_LOG  | myschema1   | mytbl2b    |                   |           20 |             1
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           20 |             1
 ENA_LOG_TRG |             |            |                   |           20 |             2
 CTRL+DBLINK |             |            |                   |           20 |            10
(88 rows)

-----------------------------
-- test end: reset history and force sequences id
-----------------------------
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 300 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
     300 |                  2 | M
     301 |                  2 | M
     302 |                  2 | M
     303 |                  2 | M
     304 |                  2 | M
     305 |                  2 | M
     306 |                  2 | M
     307 |                  2 | M
     308 |                  2 | M
     309 |                  2 | M
     310 |                  2 | M
     311 |                  2 | M
     312 |                  2 | M
     313 |                  2 | M
     314 |                  2 | M
     315 |                  2 | M
     316 |                  2 | M
     402 |                  2 | M
     403 |                  2 | M
     404 |                  2 | M
     405 |                  2 | M
     406 |                  2 | R
     414 |                  2 | R
     415 |                  2 | R
     416 |                  2 | R
     417 |                  2 | M
     418 |                  2 | M
     419 |                  2 | R
     420 |                  2 | M
     421 |                  2 | M
     422 |                  2 | M
     423 |                  2 | R
     424 |                  2 | R
     425 |                  2 | R
     426 |                  2 | M
     427 |                  2 | M
     428 |                  2 | R
     429 |                  2 | M
     430 |                  2 | M
     431 |                  2 | M
     432 |                  2 | M
     433 |                  2 | M
     434 |                 29 | M
     435 |                 41 | M
     436 |                 41 | R
     437 |                 41 | R
     438 |                 41 | M
     439 |                 41 | M
     440 |                 60 | M
     441 |                 71 | M
     442 |                 71 | R
     443 |                 71 | M
     444 |                 82 | M
     445 |                 82 | R
     446 |                 82 | M
     447 |                 96 | M
     448 |                 96 | R
     449 |                 96 | M
     450 |                 99 | M
     451 |                102 | R
     452 |                102 | M
     453 |                105 | M
     454 |                105 | R
     455 |                105 | M
     456 |                105 | R
     457 |                105 | M
     458 |                105 | M
     459 |                105 | M
     460 |                120 | M
     461 |                122 | R
     462 |                122 | M
     463 |                138 | M
     464 |                140 | R
(73 rows)

select hist_id, hist_function, hist_event, hist_object, regexp_replace(regexp_replace(hist_wording,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'),E'\\[.+\\]','(timestamp)','g'), hist_user from 
  (select * from emaj.emaj_hist order by hist_id) as t;
 hist_id |     hist_function      |  hist_event  |         hist_object          |                         regexp_replace                         | hist_user 
---------+------------------------+--------------+------------------------------+----------------------------------------------------------------+-----------
    4012 | START_GROUP            | BEGIN        | myGroup1                     | With log reset                                                 | postgres
    4013 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4014 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4015 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | Mark11                                                         | postgres
    4016 | SET_MARK_GROUP         | END          | myGroup1                     | Mark11                                                         | postgres
    4017 | START_GROUP            | END          | myGroup1                     | 6 tables/sequences processed                                   | postgres
    4018 | START_GROUP            | BEGIN        | myGroup2                     | With log reset                                                 | postgres
    4019 | LOCK_GROUP             | BEGIN        | myGroup2                     |                                                                | postgres
    4020 | LOCK_GROUP             | END          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                 | postgres
    4021 | SET_MARK_GROUP         | BEGIN        | myGroup2                     | Mark21                                                         | postgres
    4022 | SET_MARK_GROUP         | END          | myGroup2                     | Mark21                                                         | postgres
    4023 | START_GROUP            | END          | myGroup2                     | 8 tables/sequences processed                                   | postgres
    4024 | SET_MARK_GROUP         | BEGIN        | myGroup1                     |                                                                | postgres
    4025 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4026 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4027 | SET_MARK_GROUP         | END          | myGroup1                     | Different_Mark                                                 | postgres
    4028 | SET_MARK_GROUP         | BEGIN        | myGroup2                     |                                                                | postgres
    4029 | LOCK_GROUP             | BEGIN        | myGroup2                     |                                                                | postgres
    4030 | LOCK_GROUP             | END          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                 | postgres
    4031 | SET_MARK_GROUP         | END          | myGroup2                     | Different_Mark                                                 | postgres
    4032 | PROTECT_GROUP          |              | myGroup1                     | Status 1                                                       | postgres
    4033 | PROTECT_GROUP          |              | myGroup2                     | Status 1                                                       | postgres
    4034 | UNPROTECT_GROUP        |              | myGroup1                     | Status 1                                                       | postgres
    4035 | UNPROTECT_GROUP        |              | myGroup2                     | Status 1                                                       | postgres
    4036 | ROLLBACK_GROUP         | BEGIN        | myGroup1                     | Unlogged rollback to mark Different_Mark (timestamp)           | postgres
    4037 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = -5                                                    | postgres
    4038 | LOCK_GROUP             | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
    4039 | LOCK_GROUP             | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    4040 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4041 | ROLLBACK_GROUP         | END          | myGroup1                     | Rollback_id 1, 0 tables and 1 sequences effectively processed  | postgres
    4083 | ROLLBACK_GROUP         | BEGIN        | myGroup1                     | Unlogged rollback to mark Different_Mark (timestamp)           | postgres
    4084 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = -1                                                    | postgres
    4085 | LOCK_GROUP             | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
    4086 | LOCK_GROUP             | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    4087 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4088 | ROLLBACK_GROUP         | END          | myGroup1                     | Rollback_id 3, 0 tables and 1 sequences effectively processed  | postgres
    4089 | ROLLBACK_GROUP         | BEGIN        | myGroup2                     | Unlogged rollback to mark Mark21 (timestamp)                   | postgres
    4090 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = -1                                                    | postgres
    4091 | LOCK_GROUP             | BEGIN        | myGroup2                     | Rollback session #1                                            | postgres
    4092 | LOCK_GROUP             | END          | myGroup2                     | Rollback session #1: 6 tables locked, 0 deadlock(s)            | postgres
    4093 | ROLLBACK_GROUP         | MARK DELETED | myGroup2                     | mark Different_Mark is deleted                                 | postgres
    4094 | ROLLBACK_SEQUENCE      |              | myschema2.myseq1             |                                                                | postgres
    4095 | ROLLBACK_SEQUENCE      |              | myschema2."myTbl3_col31_seq" |                                                                | postgres
    4096 | ROLLBACK_GROUP         | END          | myGroup2                     | Rollback_id 4, 0 tables and 2 sequences effectively processed  | postgres
    4097 | ROLLBACK_GROUP         | BEGIN        | myGroup1                     | Logged rollback to mark Different_Mark (timestamp)             | postgres
    4098 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = -2                                                    | postgres
    4099 | LOCK_GROUP             | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
    4100 | LOCK_GROUP             | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    4101 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | RLBK_Different_Mark_%_START                                    | postgres
    4102 | SET_MARK_GROUP         | END          | myGroup1                     | RLBK_Different_Mark_%_START                                    | postgres
    4103 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4104 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | RLBK_Different_Mark_%_DONE                                     | postgres
    4105 | SET_MARK_GROUP         | END          | myGroup1                     | RLBK_Different_Mark_%_DONE                                     | postgres
    4106 | ROLLBACK_GROUP         | END          | myGroup1                     | Rollback_id 5, 0 tables and 1 sequences effectively processed  | postgres
    4107 | ROLLBACK_GROUP         | BEGIN        | myGroup2                     | Logged rollback to mark Mark21 (timestamp)                     | postgres
    4108 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = -2                                                    | postgres
    4109 | LOCK_GROUP             | BEGIN        | myGroup2                     | Rollback session #1                                            | postgres
    4110 | LOCK_GROUP             | END          | myGroup2                     | Rollback session #1: 6 tables locked, 0 deadlock(s)            | postgres
    4111 | SET_MARK_GROUP         | BEGIN        | myGroup2                     | RLBK_Mark21_%_START                                            | postgres
    4112 | SET_MARK_GROUP         | END          | myGroup2                     | RLBK_Mark21_%_START                                            | postgres
    4113 | ROLLBACK_SEQUENCE      |              | myschema2.myseq1             |                                                                | postgres
    4114 | ROLLBACK_SEQUENCE      |              | myschema2."myTbl3_col31_seq" |                                                                | postgres
    4115 | SET_MARK_GROUP         | BEGIN        | myGroup2                     | RLBK_Mark21_%_DONE                                             | postgres
    4116 | SET_MARK_GROUP         | END          | myGroup2                     | RLBK_Mark21_%_DONE                                             | postgres
    4117 | ROLLBACK_GROUP         | END          | myGroup2                     | Rollback_id 6, 0 tables and 2 sequences effectively processed  | postgres
    4118 | SET_MARK_GROUPS        | BEGIN        | myGroup1,myGroup2            | Mark1B                                                         | postgres
    4119 | LOCK_GROUPS            | BEGIN        | myGroup1,myGroup2            |                                                                | postgres
    4120 | LOCK_GROUPS            | END          | myGroup1,myGroup2            | 11 tables locked, 0 deadlock(s)                                | postgres
    4121 | SET_MARK_GROUPS        | END          | myGroup1,myGroup2            | Mark1B                                                         | postgres
    4122 | ROLLBACK_GROUPS        | BEGIN        | myGroup1,myGroup2            | Unlogged rollback to mark Mark1B (timestamp)                   | postgres
    4123 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = -5                                                    | postgres
    4124 | LOCK_GROUP             | BEGIN        | myGroup1,myGroup2            | Rollback session #1                                            | postgres
    4125 | LOCK_GROUP             | END          | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)           | postgres
    4126 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4127 | ROLLBACK_SEQUENCE      |              | myschema2.myseq1             |                                                                | postgres
    4128 | ROLLBACK_SEQUENCE      |              | myschema2."myTbl3_col31_seq" |                                                                | postgres
    4129 | ROLLBACK_GROUPS        | END          | myGroup1,myGroup2            | Rollback_id 7, 0 tables and 3 sequences effectively processed  | postgres
    4130 | ROLLBACK_GROUPS        | BEGIN        | myGroup1,myGroup2            | Unlogged rollback to mark Mark1B (timestamp)                   | postgres
    4131 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = -6                                                    | postgres
    4132 | LOCK_GROUP             | BEGIN        | myGroup1,myGroup2            | Rollback session #1                                            | postgres
    4133 | LOCK_GROUP             | END          | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)           | postgres
    4134 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4135 | ROLLBACK_SEQUENCE      |              | myschema2.myseq1             |                                                                | postgres
    4136 | ROLLBACK_SEQUENCE      |              | myschema2."myTbl3_col31_seq" |                                                                | postgres
    4137 | ROLLBACK_GROUPS        | END          | myGroup1,myGroup2            | Rollback_id 8, 0 tables and 3 sequences effectively processed  | postgres
    4138 | ROLLBACK_GROUPS        | BEGIN        | myGroup1,myGroup2            | Logged rollback to mark Mark1B (timestamp)                     | postgres
    4139 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = -4                                                    | postgres
    4140 | LOCK_GROUP             | BEGIN        | myGroup1,myGroup2            | Rollback session #1                                            | postgres
    4141 | LOCK_GROUP             | END          | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)           | postgres
    4142 | SET_MARK_GROUPS        | BEGIN        | myGroup1,myGroup2            | RLBK_Mark1B_%_START                                            | postgres
    4143 | SET_MARK_GROUPS        | END          | myGroup1,myGroup2            | RLBK_Mark1B_%_START                                            | postgres
    4144 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4145 | ROLLBACK_SEQUENCE      |              | myschema2.myseq1             |                                                                | postgres
    4146 | ROLLBACK_SEQUENCE      |              | myschema2."myTbl3_col31_seq" |                                                                | postgres
    4147 | SET_MARK_GROUPS        | BEGIN        | myGroup1,myGroup2            | RLBK_Mark1B_%_DONE                                             | postgres
    4148 | SET_MARK_GROUPS        | END          | myGroup1,myGroup2            | RLBK_Mark1B_%_DONE                                             | postgres
    4149 | ROLLBACK_GROUPS        | END          | myGroup1,myGroup2            | Rollback_id 9, 0 tables and 3 sequences effectively processed  | postgres
    4150 | ROLLBACK_GROUPS        | BEGIN        | myGroup1,myGroup2            | Logged rollback to mark Mark1B (timestamp)                     | postgres
    4151 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = 1                                                     | postgres
    4152 | LOCK_GROUP             | BEGIN        | myGroup1,myGroup2            | Rollback session #1                                            | postgres
    4153 | LOCK_GROUP             | END          | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)           | postgres
    4154 | SET_MARK_GROUPS        | BEGIN        | myGroup1,myGroup2            | RLBK_Mark1B_%_START                                            | postgres
    4155 | SET_MARK_GROUPS        | END          | myGroup1,myGroup2            | RLBK_Mark1B_%_START                                            | postgres
    4156 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4157 | ROLLBACK_SEQUENCE      |              | myschema2.myseq1             |                                                                | postgres
    4158 | ROLLBACK_SEQUENCE      |              | myschema2."myTbl3_col31_seq" |                                                                | postgres
    4159 | SET_MARK_GROUPS        | BEGIN        | myGroup1,myGroup2            | RLBK_Mark1B_%_DONE                                             | postgres
    4160 | SET_MARK_GROUPS        | END          | myGroup1,myGroup2            | RLBK_Mark1B_%_DONE                                             | postgres
    4161 | ROLLBACK_GROUPS        | END          | myGroup1,myGroup2            | Rollback_id 10, 0 tables and 3 sequences effectively processed | postgres
    4162 | DBLINK_CLOSE_CNX       |              | rlbk#1                       |                                                                | postgres
    4163 | STOP_GROUPS            | BEGIN        | myGroup1,myGroup2            |                                                                | postgres
    4164 | LOCK_GROUPS            | BEGIN        | myGroup1,myGroup2            |                                                                | postgres
    4165 | LOCK_GROUPS            | END          | myGroup1,myGroup2            | 11 tables locked, 0 deadlock(s)                                | postgres
    4166 | SET_MARK_GROUPS        | BEGIN        | myGroup1,myGroup2            | STOP_%                                                         | postgres
    4167 | CLEANUP_RLBK_STATE     |              | rollback id 10               | set to COMMITTED                                               | postgres
    4168 | SET_MARK_GROUPS        | END          | myGroup1,myGroup2            | STOP_%                                                         | postgres
    4169 | STOP_GROUPS            | END          | myGroup1,myGroup2            | 14 tables/sequences processed                                  | postgres
    4170 | START_GROUP            | BEGIN        | myGroup1                     | With log reset                                                 | postgres
    4171 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4172 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4173 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | Mark11                                                         | postgres
    4174 | SET_MARK_GROUP         | END          | myGroup1                     | Mark11                                                         | postgres
    4175 | START_GROUP            | END          | myGroup1                     | 6 tables/sequences processed                                   | postgres
    4176 | START_GROUP            | BEGIN        | myGroup2                     | With log reset                                                 | postgres
    4177 | LOCK_GROUP             | BEGIN        | myGroup2                     |                                                                | postgres
    4178 | LOCK_GROUP             | END          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                 | postgres
    4179 | SET_MARK_GROUP         | BEGIN        | myGroup2                     | Mark21                                                         | postgres
    4180 | SET_MARK_GROUP         | END          | myGroup2                     | Mark21                                                         | postgres
    4181 | START_GROUP            | END          | myGroup2                     | 8 tables/sequences processed                                   | postgres
    4182 | SET_MARK_GROUP         | BEGIN        | myGroup1                     |                                                                | postgres
    4183 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4184 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4185 | SET_MARK_GROUP         | END          | myGroup1                     | Mark12                                                         | postgres
    4186 | SET_MARK_GROUP         | BEGIN        | myGroup1                     |                                                                | postgres
    4187 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4188 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4189 | SET_MARK_GROUP         | END          | myGroup1                     | Mark13                                                         | postgres
    4190 | ROLLBACK_GROUP         | BEGIN        | myGroup1                     | Unlogged rollback to mark Mark12 (timestamp)                   | postgres
    4191 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = 1                                                     | postgres
    4192 | LOCK_GROUP             | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
    4193 | LOCK_GROUP             | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    4194 | ROLLBACK_TABLE         | BEGIN        | myschema1."myTbl3"           | All log rows with emaj_gid > 29                                | postgres
    4195 | ROLLBACK_TABLE         | END          | myschema1."myTbl3"           | 10 rolled back primary keys                                    | postgres
    4196 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl4             | All log rows with emaj_gid > 29                                | postgres
    4197 | ROLLBACK_TABLE         | END          | myschema1.mytbl4             | 1 rolled back primary keys                                     | postgres
    4198 | ROLLBACK_GROUP         | MARK DELETED | myGroup1                     | mark Mark13 is deleted                                         | postgres
    4199 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" | RESTART 1                                                      | postgres
    4200 | ROLLBACK_GROUP         | END          | myGroup1                     | Rollback_id 11, 2 tables and 1 sequences effectively processed | postgres
    4201 | DBLINK_CLOSE_CNX       |              | rlbk#1                       |                                                                | postgres
    4202 | ROLLBACK_GROUP         | BEGIN        | myGroup1                     | Unlogged rollback to mark Mark11 (timestamp)                   | postgres
    4203 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = 1                                                     | postgres
    4204 | LOCK_GROUP             | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
    4205 | LOCK_GROUP             | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    4206 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl1             | All log rows with emaj_gid > 2                                 | postgres
    4207 | ROLLBACK_TABLE         | END          | myschema1.mytbl1             | 11 rolled back primary keys                                    | postgres
    4208 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl2             | All log rows with emaj_gid > 2                                 | postgres
    4209 | ROLLBACK_TABLE         | END          | myschema1.mytbl2             | 3 rolled back primary keys                                     | postgres
    4210 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl2b            | All log rows with emaj_gid > 2                                 | postgres
    4211 | ROLLBACK_TABLE         | END          | myschema1.mytbl2b            | 6 rolled back primary keys                                     | postgres
    4212 | ROLLBACK_GROUP         | MARK DELETED | myGroup1                     | mark Mark12 is deleted                                         | postgres
    4213 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4214 | ROLLBACK_GROUP         | END          | myGroup1                     | Rollback_id 12, 3 tables and 1 sequences effectively processed | postgres
    4215 | DBLINK_CLOSE_CNX       |              | rlbk#1                       |                                                                | postgres
    4216 | STOP_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4217 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4218 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4219 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | STOP_%                                                         | postgres
    4220 | CLEANUP_RLBK_STATE     |              | rollback id 11               | set to COMMITTED                                               | postgres
    4221 | CLEANUP_RLBK_STATE     |              | rollback id 12               | set to COMMITTED                                               | postgres
    4222 | SET_MARK_GROUP         | END          | myGroup1                     | STOP_%                                                         | postgres
    4223 | STOP_GROUP             | END          | myGroup1                     | 6 tables/sequences processed                                   | postgres
    4224 | START_GROUP            | BEGIN        | myGroup1                     | With log reset                                                 | postgres
    4225 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4226 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4227 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | Mark11                                                         | postgres
    4228 | SET_MARK_GROUP         | END          | myGroup1                     | Mark11                                                         | postgres
    4229 | START_GROUP            | END          | myGroup1                     | 6 tables/sequences processed                                   | postgres
    4230 | SET_MARK_GROUP         | BEGIN        | myGroup1                     |                                                                | postgres
    4231 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4232 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4233 | SET_MARK_GROUP         | END          | myGroup1                     | Mark12                                                         | postgres
    4234 | SET_MARK_GROUP         | BEGIN        | myGroup1                     |                                                                | postgres
    4235 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4236 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4237 | SET_MARK_GROUP         | END          | myGroup1                     | Mark13                                                         | postgres
    4238 | ROLLBACK_GROUP         | BEGIN        | myGroup1                     | Logged rollback to mark Mark12 (timestamp)                     | postgres
    4239 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = 1                                                     | postgres
    4240 | LOCK_GROUP             | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
    4241 | LOCK_GROUP             | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    4242 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | RLBK_Mark12_%_START                                            | postgres
    4243 | SET_MARK_GROUP         | END          | myGroup1                     | RLBK_Mark12_%_START                                            | postgres
    4244 | ROLLBACK_TABLE         | BEGIN        | myschema1."myTbl3"           | All log rows with emaj_gid > 60                                | postgres
    4245 | ROLLBACK_TABLE         | END          | myschema1."myTbl3"           | 10 rolled back primary keys                                    | postgres
    4246 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl4             | All log rows with emaj_gid > 60                                | postgres
    4247 | ROLLBACK_TABLE         | END          | myschema1.mytbl4             | 1 rolled back primary keys                                     | postgres
    4248 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" | RESTART 1                                                      | postgres
    4249 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | RLBK_Mark12_%_DONE                                             | postgres
    4250 | SET_MARK_GROUP         | END          | myGroup1                     | RLBK_Mark12_%_DONE                                             | postgres
    4251 | ROLLBACK_GROUP         | END          | myGroup1                     | Rollback_id 13, 2 tables and 1 sequences effectively processed | postgres
    4252 | DBLINK_CLOSE_CNX       |              | rlbk#1                       |                                                                | postgres
    4253 | ROLLBACK_GROUP         | BEGIN        | myGroup1                     | Logged rollback to mark Mark11 (timestamp)                     | postgres
    4254 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = 1                                                     | postgres
    4255 | LOCK_GROUP             | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
    4256 | LOCK_GROUP             | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    4257 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | RLBK_Mark11_%_START                                            | postgres
    4258 | CLEANUP_RLBK_STATE     |              | rollback id 13               | set to COMMITTED                                               | postgres
    4259 | SET_MARK_GROUP         | END          | myGroup1                     | RLBK_Mark11_%_START                                            | postgres
    4260 | ROLLBACK_TABLE         | BEGIN        | myschema1."myTbl3"           | All log rows with emaj_gid > 41                                | postgres
    4261 | ROLLBACK_TABLE         | END          | myschema1."myTbl3"           | 10 rolled back primary keys                                    | postgres
    4262 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl1             | All log rows with emaj_gid > 41                                | postgres
    4263 | ROLLBACK_TABLE         | END          | myschema1.mytbl1             | 11 rolled back primary keys                                    | postgres
    4264 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl2             | All log rows with emaj_gid > 41                                | postgres
    4265 | ROLLBACK_TABLE         | END          | myschema1.mytbl2             | 2 rolled back primary keys                                     | postgres
    4266 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl4             | All log rows with emaj_gid > 41                                | postgres
    4267 | ROLLBACK_TABLE         | END          | myschema1.mytbl4             | 1 rolled back primary keys                                     | postgres
    4268 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl2b            | All log rows with emaj_gid > 41                                | postgres
    4269 | ROLLBACK_TABLE         | END          | myschema1.mytbl2b            | 2 rolled back primary keys                                     | postgres
    4270 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4271 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | RLBK_Mark11_%_DONE                                             | postgres
    4272 | SET_MARK_GROUP         | END          | myGroup1                     | RLBK_Mark11_%_DONE                                             | postgres
    4273 | ROLLBACK_GROUP         | END          | myGroup1                     | Rollback_id 14, 5 tables and 1 sequences effectively processed | postgres
    4274 | DBLINK_CLOSE_CNX       |              | rlbk#1                       |                                                                | postgres
    4275 | ROLLBACK_GROUP         | BEGIN        | myGroup1                     | Unlogged rollback to mark Mark13 (timestamp)                   | postgres
    4276 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = 1                                                     | postgres
    4277 | LOCK_GROUP             | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
    4278 | LOCK_GROUP             | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    4279 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl1             | All log rows with emaj_gid > 71                                | postgres
    4280 | ROLLBACK_TABLE         | END          | myschema1.mytbl1             | 10 rolled back primary keys                                    | postgres
    4281 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl2             | All log rows with emaj_gid > 71                                | postgres
    4282 | ROLLBACK_TABLE         | END          | myschema1.mytbl2             | 2 rolled back primary keys                                     | postgres
    4283 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl4             | All log rows with emaj_gid > 71                                | postgres
    4284 | ROLLBACK_TABLE         | END          | myschema1.mytbl4             | 1 rolled back primary keys                                     | postgres
    4285 | ROLLBACK_TABLE         | BEGIN        | myschema1."myTbl3"           | All log rows with emaj_gid > 71                                | postgres
    4286 | ROLLBACK_TABLE         | END          | myschema1."myTbl3"           | 10 rolled back primary keys                                    | postgres
    4287 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl2b            | All log rows with emaj_gid > 71                                | postgres
    4288 | ROLLBACK_TABLE         | END          | myschema1.mytbl2b            | 2 rolled back primary keys                                     | postgres
    4289 | ROLLBACK_GROUP         | MARK DELETED | myGroup1                     | mark RLBK_Mark12_%_START is deleted                            | postgres
    4290 | ROLLBACK_GROUP         | MARK DELETED | myGroup1                     | mark RLBK_Mark12_%_DONE is deleted                             | postgres
    4291 | ROLLBACK_GROUP         | MARK DELETED | myGroup1                     | mark RLBK_Mark11_%_START is deleted                            | postgres
    4292 | ROLLBACK_GROUP         | MARK DELETED | myGroup1                     | mark RLBK_Mark11_%_DONE is deleted                             | postgres
    4293 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" | RESTART 11                                                     | postgres
    4294 | ROLLBACK_GROUP         | END          | myGroup1                     | Rollback_id 15, 5 tables and 1 sequences effectively processed | postgres
    4295 | DBLINK_CLOSE_CNX       |              | rlbk#1                       |                                                                | postgres
    4296 | START_GROUP            | BEGIN        | myGroup4                     | With log reset                                                 | postgres
    4297 | LOCK_GROUP             | BEGIN        | myGroup4                     |                                                                | postgres
    4298 | LOCK_GROUP             | END          | myGroup4                     | 3 tables locked, 0 deadlock(s)                                 | postgres
    4299 | SET_MARK_GROUP         | BEGIN        | myGroup4                     | myGroup4_start                                                 | postgres
    4300 | CLEANUP_RLBK_STATE     |              | rollback id 14               | set to COMMITTED                                               | postgres
    4301 | CLEANUP_RLBK_STATE     |              | rollback id 15               | set to COMMITTED                                               | postgres
    4302 | SET_MARK_GROUP         | END          | myGroup4                     | myGroup4_start                                                 | postgres
    4303 | START_GROUP            | END          | myGroup4                     | 3 tables/sequences processed                                   | postgres
    4304 | SET_MARK_GROUP         | BEGIN        | myGroup4                     |                                                                | postgres
    4305 | LOCK_GROUP             | BEGIN        | myGroup4                     |                                                                | postgres
    4306 | LOCK_GROUP             | END          | myGroup4                     | 3 tables locked, 0 deadlock(s)                                 | postgres
    4307 | SET_MARK_GROUP         | END          | myGroup4                     | mark1                                                          | postgres
    4308 | ROLLBACK_GROUP         | BEGIN        | myGroup4                     | Logged rollback to mark mark1 (timestamp)                      | postgres
    4309 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = 1                                                     | postgres
    4310 | LOCK_GROUP             | BEGIN        | myGroup4                     | Rollback session #1                                            | postgres
    4311 | LOCK_GROUP             | END          | myGroup4                     | Rollback session #1: 3 tables locked, 0 deadlock(s)            | postgres
    4312 | SET_MARK_GROUP         | BEGIN        | myGroup4                     | RLBK_mark1_%_START                                             | postgres
    4313 | SET_MARK_GROUP         | END          | myGroup4                     | RLBK_mark1_%_START                                             | postgres
    4314 | ROLLBACK_TABLE         | BEGIN        | myschema4.mytblc1            | All log rows with emaj_gid > 99                                | postgres
    4315 | ROLLBACK_TABLE         | END          | myschema4.mytblc1            | 1 rolled back primary keys                                     | postgres
    4316 | ROLLBACK_TABLE         | BEGIN        | myschema4.mytblc2            | All log rows with emaj_gid > 99                                | postgres
    4317 | ROLLBACK_TABLE         | END          | myschema4.mytblc2            | 1 rolled back primary keys                                     | postgres
    4318 | ROLLBACK_TABLE         | BEGIN        | myschema4.mytblm             | All log rows with emaj_gid > 99                                | postgres
    4319 | ROLLBACK_TABLE         | END          | myschema4.mytblm             | 1 rolled back primary keys                                     | postgres
    4320 | SET_MARK_GROUP         | BEGIN        | myGroup4                     | RLBK_mark1_%_DONE                                              | postgres
    4321 | SET_MARK_GROUP         | END          | myGroup4                     | RLBK_mark1_%_DONE                                              | postgres
    4322 | ROLLBACK_GROUP         | END          | myGroup4                     | Rollback_id 16, 3 tables and 0 sequences effectively processed | postgres
    4323 | DBLINK_CLOSE_CNX       |              | rlbk#1                       |                                                                | postgres
    4324 | ROLLBACK_GROUP         | BEGIN        | myGroup4                     | Unlogged rollback to mark myGroup4_start (timestamp)           | postgres
    4325 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = 1                                                     | postgres
    4326 | LOCK_GROUP             | BEGIN        | myGroup4                     | Rollback session #1                                            | postgres
    4327 | LOCK_GROUP             | END          | myGroup4                     | Rollback session #1: 3 tables locked, 0 deadlock(s)            | postgres
    4328 | ROLLBACK_TABLE         | BEGIN        | myschema4.mytblc1            | All log rows with emaj_gid > 96                                | postgres
    4329 | ROLLBACK_TABLE         | END          | myschema4.mytblc1            | 1 rolled back primary keys                                     | postgres
    4330 | ROLLBACK_TABLE         | BEGIN        | myschema4.mytblc2            | All log rows with emaj_gid > 96                                | postgres
    4331 | ROLLBACK_TABLE         | END          | myschema4.mytblc2            | 1 rolled back primary keys                                     | postgres
    4332 | ROLLBACK_TABLE         | BEGIN        | myschema4.mytblm             | All log rows with emaj_gid > 96                                | postgres
    4333 | ROLLBACK_TABLE         | END          | myschema4.mytblm             | 1 rolled back primary keys                                     | postgres
    4334 | ROLLBACK_GROUP         | MARK DELETED | myGroup4                     | mark mark1 is deleted                                          | postgres
    4335 | ROLLBACK_GROUP         | MARK DELETED | myGroup4                     | mark RLBK_mark1_%_START is deleted                             | postgres
    4336 | ROLLBACK_GROUP         | MARK DELETED | myGroup4                     | mark RLBK_mark1_%_DONE is deleted                              | postgres
    4337 | ROLLBACK_GROUP         | END          | myGroup4                     | Rollback_id 17, 3 tables and 0 sequences effectively processed | postgres
    4338 | DBLINK_CLOSE_CNX       |              | rlbk#1                       |                                                                | postgres
    4340 | SET_MARK_GROUP         | BEGIN        | myGroup1                     |                                                                | postgres
    4341 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4342 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4343 | CLEANUP_RLBK_STATE     |              | rollback id 16               | set to COMMITTED                                               | postgres
    4344 | CLEANUP_RLBK_STATE     |              | rollback id 17               | set to COMMITTED                                               | postgres
    4345 | SET_MARK_GROUP         | END          | myGroup1                     | Conso_M1                                                       | postgres
    4346 | ROLLBACK_GROUP         | BEGIN        | myGroup1                     | Logged rollback to mark Conso_M1 (timestamp)                   | postgres
    4347 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = 1                                                     | postgres
    4348 | LOCK_GROUP             | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
    4349 | LOCK_GROUP             | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    4350 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | RLBK_Conso_M1_%_START                                          | postgres
    4351 | SET_MARK_GROUP         | END          | myGroup1                     | RLBK_Conso_M1_%_START                                          | postgres
    4352 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4353 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | RLBK_Conso_M1_%_DONE                                           | postgres
    4354 | SET_MARK_GROUP         | END          | myGroup1                     | RLBK_Conso_M1_%_DONE                                           | postgres
    4355 | ROLLBACK_GROUP         | END          | myGroup1                     | Rollback_id 18, 0 tables and 1 sequences effectively processed | postgres
    4356 | DBLINK_CLOSE_CNX       |              | rlbk#1                       |                                                                | postgres
    4357 | CONSOLIDATE_RLBK_GROUP | BEGIN        | myGroup1                     | Erase all between marks Conso_M1 and RLBK_Conso_M1_%_DONE      | postgres
    4358 | CONSOLIDATE_RLBK_GROUP | END          | myGroup1                     | 0 tables and 1 sequences processed ; 1 marks deleted           | postgres
    4359 | SET_MARK_GROUP         | BEGIN        | myGroup1                     |                                                                | postgres
    4360 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4361 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4362 | CLEANUP_RLBK_STATE     |              | rollback id 18               | set to COMMITTED                                               | postgres
    4363 | SET_MARK_GROUP         | END          | myGroup1                     | Conso_M2                                                       | postgres
    4364 | SET_MARK_GROUP         | BEGIN        | myGroup1                     |                                                                | postgres
    4365 | LOCK_GROUP             | BEGIN        | myGroup1                     |                                                                | postgres
    4366 | LOCK_GROUP             | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    4367 | SET_MARK_GROUP         | END          | myGroup1                     | Conso_M3                                                       | postgres
    4368 | ROLLBACK_GROUP         | BEGIN        | myGroup1                     | Logged rollback to mark Conso_M2 (timestamp)                   | postgres
    4369 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = 1                                                     | postgres
    4370 | LOCK_GROUP             | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
    4371 | LOCK_GROUP             | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    4372 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | RLBK_Conso_M2_%_START                                          | postgres
    4373 | SET_MARK_GROUP         | END          | myGroup1                     | RLBK_Conso_M2_%_START                                          | postgres
    4374 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl1             | All log rows with emaj_gid > 105                               | postgres
    4375 | ROLLBACK_TABLE         | END          | myschema1.mytbl1             | 12 rolled back primary keys                                    | postgres
    4376 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl2             | All log rows with emaj_gid > 105                               | postgres
    4377 | ROLLBACK_TABLE         | END          | myschema1.mytbl2             | 1 rolled back primary keys                                     | postgres
    4378 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl2b            | All log rows with emaj_gid > 105                               | postgres
    4379 | ROLLBACK_TABLE         | END          | myschema1.mytbl2b            | 3 rolled back primary keys                                     | postgres
    4380 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4381 | SET_MARK_GROUP         | BEGIN        | myGroup1                     | RLBK_Conso_M2_%_DONE                                           | postgres
    4382 | SET_MARK_GROUP         | END          | myGroup1                     | RLBK_Conso_M2_%_DONE                                           | postgres
    4383 | ROLLBACK_GROUP         | END          | myGroup1                     | Rollback_id 19, 3 tables and 1 sequences effectively processed | postgres
    4384 | DBLINK_CLOSE_CNX       |              | rlbk#1                       |                                                                | postgres
    4385 | RENAME_MARK_GROUP      | BEGIN        | myGroup1                     | Conso_M2                                                       | postgres
    4386 | RENAME_MARK_GROUP      | END          | myGroup1                     | Conso_M2 renamed Renamed_conso_M2                              | postgres
    4387 | RENAME_MARK_GROUP      | BEGIN        | myGroup1                     | EMAJ_LAST_MARK                                                 | postgres
    4388 | RENAME_MARK_GROUP      | END          | myGroup1                     | RLBK_Conso_M2_%_DONE renamed Renamed_last_mark                 | postgres
    4389 | CONSOLIDATE_RLBK_GROUP | BEGIN        | myGroup1                     | Erase all between marks Renamed_conso_M2 and Renamed_last_mark | postgres
    4390 | CONSOLIDATE_RLBK_GROUP | END          | myGroup1                     | 3 tables and 1 sequences processed ; 2 marks deleted           | postgres
    4391 | CONSOLIDATE_RLBK_GROUP | BEGIN        | myGroup1                     | Erase all between marks Renamed_conso_M2 and Renamed_last_mark | postgres
    4392 | CONSOLIDATE_RLBK_GROUP | END          | myGroup1                     | 0 tables and 1 sequences processed ; 0 marks deleted           | postgres
    4393 | ROLLBACK_GROUP         | BEGIN        | myGroup1                     | Unlogged rollback to mark Conso_M1 (timestamp)                 | postgres
    4394 | DBLINK_OPEN_CNX        |              | rlbk#1                       | Status = 1                                                     | postgres
    4395 | LOCK_GROUP             | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
    4396 | LOCK_GROUP             | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    4397 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl2             | All log rows with emaj_gid > 105                               | postgres
    4398 | ROLLBACK_TABLE         | END          | myschema1.mytbl2             | 1 rolled back primary keys                                     | postgres
    4399 | ROLLBACK_TABLE         | BEGIN        | myschema1.mytbl2b            | All log rows with emaj_gid > 105                               | postgres
    4400 | ROLLBACK_TABLE         | END          | myschema1.mytbl2b            | 2 rolled back primary keys                                     | postgres
    4401 | ROLLBACK_GROUP         | MARK DELETED | myGroup1                     | mark RLBK_Conso_M1_%_DONE is deleted                           | postgres
    4402 | ROLLBACK_GROUP         | MARK DELETED | myGroup1                     | mark Renamed_conso_M2 is deleted                               | postgres
    4403 | ROLLBACK_GROUP         | MARK DELETED | myGroup1                     | mark Renamed_last_mark is deleted                              | postgres
    4404 | ROLLBACK_SEQUENCE      |              | myschema1."myTbl3_col31_seq" |                                                                | postgres
    4405 | ROLLBACK_GROUP         | END          | myGroup1                     | Rollback_id 20, 2 tables and 1 sequences effectively processed | postgres
    4406 | DBLINK_CLOSE_CNX       |              | rlbk#1                       |                                                                | postgres
    4413 | CLEANUP_RLBK_STATE     |              | rollback id 19               | set to COMMITTED                                               | postgres
    4414 | CLEANUP_RLBK_STATE     |              | rollback id 20               | set to COMMITTED                                               | postgres
    4415 | CLEANUP_RLBK_STATE     |              | rollback id 21               | set to ABORTED                                                 | postgres
(356 rows)

truncate emaj.emaj_hist;
alter sequence emaj.emaj_hist_hist_id_seq restart 5000;
alter sequence emaj.emaj_time_stamp_time_id_seq restart 500;
alter sequence emaj.emaj_mark_mark_id_seq restart 500;
alter sequence emaj.emaj_sequence_sequ_id_seq restart 5000;
alter sequence emaj.emaj_rlbk_rlbk_id_seq restart 100;
