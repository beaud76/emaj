-- after_restore.sql: Test emaj environment restored from a dump taken at the end of schedule reg tests
--                All operations are executed by super-user
--
-----------------------------
-- Checking restore
-----------------------------
select relname,relkind from pg_class where relname like 'emaj_%';
                         relname                         | relkind 
---------------------------------------------------------+---------
 emaj_alter_plan                                         | r
 emaj_alter_plan_pkey                                    | i
 emaj_consolidable_rollback_type                         | c
 emaj_detailed_log_stat_type                             | c
 emaj_global_seq                                         | S
 emaj_group                                              | r
 emaj_group_def                                          | r
 emaj_group_def_idx1                                     | i
 emaj_group_def_pkey                                     | i
 emaj_group_pkey                                         | i
 emaj_hist                                               | r
 emaj_hist_hist_id_seq                                   | S
 emaj_hist_pkey                                          | i
 emaj_log_stat_type                                      | c
 emaj_mark                                               | r
 emaj_mark_idx1                                          | i
 emaj_mark_mark_id_seq                                   | S
 emaj_mark_pkey                                          | i
 emaj_param                                              | r
 emaj_param_pkey                                         | i
 emaj_relation                                           | r
 emaj_relation_idx1                                      | i
 emaj_relation_idx2                                      | i
 emaj_relation_pkey                                      | i
 emaj_relation_rel_schema_rel_tblseq_rel_time_range_excl | i
 emaj_rlbk                                               | r
 emaj_rlbk_idx1                                          | i
 emaj_rlbk_pkey                                          | i
 emaj_rlbk_plan                                          | r
 emaj_rlbk_plan_pkey                                     | i
 emaj_rlbk_rlbk_id_seq                                   | S
 emaj_rlbk_session                                       | r
 emaj_rlbk_session_pkey                                  | i
 emaj_rlbk_stat                                          | r
 emaj_rlbk_stat_pkey                                     | i
 emaj_rollback_activity_type                             | c
 emaj_schema                                             | r
 emaj_schema_pkey                                        | i
 emaj_seq_hole                                           | r
 emaj_seq_hole_pkey                                      | i
 emaj_sequence                                           | r
 emaj_sequence_pkey                                      | i
 emaj_time_stamp                                         | r
 emaj_time_stamp_pkey                                    | i
 emaj_time_stamp_time_id_seq                             | S
 emaj_visible_param                                      | v
(46 rows)

select * from emaj.emaj_global_seq;
  sequence_name  | last_value | start_value | increment_by |      max_value      | min_value | cache_value | log_cnt | is_cycled | is_called 
-----------------+------------+-------------+--------------+---------------------+-----------+-------------+---------+-----------+-----------
 emaj_global_seq |     100565 |           1 |            1 | 9223372036854775807 |         1 |           1 |       0 | f         | t
(1 row)

-----------------------------
-- Step 1 : for myGroup2, update tables and set a mark 
-----------------------------
set search_path=myschema2;
SET
insert into myTbl1 select 100+i, 'KLM', E'\\000\\014'::bytea from generate_series (1,11) as i;
INSERT 0 11
update myTbl1 set col13=E'\\000\\034'::bytea where col11 >105;
UPDATE 6
insert into myTbl2 values (100,'KLM','2012-12-31');
INSERT 0 1
delete from myTbl1 where col11 > 110;
DELETE 1
select nextval('myschema2.myseq1');
 nextval 
---------
    1004
(1 row)

--
select emaj.emaj_set_mark_group('myGroup2','After restore mark');
 emaj_set_mark_group 
---------------------
                   0
(1 row)

--
-----------------------------
-- Checking step 1
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_id;
 mark_id | mark_group |        regexp_replace        | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |     mark_comment     | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------+------------------------------+--------------+-----------------+------------------------+----------------------+---------------------------+------------------------------
   10006 | myGroup2   | M3                           |        10008 | t               | f                      | This mark is deleted |                         0 | 
   10011 | myGroup1   | M4                           |        10014 | t               | f                      |                      |                        10 | 
   10012 | myGroup1   | M5                           |        10015 | t               | f                      |                      |                         3 | 
   10016 | myGroup1   | Before logged rollback to M4 |        10021 | t               | f                      |                      |                        28 | 
   10018 | myGroup1   | STOP_%                       |        10023 | t               | f                      |                      |                         0 | 
   10019 | myGroup2   | STOP_%                       |        10023 | t               | f                      |                      |                         0 | 
   10028 | myGroup1   | Stop after rollback          |        10030 | t               | f                      |                      |                         0 | 
   10029 | myGroup2   | Stop after rollback          |        10030 | t               | f                      |                      |                         0 | 
   10030 | myGroup1   | Multi-1                      |        10031 | f               | f                      |                      |                           | 
   10031 | myGroup2   | Multi-1                      |        10031 | f               | f                      |                      |                        60 | 
   20002 | myGroup2   | RLBK_Multi-1_%_START         |        20001 | f               | f                      |                      |                        32 | 
   20004 | myGroup2   | RLBK_Multi-1_%_DONE          |        20002 | f               | f                      |                      |                         0 | Multi-1
   20005 | myGroup2   | After restore mark           |        20004 | f               | f                      |                      |                           | 
(13 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
 sequ_schema |         sequ_name          | sequ_time_id | sequ_last_val | sequ_is_called 
-------------+----------------------------+--------------+---------------+----------------
 emaj        | myschema2_mytbl1_log_seq   |        10008 |            15 | t
 emaj        | myschema2_mytbl2_log_seq   |        10008 |             2 | t
 emaj        | myschema2_mytbl4_log_seq   |        10008 |             4 | t
 emaj        | myschema2_mytbl6_log_seq   |        10008 |            14 | t
 emaj        | otherPrefix4mytbl5_log_seq |        10008 |             4 | t
 emajC       | myschema2_myTbl3_log_seq   |        10008 |            10 | t
 myschema2   | myseq1                     |        10008 |          1003 | t
 myschema2   | myTbl3_col31_seq           |        10008 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10014 |            30 | t
 emaj        | myschema1_mytbl2_log_seq   |        10014 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10014 |             8 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10014 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10014 |            10 | t
 myschema1   | mytbl2b_col20_seq          |        10014 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10014 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10015 |            30 | t
 emaj        | myschema1_mytbl2_log_seq   |        10015 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10015 |             8 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10015 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10015 |            20 | t
 myschema1   | mytbl2b_col20_seq          |        10015 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10015 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10021 |            32 | t
 emaj        | myschema1_mytbl2_log_seq   |        10021 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10021 |            12 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10021 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10021 |            20 | t
 myschema1   | mytbl2b_col20_seq          |        10021 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10021 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10023 |            33 | t
 emaj        | myschema1_mytbl2_log_seq   |        10023 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10023 |            14 | t
 emaj        | myschema2_mytbl1_log_seq   |        10023 |            15 | t
 emaj        | myschema2_mytbl2_log_seq   |        10023 |             2 | t
 emaj        | myschema2_mytbl4_log_seq   |        10023 |            10 | t
 emaj        | myschema2_mytbl6_log_seq   |        10023 |            23 | t
 emaj        | otherPrefix4mytbl5_log_seq |        10023 |             7 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10023 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10023 |            45 | t
 emajC       | myschema2_myTbl3_log_seq   |        10023 |            10 | t
 myschema1   | mytbl2b_col20_seq          |        10023 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10023 |            20 | t
 myschema2   | myseq1                     |        10023 |          1004 | f
 myschema2   | myTbl3_col31_seq           |        10023 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10030 |            33 | t
 emaj        | myschema1_mytbl2_log_seq   |        10030 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10030 |            14 | t
 emaj        | myschema2_mytbl1_log_seq   |        10030 |            15 | t
 emaj        | myschema2_mytbl2_log_seq   |        10030 |             2 | t
 emaj        | myschema2_mytbl4_log_seq   |        10030 |            10 | t
 emaj        | myschema2_mytbl6_log_seq   |        10030 |            23 | t
 emaj        | otherPrefix4mytbl5_log_seq |        10030 |             7 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10030 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10030 |            45 | t
 emajC       | myschema2_myTbl3_log_seq   |        10030 |            10 | t
 myschema1   | mytbl2b_col20_seq          |        10030 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10030 |            20 | t
 myschema2   | myseq1                     |        10030 |          1004 | f
 myschema2   | myTbl3_col31_seq           |        10030 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10031 |            33 | t
 emaj        | myschema1_mytbl2_log_seq   |        10031 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10031 |            14 | t
 emaj        | myschema2_mytbl1_log_seq   |        10031 |            15 | t
 emaj        | myschema2_mytbl2_log_seq   |        10031 |             2 | t
 emaj        | myschema2_mytbl4_log_seq   |        10031 |            10 | t
 emaj        | myschema2_mytbl6_log_seq   |        10031 |            23 | t
 emaj        | otherPrefix4mytbl5_log_seq |        10031 |             7 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10031 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10031 |            45 | t
 emajC       | myschema2_myTbl3_log_seq   |        10031 |            10 | t
 myschema1   | mytbl2b_col20_seq          |        10031 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10031 |            20 | t
 myschema2   | myseq1                     |        10031 |          1004 | f
 myschema2   | myTbl3_col31_seq           |        10031 |            20 | t
 emaj        | myschema2_mytbl1_log_seq   |        20001 |            25 | t
 emaj        | myschema2_mytbl2_log_seq   |        20001 |             4 | t
 emaj        | myschema2_mytbl4_log_seq   |        20001 |            12 | t
 emaj        | myschema2_mytbl6_log_seq   |        20001 |            53 | t
 emaj        | otherPrefix4mytbl5_log_seq |        20001 |            13 | t
 emajC       | myschema2_myTbl3_log_seq   |        20001 |            20 | t
 myschema2   | myseq1                     |        20001 |          9999 | f
 myschema2   | myTbl3_col31_seq           |        20001 |            20 | t
 emaj        | myschema2_mytbl1_log_seq   |        20002 |            35 | t
 emaj        | myschema2_mytbl2_log_seq   |        20002 |             6 | t
 emaj        | myschema2_mytbl4_log_seq   |        20002 |            14 | t
 emaj        | myschema2_mytbl6_log_seq   |        20002 |            60 | t
 emaj        | otherPrefix4mytbl5_log_seq |        20002 |            14 | t
 emajC       | myschema2_myTbl3_log_seq   |        20002 |            30 | t
 myschema2   | myseq1                     |        20002 |          1004 | f
 myschema2   | myTbl3_col31_seq           |        20002 |            20 | t
(90 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13  
-------+------------+--------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
   101 | KLM        | \x000c
   102 | KLM        | \x000c
   103 | KLM        | \x000c
   104 | KLM        | \x000c
   105 | KLM        | \x000c
   106 | KLM        | \x001c
   107 | KLM        | \x001c
   108 | KLM        | \x001c
   109 | KLM        | \x001c
   110 | KLM        | \x001c
(20 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 2010-01-01
     2 | DEF   | 
   100 | KLM   | 2012-12-31
(3 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13  | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+--------+-----------+------------+----------
     4 | ABC        | \x0c   | DEL       | OLD        |   100468
     5 | ABC        | \x0c   | DEL       | OLD        |   100469
     6 | ABC        | \x0c   | DEL       | OLD        |   100470
     7 | ABC        | \x0c   | DEL       | OLD        |   100471
     8 | ABC        | \x0c   | DEL       | OLD        |   100472
     9 | ABC        | \x0c   | DEL       | OLD        |   100473
    10 | ABC        | \x0c   | DEL       | OLD        |   100474
     1 | ABC        | \x1c   | DEL       | OLD        |   100475
     2 | ABC        | \x1c   | DEL       | OLD        |   100476
     3 | ABC        | \x1c   | DEL       | OLD        |   100477
    10 | ABC        | \x0c   | INS       | NEW        |   100506
     3 | ABC        | \x1c   | INS       | NEW        |   100507
     4 | ABC        | \x0c   | INS       | NEW        |   100508
     1 | ABC        | \x1c   | INS       | NEW        |   100509
     5 | ABC        | \x0c   | INS       | NEW        |   100510
     7 | ABC        | \x0c   | INS       | NEW        |   100511
     8 | ABC        | \x0c   | INS       | NEW        |   100512
     6 | ABC        | \x0c   | INS       | NEW        |   100513
     9 | ABC        | \x0c   | INS       | NEW        |   100514
     2 | ABC        | \x1c   | INS       | NEW        |   100515
   101 | KLM        | \x000c | INS       | NEW        |   100566
   102 | KLM        | \x000c | INS       | NEW        |   100567
   103 | KLM        | \x000c | INS       | NEW        |   100568
   104 | KLM        | \x000c | INS       | NEW        |   100569
   105 | KLM        | \x000c | INS       | NEW        |   100570
   106 | KLM        | \x000c | INS       | NEW        |   100571
   107 | KLM        | \x000c | INS       | NEW        |   100572
   108 | KLM        | \x000c | INS       | NEW        |   100573
   109 | KLM        | \x000c | INS       | NEW        |   100574
   110 | KLM        | \x000c | INS       | NEW        |   100575
   111 | KLM        | \x000c | INS       | NEW        |   100576
   106 | KLM        | \x000c | UPD       | OLD        |   100577
   106 | KLM        | \x001c | UPD       | NEW        |   100577
   107 | KLM        | \x000c | UPD       | OLD        |   100578
   107 | KLM        | \x001c | UPD       | NEW        |   100578
   108 | KLM        | \x000c | UPD       | OLD        |   100579
   108 | KLM        | \x001c | UPD       | NEW        |   100579
   109 | KLM        | \x000c | UPD       | OLD        |   100580
   109 | KLM        | \x001c | UPD       | NEW        |   100580
   110 | KLM        | \x000c | UPD       | OLD        |   100581
   110 | KLM        | \x001c | UPD       | NEW        |   100581
   111 | KLM        | \x000c | UPD       | OLD        |   100582
   111 | KLM        | \x001c | UPD       | NEW        |   100582
   111 | KLM        | \x001c | DEL       | OLD        |   100584
(44 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 2010-01-01 | DEL       | OLD        |   100478
     2 | DEF   |            | DEL       | OLD        |   100479
     1 | ABC   | 2010-01-01 | INS       | NEW        |   100543
     2 | DEF   |            | INS       | NEW        |   100544
   100 | KLM   | 2012-12-31 | INS       | NEW        |   100583
(5 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | DEL       | OLD        |   100480
    12 | 10.00 | DEL       | OLD        |   100481
    13 | 10.00 | DEL       | OLD        |   100482
    14 | 10.00 | DEL       | OLD        |   100483
    15 | 10.00 | DEL       | OLD        |   100484
    16 | 10.00 | DEL       | OLD        |   100485
    17 | 10.00 | DEL       | OLD        |   100486
    18 | 10.00 | DEL       | OLD        |   100487
    19 | 10.00 | DEL       | OLD        |   100488
    20 | 10.00 | DEL       | OLD        |   100489
    14 | 10.00 | INS       | NEW        |   100551
    18 | 10.00 | INS       | NEW        |   100552
    20 | 10.00 | INS       | NEW        |   100553
    12 | 10.00 | INS       | NEW        |   100554
    13 | 10.00 | INS       | NEW        |   100555
    17 | 10.00 | INS       | NEW        |   100556
    19 | 10.00 | INS       | NEW        |   100557
    15 | 10.00 | INS       | NEW        |   100558
    16 | 10.00 | INS       | NEW        |   100559
    11 | 10.00 | INS       | NEW        |   100560
(20 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     2 |     1 | ABC        | DEL       | OLD        |   100466
     2 | FK... |     2 |     1 | ABC        | DEL       | OLD        |   100467
     1 | FK... |     2 |     1 | ABC        | INS       | NEW        |   100545
     2 | FK... |     2 |     1 | ABC        | INS       | NEW        |   100546
(4 rows)

--
-----------------------------
-- Step 2 : for myGroup2, rollback to mark Multi-1 (set before dump/restore) 
-----------------------------
select * from emaj.emaj_log_stat_group('myGroup2','Multi-1',NULL);
 stat_group | stat_schema | stat_table | stat_first_mark | stat_first_mark_datetime | stat_last_mark | stat_last_mark_datetime | stat_rows 
------------+-------------+------------+-----------------+--------------------------+----------------+-------------------------+-----------
(0 rows)

select emaj.emaj_rollback_group('myGroup2','Multi-1');
 emaj_rollback_group 
---------------------
                   0
(1 row)

--
-----------------------------
-- Checking step 2
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_id;
 mark_id | mark_group |        regexp_replace        | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |     mark_comment     | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------+------------------------------+--------------+-----------------+------------------------+----------------------+---------------------------+------------------------------
   10006 | myGroup2   | M3                           |        10008 | t               | f                      | This mark is deleted |                         0 | 
   10011 | myGroup1   | M4                           |        10014 | t               | f                      |                      |                        10 | 
   10012 | myGroup1   | M5                           |        10015 | t               | f                      |                      |                         3 | 
   10016 | myGroup1   | Before logged rollback to M4 |        10021 | t               | f                      |                      |                        28 | 
   10018 | myGroup1   | STOP_%                       |        10023 | t               | f                      |                      |                         0 | 
   10019 | myGroup2   | STOP_%                       |        10023 | t               | f                      |                      |                         0 | 
   10028 | myGroup1   | Stop after rollback          |        10030 | t               | f                      |                      |                         0 | 
   10029 | myGroup2   | Stop after rollback          |        10030 | t               | f                      |                      |                         0 | 
   10030 | myGroup1   | Multi-1                      |        10031 | f               | f                      |                      |                           | 
   10031 | myGroup2   | Multi-1                      |        10031 | f               | f                      |                      |                           | 
(10 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
 sequ_schema |         sequ_name          | sequ_time_id | sequ_last_val | sequ_is_called 
-------------+----------------------------+--------------+---------------+----------------
 emaj        | myschema2_mytbl1_log_seq   |        10008 |            15 | t
 emaj        | myschema2_mytbl2_log_seq   |        10008 |             2 | t
 emaj        | myschema2_mytbl4_log_seq   |        10008 |             4 | t
 emaj        | myschema2_mytbl6_log_seq   |        10008 |            14 | t
 emaj        | otherPrefix4mytbl5_log_seq |        10008 |             4 | t
 emajC       | myschema2_myTbl3_log_seq   |        10008 |            10 | t
 myschema2   | myseq1                     |        10008 |          1003 | t
 myschema2   | myTbl3_col31_seq           |        10008 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10014 |            30 | t
 emaj        | myschema1_mytbl2_log_seq   |        10014 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10014 |             8 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10014 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10014 |            10 | t
 myschema1   | mytbl2b_col20_seq          |        10014 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10014 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10015 |            30 | t
 emaj        | myschema1_mytbl2_log_seq   |        10015 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10015 |             8 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10015 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10015 |            20 | t
 myschema1   | mytbl2b_col20_seq          |        10015 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10015 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10021 |            32 | t
 emaj        | myschema1_mytbl2_log_seq   |        10021 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10021 |            12 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10021 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10021 |            20 | t
 myschema1   | mytbl2b_col20_seq          |        10021 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10021 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10023 |            33 | t
 emaj        | myschema1_mytbl2_log_seq   |        10023 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10023 |            14 | t
 emaj        | myschema2_mytbl1_log_seq   |        10023 |            15 | t
 emaj        | myschema2_mytbl2_log_seq   |        10023 |             2 | t
 emaj        | myschema2_mytbl4_log_seq   |        10023 |            10 | t
 emaj        | myschema2_mytbl6_log_seq   |        10023 |            23 | t
 emaj        | otherPrefix4mytbl5_log_seq |        10023 |             7 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10023 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10023 |            45 | t
 emajC       | myschema2_myTbl3_log_seq   |        10023 |            10 | t
 myschema1   | mytbl2b_col20_seq          |        10023 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10023 |            20 | t
 myschema2   | myseq1                     |        10023 |          1004 | f
 myschema2   | myTbl3_col31_seq           |        10023 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10030 |            33 | t
 emaj        | myschema1_mytbl2_log_seq   |        10030 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10030 |            14 | t
 emaj        | myschema2_mytbl1_log_seq   |        10030 |            15 | t
 emaj        | myschema2_mytbl2_log_seq   |        10030 |             2 | t
 emaj        | myschema2_mytbl4_log_seq   |        10030 |            10 | t
 emaj        | myschema2_mytbl6_log_seq   |        10030 |            23 | t
 emaj        | otherPrefix4mytbl5_log_seq |        10030 |             7 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10030 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10030 |            45 | t
 emajC       | myschema2_myTbl3_log_seq   |        10030 |            10 | t
 myschema1   | mytbl2b_col20_seq          |        10030 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10030 |            20 | t
 myschema2   | myseq1                     |        10030 |          1004 | f
 myschema2   | myTbl3_col31_seq           |        10030 |            20 | t
 emaj        | myschema1_mytbl1_log_seq   |        10031 |            33 | t
 emaj        | myschema1_mytbl2_log_seq   |        10031 |             3 | t
 emaj        | myschema1_mytbl4_log_seq   |        10031 |            14 | t
 emaj        | myschema2_mytbl1_log_seq   |        10031 |            15 | t
 emaj        | myschema2_mytbl2_log_seq   |        10031 |             2 | t
 emaj        | myschema2_mytbl4_log_seq   |        10031 |            10 | t
 emaj        | myschema2_mytbl6_log_seq   |        10031 |            23 | t
 emaj        | otherPrefix4mytbl5_log_seq |        10031 |             7 | t
 emajb       | myschema1_mytbl2b_log_seq  |        10031 |             1 | f
 emajC       | myschema1_myTbl3_log_seq   |        10031 |            45 | t
 emajC       | myschema2_myTbl3_log_seq   |        10031 |            10 | t
 myschema1   | mytbl2b_col20_seq          |        10031 |             3 | f
 myschema1   | myTbl3_col31_seq           |        10031 |            20 | t
 myschema2   | myseq1                     |        10031 |          1004 | f
 myschema2   | myTbl3_col31_seq           |        10031 |            20 | t
 emaj        | myschema2_mytbl1_log_seq   |        20001 |            25 | t
 emaj        | myschema2_mytbl2_log_seq   |        20001 |             4 | t
 emaj        | myschema2_mytbl4_log_seq   |        20001 |            12 | t
 emaj        | myschema2_mytbl6_log_seq   |        20001 |            53 | t
 emaj        | otherPrefix4mytbl5_log_seq |        20001 |            13 | t
 emajC       | myschema2_myTbl3_log_seq   |        20001 |            20 | t
 myschema2   | myseq1                     |        20001 |          9999 | f
 myschema2   | myTbl3_col31_seq           |        20001 |            20 | t
 emaj        | myschema2_mytbl1_log_seq   |        20002 |            35 | t
 emaj        | myschema2_mytbl2_log_seq   |        20002 |             6 | t
 emaj        | myschema2_mytbl4_log_seq   |        20002 |            14 | t
 emaj        | myschema2_mytbl6_log_seq   |        20002 |            60 | t
 emaj        | otherPrefix4mytbl5_log_seq |        20002 |            14 | t
 emajC       | myschema2_myTbl3_log_seq   |        20002 |            30 | t
 myschema2   | myseq1                     |        20002 |          1004 | f
 myschema2   | myTbl3_col31_seq           |        20002 |            20 | t
(90 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
      -4 |                    | 
      -3 |                    | 
      -2 |                    | 
      -1 |                    | 
       4 |                  0 | C
       5 |                  0 | C
       6 |                  0 | C
       9 |                  0 | C
      10 |                  0 | C
      11 |                  0 | M
      12 |                  0 | M
      13 |                  0 | C
      14 |                  0 | M
      15 |                  0 | C
    1000 |                  0 | C
    1001 |                  0 | C
    1002 |                  0 | C
    1003 |                  0 | M
    1004 |                  0 | M
    1005 |                  0 | M
    1006 |                  0 | M
    1007 |                  0 | M
    1008 |                  0 | M
    1010 |                  0 | M
    1011 |                  0 | M
    1012 |                  2 | M
    1013 |                  2 | M
    1014 |                  2 | M
    1015 |                  2 | M
    1016 |                  2 | M
    1017 |                  2 | M
    1018 |                  2 | M
    1019 |                  2 | M
    1020 |                  2 | M
    1022 |                  2 | M
    1023 |                  2 | M
    1024 |                  2 | M
    1025 |                  2 | M
    1026 |                  2 | M
    1027 |                  2 | M
    1028 |                  2 | M
    2000 |                  2 | M
    2001 |                  2 | M
    2002 |                  2 | M
    2003 |                  2 | M
    2004 |                  2 | M
    2005 |                  2 | M
    2006 |                  2 | M
    2007 |                  2 | M
    2008 |                  2 | M
    2009 |                  2 | M
    2010 |                  2 | M
    2011 |                  2 | M
    2012 |                  2 | M
    2013 |                  2 | M
    2014 |                  2 | M
    2015 |                  2 | M
    2016 |                  2 | M
    2017 |                  2 | M
    2018 |                  2 | M
    2019 |                  2 | M
    2020 |                  2 | M
    3002 |                  2 | M
    3003 |                  2 | M
    3004 |                  2 | M
    3005 |                  2 | M
    3006 |                  2 | R
    3015 |                  2 | R
    3016 |                  2 | R
    3017 |                  2 | R
    3018 |                  2 | M
    3019 |                  2 | R
    3020 |                  2 | M
    3021 |                  2 | M
    3022 |                  2 | R
    3023 |                  2 | R
    3024 |                  2 | R
    3025 |                  2 | M
    3026 |                  2 | R
    3027 |                  2 | M
    3028 |                  2 | M
    3029 |                  2 | M
    3030 |                  2 | M
    3031 |                 29 | M
    3032 |                 41 | M
    3033 |                 41 | R
    3034 |                 41 | R
    3035 |                 41 | M
    3036 |                 41 | M
    3037 |                 60 | M
    3038 |                 71 | M
    3039 |                 71 | R
    3040 |                 82 | M
    3041 |                 82 | R
    3042 |                 96 | M
    3043 |                 96 | R
    3044 |                 96 | R
    3045 |                 96 | R
    3046 |                 96 | M
    3047 |                 96 | M
    3048 |                 99 | M
    3049 |                102 | R
    3050 |                105 | M
    3051 |                105 | R
    3052 |                105 | M
    3053 |                105 | R
    3054 |                105 | M
    3055 |                105 | M
    3056 |                120 | M
    3057 |                122 | R
    3058 |                137 | M
    3059 |                139 | R
    3062 |                140 | R
    5000 |                140 | M
    5002 |                140 | M
    5003 |                140 | M
    5004 |              11740 | M
    5005 |              11740 | M
    5006 |              11850 | M
    5007 |              11850 | M
    5010 |              11861 | M
    5011 |              11861 | M
    6000 |              11861 | M
    6001 |              11861 | M
    6002 |              11861 | C
    6003 |              11861 | C
    6004 |              11861 | C
    6005 |              11861 | C
    6008 |              11861 | A
    6009 |              11861 | A
    6010 |              11861 | A
    6011 |              11861 | A
    6012 |              11861 | A
    6013 |              11861 | A
    6014 |              11861 | A
    6015 |              11861 | A
    6016 |              11861 | A
    6017 |              11861 | A
    6018 |              11861 | A
    6019 |              11861 | A
    6020 |              11861 | A
    6021 |              11861 | A
    6022 |              11861 | A
    6023 |              11861 | A
    6024 |              11861 | A
    6025 |              11861 | A
    6026 |              11861 | A
    6027 |              11861 | A
    6028 |              11861 | A
    6029 |              11861 | A
    6030 |              11861 | A
    6031 |              11861 | A
    6032 |              11861 | A
    6033 |              11861 | A
    6034 |              11861 | A
    6035 |              11861 | A
    6036 |              11861 | A
    6037 |              11861 | A
    6040 |              11861 | A
    6041 |              11861 | A
    6042 |              11861 | A
    6043 |              11861 | A
    6044 |              11861 | A
    6045 |              11861 | A
    6046 |              11861 | A
    6047 |              11861 | A
    6050 |              11861 | M
    6051 |              11861 | A
    6052 |              11861 | A
    6053 |              11861 | M
    6054 |              11861 | A
    6055 |              11861 | A
    6056 |              11861 | M
    6061 |              11861 | R
    6063 |              11861 | R
    6078 |              11865 | M
    6079 |              11866 | A
    6080 |              11866 | M
    6081 |              11866 | A
    6082 |              11866 | M
    6083 |              11866 | R
    6084 |              11866 | R
    6085 |              11866 | M
    6086 |              11866 | R
    6087 |              11866 | R
    6088 |              11866 | R
    6089 |              11866 | M
    6090 |              11866 | R
    6094 |              11866 | C
    6095 |              11866 | M
    6096 |              11866 | C
    6097 |              11866 | M
   10000 |              99999 | M
   10001 |              99999 | C
   10002 |              99999 | C
   10003 |              99999 | M
   10004 |              99999 | M
   10005 |             100026 | M
   10006 |             100037 | M
   10007 |             100078 | M
   10008 |             100086 | M
   10009 |             100086 | R
   10010 |             100092 | M
   10011 |             100092 | R
   10012 |             100098 | M
   10013 |             100098 | R
   10014 |             100111 | M
   10015 |             100121 | M
   10016 |             100121 | M
   10017 |             100121 | R
   10018 |             100127 | M
   10019 |             100127 | R
   10020 |             100130 | R
   10021 |             100133 | R
   10022 |             100156 | M
   10023 |             100161 | M
   10024 |             100161 | M
   10025 |             100161 | M
   10026 |             100161 | R
   10027 |             100161 | M
   10028 |             100161 | R
   10029 |             100161 | R
   10030 |             100161 | M
   10031 |             100161 | M
   10032 |             100161 | M
   10033 |             100161 | R
   10034 |             100161 | C
   10035 |             100161 | A
   10036 |             100161 | M
   10037 |             100161 | M
   10038 |             100161 | C
   10039 |             100161 | A
   10040 |             100161 | C
   10041 |             100161 | M
   10042 |             100213 | M
   10043 |             100213 | M
   10044 |             100216 | M
   10045 |             100216 | R
   10046 |             100216 | M
   10047 |             100216 | R
   10048 |             100236 | R
   10049 |             100256 | R
   10050 |             100256 | R
   10051 |             100256 | R
   10052 |             100256 | M
   10053 |             100256 | A
   10054 |             100256 | M
   10055 |             100260 | M
   10056 |             100262 | R
   10057 |             100262 | M
   10058 |             100262 | M
   10059 |             100262 | M
   10060 |             100278 | M
   10061 |             100279 | R
   10062 |             100291 | M
   10063 |             100292 | M
   10064 |             100304 | M
   10065 |             100304 | M
   10066 |             100304 | R
   10067 |             100315 | M
   10068 |             100315 | M
   10069 |             100331 | M
   10070 |             100332 | M
   10071 |             100333 | R
   10072 |             100334 | M
   10073 |             100334 | M
   10074 |             100346 | R
   10075 |             100369 | M
   10076 |             100369 | M
   10077 |             100385 | R
   10078 |             100391 | M
   10079 |             100391 | M
   10080 |             100393 | R
   10081 |             100394 | M
   10082 |             100394 | M
   10083 |             100410 | M
   10084 |             100411 | R
   10085 |             100423 | M
   10086 |             100423 | M
   10087 |             100424 | R
   10088 |             100437 | M
   10089 |             100437 | R
   10090 |             100437 | C
   10091 |             100437 | M
   10092 |             100437 | M
   10093 |             100437 | M
   10094 |             100437 | A
   10095 |             100437 | A
   10096 |             100437 | M
   10097 |             100437 | M
   10098 |             100437 | M
   20000 |             100505 | A
   20001 |             100505 | R
   20002 |             100565 | M
   20003 |             100565 | R
   20004 |             100584 | M
   20005 |             100584 | R
(297 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13  
-------+------------+--------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
   101 | KLM        | \x000c
   102 | KLM        | \x000c
   103 | KLM        | \x000c
   104 | KLM        | \x000c
   105 | KLM        | \x000c
   106 | KLM        | \x001c
   107 | KLM        | \x001c
   108 | KLM        | \x001c
   109 | KLM        | \x001c
   110 | KLM        | \x001c
(20 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 2010-01-01
     2 | DEF   | 
   100 | KLM   | 2012-12-31
(3 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13  | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+--------+-----------+------------+----------
     4 | ABC        | \x0c   | DEL       | OLD        |   100468
     5 | ABC        | \x0c   | DEL       | OLD        |   100469
     6 | ABC        | \x0c   | DEL       | OLD        |   100470
     7 | ABC        | \x0c   | DEL       | OLD        |   100471
     8 | ABC        | \x0c   | DEL       | OLD        |   100472
     9 | ABC        | \x0c   | DEL       | OLD        |   100473
    10 | ABC        | \x0c   | DEL       | OLD        |   100474
     1 | ABC        | \x1c   | DEL       | OLD        |   100475
     2 | ABC        | \x1c   | DEL       | OLD        |   100476
     3 | ABC        | \x1c   | DEL       | OLD        |   100477
    10 | ABC        | \x0c   | INS       | NEW        |   100506
     3 | ABC        | \x1c   | INS       | NEW        |   100507
     4 | ABC        | \x0c   | INS       | NEW        |   100508
     1 | ABC        | \x1c   | INS       | NEW        |   100509
     5 | ABC        | \x0c   | INS       | NEW        |   100510
     7 | ABC        | \x0c   | INS       | NEW        |   100511
     8 | ABC        | \x0c   | INS       | NEW        |   100512
     6 | ABC        | \x0c   | INS       | NEW        |   100513
     9 | ABC        | \x0c   | INS       | NEW        |   100514
     2 | ABC        | \x1c   | INS       | NEW        |   100515
   101 | KLM        | \x000c | INS       | NEW        |   100566
   102 | KLM        | \x000c | INS       | NEW        |   100567
   103 | KLM        | \x000c | INS       | NEW        |   100568
   104 | KLM        | \x000c | INS       | NEW        |   100569
   105 | KLM        | \x000c | INS       | NEW        |   100570
   106 | KLM        | \x000c | INS       | NEW        |   100571
   107 | KLM        | \x000c | INS       | NEW        |   100572
   108 | KLM        | \x000c | INS       | NEW        |   100573
   109 | KLM        | \x000c | INS       | NEW        |   100574
   110 | KLM        | \x000c | INS       | NEW        |   100575
   111 | KLM        | \x000c | INS       | NEW        |   100576
   106 | KLM        | \x000c | UPD       | OLD        |   100577
   106 | KLM        | \x001c | UPD       | NEW        |   100577
   107 | KLM        | \x000c | UPD       | OLD        |   100578
   107 | KLM        | \x001c | UPD       | NEW        |   100578
   108 | KLM        | \x000c | UPD       | OLD        |   100579
   108 | KLM        | \x001c | UPD       | NEW        |   100579
   109 | KLM        | \x000c | UPD       | OLD        |   100580
   109 | KLM        | \x001c | UPD       | NEW        |   100580
   110 | KLM        | \x000c | UPD       | OLD        |   100581
   110 | KLM        | \x001c | UPD       | NEW        |   100581
   111 | KLM        | \x000c | UPD       | OLD        |   100582
   111 | KLM        | \x001c | UPD       | NEW        |   100582
   111 | KLM        | \x001c | DEL       | OLD        |   100584
(44 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 2010-01-01 | DEL       | OLD        |   100478
     2 | DEF   |            | DEL       | OLD        |   100479
     1 | ABC   | 2010-01-01 | INS       | NEW        |   100543
     2 | DEF   |            | INS       | NEW        |   100544
   100 | KLM   | 2012-12-31 | INS       | NEW        |   100583
(5 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | DEL       | OLD        |   100480
    12 | 10.00 | DEL       | OLD        |   100481
    13 | 10.00 | DEL       | OLD        |   100482
    14 | 10.00 | DEL       | OLD        |   100483
    15 | 10.00 | DEL       | OLD        |   100484
    16 | 10.00 | DEL       | OLD        |   100485
    17 | 10.00 | DEL       | OLD        |   100486
    18 | 10.00 | DEL       | OLD        |   100487
    19 | 10.00 | DEL       | OLD        |   100488
    20 | 10.00 | DEL       | OLD        |   100489
    14 | 10.00 | INS       | NEW        |   100551
    18 | 10.00 | INS       | NEW        |   100552
    20 | 10.00 | INS       | NEW        |   100553
    12 | 10.00 | INS       | NEW        |   100554
    13 | 10.00 | INS       | NEW        |   100555
    17 | 10.00 | INS       | NEW        |   100556
    19 | 10.00 | INS       | NEW        |   100557
    15 | 10.00 | INS       | NEW        |   100558
    16 | 10.00 | INS       | NEW        |   100559
    11 | 10.00 | INS       | NEW        |   100560
(20 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     2 |     1 | ABC        | DEL       | OLD        |   100466
     2 | FK... |     2 |     1 | ABC        | DEL       | OLD        |   100467
     1 | FK... |     2 |     1 | ABC        | INS       | NEW        |   100545
     2 | FK... |     2 |     1 | ABC        | INS       | NEW        |   100546
(4 rows)

--
-----------------------------
-- Step 3 : stop myGroup2
-----------------------------
select emaj.emaj_stop_group('myGroup2');
 emaj_stop_group 
-----------------
               0
(1 row)

--
-----------------------------
-- test end: check and reset history
-----------------------------
select hist_id, hist_function, hist_event, hist_object, regexp_replace(regexp_replace(hist_wording,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'),E'\\[.+\\]','(timestamp)','g'), hist_user from 
  (select * from emaj.emaj_hist order by hist_id) as t;
 hist_id |   hist_function    |  hist_event  |         hist_object          |                              regexp_replace                              | hist_user 
---------+--------------------+--------------+------------------------------+--------------------------------------------------------------------------+-----------
       1 | EMAJ_INSTALL       |              | E-Maj <NEXT_VERSION>         | Initialisation completed                                                 | postgres
   20002 | ALTER_GROUP        | BEGIN        | myGroup1                     |                                                                          | postgres
   20003 | LOCK_GROUP         | BEGIN        | myGroup1                     |                                                                          | postgres
   20004 | LOCK_GROUP         | END          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                           | postgres
   20005 | SET_MARK_GROUP     | BEGIN        | myGroup1                     | ALTER_%                                                                  | postgres
   20006 | SET_MARK_GROUP     | END          | myGroup1                     | ALTER_%                                                                  | postgres
   20007 | ALTER_GROUP        | END          | myGroup1                     | Timestamp Id : 20000                                                     | postgres
   20008 | ROLLBACK_GROUPS    | BEGIN        | myGroup1,myGroup2            | Logged rollback to mark Multi-1 (timestamp)                              | postgres
   20009 | DBLINK_OPEN_CNX    |              | rlbk#1                       | Status = 1                                                               | postgres
   20010 | LOCK_GROUP         | BEGIN        | myGroup1,myGroup2            | Rollback session #1                                                      | postgres
   20011 | LOCK_GROUP         | END          | myGroup1,myGroup2            | Rollback session #1: 2 tables locked, 0 deadlock(s)                      | postgres
   20012 | DBLINK_OPEN_CNX    |              | rlbk#2                       | Status = 1                                                               | postgres
   20013 | LOCK_GROUP         | BEGIN        | myGroup1,myGroup2            | Rollback session #2                                                      | postgres
   20014 | LOCK_GROUP         | END          | myGroup1,myGroup2            | Rollback session #2: 5 tables locked, 0 deadlock(s)                      | postgres
   20015 | DBLINK_OPEN_CNX    |              | rlbk#3                       | Status = 1                                                               | postgres
   20016 | LOCK_GROUP         | BEGIN        | myGroup1,myGroup2            | Rollback session #3                                                      | postgres
   20017 | LOCK_GROUP         | END          | myGroup1,myGroup2            | Rollback session #3: 4 tables locked, 0 deadlock(s)                      | postgres
   20018 | SET_MARK_GROUPS    | BEGIN        | myGroup1,myGroup2            | RLBK_Multi-1_%_START                                                     | postgres
   20019 | SET_MARK_GROUPS    | END          | myGroup1,myGroup2            | RLBK_Multi-1_%_START                                                     | postgres
   20020 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl1             | All log rows with emaj_gid > 100161 and <= 100505                        | postgres
   20021 | ROLLBACK_TABLE     | BEGIN        | myschema1.mytbl1             | All log rows with emaj_gid > 100161 and <= 100505                        | postgres
   20022 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl6             | All log rows with emaj_gid > 100161 and <= 100505                        | postgres
   20023 | ROLLBACK_TABLE     | END          | myschema1.mytbl1             | 20 rolled back primary keys                                              | postgres
   20024 | ROLLBACK_TABLE     | END          | myschema2.mytbl1             | 10 rolled back primary keys                                              | postgres
   20025 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl2             | All log rows with emaj_gid > 100161 and <= 100505                        | postgres
   20026 | ROLLBACK_TABLE     | END          | myschema2.mytbl6             | 14 rolled back primary keys                                              | postgres
   20027 | ROLLBACK_TABLE     | BEGIN        | myschema1.mytbl2             | All log rows with emaj_gid > 100161 and <= 100505                        | postgres
   20028 | ROLLBACK_TABLE     | END          | myschema2.mytbl2             | 2 rolled back primary keys                                               | postgres
   20029 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl4             | All log rows with emaj_gid > 100161 and <= 100505                        | postgres
   20030 | ROLLBACK_TABLE     | END          | myschema2.mytbl4             | 2 rolled back primary keys                                               | postgres
   20031 | ROLLBACK_TABLE     | END          | myschema1.mytbl2             | 3 rolled back primary keys                                               | postgres
   20032 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl5             | All log rows with emaj_gid > 100161 and <= 100505                        | postgres
   20033 | ROLLBACK_TABLE     | BEGIN        | myschema2."myTbl3"           | All log rows with emaj_gid > 100161 and <= 100505                        | postgres
   20034 | ROLLBACK_TABLE     | END          | myschema2.mytbl5             | 3 rolled back primary keys                                               | postgres
   20035 | ROLLBACK_TABLE     | END          | myschema2."myTbl3"           | 10 rolled back primary keys                                              | postgres
   20036 | DBLINK_CLOSE_CNX   |              | rlbk#3                       |                                                                          | postgres
   20037 | ROLLBACK_TABLE     | BEGIN        | myschema1."myTbl3"           | All log rows with emaj_gid > 100161 and <= 100505                        | postgres
   20038 | ROLLBACK_TABLE     | END          | myschema1."myTbl3"           | 5 rolled back primary keys                                               | postgres
   20039 | DBLINK_CLOSE_CNX   |              | rlbk#2                       |                                                                          | postgres
   20040 | ROLLBACK_SEQUENCE  |              | myschema1."myTbl3_col31_seq" | RESTART 21                                                               | postgres
   20041 | ROLLBACK_SEQUENCE  |              | myschema1.mytbl2b_col20_seq  |                                                                          | postgres
   20042 | ROLLBACK_SEQUENCE  |              | myschema2.myseq1             | RESTART 1004                                                             | postgres
   20043 | ROLLBACK_SEQUENCE  |              | myschema2."myTbl3_col31_seq" |                                                                          | postgres
   20044 | SET_MARK_GROUPS    | BEGIN        | myGroup1,myGroup2            | RLBK_Multi-1_%_DONE                                                      | postgres
   20045 | SET_MARK_GROUPS    | END          | myGroup1,myGroup2            | RLBK_Multi-1_%_DONE                                                      | postgres
   20046 | ROLLBACK_GROUPS    | NOTICE       | Rollback id 20000            | 9 / 11 tables effectively processed.                                     | postgres
   20047 | ROLLBACK_GROUPS    | NOTICE       | Rollback id 20000            | 4 sequences processed.                                                   | postgres
   20048 | ROLLBACK_GROUPS    | WARNING      | Rollback id 20000            | Tables group change not rolled back: E-Maj priority for myschema1.mytbl1 | postgres
   20049 | DBLINK_CLOSE_CNX   |              | rlbk#1                       |                                                                          | postgres
   20050 | ROLLBACK_GROUPS    | END          | myGroup1,myGroup2            | Rollback_id 20000, 9 tables and 4 sequences effectively processed        | postgres
   20051 | CLEANUP_RLBK_STATE |              | Rollback id 20000            | set to COMMITTED                                                         | postgres
   20052 | ROLLBACK_GROUP     | BEGIN        | myGroup1                     | Unlogged rollback to mark Multi-1 (timestamp)                            | postgres
   20053 | DBLINK_OPEN_CNX    |              | rlbk#1                       | Status = 1                                                               | postgres
   20054 | LOCK_GROUP         | BEGIN        | myGroup1                     | Rollback session #1                                                      | postgres
   20055 | LOCK_GROUP         | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                      | postgres
   20056 | ROLLBACK_TABLE     | BEGIN        | myschema1.mytbl1             | All log rows with emaj_gid > 100161 and <= 100565                        | postgres
   20057 | ROLLBACK_TABLE     | END          | myschema1.mytbl1             | 20 rolled back primary keys                                              | postgres
   20058 | ROLLBACK_TABLE     | BEGIN        | myschema1.mytbl2             | All log rows with emaj_gid > 100161 and <= 100565                        | postgres
   20059 | ROLLBACK_TABLE     | END          | myschema1.mytbl2             | 3 rolled back primary keys                                               | postgres
   20060 | ROLLBACK_TABLE     | BEGIN        | myschema1."myTbl3"           | All log rows with emaj_gid > 100161 and <= 100565                        | postgres
   20061 | ROLLBACK_TABLE     | END          | myschema1."myTbl3"           | 5 rolled back primary keys                                               | postgres
   20062 | ROLLBACK_GROUP     | MARK DELETED | myGroup1                     | mark ALTER_% is deleted                                                  | postgres
   20063 | ROLLBACK_GROUP     | MARK DELETED | myGroup1                     | mark RLBK_Multi-1_%_START is deleted                                     | postgres
   20064 | ROLLBACK_GROUP     | MARK DELETED | myGroup1                     | mark RLBK_Multi-1_%_DONE is deleted                                      | postgres
   20065 | ROLLBACK_SEQUENCE  |              | myschema1."myTbl3_col31_seq" | RESTART 21                                                               | postgres
   20066 | ROLLBACK_SEQUENCE  |              | myschema1.mytbl2b_col20_seq  |                                                                          | postgres
   20067 | ROLLBACK_GROUP     | NOTICE       | Rollback id 20001            | 3 / 5 tables effectively processed.                                      | postgres
   20068 | ROLLBACK_GROUP     | NOTICE       | Rollback id 20001            | 2 sequences processed.                                                   | postgres
   20069 | DBLINK_CLOSE_CNX   |              | rlbk#1                       |                                                                          | postgres
   20070 | ROLLBACK_GROUP     | END          | myGroup1                     | Rollback_id 20001, 3 tables and 2 sequences effectively processed        | postgres
   20071 | CLEANUP_RLBK_STATE |              | Rollback id 20001            | set to COMMITTED                                                         | postgres
   20072 | SET_MARK_GROUP     | BEGIN        | myGroup2                     |                                                                          | postgres
   20073 | LOCK_GROUP         | BEGIN        | myGroup2                     |                                                                          | postgres
   20074 | LOCK_GROUP         | END          | myGroup2                     | 0 tables locked, 0 deadlock(s)                                           | postgres
   20075 | SET_MARK_GROUP     | END          | myGroup2                     | After restore mark                                                       | postgres
   20076 | ROLLBACK_GROUP     | BEGIN        | myGroup2                     | Unlogged rollback to mark Multi-1 (timestamp)                            | postgres
   20077 | DBLINK_OPEN_CNX    |              | rlbk#1                       | Status = -2                                                              | postgres
   20078 | LOCK_GROUP         | BEGIN        | myGroup2                     | Rollback session #1                                                      | postgres
   20079 | LOCK_GROUP         | END          | myGroup2                     | Rollback session #1: 0 tables locked, 0 deadlock(s)                      | postgres
   20080 | ROLLBACK_GROUP     | MARK DELETED | myGroup2                     | mark RLBK_Multi-1_%_START is deleted                                     | postgres
   20081 | ROLLBACK_GROUP     | MARK DELETED | myGroup2                     | mark RLBK_Multi-1_%_DONE is deleted                                      | postgres
   20082 | ROLLBACK_GROUP     | MARK DELETED | myGroup2                     | mark After restore mark is deleted                                       | postgres
   20083 | ROLLBACK_GROUP     | NOTICE       | Rollback id 20002            | 0 / 6 tables effectively processed.                                      | postgres
   20084 | ROLLBACK_GROUP     | END          | myGroup2                     | Rollback_id 20002, 0 tables and 0 sequences effectively processed        | postgres
   20085 | STOP_GROUP         | BEGIN        | myGroup2                     |                                                                          | postgres
   20086 | LOCK_GROUP         | BEGIN        | myGroup2                     |                                                                          | postgres
   20087 | LOCK_GROUP         | END          | myGroup2                     | 0 tables locked, 0 deadlock(s)                                           | postgres
   20088 | SET_MARK_GROUP     | BEGIN        | myGroup2                     | STOP_%                                                                   | postgres
   20089 | SET_MARK_GROUP     | END          | myGroup2                     | STOP_%                                                                   | postgres
   20090 | STOP_GROUP         | END          | myGroup2                     | 0 tables/sequences processed                                             | postgres
(90 rows)

--
truncate emaj.emaj_hist;
TRUNCATE TABLE
alter sequence emaj.emaj_hist_hist_id_seq restart 30000;
ALTER SEQUENCE
