-- rollback.sql : test updates log, emaj_rollback_group(), emaj_logged_rollback_group(),
--                emaj_rollback_groups(), emaj_logged_rollback_groups(),
--                emaj_cleanup_rollback_state(), emaj_rollback_activity(),
--                emaj_consolidate_rollback_group() and emaj_get_consolidable_rollbacks() functions.
--
-- set sequence restart value
alter sequence emaj.emaj_hist_hist_id_seq restart 3000;
alter sequence emaj.emaj_time_stamp_time_id_seq restart 3000;
alter sequence emaj.emaj_global_seq restart 30000;
-- set the triggers state
select emaj.emaj_ignore_app_trigger('REMOVE','myschema1','mytbl2','mytbl2%');
 emaj_ignore_app_trigger 
-------------------------
                       0
(1 row)

ALTER TABLE mySchema1.myTbl2 ENABLE TRIGGER myTbl2trg2;
select emaj.emaj_ignore_app_trigger('ADD','myschema1','mytbl2','mytbl2trg2');
 emaj_ignore_app_trigger 
-------------------------
                       1
(1 row)

-- disable event triggers to test cases with missing components
select emaj.emaj_disable_protection_by_event_triggers();
 emaj_disable_protection_by_event_triggers 
-------------------------------------------
                                         3
(1 row)

-----------------------------
-- rollback nothing tests
-----------------------------
-- group or groups is NULL
select * from emaj.emaj_rollback_group(NULL,NULL);
ERROR:  _check_group_names: No group to process.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 30 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := v_multiGroup, v_lockGroups := FALSE, v_checkList := '')"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 17 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group(NULL,NULL);
ERROR:  _check_group_names: No group to process.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 30 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := v_multiGroup, v_lockGroups := FALSE, v_checkList := '')"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 17 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean) line 11 at RETURN QUERY
select * from emaj.emaj_rollback_groups(NULL,NULL);
WARNING:  _check_group_names: No group to process.
 rlbk_severity | rlbk_message 
---------------+--------------
 Notice        | 0
(1 row)

select * from emaj.emaj_logged_rollback_groups(NULL,NULL);
WARNING:  _check_group_names: No group to process.
 rlbk_severity | rlbk_message 
---------------+--------------
 Notice        | 0
(1 row)

-- group is unknown
select * from emaj.emaj_rollback_group('unknownGroup',NULL);
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 42 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := v_multiGroup, v_lockGroups := FALSE, v_checkList := '')"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 17 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group('unknownGroup',NULL);
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 42 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := v_multiGroup, v_lockGroups := FALSE, v_checkList := '')"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 17 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean) line 11 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"unknownGroup"}',NULL);
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 42 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := v_multiGroup, v_lockGroups := FALSE, v_checkList := '')"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 17 at SQL statement
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
select * from emaj.emaj_logged_rollback_groups('{"unknownGroup","myGroup1"}',NULL);
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 42 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := v_multiGroup, v_lockGroups := FALSE, v_checkList := '')"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 17 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean) line 12 at RETURN QUERY
begin;
  select emaj.emaj_start_group('myGroup1','');
 emaj_start_group 
------------------
                7
(1 row)

  select * from emaj.emaj_rollback_groups('{"myGroup1","unknownGroup"}','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 42 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := v_multiGroup, v_lockGroups := FALSE, v_checkList := '')"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 17 at SQL statement
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
rollback;
-- group not in logging state
select * from emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup1" is not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 87 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := FALSE, v_lockGroups := TRUE,
                                     v_checkList := 'LOGGING,ROLLBACKABLE,UNPROTECTED')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
select * from emaj.emaj_rollback_group('myGroup2','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup2" is not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 87 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := FALSE, v_lockGroups := TRUE,
                                     v_checkList := 'LOGGING,ROLLBACKABLE,UNPROTECTED')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group('myGroup1','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup1" is not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 87 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := FALSE, v_lockGroups := TRUE,
                                     v_checkList := 'LOGGING,ROLLBACKABLE,UNPROTECTED')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean) line 11 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group('myGroup2','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup2" is not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 87 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := FALSE, v_lockGroups := TRUE,
                                     v_checkList := 'LOGGING,ROLLBACKABLE,UNPROTECTED')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean) line 11 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}',NULL);
ERROR:  _check_group_names: The groups "myGroup1, myGroup2" are not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 90 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := FALSE, v_lockGroups := TRUE,
                                     v_checkList := 'LOGGING,ROLLBACKABLE,UNPROTECTED')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
begin;
  select emaj.emaj_start_group('myGroup1','');
 emaj_start_group 
------------------
                7
(1 row)

  select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup2" is not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 87 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := FALSE, v_lockGroups := TRUE,
                                     v_checkList := 'LOGGING,ROLLBACKABLE,UNPROTECTED')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean) line 12 at RETURN QUERY
rollback;
-- start groups and set some marks
select emaj.emaj_start_group('myGroup1','Mark11');
 emaj_start_group 
------------------
                7
(1 row)

select emaj.emaj_start_group('myGroup2','Mark21');
WARNING:  _check_fk_groups: The foreign key "mytbl6_col61_fkey" on the table "myschema2.mytbl6" references the table "myschema2.mytbl7" that is outside the groups (myGroup2).
WARNING:  _check_fk_groups: The table "myschema2.mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" on the table "myschema2.mytbl8" that is outside the groups (myGroup2).
 emaj_start_group 
------------------
                8
(1 row)

select emaj.emaj_set_mark_group('myGroup1','Different_Mark');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select emaj.emaj_set_mark_group('myGroup2','Different_Mark');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

-- log tables are empty
select count(*) from emaj_myschema1.mytbl1_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl2_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl2b_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1."myTbl3_log";
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl4_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema2.mytbl1_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema2.mytbl2_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema2."myTbl3_log";
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.myTbl4_log;
 count 
-------
     0
(1 row)

-- protected group
select emaj.emaj_protect_group('myGroup1');
 emaj_protect_group 
--------------------
                  1
(1 row)

select emaj.emaj_protect_group('myGroup2');
 emaj_protect_group 
--------------------
                  1
(1 row)

select * from emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup1" is currently protected against rollback operations.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 100 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := FALSE, v_lockGroups := TRUE,
                                     v_checkList := 'LOGGING,ROLLBACKABLE,UNPROTECTED')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
select * from emaj.emaj_logged_rollback_groups('{"myGroup2","myGroup1"}',NULL);
ERROR:  _check_group_names: The groups "myGroup1, myGroup2" are currently protected against rollback operations.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 103 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := FALSE, v_lockGroups := TRUE,
                                     v_checkList := 'LOGGING,ROLLBACKABLE,UNPROTECTED')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean) line 12 at RETURN QUERY
select emaj.emaj_unprotect_group('myGroup1');
 emaj_unprotect_group 
----------------------
                    1
(1 row)

select emaj.emaj_unprotect_group('myGroup2');
 emaj_unprotect_group 
----------------------
                    1
(1 row)

select * from emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 0 / 5 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

-- unknown mark name
select * from emaj.emaj_rollback_group('myGroup1',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 59 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
select * from emaj.emaj_rollback_group('myGroup1','DummyMark');
ERROR:  _check_mark_name: The mark "DummyMark" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 59 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group('myGroup1',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 59 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean) line 11 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group('myGroup1','DummyMark');
ERROR:  _check_mark_name: The mark "DummyMark" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 59 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean) line 11 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2",""}',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the groups "myGroup1, myGroup2".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 61 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2",NULL}',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the groups "myGroup1, myGroup2".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 61 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','DummyMark');
ERROR:  _check_mark_name: The mark "DummyMark" does not exist for the groups "myGroup1, myGroup2".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 61 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2","myGroup2"}',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the groups "myGroup1, myGroup2".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 61 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean) line 12 at RETURN QUERY
select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mark11');
ERROR:  _check_mark_name: The mark "Mark11" does not exist for the group "myGroup2".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 59 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean) line 12 at RETURN QUERY
-- mark name referencing different points in time
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Different_Mark');
ERROR:  _check_mark_name: The mark "Different_Mark" does not represent the same point in time for all groups.
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 70 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','EMAJ_LAST_MARK');
ERROR:  _check_mark_name: The EMAJ_LAST_MARK does not represent the same point in time for all groups.
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 38 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
-- attempt to rollback 'audit_only' groups
select emaj.emaj_create_group('auditOnlyEmptyGroup',false);
 emaj_create_group 
-------------------
                 1
(1 row)

select * from emaj.emaj_rollback_group('phil''s group#3",','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "phil's group#3"," has been created as AUDIT_ONLY.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 61 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := FALSE, v_lockGroups := TRUE,
                                     v_checkList := 'LOGGING,ROLLBACKABLE,UNPROTECTED')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
select * from emaj.emaj_logged_rollback_groups(array['phil''s group#3",','auditOnlyEmptyGroup'],'M1_audit_only');
ERROR:  _check_group_names: The groups "auditOnlyEmptyGroup, phil's group#3"," have been created as AUDIT_ONLY.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 64 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := v_groupNames, v_mayBeNull := FALSE, v_lockGroups := TRUE,
                                     v_checkList := 'LOGGING,ROLLBACKABLE,UNPROTECTED')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean) line 12 at RETURN QUERY
select emaj.emaj_drop_group('auditOnlyEmptyGroup');
 emaj_drop_group 
-----------------
               0
(1 row)

-- attempt to rollback to a stop mark
begin;
  select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               7
(1 row)

  select emaj.emaj_start_group('myGroup1','StartMark',false);
 emaj_start_group 
------------------
                7
(1 row)

  select emaj.emaj_rename_mark_group('myGroup1',(select emaj.emaj_get_previous_mark_group('myGroup1','StartMark')), 'GeneratedStopMark');
 emaj_rename_mark_group 
------------------------
 
(1 row)

  select * from emaj.emaj_rollback_group('myGroup1','GeneratedStopMark');
ERROR:  _check_mark_name: For the group "myGroup1", the mark "GeneratedStopMark" is DELETED.
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 81 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := v_groupNames, v_mark := v_mark, v_checkList := 'ACTIVE')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
rollback;
-- attempt to rollback over protected marks
begin;
  select emaj.emaj_set_mark_group('myGroup1','Protected Mark 1');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

  select emaj.emaj_protect_mark_group('myGroup1','Protected Mark 1');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select emaj.emaj_set_mark_group('myGroup1','Protected Mark 2');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

  select emaj.emaj_protect_mark_group('myGroup1','Protected Mark 2');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select * from emaj.emaj_rollback_group('myGroup1','Mark11');
ERROR:  _rlbk_check: Protected marks (Protected Mark 1, Protected Mark 2) for the group "myGroup1" block the rollback to the mark "Mark11".
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 41 at RAISE
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
rollback;
-- attempt to rollback several groups over one single-mark protected marks
begin;
  select emaj.emaj_set_mark_groups('{"myGroup1","myGroup2"}','Common Mark 1');
 emaj_set_mark_groups 
----------------------
                   15
(1 row)

  select emaj.emaj_set_mark_group('myGroup1','Protected Mark 1');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

  select emaj.emaj_protect_mark_group('myGroup1','Protected Mark 1');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Common Mark 1');
ERROR:  _rlbk_check: Protected marks (Protected Mark 1) for the group "myGroup1" block the rollback to the mark "Common Mark 1".
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 41 at RAISE
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
rollback;
-- attempt to logged-rollback over a protected mark
begin;
  select emaj.emaj_protect_mark_group('myGroup1','EMAJ_LAST_MARK');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select * from emaj.emaj_logged_rollback_group('myGroup1','Mark11');
ERROR:  _rlbk_check: Protected marks (Different_Mark) for the group "myGroup1" block the rollback to the mark "Mark11".
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 41 at RAISE
SQL statement "SELECT emaj._rlbk_check(v_groupNames, v_mark, v_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean) line 11 at RETURN QUERY
rollback;
-- rollback to a protected mark
begin;
  select emaj.emaj_protect_mark_group('myGroup1','EMAJ_LAST_MARK');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select * from emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 0 / 5 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

rollback;
-- missing application table and mono-group rollback
begin;
  drop table mySchema2."myTbl3" cascade;
  select * from emaj.emaj_rollback_group('myGroup2','Mark21');
ERROR:  _verify_groups (1): In group "myGroup2", the table "myschema2"."myTbl3" does not exist any more. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  PL/pgSQL function emaj._verify_groups(text[],boolean) line 44 at RAISE
SQL statement "SELECT 0
        FROM emaj._verify_groups(v_groupNames, TRUE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 26 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
rollback;
begin;
  drop table mySchema2."myTbl3" cascade;
  select * from emaj.emaj_logged_rollback_group('myGroup2','Mark21');
ERROR:  _verify_groups (1): In group "myGroup2", the table "myschema2"."myTbl3" does not exist any more. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  PL/pgSQL function emaj._verify_groups(text[],boolean) line 44 at RAISE
SQL statement "SELECT 0
        FROM emaj._verify_groups(v_groupNames, TRUE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 26 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean) line 11 at RETURN QUERY
rollback;
-- internal error when the row corresponding to an application sequence to rollback is missing in emaj_sequence
begin;
  delete from emaj.emaj_sequence where sequ_schema = 'myschema2' and sequ_name = 'myseq1';
  select * from emaj.emaj_rollback_group('myGroup2','Mark21');
ERROR:  _rlbk_seq: No mark at time id "3003" can be found for the sequence "myschema2.myseq1".
CONTEXT:  PL/pgSQL function emaj._rlbk_seq(emaj.emaj_relation,bigint) line 23 at RAISE
SQL statement "SELECT emaj._rlbk_seq(t.*, greatest(v_markTimeId, lower(t.rel_time_range)))
      FROM
        (SELECT *
           FROM emaj.emaj_relation
           WHERE upper_inf(rel_time_range)
             AND rel_group = ANY (v_groupNames)
             AND rel_kind = 'S'
           ORDER BY rel_schema, rel_tblseq
        ) as t"
PL/pgSQL function emaj._rlbk_end(integer,boolean) line 138 at PERFORM
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 34 at RETURN QUERY
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
rollback;
-- should be OK, with different cases of dblink status
-- hide dblink_connect functions
alter function public.dblink_connect_u(text,text) rename to renamed_dblink_connect_u;
alter function public.dblink_connect_u(text) rename to renamed_dblink_connect_u;
select * from emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 0 / 5 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

select * from emaj.emaj_rollback_group('myGroup2','Mark21');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 0 / 6 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

alter function public.renamed_dblink_connect_u(text,text) rename to dblink_connect_u;
alter function public.renamed_dblink_connect_u(text) rename to dblink_connect_u;
select emaj.emaj_set_mark_groups('{"myGroup1","myGroup2"}','Mark1B');
 emaj_set_mark_groups 
----------------------
                   15
(1 row)

-- no user/password defined in emaj_param
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','EMAJ_LAST_MARK');
 rlbk_severity |             rlbk_message             
---------------+--------------------------------------
 Notice        | 0 / 11 tables effectively processed.
 Notice        | 4 sequences processed.
(2 rows)

-- bad user/password defined in emaj_param
insert into emaj.emaj_param (param_key, param_value_text) 
  values ('dblink_user_password','user=<user> password=<password>');
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
 rlbk_severity |             rlbk_message             
---------------+--------------------------------------
 Notice        | 0 / 11 tables effectively processed.
 Notice        | 4 sequences processed.
(2 rows)

-- transaction not in READ COMMITTED isolation level => the dblink connection is not possible
begin;
  set transaction isolation level repeatable read;
  select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','EMAJ_LAST_MARK');
 rlbk_severity |             rlbk_message             
---------------+--------------------------------------
 Notice        | 0 / 11 tables effectively processed.
 Notice        | 4 sequences processed.
(2 rows)

commit;
-- dblink connection should now be ok (missing right on dblink functions is tested in adm1.sql)
update emaj.emaj_param set param_value_text = 'user=postgres password=postgres' 
  where param_key = 'dblink_user_password';
select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
 rlbk_severity |             rlbk_message             
---------------+--------------------------------------
 Notice        | 0 / 11 tables effectively processed.
 Notice        | 4 sequences processed.
(2 rows)

-- missing application table and multi-groups rollback
begin;
  drop table mySchema2."myTbl3" cascade;
  select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
ERROR:  _verify_groups (1): In group "myGroup2", the table "myschema2"."myTbl3" does not exist any more. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  PL/pgSQL function emaj._verify_groups(text[],boolean) line 44 at RAISE
SQL statement "SELECT 0
        FROM emaj._verify_groups(v_groupNames, TRUE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 26 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
rollback;
begin;
  drop table mySchema2."myTbl3" cascade;
  select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
ERROR:  _verify_groups (1): In group "myGroup2", the table "myschema2"."myTbl3" does not exist any more. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  PL/pgSQL function emaj._verify_groups(text[],boolean) line 44 at RAISE
SQL statement "SELECT 0
        FROM emaj._verify_groups(v_groupNames, TRUE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 26 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup, v_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean) line 12 at RETURN QUERY
rollback;
-- restart groups
select emaj.emaj_stop_groups('{"myGroup1","myGroup2"}');
 emaj_stop_groups 
------------------
               15
(1 row)

select emaj.emaj_start_group('myGroup1','Mark11');
 emaj_start_group 
------------------
                7
(1 row)

select emaj.emaj_start_group('myGroup2','Mark21');
WARNING:  _check_fk_groups: The foreign key "mytbl6_col61_fkey" on the table "myschema2.mytbl6" references the table "myschema2.mytbl7" that is outside the groups (myGroup2).
WARNING:  _check_fk_groups: The table "myschema2.mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" on the table "myschema2.mytbl8" that is outside the groups (myGroup2).
 emaj_start_group 
------------------
                8
(1 row)

-----------------------------
-- log phase #1 with 2 unlogged rollbacks
-----------------------------
-- Populate application tables
set search_path=public,myschema1;
-- inserts/updates/deletes in myTbl1, myTbl2 and myTbl2b (via trigger)
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
begin transaction;
  update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
  insert into myTbl2 values (1,'ABC',current_date);
commit;
delete from myTbl1 where col11 > 10;
insert into myTbl2 values (2,'DEF',NULL);
insert into myTbl2 values (3,'GHI',NULL);
update myTbl2 set col22 = NULL WHERE col23 IS NULL;
delete from myTbl2 where col21 = 3 and col22 is NULL;
select count(*) from mytbl1;
 count 
-------
    10
(1 row)

select count(*) from mytbl2;
 count 
-------
     2
(1 row)

select count(*) from mytbl2b;
 count 
-------
     6
(1 row)

select count(*) from "myTbl3";
 count 
-------
     0
(1 row)

select count(*) from myTbl4;
 count 
-------
     0
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark12');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+-----------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         2006 | f               | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         2016 | f               | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         2017 | f               | f                      |                                        |                         0 | 
 phil's group#3", | Mark4          |         2018 | f               | f                      |                                        |                         0 | 
 myGroup1         | Mark11         |         3027 | f               | f                      |                                        |                        27 | 
 myGroup2         | Mark21         |         3028 | f               | f                      |                                        |                         0 | 
 myGroup1         | Mark12         |         3029 | f               | f                      |                                        |                           | 
(7 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
  sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
----------------+-------------------+--------------+---------------+----------------
 phil's schema3 | myTbl2\_col21_seq |         2018 |             1 | f
 phil's schema3 | phil's seq\1      |         2018 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3027 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3027 |             1 | f
 myschema2      | myTbl3_col31_seq  |         3028 |             1 | f
 myschema2      | myseq1            |         3028 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3029 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3029 |             6 | t
(8 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema   |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
----------------+-------------+-------------+----------------------
 phil's schema3 | myTbl2\     |        2018 |                    0
 phil's schema3 | phil's tbl1 |        2018 |                    0
 myschema1      | myTbl3      |        3027 |                    0
 myschema1      | mytbl1      |        3027 |                    0
 myschema1      | mytbl2      |        3027 |                    0
 myschema1      | mytbl2b     |        3027 |                    0
 myschema1      | mytbl4      |        3027 |                    0
 myschema2      | myTbl3      |        3028 |                    0
 myschema2      | mytbl1      |        3028 |                    0
 myschema2      | mytbl2      |        3028 |                    0
 myschema2      | mytbl4      |        3028 |                    0
 myschema2      | mytbl5      |        3028 |                    0
 myschema2      | mytbl6      |        3028 |                    0
 myschema1      | myTbl3      |        3029 |                    0
 myschema1      | mytbl1      |        3029 |                   15
 myschema1      | mytbl2      |        3029 |                    6
 myschema1      | mytbl2b     |        3029 |                    6
 myschema1      | mytbl4      |        3029 |                    0
(18 rows)

-- inserts/updates/deletes in myTbl3 and myTbl4
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
insert into myTbl4 values (1,'FK...',1,1,'ABC');
update myTbl4 set col43 = NULL where col41 = 1;
select count(*) from "myTbl3";
 count 
-------
    10
(1 row)

select count(*) from myTbl4;
 count 
-------
     1
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark13');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+-----------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         2006 | f               | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         2016 | f               | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         2017 | f               | f                      |                                        |                         0 | 
 phil's group#3", | Mark4          |         2018 | f               | f                      |                                        |                         0 | 
 myGroup1         | Mark11         |         3027 | f               | f                      |                                        |                        27 | 
 myGroup2         | Mark21         |         3028 | f               | f                      |                                        |                         0 | 
 myGroup1         | Mark12         |         3029 | f               | f                      |                                        |                        12 | 
 myGroup1         | Mark13         |         3030 | f               | f                      |                                        |                           | 
(8 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
  sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
----------------+-------------------+--------------+---------------+----------------
 phil's schema3 | myTbl2\_col21_seq |         2018 |             1 | f
 phil's schema3 | phil's seq\1      |         2018 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3027 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3027 |             1 | f
 myschema2      | myTbl3_col31_seq  |         3028 |             1 | f
 myschema2      | myseq1            |         3028 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3029 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3029 |             6 | t
 myschema1      | myTbl3_col31_seq  |         3030 |            10 | t
 myschema1      | mytbl2b_col20_seq |         3030 |             6 | t
(10 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema   |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
----------------+-------------+-------------+----------------------
 phil's schema3 | myTbl2\     |        2018 |                    0
 phil's schema3 | phil's tbl1 |        2018 |                    0
 myschema1      | myTbl3      |        3027 |                    0
 myschema1      | mytbl1      |        3027 |                    0
 myschema1      | mytbl2      |        3027 |                    0
 myschema1      | mytbl2b     |        3027 |                    0
 myschema1      | mytbl4      |        3027 |                    0
 myschema2      | myTbl3      |        3028 |                    0
 myschema2      | mytbl1      |        3028 |                    0
 myschema2      | mytbl2      |        3028 |                    0
 myschema2      | mytbl4      |        3028 |                    0
 myschema2      | mytbl5      |        3028 |                    0
 myschema2      | mytbl6      |        3028 |                    0
 myschema1      | myTbl3      |        3029 |                    0
 myschema1      | mytbl1      |        3029 |                   15
 myschema1      | mytbl2      |        3029 |                    6
 myschema1      | mytbl2b     |        3029 |                    6
 myschema1      | mytbl4      |        3029 |                    0
 myschema1      | myTbl3      |        3030 |                   10
 myschema1      | mytbl1      |        3030 |                   15
 myschema1      | mytbl2      |        3030 |                    6
 myschema1      | mytbl2b     |        3030 |                    6
 myschema1      | mytbl4      |        3030 |                    2
(23 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    30000
     2 | ABC        | \x0c  | INS       | NEW        |    30001
     3 | ABC        | \x0c  | INS       | NEW        |    30002
     4 | ABC        | \x0c  | INS       | NEW        |    30003
     5 | ABC        | \x0c  | INS       | NEW        |    30004
     6 | ABC        | \x0c  | INS       | NEW        |    30005
     7 | ABC        | \x0c  | INS       | NEW        |    30006
     8 | ABC        | \x0c  | INS       | NEW        |    30007
     9 | ABC        | \x0c  | INS       | NEW        |    30008
    10 | ABC        | \x0c  | INS       | NEW        |    30009
    11 | ABC        | \x0c  | INS       | NEW        |    30010
     1 | ABC        | \x0c  | UPD       | OLD        |    30011
     1 | ABC        | \x1c  | UPD       | NEW        |    30011
     2 | ABC        | \x0c  | UPD       | OLD        |    30012
     2 | ABC        | \x1c  | UPD       | NEW        |    30012
     3 | ABC        | \x0c  | UPD       | OLD        |    30013
     3 | ABC        | \x1c  | UPD       | NEW        |    30013
    11 | ABC        | \x0c  | DEL       | OLD        |    30016
(18 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |    30014
     2 | DEF   | INS       | NEW        |    30017
     3 | GHI   | INS       | NEW        |    30019
     2 | DEF   | UPD       | OLD        |    30021
     2 |       | UPD       | NEW        |    30021
     3 | GHI   | UPD       | OLD        |    30023
     3 |       | UPD       | NEW        |    30023
     3 |       | DEL       | OLD        |    30025
(8 rows)

select col20, col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | col22 | col23 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-----------+------------+----------
     1 |     1 |       | t     | INS       | NEW        |    30015
     2 |     2 |       | t     | INS       | NEW        |    30018
     3 |     3 |       | t     | INS       | NEW        |    30020
     4 |     2 |       | t     | INS       | NEW        |    30022
     5 |     3 |       | t     | INS       | NEW        |    30024
     6 |     3 |       | t     | INS       | NEW        |    30026
(6 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1."myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |    30027
     2 | 10.00 | INS       | NEW        |    30028
     3 | 10.00 | INS       | NEW        |    30029
     4 | 10.00 | INS       | NEW        |    30030
     5 | 10.00 | INS       | NEW        |    30031
     6 | 10.00 | INS       | NEW        |    30032
     7 | 10.00 | INS       | NEW        |    30033
     8 | 10.00 | INS       | NEW        |    30034
     9 | 10.00 | INS       | NEW        |    30035
    10 | 10.00 | INS       | NEW        |    30036
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    30037
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    30038
     1 | FK... |       |     1 | ABC        | UPD       | NEW        |    30038
(3 rows)

-- rollback #1
select * from emaj.emaj_rollback_group('myGroup1','Mark12');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 2 / 5 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

-- check impact
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+-----------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         2006 | f               | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         2016 | f               | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         2017 | f               | f                      |                                        |                         0 | 
 phil's group#3", | Mark4          |         2018 | f               | f                      |                                        |                         0 | 
 myGroup1         | Mark11         |         3027 | f               | f                      |                                        |                        27 | 
 myGroup2         | Mark21         |         3028 | f               | f                      |                                        |                         0 | 
 myGroup1         | Mark12         |         3029 | f               | f                      |                                        |                           | 
(7 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
  sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
----------------+-------------------+--------------+---------------+----------------
 phil's schema3 | myTbl2\_col21_seq |         2018 |             1 | f
 phil's schema3 | phil's seq\1      |         2018 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3027 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3027 |             1 | f
 myschema2      | myTbl3_col31_seq  |         3028 |             1 | f
 myschema2      | myseq1            |         3028 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3029 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3029 |             6 | t
(8 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema   |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
----------------+-------------+-------------+----------------------
 phil's schema3 | myTbl2\     |        2018 |                    0
 phil's schema3 | phil's tbl1 |        2018 |                    0
 myschema1      | myTbl3      |        3027 |                    0
 myschema1      | mytbl1      |        3027 |                    0
 myschema1      | mytbl2      |        3027 |                    0
 myschema1      | mytbl2b     |        3027 |                    0
 myschema1      | mytbl4      |        3027 |                    0
 myschema2      | myTbl3      |        3028 |                    0
 myschema2      | mytbl1      |        3028 |                    0
 myschema2      | mytbl2      |        3028 |                    0
 myschema2      | mytbl4      |        3028 |                    0
 myschema2      | mytbl5      |        3028 |                    0
 myschema2      | mytbl6      |        3028 |                    0
 myschema1      | myTbl3      |        3029 |                    0
 myschema1      | mytbl1      |        3029 |                   15
 myschema1      | mytbl2      |        3029 |                    6
 myschema1      | mytbl2b     |        3029 |                    6
 myschema1      | mytbl4      |        3029 |                    0
(18 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | myTbl3     |               3029 |             3031 |             10
 myschema1   | mytbl4     |               3029 |             3031 |              2
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1."myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 | col45 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-------+-----------+------------+----------
(0 rows)

select col31, col33 from myschema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
(0 rows)

select col41, col42, col43, col44, col45 from myschema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- rollback #2 (and stop)
select * from emaj.emaj_rollback_group('myGroup1','Mark11');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 3 / 5 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               7
(1 row)

-- check impact
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+-----------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         2006 | f               | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         2016 | f               | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         2017 | f               | f                      |                                        |                         0 | 
 phil's group#3", | Mark4          |         2018 | f               | f                      |                                        |                         0 | 
 myGroup1         | Mark11         |         3027 | t               | f                      |                                        |                         0 | 
 myGroup2         | Mark21         |         3028 | f               | f                      |                                        |                         0 | 
 myGroup1         | STOP_%         |         3033 | t               | f                      |                                        |                         0 | 
(7 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
  sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
----------------+-------------------+--------------+---------------+----------------
 phil's schema3 | myTbl2\_col21_seq |         2018 |             1 | f
 phil's schema3 | phil's seq\1      |         2018 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3027 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3027 |             1 | f
 myschema2      | myTbl3_col31_seq  |         3028 |             1 | f
 myschema2      | myseq1            |         3028 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3033 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3033 |             1 | f
(8 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema   |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
----------------+-------------+-------------+----------------------
 phil's schema3 | myTbl2\     |        2018 |                    0
 phil's schema3 | phil's tbl1 |        2018 |                    0
 myschema1      | myTbl3      |        3027 |                    0
 myschema1      | mytbl1      |        3027 |                    0
 myschema1      | mytbl2      |        3027 |                    0
 myschema1      | mytbl2b     |        3027 |                    0
 myschema1      | mytbl4      |        3027 |                    0
 myschema2      | myTbl3      |        3028 |                    0
 myschema2      | mytbl1      |        3028 |                    0
 myschema2      | mytbl2      |        3028 |                    0
 myschema2      | mytbl4      |        3028 |                    0
 myschema2      | mytbl5      |        3028 |                    0
 myschema2      | mytbl6      |        3028 |                    0
 myschema1      | myTbl3      |        3033 |                   10
 myschema1      | mytbl1      |        3033 |                   15
 myschema1      | mytbl2      |        3033 |                    6
 myschema1      | mytbl2b     |        3033 |                    6
 myschema1      | mytbl4      |        3033 |                    2
(18 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | myTbl3     |               3029 |             3031 |             10
 myschema1   | mytbl1     |               3027 |             3032 |             15
 myschema1   | mytbl2     |               3027 |             3032 |              6
 myschema1   | mytbl2b    |               3027 |             3032 |              6
 myschema1   | mytbl4     |               3029 |             3031 |              2
(5 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 | col12 | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------+------------+----------
(0 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col20, col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | col22 | col23 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-----------+------------+----------
(0 rows)

select col11, col12, col13 from myschema1.myTbl1 order by col11, col12;
 col11 | col12 | col13 
-------+-------+-------
(0 rows)

select col21, col22 from myschema1.myTbl2 order by col21;
 col21 | col22 
-------+-------
(0 rows)

select col20, col21 from myschema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

-- restart group
select emaj.emaj_start_group('myGroup1','Mark11');
 emaj_start_group 
------------------
                7
(1 row)

-- check the logs are empty again
select count(*) from emaj_myschema1.mytbl1_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl2_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl2b_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1."myTbl3_log";
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl4_log;
 count 
-------
     0
(1 row)

-----------------------------
-- log phase #2 with 2 logged rollbacks
-----------------------------
-- Populate application tables
set search_path=public,myschema1;
-- inserts/updates/deletes in myTbl1, myTbl2 and myTbl2b (via trigger)
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
begin transaction;
  update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
  insert into myTbl2 values (1,'ABC',current_date);
commit;
delete from myTbl1 where col11 > 10;
insert into myTbl2 values (2,'DEF',NULL);
select count(*) from mytbl1;
 count 
-------
    10
(1 row)

select count(*) from mytbl2;
 count 
-------
     2
(1 row)

select count(*) from mytbl2b;
 count 
-------
     2
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark12');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

-- inserts/updates/deletes in myTbl3 and myTbl4
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
insert into myTbl4 values (1,'FK...',1,1,'ABC');
select count(*) from "myTbl3";
 count 
-------
    10
(1 row)

select count(*) from myTbl4;
 count 
-------
     1
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark13');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+-----------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         2006 | f               | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         2016 | f               | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         2017 | f               | f                      |                                        |                         0 | 
 phil's group#3", | Mark4          |         2018 | f               | f                      |                                        |                         0 | 
 myGroup2         | Mark21         |         3028 | f               | f                      |                                        |                         0 | 
 myGroup1         | Mark11         |         3034 | f               | f                      |                                        |                        19 | 
 myGroup1         | Mark12         |         3035 | f               | f                      |                                        |                        11 | 
 myGroup1         | Mark13         |         3036 | f               | f                      |                                        |                           | 
(8 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
  sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
----------------+-------------------+--------------+---------------+----------------
 phil's schema3 | myTbl2\_col21_seq |         2018 |             1 | f
 phil's schema3 | phil's seq\1      |         2018 |          1000 | f
 myschema2      | myTbl3_col31_seq  |         3028 |             1 | f
 myschema2      | myseq1            |         3028 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3034 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3034 |             1 | f
 myschema1      | myTbl3_col31_seq  |         3035 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3035 |             2 | t
 myschema1      | myTbl3_col31_seq  |         3036 |            10 | t
 myschema1      | mytbl2b_col20_seq |         3036 |             2 | t
(10 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema   |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
----------------+-------------+-------------+----------------------
 phil's schema3 | myTbl2\     |        2018 |                    0
 phil's schema3 | phil's tbl1 |        2018 |                    0
 myschema2      | myTbl3      |        3028 |                    0
 myschema2      | mytbl1      |        3028 |                    0
 myschema2      | mytbl2      |        3028 |                    0
 myschema2      | mytbl4      |        3028 |                    0
 myschema2      | mytbl5      |        3028 |                    0
 myschema2      | mytbl6      |        3028 |                    0
 myschema1      | myTbl3      |        3034 |                   10
 myschema1      | mytbl1      |        3034 |                   15
 myschema1      | mytbl2      |        3034 |                    6
 myschema1      | mytbl2b     |        3034 |                    6
 myschema1      | mytbl4      |        3034 |                    2
 myschema1      | myTbl3      |        3035 |                   10
 myschema1      | mytbl1      |        3035 |                   30
 myschema1      | mytbl2      |        3035 |                    8
 myschema1      | mytbl2b     |        3035 |                    8
 myschema1      | mytbl4      |        3035 |                    2
 myschema1      | myTbl3      |        3036 |                   20
 myschema1      | mytbl1      |        3036 |                   30
 myschema1      | mytbl2      |        3036 |                    8
 myschema1      | mytbl2b     |        3036 |                    8
 myschema1      | mytbl4      |        3036 |                    3
(23 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    30039
     2 | ABC        | \x0c  | INS       | NEW        |    30040
     3 | ABC        | \x0c  | INS       | NEW        |    30041
     4 | ABC        | \x0c  | INS       | NEW        |    30042
     5 | ABC        | \x0c  | INS       | NEW        |    30043
     6 | ABC        | \x0c  | INS       | NEW        |    30044
     7 | ABC        | \x0c  | INS       | NEW        |    30045
     8 | ABC        | \x0c  | INS       | NEW        |    30046
     9 | ABC        | \x0c  | INS       | NEW        |    30047
    10 | ABC        | \x0c  | INS       | NEW        |    30048
    11 | ABC        | \x0c  | INS       | NEW        |    30049
     1 | ABC        | \x0c  | UPD       | OLD        |    30050
     1 | ABC        | \x1c  | UPD       | NEW        |    30050
     2 | ABC        | \x0c  | UPD       | OLD        |    30051
     2 | ABC        | \x1c  | UPD       | NEW        |    30051
     3 | ABC        | \x0c  | UPD       | OLD        |    30052
     3 | ABC        | \x1c  | UPD       | NEW        |    30052
    11 | ABC        | \x0c  | DEL       | OLD        |    30055
(18 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |    30053
     2 | DEF   | INS       | NEW        |    30056
(2 rows)

select col20, col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | col22 | col23 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-----------+------------+----------
     1 |     1 |       | t     | INS       | NEW        |    30054
     2 |     2 |       | t     | INS       | NEW        |    30057
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1."myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |    30058
     2 | 10.00 | INS       | NEW        |    30059
     3 | 10.00 | INS       | NEW        |    30060
     4 | 10.00 | INS       | NEW        |    30061
     5 | 10.00 | INS       | NEW        |    30062
     6 | 10.00 | INS       | NEW        |    30063
     7 | 10.00 | INS       | NEW        |    30064
     8 | 10.00 | INS       | NEW        |    30065
     9 | 10.00 | INS       | NEW        |    30066
    10 | 10.00 | INS       | NEW        |    30067
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    30068
(1 row)

-- logged rollback #1
select * from emaj.emaj_logged_rollback_group('myGroup1','Mark12');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 2 / 5 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

-- check impact
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    |   regexp_replace    | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+---------------------+--------------+-----------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2                 |         2006 | f               | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3                |         2016 | f               | f                      |                                        |                         0 | 
 emptyGroup       | EGM4                |         2017 | f               | f                      |                                        |                         0 | 
 phil's group#3", | Mark4               |         2018 | f               | f                      |                                        |                         0 | 
 myGroup2         | Mark21              |         3028 | f               | f                      |                                        |                         0 | 
 myGroup1         | Mark11              |         3034 | f               | f                      |                                        |                        19 | 
 myGroup1         | Mark12              |         3035 | f               | f                      |                                        |                        11 | 
 myGroup1         | Mark13              |         3036 | f               | f                      |                                        |                         0 | 
 myGroup1         | RLBK_Mark12_%_START |         3037 | f               | f                      |                                        |                        11 | 
 myGroup1         | RLBK_Mark12_%_DONE  |         3038 | f               | f                      |                                        |                           | Mark12
(10 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
  sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
----------------+-------------------+--------------+---------------+----------------
 phil's schema3 | myTbl2\_col21_seq |         2018 |             1 | f
 phil's schema3 | phil's seq\1      |         2018 |          1000 | f
 myschema2      | myTbl3_col31_seq  |         3028 |             1 | f
 myschema2      | myseq1            |         3028 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3034 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3034 |             1 | f
 myschema1      | myTbl3_col31_seq  |         3035 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3035 |             2 | t
 myschema1      | myTbl3_col31_seq  |         3036 |            10 | t
 myschema1      | mytbl2b_col20_seq |         3036 |             2 | t
 myschema1      | myTbl3_col31_seq  |         3037 |            10 | t
 myschema1      | mytbl2b_col20_seq |         3037 |             2 | t
 myschema1      | myTbl3_col31_seq  |         3038 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3038 |             2 | t
(14 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema   |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
----------------+-------------+-------------+----------------------
 phil's schema3 | myTbl2\     |        2018 |                    0
 phil's schema3 | phil's tbl1 |        2018 |                    0
 myschema2      | myTbl3      |        3028 |                    0
 myschema2      | mytbl1      |        3028 |                    0
 myschema2      | mytbl2      |        3028 |                    0
 myschema2      | mytbl4      |        3028 |                    0
 myschema2      | mytbl5      |        3028 |                    0
 myschema2      | mytbl6      |        3028 |                    0
 myschema1      | myTbl3      |        3034 |                   10
 myschema1      | mytbl1      |        3034 |                   15
 myschema1      | mytbl2      |        3034 |                    6
 myschema1      | mytbl2b     |        3034 |                    6
 myschema1      | mytbl4      |        3034 |                    2
 myschema1      | myTbl3      |        3035 |                   10
 myschema1      | mytbl1      |        3035 |                   30
 myschema1      | mytbl2      |        3035 |                    8
 myschema1      | mytbl2b     |        3035 |                    8
 myschema1      | mytbl4      |        3035 |                    2
 myschema1      | myTbl3      |        3036 |                   20
 myschema1      | mytbl1      |        3036 |                   30
 myschema1      | mytbl2      |        3036 |                    8
 myschema1      | mytbl2b     |        3036 |                    8
 myschema1      | mytbl4      |        3036 |                    3
 myschema1      | myTbl3      |        3037 |                   20
 myschema1      | mytbl1      |        3037 |                   30
 myschema1      | mytbl2      |        3037 |                    8
 myschema1      | mytbl2b     |        3037 |                    8
 myschema1      | mytbl4      |        3037 |                    3
 myschema1      | myTbl3      |        3038 |                   30
 myschema1      | mytbl1      |        3038 |                   30
 myschema1      | mytbl2      |        3038 |                    8
 myschema1      | mytbl2b     |        3038 |                    8
 myschema1      | mytbl4      |        3038 |                    4
(33 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1."myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |    30058
     2 | 10.00 | INS       | NEW        |    30059
     3 | 10.00 | INS       | NEW        |    30060
     4 | 10.00 | INS       | NEW        |    30061
     5 | 10.00 | INS       | NEW        |    30062
     6 | 10.00 | INS       | NEW        |    30063
     7 | 10.00 | INS       | NEW        |    30064
     8 | 10.00 | INS       | NEW        |    30065
     9 | 10.00 | INS       | NEW        |    30066
    10 | 10.00 | INS       | NEW        |    30067
     1 | 10.00 | DEL       | OLD        |    30069
     2 | 10.00 | DEL       | OLD        |    30070
     3 | 10.00 | DEL       | OLD        |    30071
     4 | 10.00 | DEL       | OLD        |    30072
     5 | 10.00 | DEL       | OLD        |    30073
     6 | 10.00 | DEL       | OLD        |    30074
     7 | 10.00 | DEL       | OLD        |    30075
     8 | 10.00 | DEL       | OLD        |    30076
     9 | 10.00 | DEL       | OLD        |    30077
    10 | 10.00 | DEL       | OLD        |    30078
(20 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    30068
     1 | FK... |     1 |     1 | ABC        | DEL       | OLD        |    30079
(2 rows)

select col31, col33 from myschema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
(0 rows)

select col41, col42, col43, col44, col45 from myschema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- logged rollback #2
select * from emaj.emaj_logged_rollback_group('myGroup1','Mark11');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 5 / 5 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

-- check impact
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    |   regexp_replace    | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+---------------------+--------------+-----------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2                 |         2006 | f               | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3                |         2016 | f               | f                      |                                        |                         0 | 
 emptyGroup       | EGM4                |         2017 | f               | f                      |                                        |                         0 | 
 phil's group#3", | Mark4               |         2018 | f               | f                      |                                        |                         0 | 
 myGroup2         | Mark21              |         3028 | f               | f                      |                                        |                         0 | 
 myGroup1         | Mark11              |         3034 | f               | f                      |                                        |                        19 | 
 myGroup1         | Mark12              |         3035 | f               | f                      |                                        |                        11 | 
 myGroup1         | Mark13              |         3036 | f               | f                      |                                        |                         0 | 
 myGroup1         | RLBK_Mark12_%_START |         3037 | f               | f                      |                                        |                        11 | 
 myGroup1         | RLBK_Mark12_%_DONE  |         3038 | f               | f                      |                                        |                         0 | Mark12
 myGroup1         | RLBK_Mark11_%_START |         3039 | f               | f                      |                                        |                        14 | 
 myGroup1         | RLBK_Mark11_%_DONE  |         3040 | f               | f                      |                                        |                           | Mark11
(12 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
  sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
----------------+-------------------+--------------+---------------+----------------
 phil's schema3 | myTbl2\_col21_seq |         2018 |             1 | f
 phil's schema3 | phil's seq\1      |         2018 |          1000 | f
 myschema2      | myTbl3_col31_seq  |         3028 |             1 | f
 myschema2      | myseq1            |         3028 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3034 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3034 |             1 | f
 myschema1      | myTbl3_col31_seq  |         3035 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3035 |             2 | t
 myschema1      | myTbl3_col31_seq  |         3036 |            10 | t
 myschema1      | mytbl2b_col20_seq |         3036 |             2 | t
 myschema1      | myTbl3_col31_seq  |         3037 |            10 | t
 myschema1      | mytbl2b_col20_seq |         3037 |             2 | t
 myschema1      | myTbl3_col31_seq  |         3038 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3038 |             2 | t
 myschema1      | myTbl3_col31_seq  |         3039 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3039 |             2 | t
 myschema1      | myTbl3_col31_seq  |         3040 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3040 |             1 | f
(18 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema   |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
----------------+-------------+-------------+----------------------
 phil's schema3 | myTbl2\     |        2018 |                    0
 phil's schema3 | phil's tbl1 |        2018 |                    0
 myschema2      | myTbl3      |        3028 |                    0
 myschema2      | mytbl1      |        3028 |                    0
 myschema2      | mytbl2      |        3028 |                    0
 myschema2      | mytbl4      |        3028 |                    0
 myschema2      | mytbl5      |        3028 |                    0
 myschema2      | mytbl6      |        3028 |                    0
 myschema1      | myTbl3      |        3034 |                   10
 myschema1      | mytbl1      |        3034 |                   15
 myschema1      | mytbl2      |        3034 |                    6
 myschema1      | mytbl2b     |        3034 |                    6
 myschema1      | mytbl4      |        3034 |                    2
 myschema1      | myTbl3      |        3035 |                   10
 myschema1      | mytbl1      |        3035 |                   30
 myschema1      | mytbl2      |        3035 |                    8
 myschema1      | mytbl2b     |        3035 |                    8
 myschema1      | mytbl4      |        3035 |                    2
 myschema1      | myTbl3      |        3036 |                   20
 myschema1      | mytbl1      |        3036 |                   30
 myschema1      | mytbl2      |        3036 |                    8
 myschema1      | mytbl2b     |        3036 |                    8
 myschema1      | mytbl4      |        3036 |                    3
 myschema1      | myTbl3      |        3037 |                   20
 myschema1      | mytbl1      |        3037 |                   30
 myschema1      | mytbl2      |        3037 |                    8
 myschema1      | mytbl2b     |        3037 |                    8
 myschema1      | mytbl4      |        3037 |                    3
 myschema1      | myTbl3      |        3038 |                   30
 myschema1      | mytbl1      |        3038 |                   30
 myschema1      | mytbl2      |        3038 |                    8
 myschema1      | mytbl2b     |        3038 |                    8
 myschema1      | mytbl4      |        3038 |                    4
 myschema1      | myTbl3      |        3039 |                   30
 myschema1      | mytbl1      |        3039 |                   30
 myschema1      | mytbl2      |        3039 |                    8
 myschema1      | mytbl2b     |        3039 |                    8
 myschema1      | mytbl4      |        3039 |                    4
 myschema1      | myTbl3      |        3040 |                   30
 myschema1      | mytbl1      |        3040 |                   40
 myschema1      | mytbl2      |        3040 |                   10
 myschema1      | mytbl2b     |        3040 |                   10
 myschema1      | mytbl4      |        3040 |                    4
(43 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
(0 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    30039
     2 | ABC        | \x0c  | INS       | NEW        |    30040
     3 | ABC        | \x0c  | INS       | NEW        |    30041
     4 | ABC        | \x0c  | INS       | NEW        |    30042
     5 | ABC        | \x0c  | INS       | NEW        |    30043
     6 | ABC        | \x0c  | INS       | NEW        |    30044
     7 | ABC        | \x0c  | INS       | NEW        |    30045
     8 | ABC        | \x0c  | INS       | NEW        |    30046
     9 | ABC        | \x0c  | INS       | NEW        |    30047
    10 | ABC        | \x0c  | INS       | NEW        |    30048
    11 | ABC        | \x0c  | INS       | NEW        |    30049
     1 | ABC        | \x0c  | UPD       | OLD        |    30050
     1 | ABC        | \x1c  | UPD       | NEW        |    30050
     2 | ABC        | \x0c  | UPD       | OLD        |    30051
     2 | ABC        | \x1c  | UPD       | NEW        |    30051
     3 | ABC        | \x0c  | UPD       | OLD        |    30052
     3 | ABC        | \x1c  | UPD       | NEW        |    30052
    11 | ABC        | \x0c  | DEL       | OLD        |    30055
     1 | ABC        | \x1c  | DEL       | OLD        |    30080
     2 | ABC        | \x1c  | DEL       | OLD        |    30081
     3 | ABC        | \x1c  | DEL       | OLD        |    30082
     4 | ABC        | \x0c  | DEL       | OLD        |    30083
     5 | ABC        | \x0c  | DEL       | OLD        |    30084
     6 | ABC        | \x0c  | DEL       | OLD        |    30085
     7 | ABC        | \x0c  | DEL       | OLD        |    30086
     8 | ABC        | \x0c  | DEL       | OLD        |    30087
     9 | ABC        | \x0c  | DEL       | OLD        |    30088
    10 | ABC        | \x0c  | DEL       | OLD        |    30089
(28 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |    30053
     2 | DEF   | INS       | NEW        |    30056
     1 | ABC   | DEL       | OLD        |    30090
     2 | DEF   | DEL       | OLD        |    30091
(4 rows)

select col20, col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | col22 | col23 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-----------+------------+----------
     1 |     1 |       | t     | INS       | NEW        |    30054
     2 |     2 |       | t     | INS       | NEW        |    30057
     1 |     1 |       | t     | DEL       | OLD        |    30092
     2 |     2 |       | t     | DEL       | OLD        |    30093
(4 rows)

select col11, col12, col13 from myschema1.myTbl1 order by col11, col12;
 col11 | col12 | col13 
-------+-------+-------
(0 rows)

select col21, col22 from myschema1.myTbl2 order by col21;
 col21 | col22 
-------+-------
(0 rows)

select col20, col21 from myschema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

-----------------------------
-- unlogged rollback of logged rollbacks #3
-----------------------------
alter table mySchema1.myTbl2 disable trigger myTbl2trg1;
select * from emaj.emaj_rollback_group('myGroup1','Mark13');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 5 / 5 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

alter table mySchema1.myTbl2 enable trigger myTbl2trg1;
-- check impact
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+-----------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         2006 | f               | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         2016 | f               | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         2017 | f               | f                      |                                        |                         0 | 
 phil's group#3", | Mark4          |         2018 | f               | f                      |                                        |                         0 | 
 myGroup2         | Mark21         |         3028 | f               | f                      |                                        |                         0 | 
 myGroup1         | Mark11         |         3034 | f               | f                      |                                        |                        19 | 
 myGroup1         | Mark12         |         3035 | f               | f                      |                                        |                        11 | 
 myGroup1         | Mark13         |         3036 | f               | f                      |                                        |                           | 
(8 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
  sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
----------------+-------------------+--------------+---------------+----------------
 phil's schema3 | myTbl2\_col21_seq |         2018 |             1 | f
 phil's schema3 | phil's seq\1      |         2018 |          1000 | f
 myschema2      | myTbl3_col31_seq  |         3028 |             1 | f
 myschema2      | myseq1            |         3028 |          1000 | f
 myschema1      | myTbl3_col31_seq  |         3034 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3034 |             1 | f
 myschema1      | myTbl3_col31_seq  |         3035 |             1 | f
 myschema1      | mytbl2b_col20_seq |         3035 |             2 | t
 myschema1      | myTbl3_col31_seq  |         3036 |            10 | t
 myschema1      | mytbl2b_col20_seq |         3036 |             2 | t
(10 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema   |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
----------------+-------------+-------------+----------------------
 phil's schema3 | myTbl2\     |        2018 |                    0
 phil's schema3 | phil's tbl1 |        2018 |                    0
 myschema2      | myTbl3      |        3028 |                    0
 myschema2      | mytbl1      |        3028 |                    0
 myschema2      | mytbl2      |        3028 |                    0
 myschema2      | mytbl4      |        3028 |                    0
 myschema2      | mytbl5      |        3028 |                    0
 myschema2      | mytbl6      |        3028 |                    0
 myschema1      | myTbl3      |        3034 |                   10
 myschema1      | mytbl1      |        3034 |                   15
 myschema1      | mytbl2      |        3034 |                    6
 myschema1      | mytbl2b     |        3034 |                    6
 myschema1      | mytbl4      |        3034 |                    2
 myschema1      | myTbl3      |        3035 |                   10
 myschema1      | mytbl1      |        3035 |                   30
 myschema1      | mytbl2      |        3035 |                    8
 myschema1      | mytbl2b     |        3035 |                    8
 myschema1      | mytbl4      |        3035 |                    2
 myschema1      | myTbl3      |        3036 |                   20
 myschema1      | mytbl1      |        3036 |                   30
 myschema1      | mytbl2      |        3036 |                    8
 myschema1      | mytbl2b     |        3036 |                    8
 myschema1      | mytbl4      |        3036 |                    3
(23 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | myTbl3     |               3036 |             3041 |             10
 myschema1   | mytbl1     |               3036 |             3041 |             10
 myschema1   | mytbl2     |               3036 |             3041 |              2
 myschema1   | mytbl2b    |               3036 |             3041 |              2
 myschema1   | mytbl4     |               3036 |             3041 |              1
(5 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    30039
     2 | ABC        | \x0c  | INS       | NEW        |    30040
     3 | ABC        | \x0c  | INS       | NEW        |    30041
     4 | ABC        | \x0c  | INS       | NEW        |    30042
     5 | ABC        | \x0c  | INS       | NEW        |    30043
     6 | ABC        | \x0c  | INS       | NEW        |    30044
     7 | ABC        | \x0c  | INS       | NEW        |    30045
     8 | ABC        | \x0c  | INS       | NEW        |    30046
     9 | ABC        | \x0c  | INS       | NEW        |    30047
    10 | ABC        | \x0c  | INS       | NEW        |    30048
    11 | ABC        | \x0c  | INS       | NEW        |    30049
     1 | ABC        | \x0c  | UPD       | OLD        |    30050
     1 | ABC        | \x1c  | UPD       | NEW        |    30050
     2 | ABC        | \x0c  | UPD       | OLD        |    30051
     2 | ABC        | \x1c  | UPD       | NEW        |    30051
     3 | ABC        | \x0c  | UPD       | OLD        |    30052
     3 | ABC        | \x1c  | UPD       | NEW        |    30052
    11 | ABC        | \x0c  | DEL       | OLD        |    30055
(18 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |    30053
     2 | DEF   | INS       | NEW        |    30056
(2 rows)

select col20, col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | col22 | col23 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-----------+------------+----------
     1 |     1 |       | t     | INS       | NEW        |    30054
     2 |     2 |       | t     | INS       | NEW        |    30057
(2 rows)

select col11, col12, col13 from myschema1.myTbl1 order by col11, col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select col21, col22 from myschema1.myTbl2 order by col21;
 col21 | col22 
-------+-------
     1 | ABC
     2 | DEF
(2 rows)

select col20, col21 from myschema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
     1 |     1
     2 |     2
(2 rows)

-----------------------------
-- rollback an empty group
-----------------------------
select * from emaj.emaj_rollback_group('emptyGroup','EGM4');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 0 / 0 tables effectively processed.
(1 row)

select * from emaj.emaj_logged_rollback_group('emptyGroup','EGM3');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 0 / 0 tables effectively processed.
(1 row)

-----------------------------
-- test use of partitionned tables
-----------------------------
select emaj.emaj_start_group('myGroup4','myGroup4_start');
 emaj_start_group 
------------------
                5
(1 row)

insert into myschema4.myTblM values ('2001-09-11',0,'abc'),('2011-09-11',10,'def'),('2021-09-11',20,'ghi');
insert into myschema4.myTblP values (-1,'abc'),(0,'def'),(1,'ghi');
select emaj.emaj_set_mark_group('myGroup4','mark1');
 emaj_set_mark_group 
---------------------
                   5
(1 row)

truncate myschema4.myTblM;
update myschema4.myTblP set col2 = 'DEF' where col1 = 0;
select * from emaj.emaj_logged_rollback_group('myGroup4','mark1');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 3 / 5 tables effectively processed.
(1 row)

select col1, col2, col3, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mytblm_log;
    col1    | col2 | col3 | emaj_verb | emaj_tuple | emaj_gid 
------------+------+------+-----------+------------+----------
 09-11-2021 |   20 | ghi  | INS       | NEW        |    30096
            |      |      | TRU       |            |    30097
 09-11-2021 |   20 | ghi  | TRU       | OLD        |    30098
 09-11-2021 |   20 | ghi  | INS       | NEW        |    30105
(4 rows)

select col1, col2, col3, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mytblc1_log;
    col1    | col2 | col3 | emaj_verb | emaj_tuple | emaj_gid 
------------+------+------+-----------+------------+----------
 09-11-2001 |    0 | abc  | INS       | NEW        |    30094
            |      |      | TRU       |            |    30099
 09-11-2001 |    0 | abc  | TRU       | OLD        |    30100
 09-11-2001 |    0 | abc  | INS       | NEW        |    30103
(4 rows)

select col1, col2, col3, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mytblc2_log;
    col1    | col2 | col3 | emaj_verb | emaj_tuple | emaj_gid 
------------+------+------+-----------+------------+----------
 09-11-2011 |   10 | def  | INS       | NEW        |    30095
            |      |      | TRU       |            |    30101
 09-11-2011 |   10 | def  | TRU       | OLD        |    30102
 09-11-2011 |   10 | def  | INS       | NEW        |    30104
(4 rows)

select col1, col2, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mypartp1_log;          -- empty in pg 9.6-
 col1 | col2 | emaj_verb | emaj_tuple | emaj_gid 
------+------+-----------+------------+----------
(0 rows)

select col1, col2, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mypartp2_log;          -- empty in pg 9.6-
 col1 | col2 | emaj_verb | emaj_tuple | emaj_gid 
------+------+-----------+------------+----------
(0 rows)

-- use the functions dedicated to emaj_web
-- for an equivalent of "select * from emaj.emaj_rollback_group('myGroup4','myGroup4_start',true);"
select * from emaj._rlbk_async(emaj._rlbk_init(array['myGroup4'], 'myGroup4_start', false, 1, false, true), false);
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 3 / 5 tables effectively processed.
(1 row)

-- and check the result
select rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_time_id, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, 
       rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status, rlbk_begin_hist_id,
       rlbk_dblink_schema, rlbk_is_dblink_used, rlbk_messages
 from emaj.emaj_rlbk order by rlbk_id desc limit 1;
 rlbk_id | rlbk_groups |   rlbk_mark    | rlbk_mark_time_id | rlbk_time_id | rlbk_is_logged | rlbk_is_alter_group_allowed | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_status | rlbk_begin_hist_id | rlbk_dblink_schema | rlbk_is_dblink_used |                  rlbk_messages                  
---------+-------------+----------------+-------------------+--------------+----------------+-----------------------------+-----------------+---------------+------------------+-------------------+-------------+--------------------+--------------------+---------------------+-------------------------------------------------
      18 | {myGroup4}  | myGroup4_start |              3045 |         3049 | f              | t                           |               1 |             5 |                0 |                 3 | COMPLETED   |               3375 | public             | t                   | {"Notice: 3 / 5 tables effectively processed."}
(1 row)

-----------------------------
-- test emaj_rollback_activity()
-----------------------------
-- insert necessary rows into rollback tables in order to test various cases of emaj_rollback_activity() reports.
-- these tests ares performed inside transactions that are then rolled back.
begin;
-- 1 rollback operation in EXECUTING state, but no rollback steps have started yet
  insert into emaj.emaj_time_stamp (time_id, time_tx_timestamp) values (-1, now()-'0.1 seconds'::interval);
  insert into emaj.emaj_time_stamp (time_id, time_clock_timestamp) values (-2, '2000-01-01 01:00:00');
  insert into emaj.emaj_rlbk (rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_time_id, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, 
             rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status)
    values (1232,array['group1232'],'mark1232',-2,-1,true,false,
             1,5,4,3,'EXECUTING');
  insert into emaj.emaj_rlbk_plan (rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object,
             rlbp_estimated_duration, rlbp_estimated_quantity, rlbp_start_datetime, rlbp_duration)
    values (1232, 'RLBK_TABLE','schema','t1','','50 seconds'::interval,null,null,null),
           (1232, 'RLBK_TABLE','schema','t2','','30 seconds'::interval,null,null,null),
           (1232, 'RLBK_TABLE','schema','t3','','20 seconds'::interval,null,null,null),
           (1232, 'CTRL+DBLINK','',     '',  '','0.3 second'::interval,3,   null,null);
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status |  rlbk_remaining   | rlbk_completion_pct 
---------+-------------+-------------------+---------------------
    1232 | EXECUTING   | @ 1 min 40.3 secs |                   0
(1 row)

-- the first RLBK_TABLE has started, but the elapse of the step is not yet > estimated duration 
  update emaj.emaj_time_stamp set time_tx_timestamp = now() - '11 seconds'::interval where time_id = -1;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '11 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't1';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status |  rlbk_remaining   | rlbk_completion_pct 
---------+-------------+-------------------+---------------------
    1232 | EXECUTING   | @ 1 min 29.2 secs |                  11
(1 row)

  select 1.0 - ((20.0 + 30.0)+(50.0 - 11.0) + 2*0.3/3) / (11.1 + (20.0 + 30.0)+(50.0 - 11.0) + 2*0.3/3); -- the completion % should be 11%
        ?column?        
------------------------
 0.11066799601196410768
(1 row)

-- the first RLBK_TABLE is completed, and the step duration < the estimated duration 
  update emaj.emaj_time_stamp set time_tx_timestamp = now() - '45.1 seconds'::interval where time_id = -1;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '45 seconds'::interval,
                                 rlbp_duration = '45 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't1';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 50.2 secs    |                  47
(1 row)

  select 1.0 - (20.0 + 30.0 + 2*0.3/3) / (45.1 + (20.0 + 30.0) + 2*0.3/3);  -- the completion % should be 47%
        ?column?        
------------------------
 0.47324239244491080797
(1 row)

-- the second RLBK_TABLE has started, but the elapse of the step is not yet > estimated duration 
  update emaj.emaj_time_stamp set time_tx_timestamp = now() - '73.1 seconds'::interval where time_id = -1;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '28 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 22.1 secs    |                  77
(1 row)

  select 1.0 - (20.0 + (30.0 - 28.0) + 1*0.3/3) / (73.1 + (20.0 + (30.0 - 28.0) + 1*0.3/3));  -- the completion % should be 77%
        ?column?        
------------------------
 0.76785714285714285714
(1 row)

-- the second RLBK_TABLE has started, but the elapse of the step is already > estimated duration 
  update emaj.emaj_time_stamp set time_tx_timestamp = now() - '85.1 seconds'::interval where time_id = -1;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '40 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 20.1 secs    |                  81
(1 row)

  select 1.0 - (20.0 + 1*0.3/3) / (85.1 + (20.0 + 1*0.3/3));  -- the completion % should be 81%
        ?column?        
------------------------
 0.80893536121673003802
(1 row)

-- the second RLBK_TABLE has started, but the elapse of the step is already > estimated duration 
  update emaj.emaj_time_stamp set time_tx_timestamp = now() - '105.1 seconds'::interval where time_id = -1;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '60 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 20.1 secs    |                  84
(1 row)

  select 1.0 - (20.0 + 1*0.3/3) / (105.1 + (20.0 + 1*0.3/3 ));  -- the completion % should be 84%
        ?column?        
------------------------
 0.83945686900958466454
(1 row)

-- the second RLBK_TABLE is completed, and the step duration > the estimated duration 
  update emaj.emaj_time_stamp set time_tx_timestamp = now() - '110.1 seconds'::interval where time_id = -1;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '65 seconds'::interval,
                                 rlbp_duration = '65 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 20.1 secs    |                  85
(1 row)

  select 1.0 - (20.0 + 1*0.3/3) / (110.1 + (20.0 + 1*0.3/3));  -- the completion % should be 85%
        ?column?        
------------------------
 0.84562211981566820276
(1 row)

-- the third RLBK_TABLE has started, and is almost completed 
  update emaj.emaj_time_stamp set time_tx_timestamp = now() - '124.1 seconds'::interval where time_id = -1;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '19 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't3';
  select rlbk_id, rlbk_status, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_remaining | rlbk_completion_pct 
---------+-------------+----------------+---------------------
    1232 | EXECUTING   | @ 1 sec        |                  99
(1 row)

  select 1.0 - ((20.0 - 19.0)) / (124.1 + (20.0 - 19.0));  -- the completion % should be 99%
        ?column?        
------------------------
 0.99200639488409272582
(1 row)

rollback;
begin;
-- 1 rollback operation in LOCKING state and without step other than LOCK_TABLE
  insert into emaj.emaj_time_stamp (time_id, time_tx_timestamp) values (-1, now()-'2 minutes'::interval);
  insert into emaj.emaj_time_stamp (time_id, time_clock_timestamp) values (-2, '2000-01-01 01:00:00');
  insert into emaj.emaj_rlbk (rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_time_id, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, 
             rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status)
    values (1233,array['group1233'],'mark1233',-2,-1,true,false,
             1,5,4,3,'LOCKING');
  insert into emaj.emaj_rlbk_plan (rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object,
             rlbp_estimated_duration, rlbp_start_datetime, rlbp_duration)
    values (1233, 'LOCK_TABLE','schema','t1','',null,null,null),
           (1233, 'LOCK_TABLE','schema','t2','',null,null,null),
           (1233, 'LOCK_TABLE','schema','t3','',null,null,null);
  select rlbk_id, rlbk_status, rlbk_elapse, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_elapse | rlbk_remaining | rlbk_completion_pct 
---------+-------------+-------------+----------------+---------------------
    1233 | LOCKING     | @ 2 mins    | @ 0            |                   0
(1 row)

-- the rollback operation in LOCKING state now has RLBK_TABLE steps
  insert into emaj.emaj_rlbk_plan (rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object,
             rlbp_estimated_duration, rlbp_start_datetime, rlbp_duration)
    values (1233, 'RLBK_TABLE','schema','t1','','0:20:00'::interval,null,null),
           (1233, 'RLBK_TABLE','schema','t2','','0:02:00'::interval,null,null),
           (1233, 'RLBK_TABLE','schema','t3','','0:00:20'::interval,null,null);
  select rlbk_id, rlbk_status, rlbk_elapse, rlbk_remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_elapse |  rlbk_remaining   | rlbk_completion_pct 
---------+-------------+-------------+-------------------+---------------------
    1233 | LOCKING     | @ 2 mins    | @ 22 mins 20 secs |                   0
(1 row)

-- +1 rollback operation in PLANNING state
  insert into emaj.emaj_time_stamp (time_id, time_tx_timestamp) values (-3, now()-'1 minute'::interval);
  insert into emaj.emaj_rlbk (rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_time_id, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, 
             rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status)
    values (1234,array['group1234'],'mark1234',-2,-3,true,false,
             1,5,4,3,'PLANNING');
  select rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_datetime, rlbk_is_logged, rlbk_nb_session, rlbk_nb_table,
         rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status, rlbk_elapse, rlbk_remaining, rlbk_completion_pct 
    from emaj._rollback_activity();
 rlbk_id | rlbk_groups | rlbk_mark |      rlbk_mark_datetime      | rlbk_is_logged | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_status | rlbk_elapse |  rlbk_remaining   | rlbk_completion_pct 
---------+-------------+-----------+------------------------------+----------------+-----------------+---------------+------------------+-------------------+-------------+-------------+-------------------+---------------------
    1233 | {group1233} | mark1233  | Sat Jan 01 01:00:00 2000 PST | t              |               1 |             5 |                4 |                 3 | LOCKING     | @ 2 mins    | @ 22 mins 20 secs |                   0
    1234 | {group1234} | mark1234  | Sat Jan 01 01:00:00 2000 PST | t              |               1 |             5 |                4 |                 3 | PLANNING    | @ 1 min     |                   |                   0
(2 rows)

rollback;
-----------------------------
-- test emaj_consolidate_rollback_group() and emaj_get_consolidable_rollbacks()
-----------------------------
-- group is NULL or unknown
select emaj.emaj_consolidate_rollback_group(NULL,NULL);
ERROR:  _check_group_names: No group to process.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 30 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := ARRAY[v_groupName], v_mayBeNull := FALSE, v_lockGroups := TRUE, v_checkList := '')"
PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 16 at PERFORM
select emaj.emaj_consolidate_rollback_group('unknownGroup',NULL);
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 42 at RAISE
SQL statement "SELECT emaj._check_group_names(v_groupNames := ARRAY[v_groupName], v_mayBeNull := FALSE, v_lockGroups := TRUE, v_checkList := '')"
PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 16 at PERFORM
-- mark is unknown
select emaj.emaj_consolidate_rollback_group('myGroup1',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 59 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := ARRAY[v_groupName], v_mark := v_endRlbkMark, v_checkList := '')"
PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 18 at SQL statement
select emaj.emaj_consolidate_rollback_group('myGroup1','unknown mark');
ERROR:  _check_mark_name: The mark "unknown mark" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,text) line 59 at RAISE
SQL statement "SELECT emaj._check_mark_name(v_groupNames := ARRAY[v_groupName], v_mark := v_endRlbkMark, v_checkList := '')"
PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 18 at SQL statement
-- mark is known but is not an end rollback mark
select emaj.emaj_consolidate_rollback_group('myGroup1','Mark12');
ERROR:  emaj_consolidate_rollback_group: The mark "Mark12" for the group "myGroup1" is not an end rollback mark.
CONTEXT:  PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 28 at RAISE
-- mark is an end rollback mark but the rollback target mark is invalid
begin;
  update emaj.emaj_mark set mark_logged_rlbk_target_mark = 'dummy' where mark_name = 'Mark12';
  select emaj.emaj_consolidate_rollback_group('myGroup1','Mark12');
ERROR:  emaj_consolidate_rollback_group: The rollback target mark "dummy" for the group "myGroup1" has not been found.
CONTEXT:  PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 41 at RAISE
rollback;
-- should be ok
set search_path=public,myschema1;
select emaj.emaj_ignore_app_trigger('ADD', 'myschema1', 'mytbl2', 'mytbl2trg%');
 emaj_ignore_app_trigger 
-------------------------
                       1
(1 row)

-- rollback without log rows to delete
select emaj.emaj_set_mark_group('myGroup1','Conso_M1');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select * from emaj.emaj_logged_rollback_group('myGroup1','Conso_M1');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 0 / 5 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

select emaj.emaj_consolidate_rollback_group('myGroup1','EMAJ_LAST_MARK');
 emaj_consolidate_rollback_group 
---------------------------------
                               2
(1 row)

-- mark Conso_M1, updates, mark Conso_M2, updates, logged rlbk back to Conso_M1, updates, rename both marks, consolidate, check and cancel
select emaj.emaj_set_mark_group('myGroup1','Conso_M2');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

insert into myTbl1 select i, 'Test', 'Conso' from generate_series (1000,1011) as i;
insert into myTbl2 values (1000,'TC1',NULL);
delete from myTbl1 where col11 > 1010;
select emaj.emaj_set_mark_group('myGroup1','Conso_M3');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

update myTbl2 set col22 = 'TC2' WHERE col22 ='TC1';
select * from emaj.emaj_logged_rollback_group('myGroup1','Conso_M2');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 3 / 5 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

insert into myTbl2 values (1000,'TC3',NULL);
select emaj.emaj_rename_mark_group('myGroup1','Conso_M2','Renamed_conso_M2');
 emaj_rename_mark_group 
------------------------
 
(1 row)

select emaj.emaj_rename_mark_group('myGroup1','EMAJ_LAST_MARK','Renamed_last_mark');
 emaj_rename_mark_group 
------------------------
 
(1 row)

select cons_group, cons_target_rlbk_mark_name, cons_target_rlbk_mark_time_id, 
       regexp_replace(cons_end_rlbk_mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), cons_end_rlbk_mark_time_id, cons_rows, cons_marks 
  from emaj.emaj_get_consolidable_rollbacks();
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_time_id |    regexp_replace    | cons_end_rlbk_mark_time_id | cons_rows | cons_marks 
------------+----------------------------+-------------------------------+----------------------+----------------------------+-----------+------------
 emptyGroup | EGM3                       |                          2016 | RLBK_EGM3_%_DONE     |                       3044 |         0 |          2
 myGroup1   | Conso_M1                   |                          3050 | RLBK_Conso_M1_%_DONE |                       3052 |         0 |          0
 myGroup1   | Renamed_conso_M2           |                          3053 | Renamed_last_mark    |                       3056 |        32 |          2
(3 rows)

  
select emaj.emaj_consolidate_rollback_group('myGroup1','Renamed_last_mark');
 emaj_consolidate_rollback_group 
---------------------------------
                               5
(1 row)

select cons_group, cons_target_rlbk_mark_name, cons_target_rlbk_mark_time_id, 
       regexp_replace(cons_end_rlbk_mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), cons_end_rlbk_mark_time_id, cons_rows, cons_marks
  from emaj.emaj_get_consolidable_rollbacks();
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_time_id |    regexp_replace    | cons_end_rlbk_mark_time_id | cons_rows | cons_marks 
------------+----------------------------+-------------------------------+----------------------+----------------------------+-----------+------------
 emptyGroup | EGM3                       |                          2016 | RLBK_EGM3_%_DONE     |                       3044 |         0 |          2
 myGroup1   | Conso_M1                   |                          3050 | RLBK_Conso_M1_%_DONE |                       3052 |         0 |          0
 myGroup1   | Renamed_conso_M2           |                          3053 | Renamed_last_mark    |                       3056 |         0 |          0
(3 rows)

-- consolidate a rollback already consolidated
select emaj.emaj_consolidate_rollback_group('myGroup1','Renamed_last_mark');
 emaj_consolidate_rollback_group 
---------------------------------
                               2
(1 row)

select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark where mark_group = 'myGroup1' order by mark_time_id, mark_group;
 mark_group |    regexp_replace    | mark_time_id | mark_is_deleted | mark_is_rlbk_protected | mark_comment | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+----------------------+--------------+-----------------+------------------------+--------------+---------------------------+------------------------------
 myGroup1   | Mark11               |         3034 | f               | f                      |              |                        19 | 
 myGroup1   | Mark12               |         3035 | f               | f                      |              |                        11 | 
 myGroup1   | Mark13               |         3036 | f               | f                      |              |                         0 | 
 myGroup1   | Conso_M1             |         3050 | f               | f                      |              |                         0 | 
 myGroup1   | RLBK_Conso_M1_%_DONE |         3052 | f               | f                      |              |                         0 | Conso_M1
 myGroup1   | Renamed_conso_M2     |         3053 | f               | f                      |              |                         0 | 
 myGroup1   | Renamed_last_mark    |         3056 | f               | f                      |              |                           | Renamed_conso_M2
(7 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence where sequ_schema = 'emaj_myschema1' order by sequ_time_id, sequ_schema, sequ_name;
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_is_called 
-------------+-----------+--------------+---------------+----------------
(0 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema   |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
----------------+-------------+-------------+----------------------
 phil's schema3 | myTbl2\     |        2018 |                    0
 phil's schema3 | phil's tbl1 |        2018 |                    0
 myschema2      | myTbl3      |        3028 |                    0
 myschema2      | mytbl1      |        3028 |                    0
 myschema2      | mytbl2      |        3028 |                    0
 myschema2      | mytbl4      |        3028 |                    0
 myschema2      | mytbl5      |        3028 |                    0
 myschema2      | mytbl6      |        3028 |                    0
 myschema1      | myTbl3      |        3034 |                   10
 myschema1      | mytbl1      |        3034 |                   15
 myschema1      | mytbl2      |        3034 |                    6
 myschema1      | mytbl2b     |        3034 |                    6
 myschema1      | mytbl4      |        3034 |                    2
 myschema1      | myTbl3      |        3035 |                   10
 myschema1      | mytbl1      |        3035 |                   30
 myschema1      | mytbl2      |        3035 |                    8
 myschema1      | mytbl2b     |        3035 |                    8
 myschema1      | mytbl4      |        3035 |                    2
 myschema1      | myTbl3      |        3036 |                   20
 myschema1      | mytbl1      |        3036 |                   30
 myschema1      | mytbl2      |        3036 |                    8
 myschema1      | mytbl2b     |        3036 |                    8
 myschema1      | mytbl4      |        3036 |                    3
 myschema4      | mypartp1    |        3045 |                    0
 myschema4      | mypartp2    |        3045 |                    0
 myschema4      | mytblc1     |        3045 |                    0
 myschema4      | mytblc2     |        3045 |                    0
 myschema4      | mytblm      |        3045 |                    0
 myschema1      | myTbl3      |        3050 |                   30
 myschema1      | mytbl1      |        3050 |                   40
 myschema1      | mytbl2      |        3050 |                   10
 myschema1      | mytbl2b     |        3050 |                   10
 myschema1      | mytbl4      |        3050 |                    4
 myschema1      | myTbl3      |        3052 |                   30
 myschema1      | mytbl1      |        3052 |                   40
 myschema1      | mytbl2      |        3052 |                   10
 myschema1      | mytbl2b     |        3052 |                   10
 myschema1      | mytbl4      |        3052 |                    4
 myschema1      | myTbl3      |        3053 |                   30
 myschema1      | mytbl1      |        3053 |                   40
 myschema1      | mytbl2      |        3053 |                   10
 myschema1      | mytbl2b     |        3053 |                   10
 myschema1      | mytbl4      |        3053 |                    4
 myschema1      | myTbl3      |        3056 |                   30
 myschema1      | mytbl1      |        3056 |                   64
 myschema1      | mytbl2      |        3056 |                   13
 myschema1      | mytbl2b     |        3056 |                   15
 myschema1      | mytbl4      |        3056 |                    4
(48 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole where sqhl_schema = 'myschema1' order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | myTbl3     |               3036 |             3041 |             10
 myschema1   | mytbl1     |               3036 |             3041 |             10
 myschema1   | mytbl1     |               3053 |             3056 |             24
 myschema1   | mytbl2     |               3036 |             3041 |              2
 myschema1   | mytbl2     |               3053 |             3056 |              3
 myschema1   | mytbl2b    |               3036 |             3041 |              2
 myschema1   | mytbl2b    |               3053 |             3056 |              5
 myschema1   | mytbl4     |               3036 |             3041 |              1
(8 rows)

select * from emaj.emaj_rollback_group('myGroup1','Conso_M1');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 2 / 5 tables effectively processed.
 Notice        | 2 sequences processed.
(2 rows)

select emaj.emaj_ignore_app_trigger('REMOVE', 'myschema1', 'mytbl2', '%');
 emaj_ignore_app_trigger 
-------------------------
                       2
(1 row)

-- consolidate a stopped (and empty) group
begin;
  select emaj.emaj_rename_mark_group('emptyGroup','EMAJ_LAST_MARK','end_rlbk_mark');
 emaj_rename_mark_group 
------------------------
 
(1 row)

  select emaj.emaj_stop_group('emptyGroup','stop');
 emaj_stop_group 
-----------------
               0
(1 row)

  select * from emaj.emaj_get_consolidable_rollbacks();
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_time_id | cons_end_rlbk_mark_name | cons_end_rlbk_mark_time_id | cons_rows | cons_marks 
------------+----------------------------+-------------------------------+-------------------------+----------------------------+-----------+------------
 emptyGroup | EGM3                       |                          2016 | end_rlbk_mark           |                       3044 |         0 |          2
(1 row)

  select emaj.emaj_consolidate_rollback_group('emptyGroup','end_rlbk_mark');
 emaj_consolidate_rollback_group 
---------------------------------
                               0
(1 row)

  select * from emaj.emaj_mark where mark_group = 'emptyGroup' order by mark_time_id, mark_group;
 mark_group |   mark_name   | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+---------------+--------------+-----------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup | SM2           |         2006 | t               | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup | EGM3          |         2016 | t               | f                      |                                        |                         0 | 
 emptyGroup | end_rlbk_mark |         3044 | t               | f                      |                                        |                         0 | EGM3
 emptyGroup | stop          |         3058 | t               | f                      |                                        |                         0 | 
(4 rows)

rollback;
-- check that dropping the group deletes rows from emaj_sequence and emaj_seq_hole
begin;
  select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               7
(1 row)

  select emaj.emaj_drop_group('myGroup1');
 emaj_drop_group 
-----------------
               7
(1 row)

  select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence where sequ_name like 'myschema1%' order by sequ_time_id, sequ_schema, sequ_name;
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_is_called 
-------------+-----------+--------------+---------------+----------------
(0 rows)

  select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_schema, tbl_name, tbl_time_id;
   tbl_schema   |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
----------------+-------------+-------------+----------------------
 myschema2      | myTbl3      |        3028 |                    0
 myschema2      | mytbl1      |        3028 |                    0
 myschema2      | mytbl2      |        3028 |                    0
 myschema2      | mytbl4      |        3028 |                    0
 myschema2      | mytbl5      |        3028 |                    0
 myschema2      | mytbl6      |        3028 |                    0
 myschema4      | mypartp1    |        3045 |                    0
 myschema4      | mypartp2    |        3045 |                    0
 myschema4      | mytblc1     |        3045 |                    0
 myschema4      | mytblc2     |        3045 |                    0
 myschema4      | mytblm      |        3045 |                    0
 phil's schema3 | myTbl2\     |        2018 |                    0
 phil's schema3 | phil's tbl1 |        2018 |                    0
(13 rows)

  select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole where sqhl_schema = 'myschema1' order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
(0 rows)

rollback;
-----------------------------
-- test emaj_cleanup_rollback_state()
-----------------------------
-- rollback a transaction with an E-Maj rollback to generate an ABORTED rollback event
begin;
  select * from emaj.emaj_rollback_group('myGroup4','myGroup4_start');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 0 / 5 tables effectively processed.
(1 row)

rollback;
select rlbk_id, rlbk_status, rlbk_begin_hist_id, rlbk_nb_session from emaj.emaj_rlbk
  where rlbk_status in ('PLANNING', 'LOCKING', 'EXECUTING', 'COMPLETED') order by rlbk_id;
 rlbk_id | rlbk_status | rlbk_begin_hist_id | rlbk_nb_session 
---------+-------------+--------------------+-----------------
      20 | COMPLETED   |               3424 |               1
      21 | COMPLETED   |               3452 |               1
      22 | COMPLETED   |               3492 |               1
(3 rows)

select emaj.emaj_cleanup_rollback_state();
 emaj_cleanup_rollback_state 
-----------------------------
                           3
(1 row)

-----------------------------
-- check rollback tables
-----------------------------
select rlbk_id, rlbk_groups, rlbk_mark, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, rlbk_nb_session, rlbk_nb_table,
       rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status, rlbk_begin_hist_id, rlbk_dblink_schema, rlbk_is_dblink_used,
       case when rlbk_end_datetime is null then 'null' else '[ts]' end as "end_datetime", rlbk_messages
  from emaj.emaj_rlbk order by rlbk_id;
 rlbk_id |     rlbk_groups     |   rlbk_mark    | rlbk_time_id | rlbk_is_logged | rlbk_is_alter_group_allowed | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_status | rlbk_begin_hist_id | rlbk_dblink_schema | rlbk_is_dblink_used | end_datetime |                                   rlbk_messages                                   
---------+---------------------+----------------+--------------+----------------+-----------------------------+-----------------+---------------+------------------+-------------------+-------------+--------------------+--------------------+---------------------+--------------+-----------------------------------------------------------------------------------
       1 | {myGroup1}          | Different_Mark |         3006 | f              | f                           |               1 |             5 |                2 |                 0 | COMMITTED   |               3037 |                    | f                   | [ts]         | {"Notice: 0 / 5 tables effectively processed.","Notice: 2 sequences processed."}
       4 | {myGroup1}          | Different_Mark |         3017 | f              | f                           |               1 |             5 |                2 |                 0 | COMMITTED   |               3100 |                    | f                   | [ts]         | {"Notice: 0 / 5 tables effectively processed.","Notice: 2 sequences processed."}
       5 | {myGroup2}          | Mark21         |         3018 | f              | f                           |               1 |             6 |                2 |                 0 | COMMITTED   |               3109 |                    | f                   | [ts]         | {"Notice: 0 / 6 tables effectively processed.","Notice: 2 sequences processed."}
       6 | {myGroup1,myGroup2} | Mark1B         |         3020 | f              | f                           |               1 |            11 |                4 |                 0 | COMMITTED   |               3123 |                    | f                   | [ts]         | {"Notice: 0 / 11 tables effectively processed.","Notice: 4 sequences processed."}
       7 | {myGroup1,myGroup2} | Mark1B         |         3021 | f              | f                           |               1 |            11 |                4 |                 0 | COMMITTED   |               3135 |                    | f                   | [ts]         | {"Notice: 0 / 11 tables effectively processed.","Notice: 4 sequences processed."}
       8 | {myGroup1,myGroup2} | Mark1B         |         3022 | t              | f                           |               1 |            11 |                4 |                 0 | COMMITTED   |               3146 |                    | f                   | [ts]         | {"Notice: 0 / 11 tables effectively processed.","Notice: 4 sequences processed."}
       9 | {myGroup1,myGroup2} | Mark1B         |         3024 | t              | f                           |               1 |            11 |                4 |                 0 | COMMITTED   |               3162 | public             | t                   | [ts]         | {"Notice: 0 / 11 tables effectively processed.","Notice: 4 sequences processed."}
      10 | {myGroup1}          | Mark12         |         3031 | f              | f                           |               1 |             5 |                2 |                 2 | COMMITTED   |               3205 | public             | t                   | [ts]         | {"Notice: 2 / 5 tables effectively processed.","Notice: 2 sequences processed."}
      11 | {myGroup1}          | Mark11         |         3032 | f              | f                           |               1 |             5 |                2 |                 3 | COMMITTED   |               3220 | public             | t                   | [ts]         | {"Notice: 3 / 5 tables effectively processed.","Notice: 2 sequences processed."}
      12 | {myGroup1}          | Mark12         |         3037 | t              | f                           |               1 |             5 |                2 |                 2 | COMMITTED   |               3259 | public             | t                   | [ts]         | {"Notice: 2 / 5 tables effectively processed.","Notice: 2 sequences processed."}
      13 | {myGroup1}          | Mark11         |         3039 | t              | f                           |               1 |             5 |                2 |                 5 | COMMITTED   |               3277 | public             | t                   | [ts]         | {"Notice: 5 / 5 tables effectively processed.","Notice: 2 sequences processed."}
      14 | {myGroup1}          | Mark13         |         3041 | f              | f                           |               1 |             5 |                2 |                 5 | COMMITTED   |               3302 | public             | t                   | [ts]         | {"Notice: 5 / 5 tables effectively processed.","Notice: 2 sequences processed."}
      15 | {emptyGroup}        | EGM4           |         3042 | f              | f                           |               1 |             0 |                0 |                 0 | COMMITTED   |               3326 | public             | t                   | [ts]         | {"Notice: 0 / 0 tables effectively processed."}
      16 | {emptyGroup}        | EGM3           |         3043 | t              | f                           |               1 |             0 |                0 |                 0 | COMMITTED   |               3333 | public             | t                   | [ts]         | {"Notice: 0 / 0 tables effectively processed."}
      17 | {myGroup4}          | mark1          |         3047 | t              | f                           |               1 |             5 |                0 |                 3 | COMMITTED   |               3358 | public             | t                   | [ts]         | {"Notice: 3 / 5 tables effectively processed."}
      18 | {myGroup4}          | myGroup4_start |         3049 | f              | t                           |               1 |             5 |                0 |                 3 | COMMITTED   |               3375 | public             | t                   | [ts]         | {"Notice: 3 / 5 tables effectively processed."}
      19 | {myGroup1}          | Conso_M1       |         3051 | t              | f                           |               1 |             5 |                2 |                 0 | COMMITTED   |               3399 | public             | t                   | [ts]         | {"Notice: 0 / 5 tables effectively processed.","Notice: 2 sequences processed."}
      20 | {myGroup1}          | Conso_M2       |         3055 | t              | f                           |               1 |             5 |                2 |                 3 | COMMITTED   |               3424 | public             | t                   | [ts]         | {"Notice: 3 / 5 tables effectively processed.","Notice: 2 sequences processed."}
      21 | {myGroup1}          | Conso_M1       |         3057 | f              | f                           |               1 |             5 |                2 |                 2 | COMMITTED   |               3452 | public             | t                   | [ts]         | {"Notice: 2 / 5 tables effectively processed.","Notice: 2 sequences processed."}
      22 | {myGroup4}          | myGroup4_start |         3061 | f              | f                           |               1 |             5 |                0 |                 0 | ABORTED     |               3492 | public             | t                   | [ts]         | {"Notice: 0 / 5 tables effectively processed."}
(20 rows)

select rlbs_rlbk_id, rlbs_session, 
       case when rlbs_end_datetime is null then 'null' else '[ts]' end as "end_datetime"
  from emaj.emaj_rlbk_session order by rlbs_rlbk_id, rlbs_session;
 rlbs_rlbk_id | rlbs_session | end_datetime 
--------------+--------------+--------------
            1 |            1 | [ts]
            4 |            1 | [ts]
            5 |            1 | [ts]
            6 |            1 | [ts]
            7 |            1 | [ts]
            8 |            1 | [ts]
            9 |            1 | [ts]
           10 |            1 | [ts]
           11 |            1 | [ts]
           12 |            1 | [ts]
           13 |            1 | [ts]
           14 |            1 | [ts]
           15 |            1 | [ts]
           16 |            1 | [ts]
           17 |            1 | [ts]
           18 |            1 | [ts]
           19 |            1 | [ts]
           20 |            1 | [ts]
           21 |            1 | [ts]
           22 |            1 | [ts]
(20 rows)

select rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object, rlbp_target_time_id, rlbp_batch_number, rlbp_session,
       rlbp_object_def, rlbp_estimated_quantity, rlbp_estimate_method, rlbp_quantity
  from emaj.emaj_rlbk_plan order by rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object;
 rlbp_rlbk_id |  rlbp_step  | rlbp_schema | rlbp_table |      rlbp_object      | rlbp_target_time_id | rlbp_batch_number | rlbp_session |                                                             rlbp_object_def                                                             | rlbp_estimated_quantity | rlbp_estimate_method | rlbp_quantity 
--------------+-------------+-------------+------------+-----------------------+---------------------+-------------------+--------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------------------+----------------------+---------------
           10 | DIS_LOG_TRG | myschema1   | myTbl3     |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    3 |              
           10 | DIS_LOG_TRG | myschema1   | mytbl4     |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    3 |              
           10 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 2 |            1 |                                                                                                                                         |                         |                    3 |              
           10 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 2 |            1 |                                                                                                                                         |                         |                    3 |              
           10 | RLBK_TABLE  | myschema1   | myTbl3     |                       |                3029 |                 1 |            1 |                                                                                                                                         |                      10 |                    3 |            10
           10 | RLBK_TABLE  | myschema1   | mytbl4     |                       |                3029 |                 2 |            1 |                                                                                                                                         |                       2 |                    3 |             1
           10 | DELETE_LOG  | myschema1   | myTbl3     |                       |                3029 |                 1 |            1 |                                                                                                                                         |                      10 |                    3 |            10
           10 | DELETE_LOG  | myschema1   | mytbl4     |                       |                3029 |                 2 |            1 |                                                                                                                                         |                       2 |                    3 |             3
           10 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 2 |            1 |                                                                                                                                         |                       2 |                    3 |              
           10 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 2 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           10 | ENA_LOG_TRG | myschema1   | myTbl3     |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    3 |              
           10 | ENA_LOG_TRG | myschema1   | mytbl4     |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    3 |              
           10 | CTRL+DBLINK |             |            |                       |                     |                   |              |                                                                                                                                         |                      12 |                    3 |              
           11 | DIS_APP_TRG | myschema1   | mytbl2     | mytbl2trg1            |                     |                 1 |            1 |                                                                                                                                         |                         |                    3 |              
           11 | DIS_LOG_TRG | myschema1   | mytbl1     |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           11 | DIS_LOG_TRG | myschema1   | mytbl2     |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           11 | DIS_LOG_TRG | myschema1   | mytbl2b    |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           11 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           11 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           11 | RLBK_TABLE  | myschema1   | mytbl1     |                       |                3027 |                 1 |            1 |                                                                                                                                         |                      15 |                    3 |            11
           11 | RLBK_TABLE  | myschema1   | mytbl2     |                       |                3027 |                 1 |            1 |                                                                                                                                         |                       6 |                    3 |             3
           11 | RLBK_TABLE  | myschema1   | mytbl2b    |                       |                3027 |                 2 |            1 |                                                                                                                                         |                       6 |                    3 |             6
           11 | DELETE_LOG  | myschema1   | mytbl1     |                       |                3027 |                 1 |            1 |                                                                                                                                         |                      15 |                    3 |            18
           11 | DELETE_LOG  | myschema1   | mytbl2     |                       |                3027 |                 1 |            1 |                                                                                                                                         |                       6 |                    3 |             8
           11 | DELETE_LOG  | myschema1   | mytbl2b    |                       |                3027 |                 2 |            1 |                                                                                                                                         |                       6 |                    3 |             6
           11 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 1 |            1 |                                                                                                                                         |                       6 |                    2 |              
           11 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 1 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           11 | ENA_APP_TRG | myschema1   | mytbl2     | mytbl2trg1            |                     |                 1 |            1 |                                                                                                                                         |                         |                    3 |              
           11 | ENA_LOG_TRG | myschema1   | mytbl1     |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           11 | ENA_LOG_TRG | myschema1   | mytbl2     |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           11 | ENA_LOG_TRG | myschema1   | mytbl2b    |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           11 | CTRL+DBLINK |             |            |                       |                     |                   |              |                                                                                                                                         |                      18 |                    2 |              
           12 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           12 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           12 | RLBK_TABLE  | myschema1   | myTbl3     |                       |                3035 |                 1 |            1 |                                                                                                                                         |                      10 |                    1 |            10
           12 | RLBK_TABLE  | myschema1   | mytbl4     |                       |                3035 |                 2 |            1 |                                                                                                                                         |                       1 |                    1 |             1
           12 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 2 |            1 |                                                                                                                                         |                       1 |                    2 |              
           12 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 2 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           12 | CTRL+DBLINK |             |            |                       |                     |                   |              |                                                                                                                                         |                       6 |                    2 |              
           13 | DIS_APP_TRG | myschema1   | mytbl2     | mytbl2trg1            |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           13 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           13 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           13 | RLBK_TABLE  | myschema1   | myTbl3     |                       |                3034 |                 1 |            1 |                                                                                                                                         |                      20 |                    1 |            10
           13 | RLBK_TABLE  | myschema1   | mytbl1     |                       |                3034 |                 2 |            1 |                                                                                                                                         |                      15 |                    1 |            11
           13 | RLBK_TABLE  | myschema1   | mytbl2     |                       |                3034 |                 2 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           13 | RLBK_TABLE  | myschema1   | mytbl2b    |                       |                3034 |                 3 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           13 | RLBK_TABLE  | myschema1   | mytbl4     |                       |                3034 |                 2 |            1 |                                                                                                                                         |                       2 |                    1 |             1
           13 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 2 |            1 |                                                                                                                                         |                       4 |                    2 |              
           13 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 2 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           13 | ENA_APP_TRG | myschema1   | mytbl2     | mytbl2trg1            |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           13 | CTRL+DBLINK |             |            |                       |                     |                   |              |                                                                                                                                         |                      11 |                    2 |              
           14 | DIS_LOG_TRG | myschema1   | myTbl3     |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | DIS_LOG_TRG | myschema1   | mytbl1     |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | DIS_LOG_TRG | myschema1   | mytbl2     |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | DIS_LOG_TRG | myschema1   | mytbl2b    |                       |                     |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | DIS_LOG_TRG | myschema1   | mytbl4     |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | RLBK_TABLE  | myschema1   | myTbl3     |                       |                3036 |                 1 |            1 |                                                                                                                                         |                      10 |                    1 |            10
           14 | RLBK_TABLE  | myschema1   | mytbl1     |                       |                3036 |                 2 |            1 |                                                                                                                                         |                      10 |                    1 |            10
           14 | RLBK_TABLE  | myschema1   | mytbl2     |                       |                3036 |                 2 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           14 | RLBK_TABLE  | myschema1   | mytbl2b    |                       |                3036 |                 3 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           14 | RLBK_TABLE  | myschema1   | mytbl4     |                       |                3036 |                 2 |            1 |                                                                                                                                         |                       1 |                    1 |             1
           14 | DELETE_LOG  | myschema1   | myTbl3     |                       |                3036 |                 1 |            1 |                                                                                                                                         |                      10 |                    1 |            10
           14 | DELETE_LOG  | myschema1   | mytbl1     |                       |                3036 |                 2 |            1 |                                                                                                                                         |                      10 |                    1 |            10
           14 | DELETE_LOG  | myschema1   | mytbl2     |                       |                3036 |                 2 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           14 | DELETE_LOG  | myschema1   | mytbl2b    |                       |                3036 |                 3 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           14 | DELETE_LOG  | myschema1   | mytbl4     |                       |                3036 |                 2 |            1 |                                                                                                                                         |                       1 |                    1 |             1
           14 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 2 |            1 |                                                                                                                                         |                       3 |                    2 |              
           14 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 2 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           14 | ENA_LOG_TRG | myschema1   | myTbl3     |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | ENA_LOG_TRG | myschema1   | mytbl1     |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | ENA_LOG_TRG | myschema1   | mytbl2     |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | ENA_LOG_TRG | myschema1   | mytbl2b    |                       |                     |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | ENA_LOG_TRG | myschema1   | mytbl4     |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           14 | CTRL+DBLINK |             |            |                       |                     |                   |              |                                                                                                                                         |                      24 |                    2 |              
           17 | DIS_APP_TRG | myschema4   | mytblm     | mytblm_insert_trigger |                     |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           17 | RLBK_TABLE  | myschema4   | mytblc1    |                       |                3046 |                 1 |            1 |                                                                                                                                         |                       1 |                    3 |             2
           17 | RLBK_TABLE  | myschema4   | mytblc2    |                       |                3046 |                 2 |            1 |                                                                                                                                         |                       1 |                    3 |             2
           17 | RLBK_TABLE  | myschema4   | mytblm     |                       |                3046 |                 3 |            1 |                                                                                                                                         |                       1 |                    3 |             2
           17 | ENA_APP_TRG | myschema4   | mytblm     | mytblm_insert_trigger |                     |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           17 | CTRL+DBLINK |             |            |                       |                     |                   |              |                                                                                                                                         |                       5 |                    2 |              
           18 | DIS_APP_TRG | myschema4   | mytblm     | mytblm_insert_trigger |                     |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           18 | DIS_LOG_TRG | myschema4   | mytblc1    |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           18 | DIS_LOG_TRG | myschema4   | mytblc2    |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           18 | DIS_LOG_TRG | myschema4   | mytblm     |                       |                     |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           18 | RLBK_TABLE  | myschema4   | mytblc1    |                       |                3045 |                 1 |            1 |                                                                                                                                         |                       3 |                    1 |             2
           18 | RLBK_TABLE  | myschema4   | mytblc2    |                       |                3045 |                 2 |            1 |                                                                                                                                         |                       3 |                    1 |             2
           18 | RLBK_TABLE  | myschema4   | mytblm     |                       |                3045 |                 3 |            1 |                                                                                                                                         |                       3 |                    1 |             2
           18 | DELETE_LOG  | myschema4   | mytblc1    |                       |                3045 |                 1 |            1 |                                                                                                                                         |                       3 |                    3 |             4
           18 | DELETE_LOG  | myschema4   | mytblc2    |                       |                3045 |                 2 |            1 |                                                                                                                                         |                       3 |                    3 |             4
           18 | DELETE_LOG  | myschema4   | mytblm     |                       |                3045 |                 3 |            1 |                                                                                                                                         |                       3 |                    3 |             4
           18 | ENA_APP_TRG | myschema4   | mytblm     | mytblm_insert_trigger |                     |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           18 | ENA_LOG_TRG | myschema4   | mytblc1    |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           18 | ENA_LOG_TRG | myschema4   | mytblc2    |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           18 | ENA_LOG_TRG | myschema4   | mytblm     |                       |                     |                 3 |            1 |                                                                                                                                         |                         |                    2 |              
           18 | CTRL+DBLINK |             |            |                       |                     |                   |              |                                                                                                                                         |                      14 |                    2 |              
           20 | DROP_FK     | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           20 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           20 | RLBK_TABLE  | myschema1   | mytbl1     |                       |                3053 |                 1 |            1 |                                                                                                                                         |                      13 |                    1 |            12
           20 | RLBK_TABLE  | myschema1   | mytbl2     |                       |                3053 |                 1 |            1 |                                                                                                                                         |                       2 |                    1 |             1
           20 | RLBK_TABLE  | myschema1   | mytbl2b    |                       |                3053 |                 2 |            1 |                                                                                                                                         |                       2 |                    1 |             2
           20 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 1 |            1 |                                                                                                                                         |                       2 |                    2 |              
           20 | ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey     |                     |                 1 |            1 | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED |                       0 |                    3 |              
           20 | CTRL+DBLINK |             |            |                       |                     |                   |              |                                                                                                                                         |                       7 |                    2 |              
           21 | DIS_LOG_TRG | myschema1   | mytbl2     |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           21 | DIS_LOG_TRG | myschema1   | mytbl2b    |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           21 | SET_FK_DEF  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           21 | RLBK_TABLE  | myschema1   | mytbl2     |                       |                3050 |                 1 |            1 |                                                                                                                                         |                       1 |                    1 |             1
           21 | RLBK_TABLE  | myschema1   | mytbl2b    |                       |                3050 |                 2 |            1 |                                                                                                                                         |                       1 |                    1 |             1
           21 | DELETE_LOG  | myschema1   | mytbl2     |                       |                3050 |                 1 |            1 |                                                                                                                                         |                       1 |                    1 |             1
           21 | DELETE_LOG  | myschema1   | mytbl2b    |                       |                3050 |                 2 |            1 |                                                                                                                                         |                       1 |                    1 |             2
           21 | SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey     |                     |                 1 |            1 |                                                                                                                                         |                       1 |                    2 |              
           21 | ENA_LOG_TRG | myschema1   | mytbl2     |                       |                     |                 1 |            1 |                                                                                                                                         |                         |                    2 |              
           21 | ENA_LOG_TRG | myschema1   | mytbl2b    |                       |                     |                 2 |            1 |                                                                                                                                         |                         |                    2 |              
           21 | CTRL+DBLINK |             |            |                       |                     |                   |              |                                                                                                                                         |                      10 |                    2 |              
(116 rows)

select rlbt_step, rlbt_schema, rlbt_table, rlbt_object, rlbt_rlbk_id, rlbt_quantity from emaj.emaj_rlbk_stat
  order by rlbt_rlbk_id, rlbt_step, rlbt_schema, rlbt_table, rlbt_object;
  rlbt_step  | rlbt_schema | rlbt_table |    rlbt_object    | rlbt_rlbk_id | rlbt_quantity 
-------------+-------------+------------+-------------------+--------------+---------------
 DIS_LOG_TRG |             |            |                   |           10 |             2
 DROP_FK     |             |            |                   |           10 |             1
 SET_FK_DEF  |             |            |                   |           10 |             1
 RLBK_TABLE  | myschema1   | myTbl3     |                   |           10 |            10
 RLBK_TABLE  | myschema1   | mytbl4     |                   |           10 |             2
 DELETE_LOG  | myschema1   | myTbl3     |                   |           10 |            10
 DELETE_LOG  | myschema1   | mytbl4     |                   |           10 |             2
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           10 |             2
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           10 |             0
 ENA_LOG_TRG |             |            |                   |           10 |             2
 CTRL+DBLINK |             |            |                   |           10 |            12
 DIS_APP_TRG |             |            |                   |           11 |             1
 DIS_LOG_TRG |             |            |                   |           11 |             3
 DROP_FK     |             |            |                   |           11 |             1
 SET_FK_DEF  |             |            |                   |           11 |             1
 RLBK_TABLE  | myschema1   | mytbl1     |                   |           11 |            15
 RLBK_TABLE  | myschema1   | mytbl2     |                   |           11 |             6
 RLBK_TABLE  | myschema1   | mytbl2b    |                   |           11 |             6
 DELETE_LOG  | myschema1   | mytbl1     |                   |           11 |            15
 DELETE_LOG  | myschema1   | mytbl2     |                   |           11 |             6
 DELETE_LOG  | myschema1   | mytbl2b    |                   |           11 |             6
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           11 |             6
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           11 |             0
 ENA_APP_TRG |             |            |                   |           11 |             1
 ENA_LOG_TRG |             |            |                   |           11 |             3
 CTRL+DBLINK |             |            |                   |           11 |            18
 DROP_FK     |             |            |                   |           12 |             1
 SET_FK_DEF  |             |            |                   |           12 |             1
 RLBK_TABLE  | myschema1   | myTbl3     |                   |           12 |            10
 RLBK_TABLE  | myschema1   | mytbl4     |                   |           12 |             1
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           12 |             1
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           12 |             0
 CTRL+DBLINK |             |            |                   |           12 |             6
 DIS_APP_TRG |             |            |                   |           13 |             1
 DROP_FK     |             |            |                   |           13 |             1
 SET_FK_DEF  |             |            |                   |           13 |             1
 RLBK_TABLE  | myschema1   | myTbl3     |                   |           13 |            20
 RLBK_TABLE  | myschema1   | mytbl1     |                   |           13 |            15
 RLBK_TABLE  | myschema1   | mytbl2     |                   |           13 |             2
 RLBK_TABLE  | myschema1   | mytbl2b    |                   |           13 |             2
 RLBK_TABLE  | myschema1   | mytbl4     |                   |           13 |             2
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           13 |             4
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           13 |             0
 ENA_APP_TRG |             |            |                   |           13 |             1
 CTRL+DBLINK |             |            |                   |           13 |            11
 DIS_LOG_TRG |             |            |                   |           14 |             5
 DROP_FK     |             |            |                   |           14 |             1
 SET_FK_DEF  |             |            |                   |           14 |             1
 RLBK_TABLE  | myschema1   | myTbl3     |                   |           14 |            10
 RLBK_TABLE  | myschema1   | mytbl1     |                   |           14 |            10
 RLBK_TABLE  | myschema1   | mytbl2     |                   |           14 |             2
 RLBK_TABLE  | myschema1   | mytbl2b    |                   |           14 |             2
 RLBK_TABLE  | myschema1   | mytbl4     |                   |           14 |             1
 DELETE_LOG  | myschema1   | myTbl3     |                   |           14 |            10
 DELETE_LOG  | myschema1   | mytbl1     |                   |           14 |            10
 DELETE_LOG  | myschema1   | mytbl2     |                   |           14 |             2
 DELETE_LOG  | myschema1   | mytbl2b    |                   |           14 |             2
 DELETE_LOG  | myschema1   | mytbl4     |                   |           14 |             1
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           14 |             3
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           14 |             0
 ENA_LOG_TRG |             |            |                   |           14 |             5
 CTRL+DBLINK |             |            |                   |           14 |            24
 DIS_APP_TRG |             |            |                   |           17 |             1
 RLBK_TABLE  | myschema4   | mytblc1    |                   |           17 |             1
 RLBK_TABLE  | myschema4   | mytblc2    |                   |           17 |             1
 RLBK_TABLE  | myschema4   | mytblm     |                   |           17 |             1
 ENA_APP_TRG |             |            |                   |           17 |             1
 CTRL+DBLINK |             |            |                   |           17 |             5
 DIS_APP_TRG |             |            |                   |           18 |             1
 DIS_LOG_TRG |             |            |                   |           18 |             3
 RLBK_TABLE  | myschema4   | mytblc1    |                   |           18 |             3
 RLBK_TABLE  | myschema4   | mytblc2    |                   |           18 |             3
 RLBK_TABLE  | myschema4   | mytblm     |                   |           18 |             3
 DELETE_LOG  | myschema4   | mytblc1    |                   |           18 |             3
 DELETE_LOG  | myschema4   | mytblc2    |                   |           18 |             3
 DELETE_LOG  | myschema4   | mytblm     |                   |           18 |             3
 ENA_APP_TRG |             |            |                   |           18 |             1
 ENA_LOG_TRG |             |            |                   |           18 |             3
 CTRL+DBLINK |             |            |                   |           18 |            14
 DROP_FK     |             |            |                   |           20 |             1
 SET_FK_DEF  |             |            |                   |           20 |             1
 RLBK_TABLE  | myschema1   | mytbl1     |                   |           20 |            13
 RLBK_TABLE  | myschema1   | mytbl2     |                   |           20 |             2
 RLBK_TABLE  | myschema1   | mytbl2b    |                   |           20 |             2
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           20 |             2
 ADD_FK      | myschema1   | mytbl4     | mytbl4_col44_fkey |           20 |             0
 CTRL+DBLINK |             |            |                   |           20 |             7
 DIS_LOG_TRG |             |            |                   |           21 |             2
 SET_FK_DEF  |             |            |                   |           21 |             1
 RLBK_TABLE  | myschema1   | mytbl2     |                   |           21 |             1
 RLBK_TABLE  | myschema1   | mytbl2b    |                   |           21 |             1
 DELETE_LOG  | myschema1   | mytbl2     |                   |           21 |             1
 DELETE_LOG  | myschema1   | mytbl2b    |                   |           21 |             1
 SET_FK_IMM  | myschema1   | mytbl4     | mytbl4_col43_fkey |           21 |             1
 ENA_LOG_TRG |             |            |                   |           21 |             2
 CTRL+DBLINK |             |            |                   |           21 |            10
(96 rows)

-----------------------------
-- test end: reset history and force sequences id
-----------------------------
select emaj.emaj_enable_protection_by_event_triggers();
 emaj_enable_protection_by_event_triggers 
------------------------------------------
                                        3
(1 row)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 3000 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
    3002 |              29999 | M
    3003 |              29999 | M
    3004 |              29999 | M
    3005 |              29999 | M
    3006 |              29999 | R
    3007 |              29999 | C
    3008 |              29999 | D
    3017 |              29999 | R
    3018 |              29999 | R
    3019 |              29999 | M
    3020 |              29999 | R
    3021 |              29999 | R
    3022 |              29999 | R
    3023 |              29999 | M
    3024 |              29999 | R
    3025 |              29999 | M
    3026 |              29999 | M
    3027 |              29999 | M
    3028 |              29999 | M
    3029 |              30026 | M
    3030 |              30038 | M
    3031 |              30038 | R
    3032 |              30038 | R
    3033 |              30038 | M
    3034 |              30038 | M
    3035 |              30057 | M
    3036 |              30068 | M
    3037 |              30068 | R
    3038 |              30079 | M
    3039 |              30079 | R
    3040 |              30093 | M
    3041 |              30093 | R
    3042 |              30093 | R
    3043 |              30093 | R
    3044 |              30093 | M
    3045 |              30093 | M
    3046 |              30096 | M
    3047 |              30102 | R
    3048 |              30105 | M
    3049 |              30105 | R
    3050 |              30105 | M
    3051 |              30105 | R
    3052 |              30105 | M
    3053 |              30105 | M
    3054 |              30120 | M
    3055 |              30122 | R
    3056 |              30137 | M
    3057 |              30139 | R
    3061 |              30140 | R
(49 rows)

select hist_id, hist_function, hist_event, hist_object, regexp_replace(regexp_replace(hist_wording,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),E'\\[.+\\]','(timestamp)','g'), hist_user from 
  (select * from emaj.emaj_hist where hist_id >= 3000 order by hist_id) as t;
 hist_id |     hist_function      |       hist_event        |         hist_object          |                         regexp_replace                         | hist_user 
---------+------------------------+-------------------------+------------------------------+----------------------------------------------------------------+-----------
    3000 | DISABLE_PROTECTION     | EVENT TRIGGERS DISABLED |                              | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg | postgres
    3013 | START_GROUP            | BEGIN                   | myGroup1                     | With log reset                                                 | postgres
    3014 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3015 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3016 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | Mark11                                                         | postgres
    3017 | SET_MARK_GROUP         | END                     | myGroup1                     | Mark11                                                         | postgres
    3018 | START_GROUP            | END                     | myGroup1                     | 7 tables/sequences processed                                   | postgres
    3019 | START_GROUP            | BEGIN                   | myGroup2                     | With log reset                                                 | postgres
    3020 | LOCK_GROUP             | BEGIN                   | myGroup2                     |                                                                | postgres
    3021 | LOCK_GROUP             | END                     | myGroup2                     | 6 tables locked, 0 deadlock(s)                                 | postgres
    3022 | SET_MARK_GROUP         | BEGIN                   | myGroup2                     | Mark21                                                         | postgres
    3023 | SET_MARK_GROUP         | END                     | myGroup2                     | Mark21                                                         | postgres
    3024 | START_GROUP            | END                     | myGroup2                     | 8 tables/sequences processed                                   | postgres
    3025 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     |                                                                | postgres
    3026 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3027 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3028 | SET_MARK_GROUP         | END                     | myGroup1                     | Different_Mark                                                 | postgres
    3029 | SET_MARK_GROUP         | BEGIN                   | myGroup2                     |                                                                | postgres
    3030 | LOCK_GROUP             | BEGIN                   | myGroup2                     |                                                                | postgres
    3031 | LOCK_GROUP             | END                     | myGroup2                     | 6 tables locked, 0 deadlock(s)                                 | postgres
    3032 | SET_MARK_GROUP         | END                     | myGroup2                     | Different_Mark                                                 | postgres
    3033 | PROTECT_GROUP          |                         | myGroup1                     | Status 1                                                       | postgres
    3034 | PROTECT_GROUP          |                         | myGroup2                     | Status 1                                                       | postgres
    3035 | UNPROTECT_GROUP        |                         | myGroup1                     | Status 1                                                       | postgres
    3036 | UNPROTECT_GROUP        |                         | myGroup2                     | Status 1                                                       | postgres
    3037 | ROLLBACK_GROUP         | BEGIN                   | myGroup1                     | Unlogged rollback to mark Different_Mark (timestamp)           | postgres
    3038 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = -5                                                    | postgres
    3039 | LOCK_GROUP             | BEGIN                   | myGroup1                     | Rollback session #1                                            | postgres
    3040 | LOCK_GROUP             | END                     | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3041 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" |                                                                | postgres
    3042 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  |                                                                | postgres
    3043 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 1                | 0 / 5 tables effectively processed.                            | postgres
    3044 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 1                | 2 sequences processed.                                         | postgres
    3045 | ROLLBACK_GROUP         | END                     | myGroup1                     | Rollback_id 1, 0 tables and 2 sequences effectively processed  | postgres
    3046 | CREATE_GROUP           | BEGIN                   | auditOnlyEmptyGroup          | audit_only                                                     | postgres
    3047 | CREATE_GROUP           | END                     | auditOnlyEmptyGroup          |                                                                | postgres
    3048 | DROP_GROUP             | BEGIN                   | auditOnlyEmptyGroup          |                                                                | postgres
    3049 | DROP_GROUP             | END                     | auditOnlyEmptyGroup          | 0 tables/sequences processed                                   | postgres
    3100 | ROLLBACK_GROUP         | BEGIN                   | myGroup1                     | Unlogged rollback to mark Different_Mark (timestamp)           | postgres
    3101 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = -1                                                    | postgres
    3102 | LOCK_GROUP             | BEGIN                   | myGroup1                     | Rollback session #1                                            | postgres
    3103 | LOCK_GROUP             | END                     | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3104 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" |                                                                | postgres
    3105 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  |                                                                | postgres
    3106 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 4                | 0 / 5 tables effectively processed.                            | postgres
    3107 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 4                | 2 sequences processed.                                         | postgres
    3108 | ROLLBACK_GROUP         | END                     | myGroup1                     | Rollback_id 4, 0 tables and 2 sequences effectively processed  | postgres
    3109 | ROLLBACK_GROUP         | BEGIN                   | myGroup2                     | Unlogged rollback to mark Mark21 (timestamp)                   | postgres
    3110 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = -1                                                    | postgres
    3111 | LOCK_GROUP             | BEGIN                   | myGroup2                     | Rollback session #1                                            | postgres
    3112 | LOCK_GROUP             | END                     | myGroup2                     | Rollback session #1: 6 tables locked, 0 deadlock(s)            | postgres
    3113 | ROLLBACK_GROUP         | MARK DELETED            | myGroup2                     | mark Different_Mark is deleted                                 | postgres
    3114 | ROLLBACK_SEQUENCE      |                         | myschema2."myTbl3_col31_seq" |                                                                | postgres
    3115 | ROLLBACK_SEQUENCE      |                         | myschema2.myseq1             |                                                                | postgres
    3116 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 5                | 0 / 6 tables effectively processed.                            | postgres
    3117 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 5                | 2 sequences processed.                                         | postgres
    3118 | ROLLBACK_GROUP         | END                     | myGroup2                     | Rollback_id 5, 0 tables and 2 sequences effectively processed  | postgres
    3119 | SET_MARK_GROUPS        | BEGIN                   | myGroup1,myGroup2            | Mark1B                                                         | postgres
    3120 | LOCK_GROUPS            | BEGIN                   | myGroup1,myGroup2            |                                                                | postgres
    3121 | LOCK_GROUPS            | END                     | myGroup1,myGroup2            | 11 tables locked, 0 deadlock(s)                                | postgres
    3122 | SET_MARK_GROUPS        | END                     | myGroup1,myGroup2            | Mark1B                                                         | postgres
    3123 | ROLLBACK_GROUPS        | BEGIN                   | myGroup1,myGroup2            | Unlogged rollback to mark Mark1B (timestamp)                   | postgres
    3124 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = -5                                                    | postgres
    3125 | LOCK_GROUP             | BEGIN                   | myGroup1,myGroup2            | Rollback session #1                                            | postgres
    3126 | LOCK_GROUP             | END                     | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)           | postgres
    3127 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" |                                                                | postgres
    3128 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  |                                                                | postgres
    3129 | ROLLBACK_SEQUENCE      |                         | myschema2."myTbl3_col31_seq" |                                                                | postgres
    3130 | ROLLBACK_SEQUENCE      |                         | myschema2.myseq1             |                                                                | postgres
    3131 | ROLLBACK_GROUPS        | NOTICE                  | Rollback id 6                | 0 / 11 tables effectively processed.                           | postgres
    3132 | ROLLBACK_GROUPS        | NOTICE                  | Rollback id 6                | 4 sequences processed.                                         | postgres
    3133 | ROLLBACK_GROUPS        | END                     | myGroup1,myGroup2            | Rollback_id 6, 0 tables and 4 sequences effectively processed  | postgres
    3134 |                        | INSERTED PARAMETER      | dblink_user_password         | <masked data>                                                  | postgres
    3135 | ROLLBACK_GROUPS        | BEGIN                   | myGroup1,myGroup2            | Unlogged rollback to mark Mark1B (timestamp)                   | postgres
    3136 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = -6                                                    | postgres
    3137 | LOCK_GROUP             | BEGIN                   | myGroup1,myGroup2            | Rollback session #1                                            | postgres
    3138 | LOCK_GROUP             | END                     | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)           | postgres
    3139 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" |                                                                | postgres
    3140 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  |                                                                | postgres
    3141 | ROLLBACK_SEQUENCE      |                         | myschema2."myTbl3_col31_seq" |                                                                | postgres
    3142 | ROLLBACK_SEQUENCE      |                         | myschema2.myseq1             |                                                                | postgres
    3143 | ROLLBACK_GROUPS        | NOTICE                  | Rollback id 7                | 0 / 11 tables effectively processed.                           | postgres
    3144 | ROLLBACK_GROUPS        | NOTICE                  | Rollback id 7                | 4 sequences processed.                                         | postgres
    3145 | ROLLBACK_GROUPS        | END                     | myGroup1,myGroup2            | Rollback_id 7, 0 tables and 4 sequences effectively processed  | postgres
    3146 | ROLLBACK_GROUPS        | BEGIN                   | myGroup1,myGroup2            | Logged rollback to mark Mark1B (timestamp)                     | postgres
    3147 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = -4                                                    | postgres
    3148 | LOCK_GROUP             | BEGIN                   | myGroup1,myGroup2            | Rollback session #1                                            | postgres
    3149 | LOCK_GROUP             | END                     | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)           | postgres
    3150 | SET_MARK_GROUPS        | BEGIN                   | myGroup1,myGroup2            | RLBK_Mark1B_%_START                                            | postgres
    3151 | SET_MARK_GROUPS        | END                     | myGroup1,myGroup2            | RLBK_Mark1B_%_START                                            | postgres
    3152 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" |                                                                | postgres
    3153 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  |                                                                | postgres
    3154 | ROLLBACK_SEQUENCE      |                         | myschema2."myTbl3_col31_seq" |                                                                | postgres
    3155 | ROLLBACK_SEQUENCE      |                         | myschema2.myseq1             |                                                                | postgres
    3156 | SET_MARK_GROUPS        | BEGIN                   | myGroup1,myGroup2            | RLBK_Mark1B_%_DONE                                             | postgres
    3157 | SET_MARK_GROUPS        | END                     | myGroup1,myGroup2            | RLBK_Mark1B_%_DONE                                             | postgres
    3158 | ROLLBACK_GROUPS        | NOTICE                  | Rollback id 8                | 0 / 11 tables effectively processed.                           | postgres
    3159 | ROLLBACK_GROUPS        | NOTICE                  | Rollback id 8                | 4 sequences processed.                                         | postgres
    3160 | ROLLBACK_GROUPS        | END                     | myGroup1,myGroup2            | Rollback_id 8, 0 tables and 4 sequences effectively processed  | postgres
    3161 |                        | UPDATED PARAMETER       | dblink_user_password         | <masked data>                                                  | postgres
    3162 | ROLLBACK_GROUPS        | BEGIN                   | myGroup1,myGroup2            | Logged rollback to mark Mark1B (timestamp)                     | postgres
    3163 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3164 | LOCK_GROUP             | BEGIN                   | myGroup1,myGroup2            | Rollback session #1                                            | postgres
    3165 | LOCK_GROUP             | END                     | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)           | postgres
    3166 | SET_MARK_GROUPS        | BEGIN                   | myGroup1,myGroup2            | RLBK_Mark1B_%_START                                            | postgres
    3167 | SET_MARK_GROUPS        | END                     | myGroup1,myGroup2            | RLBK_Mark1B_%_START                                            | postgres
    3168 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" |                                                                | postgres
    3169 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  |                                                                | postgres
    3170 | ROLLBACK_SEQUENCE      |                         | myschema2."myTbl3_col31_seq" |                                                                | postgres
    3171 | ROLLBACK_SEQUENCE      |                         | myschema2.myseq1             |                                                                | postgres
    3172 | SET_MARK_GROUPS        | BEGIN                   | myGroup1,myGroup2            | RLBK_Mark1B_%_DONE                                             | postgres
    3173 | SET_MARK_GROUPS        | END                     | myGroup1,myGroup2            | RLBK_Mark1B_%_DONE                                             | postgres
    3174 | ROLLBACK_GROUPS        | NOTICE                  | Rollback id 9                | 0 / 11 tables effectively processed.                           | postgres
    3175 | ROLLBACK_GROUPS        | NOTICE                  | Rollback id 9                | 4 sequences processed.                                         | postgres
    3176 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3177 | ROLLBACK_GROUPS        | END                     | myGroup1,myGroup2            | Rollback_id 9, 0 tables and 4 sequences effectively processed  | postgres
    3178 | STOP_GROUPS            | BEGIN                   | myGroup1,myGroup2            |                                                                | postgres
    3179 | LOCK_GROUPS            | BEGIN                   | myGroup1,myGroup2            |                                                                | postgres
    3180 | LOCK_GROUPS            | END                     | myGroup1,myGroup2            | 11 tables locked, 0 deadlock(s)                                | postgres
    3181 | SET_MARK_GROUPS        | BEGIN                   | myGroup1,myGroup2            | STOP_%                                                         | postgres
    3182 | CLEANUP_RLBK_STATE     |                         | Rollback id 9                | set to COMMITTED                                               | postgres
    3183 | SET_MARK_GROUPS        | END                     | myGroup1,myGroup2            | STOP_%                                                         | postgres
    3184 | STOP_GROUPS            | END                     | myGroup1,myGroup2            | 15 tables/sequences processed                                  | postgres
    3185 | START_GROUP            | BEGIN                   | myGroup1                     | With log reset                                                 | postgres
    3186 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3187 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3188 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | Mark11                                                         | postgres
    3189 | SET_MARK_GROUP         | END                     | myGroup1                     | Mark11                                                         | postgres
    3190 | START_GROUP            | END                     | myGroup1                     | 7 tables/sequences processed                                   | postgres
    3191 | START_GROUP            | BEGIN                   | myGroup2                     | With log reset                                                 | postgres
    3192 | LOCK_GROUP             | BEGIN                   | myGroup2                     |                                                                | postgres
    3193 | LOCK_GROUP             | END                     | myGroup2                     | 6 tables locked, 0 deadlock(s)                                 | postgres
    3194 | SET_MARK_GROUP         | BEGIN                   | myGroup2                     | Mark21                                                         | postgres
    3195 | SET_MARK_GROUP         | END                     | myGroup2                     | Mark21                                                         | postgres
    3196 | START_GROUP            | END                     | myGroup2                     | 8 tables/sequences processed                                   | postgres
    3197 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     |                                                                | postgres
    3198 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3199 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3200 | SET_MARK_GROUP         | END                     | myGroup1                     | Mark12                                                         | postgres
    3201 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     |                                                                | postgres
    3202 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3203 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3204 | SET_MARK_GROUP         | END                     | myGroup1                     | Mark13                                                         | postgres
    3205 | ROLLBACK_GROUP         | BEGIN                   | myGroup1                     | Unlogged rollback to mark Mark12 (timestamp)                   | postgres
    3206 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3207 | LOCK_GROUP             | BEGIN                   | myGroup1                     | Rollback session #1                                            | postgres
    3208 | LOCK_GROUP             | END                     | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3209 | ROLLBACK_TABLE         | BEGIN                   | myschema1."myTbl3"           | All log rows with emaj_gid > 30026 and <= 30038                | postgres
    3210 | ROLLBACK_TABLE         | END                     | myschema1."myTbl3"           | 10 rolled back primary keys                                    | postgres
    3211 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl4             | All log rows with emaj_gid > 30026 and <= 30038                | postgres
    3212 | ROLLBACK_TABLE         | END                     | myschema1.mytbl4             | 1 rolled back primary keys                                     | postgres
    3213 | ROLLBACK_GROUP         | MARK DELETED            | myGroup1                     | mark Mark13 is deleted                                         | postgres
    3214 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" | RESTART 1                                                      | postgres
    3215 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  |                                                                | postgres
    3216 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 10               | 2 / 5 tables effectively processed.                            | postgres
    3217 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 10               | 2 sequences processed.                                         | postgres
    3218 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3219 | ROLLBACK_GROUP         | END                     | myGroup1                     | Rollback_id 10, 2 tables and 2 sequences effectively processed | postgres
    3220 | ROLLBACK_GROUP         | BEGIN                   | myGroup1                     | Unlogged rollback to mark Mark11 (timestamp)                   | postgres
    3221 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3222 | LOCK_GROUP             | BEGIN                   | myGroup1                     | Rollback session #1                                            | postgres
    3223 | LOCK_GROUP             | END                     | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3224 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl1             | All log rows with emaj_gid > 29999 and <= 30038                | postgres
    3225 | ROLLBACK_TABLE         | END                     | myschema1.mytbl1             | 11 rolled back primary keys                                    | postgres
    3226 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl2             | All log rows with emaj_gid > 29999 and <= 30038                | postgres
    3227 | ROLLBACK_TABLE         | END                     | myschema1.mytbl2             | 3 rolled back primary keys                                     | postgres
    3228 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl2b            | All log rows with emaj_gid > 29999 and <= 30038                | postgres
    3229 | ROLLBACK_TABLE         | END                     | myschema1.mytbl2b            | 6 rolled back primary keys                                     | postgres
    3230 | ROLLBACK_GROUP         | MARK DELETED            | myGroup1                     | mark Mark12 is deleted                                         | postgres
    3231 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" |                                                                | postgres
    3232 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  | RESTART 1                                                      | postgres
    3233 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 11               | 3 / 5 tables effectively processed.                            | postgres
    3234 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 11               | 2 sequences processed.                                         | postgres
    3235 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3236 | ROLLBACK_GROUP         | END                     | myGroup1                     | Rollback_id 11, 3 tables and 2 sequences effectively processed | postgres
    3237 | STOP_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3238 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3239 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3240 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | STOP_%                                                         | postgres
    3241 | CLEANUP_RLBK_STATE     |                         | Rollback id 10               | set to COMMITTED                                               | postgres
    3242 | CLEANUP_RLBK_STATE     |                         | Rollback id 11               | set to COMMITTED                                               | postgres
    3243 | SET_MARK_GROUP         | END                     | myGroup1                     | STOP_%                                                         | postgres
    3244 | STOP_GROUP             | END                     | myGroup1                     | 7 tables/sequences processed                                   | postgres
    3245 | START_GROUP            | BEGIN                   | myGroup1                     | With log reset                                                 | postgres
    3246 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3247 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3248 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | Mark11                                                         | postgres
    3249 | SET_MARK_GROUP         | END                     | myGroup1                     | Mark11                                                         | postgres
    3250 | START_GROUP            | END                     | myGroup1                     | 7 tables/sequences processed                                   | postgres
    3251 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     |                                                                | postgres
    3252 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3253 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3254 | SET_MARK_GROUP         | END                     | myGroup1                     | Mark12                                                         | postgres
    3255 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     |                                                                | postgres
    3256 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3257 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3258 | SET_MARK_GROUP         | END                     | myGroup1                     | Mark13                                                         | postgres
    3259 | ROLLBACK_GROUP         | BEGIN                   | myGroup1                     | Logged rollback to mark Mark12 (timestamp)                     | postgres
    3260 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3261 | LOCK_GROUP             | BEGIN                   | myGroup1                     | Rollback session #1                                            | postgres
    3262 | LOCK_GROUP             | END                     | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3263 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | RLBK_Mark12_%_START                                            | postgres
    3264 | SET_MARK_GROUP         | END                     | myGroup1                     | RLBK_Mark12_%_START                                            | postgres
    3265 | ROLLBACK_TABLE         | BEGIN                   | myschema1."myTbl3"           | All log rows with emaj_gid > 30057 and <= 30068                | postgres
    3266 | ROLLBACK_TABLE         | END                     | myschema1."myTbl3"           | 10 rolled back primary keys                                    | postgres
    3267 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl4             | All log rows with emaj_gid > 30057 and <= 30068                | postgres
    3268 | ROLLBACK_TABLE         | END                     | myschema1.mytbl4             | 1 rolled back primary keys                                     | postgres
    3269 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" | RESTART 1                                                      | postgres
    3270 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  |                                                                | postgres
    3271 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | RLBK_Mark12_%_DONE                                             | postgres
    3272 | SET_MARK_GROUP         | END                     | myGroup1                     | RLBK_Mark12_%_DONE                                             | postgres
    3273 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 12               | 2 / 5 tables effectively processed.                            | postgres
    3274 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 12               | 2 sequences processed.                                         | postgres
    3275 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3276 | ROLLBACK_GROUP         | END                     | myGroup1                     | Rollback_id 12, 2 tables and 2 sequences effectively processed | postgres
    3277 | ROLLBACK_GROUP         | BEGIN                   | myGroup1                     | Logged rollback to mark Mark11 (timestamp)                     | postgres
    3278 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3279 | LOCK_GROUP             | BEGIN                   | myGroup1                     | Rollback session #1                                            | postgres
    3280 | LOCK_GROUP             | END                     | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3281 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | RLBK_Mark11_%_START                                            | postgres
    3282 | CLEANUP_RLBK_STATE     |                         | Rollback id 12               | set to COMMITTED                                               | postgres
    3283 | SET_MARK_GROUP         | END                     | myGroup1                     | RLBK_Mark11_%_START                                            | postgres
    3284 | ROLLBACK_TABLE         | BEGIN                   | myschema1."myTbl3"           | All log rows with emaj_gid > 30038 and <= 30079                | postgres
    3285 | ROLLBACK_TABLE         | END                     | myschema1."myTbl3"           | 10 rolled back primary keys                                    | postgres
    3286 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl1             | All log rows with emaj_gid > 30038 and <= 30079                | postgres
    3287 | ROLLBACK_TABLE         | END                     | myschema1.mytbl1             | 11 rolled back primary keys                                    | postgres
    3288 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl2             | All log rows with emaj_gid > 30038 and <= 30079                | postgres
    3289 | ROLLBACK_TABLE         | END                     | myschema1.mytbl2             | 2 rolled back primary keys                                     | postgres
    3290 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl4             | All log rows with emaj_gid > 30038 and <= 30079                | postgres
    3291 | ROLLBACK_TABLE         | END                     | myschema1.mytbl4             | 1 rolled back primary keys                                     | postgres
    3292 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl2b            | All log rows with emaj_gid > 30038 and <= 30079                | postgres
    3293 | ROLLBACK_TABLE         | END                     | myschema1.mytbl2b            | 2 rolled back primary keys                                     | postgres
    3294 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" |                                                                | postgres
    3295 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  | RESTART 1                                                      | postgres
    3296 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | RLBK_Mark11_%_DONE                                             | postgres
    3297 | SET_MARK_GROUP         | END                     | myGroup1                     | RLBK_Mark11_%_DONE                                             | postgres
    3298 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 13               | 5 / 5 tables effectively processed.                            | postgres
    3299 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 13               | 2 sequences processed.                                         | postgres
    3300 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3301 | ROLLBACK_GROUP         | END                     | myGroup1                     | Rollback_id 13, 5 tables and 2 sequences effectively processed | postgres
    3302 | ROLLBACK_GROUP         | BEGIN                   | myGroup1                     | Unlogged rollback to mark Mark13 (timestamp)                   | postgres
    3303 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3304 | LOCK_GROUP             | BEGIN                   | myGroup1                     | Rollback session #1                                            | postgres
    3305 | LOCK_GROUP             | END                     | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3306 | ROLLBACK_TABLE         | BEGIN                   | myschema1."myTbl3"           | All log rows with emaj_gid > 30068 and <= 30093                | postgres
    3307 | ROLLBACK_TABLE         | END                     | myschema1."myTbl3"           | 10 rolled back primary keys                                    | postgres
    3308 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl1             | All log rows with emaj_gid > 30068 and <= 30093                | postgres
    3309 | ROLLBACK_TABLE         | END                     | myschema1.mytbl1             | 10 rolled back primary keys                                    | postgres
    3310 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl2             | All log rows with emaj_gid > 30068 and <= 30093                | postgres
    3311 | ROLLBACK_TABLE         | END                     | myschema1.mytbl2             | 2 rolled back primary keys                                     | postgres
    3312 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl4             | All log rows with emaj_gid > 30068 and <= 30093                | postgres
    3313 | ROLLBACK_TABLE         | END                     | myschema1.mytbl4             | 1 rolled back primary keys                                     | postgres
    3314 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl2b            | All log rows with emaj_gid > 30068 and <= 30093                | postgres
    3315 | ROLLBACK_TABLE         | END                     | myschema1.mytbl2b            | 2 rolled back primary keys                                     | postgres
    3316 | ROLLBACK_GROUP         | MARK DELETED            | myGroup1                     | mark RLBK_Mark12_%_START is deleted                            | postgres
    3317 | ROLLBACK_GROUP         | MARK DELETED            | myGroup1                     | mark RLBK_Mark12_%_DONE is deleted                             | postgres
    3318 | ROLLBACK_GROUP         | MARK DELETED            | myGroup1                     | mark RLBK_Mark11_%_START is deleted                            | postgres
    3319 | ROLLBACK_GROUP         | MARK DELETED            | myGroup1                     | mark RLBK_Mark11_%_DONE is deleted                             | postgres
    3320 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" | RESTART 11                                                     | postgres
    3321 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  | RESTART 3                                                      | postgres
    3322 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 14               | 5 / 5 tables effectively processed.                            | postgres
    3323 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 14               | 2 sequences processed.                                         | postgres
    3324 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3325 | ROLLBACK_GROUP         | END                     | myGroup1                     | Rollback_id 14, 5 tables and 2 sequences effectively processed | postgres
    3326 | ROLLBACK_GROUP         | BEGIN                   | emptyGroup                   | Unlogged rollback to mark EGM4 (timestamp)                     | postgres
    3327 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3328 | LOCK_GROUP             | BEGIN                   | emptyGroup                   | Rollback session #1                                            | postgres
    3329 | LOCK_GROUP             | END                     | emptyGroup                   | Rollback session #1: 0 tables locked, 0 deadlock(s)            | postgres
    3330 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 15               | 0 / 0 tables effectively processed.                            | postgres
    3331 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3332 | ROLLBACK_GROUP         | END                     | emptyGroup                   | Rollback_id 15, 0 tables and 0 sequences effectively processed | postgres
    3333 | ROLLBACK_GROUP         | BEGIN                   | emptyGroup                   | Logged rollback to mark EGM3 (timestamp)                       | postgres
    3334 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3335 | LOCK_GROUP             | BEGIN                   | emptyGroup                   | Rollback session #1                                            | postgres
    3336 | LOCK_GROUP             | END                     | emptyGroup                   | Rollback session #1: 0 tables locked, 0 deadlock(s)            | postgres
    3337 | SET_MARK_GROUP         | BEGIN                   | emptyGroup                   | RLBK_EGM3_%_START                                              | postgres
    3338 | CLEANUP_RLBK_STATE     |                         | Rollback id 13               | set to COMMITTED                                               | postgres
    3339 | CLEANUP_RLBK_STATE     |                         | Rollback id 14               | set to COMMITTED                                               | postgres
    3340 | CLEANUP_RLBK_STATE     |                         | Rollback id 15               | set to COMMITTED                                               | postgres
    3341 | SET_MARK_GROUP         | END                     | emptyGroup                   | RLBK_EGM3_%_START                                              | postgres
    3342 | SET_MARK_GROUP         | BEGIN                   | emptyGroup                   | RLBK_EGM3_%_DONE                                               | postgres
    3343 | SET_MARK_GROUP         | END                     | emptyGroup                   | RLBK_EGM3_%_DONE                                               | postgres
    3344 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 16               | 0 / 0 tables effectively processed.                            | postgres
    3345 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3346 | ROLLBACK_GROUP         | END                     | emptyGroup                   | Rollback_id 16, 0 tables and 0 sequences effectively processed | postgres
    3347 | START_GROUP            | BEGIN                   | myGroup4                     | With log reset                                                 | postgres
    3348 | LOCK_GROUP             | BEGIN                   | myGroup4                     |                                                                | postgres
    3349 | LOCK_GROUP             | END                     | myGroup4                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3350 | SET_MARK_GROUP         | BEGIN                   | myGroup4                     | myGroup4_start                                                 | postgres
    3351 | CLEANUP_RLBK_STATE     |                         | Rollback id 16               | set to COMMITTED                                               | postgres
    3352 | SET_MARK_GROUP         | END                     | myGroup4                     | myGroup4_start                                                 | postgres
    3353 | START_GROUP            | END                     | myGroup4                     | 5 tables/sequences processed                                   | postgres
    3354 | SET_MARK_GROUP         | BEGIN                   | myGroup4                     |                                                                | postgres
    3355 | LOCK_GROUP             | BEGIN                   | myGroup4                     |                                                                | postgres
    3356 | LOCK_GROUP             | END                     | myGroup4                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3357 | SET_MARK_GROUP         | END                     | myGroup4                     | mark1                                                          | postgres
    3358 | ROLLBACK_GROUP         | BEGIN                   | myGroup4                     | Logged rollback to mark mark1 (timestamp)                      | postgres
    3359 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3360 | LOCK_GROUP             | BEGIN                   | myGroup4                     | Rollback session #1                                            | postgres
    3361 | LOCK_GROUP             | END                     | myGroup4                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3362 | SET_MARK_GROUP         | BEGIN                   | myGroup4                     | RLBK_mark1_%_START                                             | postgres
    3363 | SET_MARK_GROUP         | END                     | myGroup4                     | RLBK_mark1_%_START                                             | postgres
    3364 | ROLLBACK_TABLE         | BEGIN                   | myschema4.mytblc1            | All log rows with emaj_gid > 30096 and <= 30102                | postgres
    3365 | ROLLBACK_TABLE         | END                     | myschema4.mytblc1            | 2 rolled back primary keys                                     | postgres
    3366 | ROLLBACK_TABLE         | BEGIN                   | myschema4.mytblc2            | All log rows with emaj_gid > 30096 and <= 30102                | postgres
    3367 | ROLLBACK_TABLE         | END                     | myschema4.mytblc2            | 2 rolled back primary keys                                     | postgres
    3368 | ROLLBACK_TABLE         | BEGIN                   | myschema4.mytblm             | All log rows with emaj_gid > 30096 and <= 30102                | postgres
    3369 | ROLLBACK_TABLE         | END                     | myschema4.mytblm             | 2 rolled back primary keys                                     | postgres
    3370 | SET_MARK_GROUP         | BEGIN                   | myGroup4                     | RLBK_mark1_%_DONE                                              | postgres
    3371 | SET_MARK_GROUP         | END                     | myGroup4                     | RLBK_mark1_%_DONE                                              | postgres
    3372 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 17               | 3 / 5 tables effectively processed.                            | postgres
    3373 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3374 | ROLLBACK_GROUP         | END                     | myGroup4                     | Rollback_id 17, 3 tables and 0 sequences effectively processed | postgres
    3375 | ROLLBACK_GROUP         | BEGIN                   | myGroup4                     | Unlogged rollback to mark myGroup4_start (timestamp)           | postgres
    3376 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3377 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 0                                                     | postgres
    3378 | LOCK_GROUP             | BEGIN                   | myGroup4                     | Rollback session #1                                            | postgres
    3379 | LOCK_GROUP             | END                     | myGroup4                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3380 | ROLLBACK_TABLE         | BEGIN                   | myschema4.mytblc1            | All log rows with emaj_gid > 30093 and <= 30105                | postgres
    3381 | ROLLBACK_TABLE         | END                     | myschema4.mytblc1            | 2 rolled back primary keys                                     | postgres
    3382 | ROLLBACK_TABLE         | BEGIN                   | myschema4.mytblc2            | All log rows with emaj_gid > 30093 and <= 30105                | postgres
    3383 | ROLLBACK_TABLE         | END                     | myschema4.mytblc2            | 2 rolled back primary keys                                     | postgres
    3384 | ROLLBACK_TABLE         | BEGIN                   | myschema4.mytblm             | All log rows with emaj_gid > 30093 and <= 30105                | postgres
    3385 | ROLLBACK_TABLE         | END                     | myschema4.mytblm             | 2 rolled back primary keys                                     | postgres
    3386 | ROLLBACK_GROUP         | MARK DELETED            | myGroup4                     | mark mark1 is deleted                                          | postgres
    3387 | ROLLBACK_GROUP         | MARK DELETED            | myGroup4                     | mark RLBK_mark1_%_START is deleted                             | postgres
    3388 | ROLLBACK_GROUP         | MARK DELETED            | myGroup4                     | mark RLBK_mark1_%_DONE is deleted                              | postgres
    3389 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 18               | 3 / 5 tables effectively processed.                            | postgres
    3390 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3391 | ROLLBACK_GROUP         | END                     | myGroup4                     | Rollback_id 18, 3 tables and 0 sequences effectively processed | postgres
    3393 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     |                                                                | postgres
    3394 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3395 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3396 | CLEANUP_RLBK_STATE     |                         | Rollback id 17               | set to COMMITTED                                               | postgres
    3397 | CLEANUP_RLBK_STATE     |                         | Rollback id 18               | set to COMMITTED                                               | postgres
    3398 | SET_MARK_GROUP         | END                     | myGroup1                     | Conso_M1                                                       | postgres
    3399 | ROLLBACK_GROUP         | BEGIN                   | myGroup1                     | Logged rollback to mark Conso_M1 (timestamp)                   | postgres
    3400 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3401 | LOCK_GROUP             | BEGIN                   | myGroup1                     | Rollback session #1                                            | postgres
    3402 | LOCK_GROUP             | END                     | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3403 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | RLBK_Conso_M1_%_START                                          | postgres
    3404 | SET_MARK_GROUP         | END                     | myGroup1                     | RLBK_Conso_M1_%_START                                          | postgres
    3405 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" |                                                                | postgres
    3406 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  |                                                                | postgres
    3407 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | RLBK_Conso_M1_%_DONE                                           | postgres
    3408 | SET_MARK_GROUP         | END                     | myGroup1                     | RLBK_Conso_M1_%_DONE                                           | postgres
    3409 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 19               | 0 / 5 tables effectively processed.                            | postgres
    3410 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 19               | 2 sequences processed.                                         | postgres
    3411 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3412 | ROLLBACK_GROUP         | END                     | myGroup1                     | Rollback_id 19, 0 tables and 2 sequences effectively processed | postgres
    3413 | CONSOLIDATE_RLBK_GROUP | BEGIN                   | myGroup1                     | Erase all between marks Conso_M1 and RLBK_Conso_M1_%_DONE      | postgres
    3414 | CONSOLIDATE_RLBK_GROUP | END                     | myGroup1                     | 0 tables and 2 sequences processed ; 1 marks deleted           | postgres
    3415 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     |                                                                | postgres
    3416 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3417 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3418 | CLEANUP_RLBK_STATE     |                         | Rollback id 19               | set to COMMITTED                                               | postgres
    3419 | SET_MARK_GROUP         | END                     | myGroup1                     | Conso_M2                                                       | postgres
    3420 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     |                                                                | postgres
    3421 | LOCK_GROUP             | BEGIN                   | myGroup1                     |                                                                | postgres
    3422 | LOCK_GROUP             | END                     | myGroup1                     | 5 tables locked, 0 deadlock(s)                                 | postgres
    3423 | SET_MARK_GROUP         | END                     | myGroup1                     | Conso_M3                                                       | postgres
    3424 | ROLLBACK_GROUP         | BEGIN                   | myGroup1                     | Logged rollback to mark Conso_M2 (timestamp)                   | postgres
    3425 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3426 | LOCK_GROUP             | BEGIN                   | myGroup1                     | Rollback session #1                                            | postgres
    3427 | LOCK_GROUP             | END                     | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3428 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | RLBK_Conso_M2_%_START                                          | postgres
    3429 | SET_MARK_GROUP         | END                     | myGroup1                     | RLBK_Conso_M2_%_START                                          | postgres
    3430 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl1             | All log rows with emaj_gid > 30105 and <= 30122                | postgres
    3431 | ROLLBACK_TABLE         | END                     | myschema1.mytbl1             | 12 rolled back primary keys                                    | postgres
    3432 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl2             | All log rows with emaj_gid > 30105 and <= 30122                | postgres
    3433 | ROLLBACK_TABLE         | END                     | myschema1.mytbl2             | 1 rolled back primary keys                                     | postgres
    3434 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl2b            | All log rows with emaj_gid > 30105 and <= 30122                | postgres
    3435 | ROLLBACK_TABLE         | END                     | myschema1.mytbl2b            | 2 rolled back primary keys                                     | postgres
    3436 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" |                                                                | postgres
    3437 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  | RESTART 3                                                      | postgres
    3438 | SET_MARK_GROUP         | BEGIN                   | myGroup1                     | RLBK_Conso_M2_%_DONE                                           | postgres
    3439 | SET_MARK_GROUP         | END                     | myGroup1                     | RLBK_Conso_M2_%_DONE                                           | postgres
    3440 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 20               | 3 / 5 tables effectively processed.                            | postgres
    3441 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 20               | 2 sequences processed.                                         | postgres
    3442 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3443 | ROLLBACK_GROUP         | END                     | myGroup1                     | Rollback_id 20, 3 tables and 2 sequences effectively processed | postgres
    3444 | RENAME_MARK_GROUP      | BEGIN                   | myGroup1                     | Conso_M2                                                       | postgres
    3445 | RENAME_MARK_GROUP      | END                     | myGroup1                     | Conso_M2 renamed Renamed_conso_M2                              | postgres
    3446 | RENAME_MARK_GROUP      | BEGIN                   | myGroup1                     | EMAJ_LAST_MARK                                                 | postgres
    3447 | RENAME_MARK_GROUP      | END                     | myGroup1                     | RLBK_Conso_M2_%_DONE renamed Renamed_last_mark                 | postgres
    3448 | CONSOLIDATE_RLBK_GROUP | BEGIN                   | myGroup1                     | Erase all between marks Renamed_conso_M2 and Renamed_last_mark | postgres
    3449 | CONSOLIDATE_RLBK_GROUP | END                     | myGroup1                     | 3 tables and 2 sequences processed ; 2 marks deleted           | postgres
    3450 | CONSOLIDATE_RLBK_GROUP | BEGIN                   | myGroup1                     | Erase all between marks Renamed_conso_M2 and Renamed_last_mark | postgres
    3451 | CONSOLIDATE_RLBK_GROUP | END                     | myGroup1                     | 0 tables and 2 sequences processed ; 0 marks deleted           | postgres
    3452 | ROLLBACK_GROUP         | BEGIN                   | myGroup1                     | Unlogged rollback to mark Conso_M1 (timestamp)                 | postgres
    3453 | DBLINK_OPEN_CNX        |                         | rlbk#1                       | Status = 1                                                     | postgres
    3454 | LOCK_GROUP             | BEGIN                   | myGroup1                     | Rollback session #1                                            | postgres
    3455 | LOCK_GROUP             | END                     | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
    3456 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl2             | All log rows with emaj_gid > 30105 and <= 30139                | postgres
    3457 | ROLLBACK_TABLE         | END                     | myschema1.mytbl2             | 1 rolled back primary keys                                     | postgres
    3458 | ROLLBACK_TABLE         | BEGIN                   | myschema1.mytbl2b            | All log rows with emaj_gid > 30105 and <= 30139                | postgres
    3459 | ROLLBACK_TABLE         | END                     | myschema1.mytbl2b            | 1 rolled back primary keys                                     | postgres
    3460 | ROLLBACK_GROUP         | MARK DELETED            | myGroup1                     | mark RLBK_Conso_M1_%_DONE is deleted                           | postgres
    3461 | ROLLBACK_GROUP         | MARK DELETED            | myGroup1                     | mark Renamed_conso_M2 is deleted                               | postgres
    3462 | ROLLBACK_GROUP         | MARK DELETED            | myGroup1                     | mark Renamed_last_mark is deleted                              | postgres
    3463 | ROLLBACK_SEQUENCE      |                         | myschema1."myTbl3_col31_seq" |                                                                | postgres
    3464 | ROLLBACK_SEQUENCE      |                         | myschema1.mytbl2b_col20_seq  | RESTART 3                                                      | postgres
    3465 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 21               | 2 / 5 tables effectively processed.                            | postgres
    3466 | ROLLBACK_GROUP         | NOTICE                  | Rollback id 21               | 2 sequences processed.                                         | postgres
    3467 | DBLINK_CLOSE_CNX       |                         | rlbk#1                       |                                                                | postgres
    3468 | ROLLBACK_GROUP         | END                     | myGroup1                     | Rollback_id 21, 2 tables and 2 sequences effectively processed | postgres
    3499 | CLEANUP_RLBK_STATE     |                         | Rollback id 20               | set to COMMITTED                                               | postgres
    3500 | CLEANUP_RLBK_STATE     |                         | Rollback id 21               | set to COMMITTED                                               | postgres
    3501 | CLEANUP_RLBK_STATE     |                         | Rollback id 22               | set to ABORTED                                                 | postgres
    3502 | ENABLE_PROTECTION      | EVENT TRIGGERS ENABLED  |                              | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg | postgres
(410 rows)

