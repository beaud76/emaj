-- adm1.sql : complex scenario executed by an emaj_adm role
--            playing with both myGroup1 and myGroup2 tables groups
--
SET datestyle TO ymd;
-----------------------------
-- grant emaj_adm role 
-----------------------------
grant emaj_adm to emaj_regression_tests_adm_user;
--
set role emaj_regression_tests_adm_user;
-----------------------------
-- authorized table accesses
-----------------------------
select count(*) from emaj.emaj_param;
 count 
-------
     3
(1 row)

select count(*) from emaj.emaj_hist;
 count 
-------
     0
(1 row)

select count(*) from emaj.emaj_group_def;
 count 
-------
    21
(1 row)

select count(*) from emaj.emaj_group;
 count 
-------
     3
(1 row)

select count(*) from emaj.emaj_relation;
 count 
-------
    17
(1 row)

select count(*) from emaj.emaj_mark;
 count 
-------
     6
(1 row)

select count(*) from emaj.emaj_sequence;
 count 
-------
    39
(1 row)

select count(*) from emaj.emaj_seq_hole;
 count 
-------
     0
(1 row)

select count(*) from emaj.emaj_rlbk_stat;
 count 
-------
     0
(1 row)

select count(*) from emaj.emaj_fk;
 count 
-------
     2
(1 row)

select count(*) from emaj.mySchema1_myTbl1_log;
 count 
-------
     0
(1 row)

-----------------------------
-- stop and drop groups
-----------------------------
select emaj.emaj_stop_group('myGroup1');
WARNING:  _stop_group: Group myGroup1 cannot be stopped because it is not in logging state.
CONTEXT:  SQL statement "SELECT emaj._stop_groups(array[v_groupName], 'STOP_%', false, false)"
PL/pgSQL function emaj.emaj_stop_group(text) line 13 at SQL statement
 emaj_stop_group 
-----------------
               0
(1 row)

select emaj.emaj_drop_group('myGroup1');
 emaj_drop_group 
-----------------
               6
(1 row)

select emaj.emaj_force_drop_group('myGroup2');
 emaj_force_drop_group 
-----------------------
                     8
(1 row)

select emaj.emaj_stop_group('phil''s group#3",','Simple stop mark');
 emaj_stop_group 
-----------------
               3
(1 row)

select emaj.emaj_drop_group('phil''s group#3",');
 emaj_drop_group 
-----------------
               3
(1 row)

-- emaj tables
select * from emaj.emaj_group;
 group_name | group_state | group_nb_table | group_nb_sequence | group_is_rollbackable | group_creation_datetime | group_last_alter_datetime | group_pg_version | group_comment 
------------+-------------+----------------+-------------------+-----------------------+-------------------------+---------------------------+------------------+---------------
(0 rows)

select * from emaj.emaj_relation;
 rel_schema | rel_tblseq | rel_group | rel_priority | rel_log_schema | rel_log_dat_tsp | rel_log_idx_tsp | rel_kind | rel_session | rel_rows 
------------+------------+-----------+--------------+----------------+-----------------+-----------------+----------+-------------+----------
(0 rows)

select * from emaj.emaj_mark;
 mark_group | mark_name | mark_id | mark_datetime | mark_global_seq | mark_state | mark_comment | mark_txid | mark_last_sequence_id | mark_last_seq_hole_id | mark_log_rows_before_next 
------------+-----------+---------+---------------+-----------------+------------+--------------+-----------+-----------------------+-----------------------+---------------------------
(0 rows)

select * from emaj.emaj_sequence;
 sequ_id | sequ_schema | sequ_name | sequ_datetime | sequ_mark | sequ_last_val | sequ_start_val | sequ_increment | sequ_max_val | sequ_min_val | sequ_cache_val | sequ_is_cycled | sequ_is_called 
---------+-------------+-----------+---------------+-----------+---------------+----------------+----------------+--------------+--------------+----------------+----------------+----------------
(0 rows)

select * from emaj.emaj_fk;
 fk_groups | fk_session | fk_name | fk_schema | fk_table | fk_action | fk_def 
-----------+------------+---------+-----------+----------+-----------+--------
(0 rows)

select * from emaj.emaj_seq_hole;
 sqhl_id | sqhl_schema | sqhl_table | sqhl_datetime | sqhl_hole_size 
---------+-------------+------------+---------------+----------------
(0 rows)

select count(*) from emaj.emaj_rlbk_stat;
 count 
-------
     0
(1 row)

-----------------------------
-- cleanup application tables
-----------------------------
reset role;
truncate mySchema1.myTbl1, mySchema1.myTbl2, mySchema1."myTbl3", mySchema1.myTbl4, mySchema1.myTbl2b; 
truncate mySchema2.myTbl1, mySchema2.myTbl2, mySchema2."myTbl3", mySchema2.myTbl4, mySchema2.myTbl5, mySchema2.myTbl6;
alter sequence mySchema2.mySeq1 restart 1000;
-- starting from this point, disable the trigger on myTbl2
alter table mySchema1.myTbl2 disable trigger myTbl2trg;
set role emaj_regression_tests_adm_user;
-----------------------------
-- recreate and start groups
-----------------------------
select emaj.emaj_create_group('myGroup1');
NOTICE:  table "myschema1_myTbl3_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS "emajC"."myschema1_myTbl3_log""
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  trigger "myschema1_myTbl3_emaj_log_trg" for table "myschema1.myTbl3" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS "myschema1_myTbl3_emaj_log_trg" ON myschema1."myTbl3""
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 149 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  trigger "myschema1_myTbl3_emaj_trunc_trg" for table "myschema1.myTbl3" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS "myschema1_myTbl3_emaj_trunc_trg" ON myschema1."myTbl3""
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 157 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  table "myschema1_mytbl1_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema1_mytbl1_log"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl1_emaj_log_trg" for table "myschema1.mytbl1" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl1_emaj_log_trg ON myschema1.mytbl1"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 149 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl1_emaj_trunc_trg" for table "myschema1.mytbl1" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl1_emaj_trunc_trg ON myschema1.mytbl1"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 157 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  table "myschema1_mytbl4_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema1_mytbl4_log"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl4_emaj_log_trg" for table "myschema1.mytbl4" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl4_emaj_log_trg ON myschema1.mytbl4"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 149 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl4_emaj_trunc_trg" for table "myschema1.mytbl4" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl4_emaj_trunc_trg ON myschema1.mytbl4"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 157 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  table "myschema1_mytbl2_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema1_mytbl2_log"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl2_emaj_log_trg" for table "myschema1.mytbl2" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl2_emaj_log_trg ON myschema1.mytbl2"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 149 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl2_emaj_trunc_trg" for table "myschema1.mytbl2" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl2_emaj_trunc_trg ON myschema1.mytbl2"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 157 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
WARNING:  _create_tbl: table myschema1.mytbl2 has triggers (mytbl2trg). Verify the compatibility with emaj rollback operations (in particular if triggers update one or several other tables). Triggers may have to be manualy disabled before rollback.
CONTEXT:  SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  table "myschema1_mytbl2b_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emajb.myschema1_mytbl2b_log"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl2b_emaj_log_trg" for table "myschema1.mytbl2b" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl2b_emaj_log_trg ON myschema1.mytbl2b"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 149 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
NOTICE:  trigger "myschema1_mytbl2b_emaj_trunc_trg" for table "myschema1.mytbl2b" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema1_mytbl2b_emaj_trunc_trg ON myschema1.mytbl2b"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 157 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
 emaj_create_group 
-------------------
                 6
(1 row)

select emaj.emaj_comment_group('myGroup1','This is group #1');
 emaj_comment_group 
--------------------
 
(1 row)

select emaj.emaj_create_group('myGroup2',true);
NOTICE:  table "myschema2_mytbl1_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema2_mytbl1_log"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl1_emaj_log_trg" for table "myschema2.mytbl1" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl1_emaj_log_trg ON myschema2.mytbl1"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 149 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl1_emaj_trunc_trg" for table "myschema2.mytbl1" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl1_emaj_trunc_trg ON myschema2.mytbl1"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 157 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  table "myschema2_mytbl2_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema2_mytbl2_log"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl2_emaj_log_trg" for table "myschema2.mytbl2" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl2_emaj_log_trg ON myschema2.mytbl2"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 149 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl2_emaj_trunc_trg" for table "myschema2.mytbl2" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl2_emaj_trunc_trg ON myschema2.mytbl2"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 157 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  table "myschema2_myTbl3_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS "emajC"."myschema2_myTbl3_log""
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_myTbl3_emaj_log_trg" for table "myschema2.myTbl3" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS "myschema2_myTbl3_emaj_log_trg" ON myschema2."myTbl3""
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 149 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_myTbl3_emaj_trunc_trg" for table "myschema2.myTbl3" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS "myschema2_myTbl3_emaj_trunc_trg" ON myschema2."myTbl3""
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 157 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  table "myschema2_mytbl4_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema2_mytbl4_log"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl4_emaj_log_trg" for table "myschema2.mytbl4" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl4_emaj_log_trg ON myschema2.mytbl4"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 149 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl4_emaj_trunc_trg" for table "myschema2.mytbl4" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl4_emaj_trunc_trg ON myschema2.mytbl4"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 157 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  table "myschema2_mytbl5_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema2_mytbl5_log"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl5_emaj_log_trg" for table "myschema2.mytbl5" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl5_emaj_log_trg ON myschema2.mytbl5"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 149 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl5_emaj_trunc_trg" for table "myschema2.mytbl5" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl5_emaj_trunc_trg ON myschema2.mytbl5"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 157 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  table "myschema2_mytbl6_log" does not exist, skipping
CONTEXT:  SQL statement "DROP TABLE IF EXISTS emaj.myschema2_mytbl6_log"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 84 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl6_emaj_log_trg" for table "myschema2.mytbl6" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl6_emaj_log_trg ON myschema2.mytbl6"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 149 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
NOTICE:  trigger "myschema2_mytbl6_emaj_trunc_trg" for table "myschema2.mytbl6" does not exist, skipping
CONTEXT:  SQL statement "DROP TRIGGER IF EXISTS myschema2_mytbl6_emaj_trunc_trg ON myschema2.mytbl6"
PL/pgSQL function emaj._create_tbl(text,text,text,text,text,boolean) line 157 at EXECUTE statement
SQL statement "SELECT emaj._create_tbl(r_tblsq.grpdef_schema, r_tblsq.grpdef_tblseq, v_logSchema, coalesce(r_tblsq.grpdef_log_dat_tsp, v_defTsp), coalesce(r_tblsq.grpdef_log_idx_tsp, v_defTsp), v_isRollbackable)"
PL/pgSQL function emaj.emaj_create_group(text,boolean) line 88 at PERFORM
 emaj_create_group 
-------------------
                 8
(1 row)

select emaj.emaj_start_group('myGroup1','M1');
 emaj_start_group 
------------------
                6
(1 row)

select emaj.emaj_start_group('myGroup2','M1');
 emaj_start_group 
------------------
                8
(1 row)

-----------------------------
-- Step 1 : for myGroup1, update tables and set 2 marks
-----------------------------
-- check how truncate reacts (must be blocked in pg 8.4+) - tables are empty anyway
truncate myschema1.mytbl1 cascade;
NOTICE:  truncate cascades to table "mytbl4"
ERROR:  emaj._forbid_truncate_fnct: TRUNCATE is not allowed while updates on this table (myschema1.mytbl1) are currently protected by E-Maj. Consider stopping the group before issuing a TRUNCATE.
-- 
set search_path=myschema1;
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
insert into myTbl2 values (1,'ABC','2010-12-31');
delete from myTbl1 where col11 > 10;
insert into myTbl2 values (2,'DEF',NULL);
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
--
select emaj.emaj_set_mark_group('myGroup1','M2');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

--
set search_path=myschema1;
insert into myTbl4 values (1,'FK...',1,1,'ABC');
insert into myTbl4 values (2,'FK...',1,1,'ABC');
update myTbl4 set col43 = 2;
insert into myTbl4 values (3,'FK...',1,10,'ABC');
-- the 2 next statements activate fkey on delete and on update clauses 
delete from myTbl1 where col11 = 10;
update myTbl1 set col12='DEF' where col11 <= 2;
--
select emaj.emaj_set_mark_group('myGroup1','M3');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

select emaj.emaj_comment_mark_group('myGroup1','M3','Third mark set');
 emaj_comment_mark_group 
-------------------------
 
(1 row)

-----------------------------
-- Checking step 1
-----------------------------
-- emaj tables
select group_name, group_state, group_nb_table, group_nb_sequence, group_is_rollbackable, group_comment 
from emaj.emaj_group order by group_nb_table;
 group_name | group_state | group_nb_table | group_nb_sequence | group_is_rollbackable |  group_comment   
------------+-------------+----------------+-------------------+-----------------------+------------------
 myGroup1   | LOGGING     |              5 |                 1 | t                     | This is group #1
 myGroup2   | LOGGING     |              6 |                 2 | t                     | 
(2 rows)

select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace | mark_global_seq | mark_state |  mark_comment  | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+----------------+-----------------+------------+----------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1             |           11833 | ACTIVE     |                |                   599 |                   608 |                        27
     602 | myGroup2   | M1             |           11833 | ACTIVE     |                |                   599 |                   616 |                          
     603 | myGroup1   | M2             |           11860 | ACTIVE     |                |                   599 |                   622 |                        11
     604 | myGroup1   | M3             |           11871 | ACTIVE     | Third mark set |                   599 |                   628 |                          
(4 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+----------------+---------------+----------------
     603 | myschema1   | myTbl3_col31_seq          | M1             |            11 | f
     604 | emajC       | myschema1_myTbl3_log_seq  | M1             |             1 | f
     605 | emaj        | myschema1_mytbl1_log_seq  | M1             |             1 | f
     606 | emaj        | myschema1_mytbl4_log_seq  | M1             |             1 | f
     607 | emaj        | myschema1_mytbl2_log_seq  | M1             |             1 | f
     608 | emajb       | myschema1_mytbl2b_log_seq | M1             |             1 | f
     609 | myschema2   | myseq1                    | M1             |          1000 | f
     610 | emaj        | myschema2_mytbl1_log_seq  | M1             |             1 | f
     611 | emaj        | myschema2_mytbl2_log_seq  | M1             |             1 | f
     612 | emajC       | myschema2_myTbl3_log_seq  | M1             |             1 | f
     613 | myschema2   | myTbl3_col31_seq          | M1             |            10 | t
     614 | emaj        | myschema2_mytbl4_log_seq  | M1             |             1 | f
     615 | emaj        | myschema2_mytbl5_log_seq  | M1             |             1 | f
     616 | emaj        | myschema2_mytbl6_log_seq  | M1             |             1 | f
     617 | myschema1   | myTbl3_col31_seq          | M2             |            20 | t
     618 | emajC       | myschema1_myTbl3_log_seq  | M2             |            10 | t
     619 | emaj        | myschema1_mytbl1_log_seq  | M2             |            15 | t
     620 | emaj        | myschema1_mytbl4_log_seq  | M2             |             1 | f
     621 | emaj        | myschema1_mytbl2_log_seq  | M2             |             2 | t
     622 | emajb       | myschema1_mytbl2b_log_seq | M2             |             1 | f
     623 | myschema1   | myTbl3_col31_seq          | M3             |            20 | t
     624 | emajC       | myschema1_myTbl3_log_seq  | M3             |            10 | t
     625 | emaj        | myschema1_mytbl1_log_seq  | M3             |            18 | t
     626 | emaj        | myschema1_mytbl4_log_seq  | M3             |             8 | t
     627 | emaj        | myschema1_mytbl2_log_seq  | M3             |             2 | t
     628 | emajb       | myschema1_mytbl2b_log_seq | M3             |             1 | f
(26 rows)

-- user tables
select * from mySchema1.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | DEF        | \x1c
     2 | DEF        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
(9 rows)

select * from mySchema1.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 12-31-2010
     2 | DEF   | 
(2 rows)

select * from mySchema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

select col31,col33 from mySchema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
     1 | FK... |     2 |     1 | 
     2 | FK... |     2 |     1 | 
(2 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid, emaj_user, emaj_user_ip from emaj.mySchema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid | emaj_user | emaj_user_ip 
-------+------------+-------+-----------+------------+----------+-----------+--------------
     1 | ABC        | \x0c  | INS       | NEW        |    11834 | postgres  | 
     2 | ABC        | \x0c  | INS       | NEW        |    11835 | postgres  | 
     3 | ABC        | \x0c  | INS       | NEW        |    11836 | postgres  | 
     4 | ABC        | \x0c  | INS       | NEW        |    11837 | postgres  | 
     5 | ABC        | \x0c  | INS       | NEW        |    11838 | postgres  | 
     6 | ABC        | \x0c  | INS       | NEW        |    11839 | postgres  | 
     7 | ABC        | \x0c  | INS       | NEW        |    11840 | postgres  | 
     8 | ABC        | \x0c  | INS       | NEW        |    11841 | postgres  | 
     9 | ABC        | \x0c  | INS       | NEW        |    11842 | postgres  | 
    10 | ABC        | \x0c  | INS       | NEW        |    11843 | postgres  | 
    11 | ABC        | \x0c  | INS       | NEW        |    11844 | postgres  | 
     1 | ABC        | \x0c  | UPD       | OLD        |    11845 | postgres  | 
     1 | ABC        | \x1c  | UPD       | NEW        |    11845 | postgres  | 
     2 | ABC        | \x0c  | UPD       | OLD        |    11846 | postgres  | 
     2 | ABC        | \x1c  | UPD       | NEW        |    11846 | postgres  | 
     3 | ABC        | \x0c  | UPD       | OLD        |    11847 | postgres  | 
     3 | ABC        | \x1c  | UPD       | NEW        |    11847 | postgres  | 
    11 | ABC        | \x0c  | DEL       | OLD        |    11849 | postgres  | 
    10 | ABC        | \x0c  | DEL       | OLD        |    11866 | postgres  | 
     1 | ABC        | \x1c  | UPD       | OLD        |    11868 | postgres  | 
     1 | DEF        | \x1c  | UPD       | NEW        |    11868 | postgres  | 
     2 | ABC        | \x1c  | UPD       | OLD        |    11869 | postgres  | 
     2 | DEF        | \x1c  | UPD       | NEW        |    11869 | postgres  | 
(23 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid, emaj_user, emaj_user_ip from emaj.mySchema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid | emaj_user | emaj_user_ip 
-------+-------+------------+-----------+------------+----------+-----------+--------------
     1 | ABC   | 12-31-2010 | INS       | NEW        |    11848 | postgres  | 
     2 | DEF   |            | INS       | NEW        |    11850 | postgres  | 
(2 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid, emaj_user, emaj_user_ip from emajb.mySchema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid | emaj_user | emaj_user_ip 
-------+-------+-----------+------------+----------+-----------+--------------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid, emaj_user, emaj_user_ip from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid | emaj_user | emaj_user_ip 
-------+-------+-----------+------------+----------+-----------+--------------
    11 | 10.00 | INS       | NEW        |    11851 | postgres  | 
    12 | 10.00 | INS       | NEW        |    11852 | postgres  | 
    13 | 10.00 | INS       | NEW        |    11853 | postgres  | 
    14 | 10.00 | INS       | NEW        |    11854 | postgres  | 
    15 | 10.00 | INS       | NEW        |    11855 | postgres  | 
    16 | 10.00 | INS       | NEW        |    11856 | postgres  | 
    17 | 10.00 | INS       | NEW        |    11857 | postgres  | 
    18 | 10.00 | INS       | NEW        |    11858 | postgres  | 
    19 | 10.00 | INS       | NEW        |    11859 | postgres  | 
    20 | 10.00 | INS       | NEW        |    11860 | postgres  | 
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid, emaj_user, emaj_user_ip from emaj.mySchema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid | emaj_user | emaj_user_ip 
-------+-------+-------+-------+------------+-----------+------------+----------+-----------+--------------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11861 | postgres  | 
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11862 | postgres  | 
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11863 | postgres  | 
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11863 | postgres  | 
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11864 | postgres  | 
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11864 | postgres  | 
     3 | FK... |     1 |    10 | ABC        | INS       | NEW        |    11865 | postgres  | 
     3 | FK... |     1 |    10 | ABC        | DEL       | OLD        |    11867 | postgres  | 
     1 | FK... |     2 |     1 | ABC        | UPD       | OLD        |    11870 | postgres  | 
     1 | FK... |     2 |     1 |            | UPD       | NEW        |    11870 | postgres  | 
     2 | FK... |     2 |     1 | ABC        | UPD       | OLD        |    11871 | postgres  | 
     2 | FK... |     2 |     1 |            | UPD       | NEW        |    11871 | postgres  | 
(12 rows)

-----------------------------
-- Step 2 : for myGroup2, start, update tables and set 2 marks 
-----------------------------
set search_path=myschema2;
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
insert into myTbl2 values (1,'ABC','2010-01-01');
delete from myTbl1 where col11 > 10;
select nextval('myschema2.myseq1');
 nextval 
---------
    1000
(1 row)

insert into myTbl2 values (2,'DEF',NULL);
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
insert into myTbl5 values (1,'{"abc","def","ghi"}','{1,2,3}',NULL);
insert into myTbl5 values (2,array['abc','def','ghi'],array[3,4,5],array['2000/02/01'::date,'2000/02/28'::date]);
update myTbl5 set col54 = '{"2010/11/28","2010/12/03"}' where col54 is null;
insert into myTbl6 select i, point(i,1.3), '((0,0),(2,2))', circle(point(5,5),i),'((-2,-2),(3,0),(1,4))','10.20.30.40/27' from generate_series (1,8) as i;
update myTbl6 set col64 = '<(5,6),3.5>', col65 = null where col61 <= 3;
--
select emaj.emaj_set_mark_group('myGroup2','M2');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

--
set search_path=myschema2;
select nextval('myschema2.myseq1');
 nextval 
---------
    1001
(1 row)

select nextval('myschema2.myseq1');
 nextval 
---------
    1002
(1 row)

select nextval('myschema2.myseq1');
 nextval 
---------
    1003
(1 row)

--
reset role;
alter sequence mySeq1 NO MAXVALUE NO CYCLE;
set role emaj_regression_tests_adm_user;
--
insert into myTbl4 values (1,'FK...',1,1,'ABC');
insert into myTbl4 values (2,'FK...',1,1,'ABC');
update myTbl4 set col43 = 2;
delete from mytbl5 where 4 = any(col53);
delete from myTbl6 where col65 is null;
--
select emaj.emaj_set_mark_group('myGroup2','M3');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

-----------------------------
-- Checking step 2
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace | mark_global_seq | mark_state |  mark_comment  | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+----------------+-----------------+------------+----------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1             |           11833 | ACTIVE     |                |                   599 |                   608 |                        27
     602 | myGroup2   | M1             |           11833 | ACTIVE     |                |                   599 |                   616 |                        41
     603 | myGroup1   | M2             |           11860 | ACTIVE     |                |                   599 |                   622 |                        11
     604 | myGroup1   | M3             |           11871 | ACTIVE     | Third mark set |                   599 |                   628 |                          
     605 | myGroup2   | M2             |           11912 | ACTIVE     |                |                   599 |                   636 |                         8
     606 | myGroup2   | M3             |           11920 | ACTIVE     |                |                   599 |                   644 |                          
(6 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+----------------+---------------+----------------
     603 | myschema1   | myTbl3_col31_seq          | M1             |            11 | f
     604 | emajC       | myschema1_myTbl3_log_seq  | M1             |             1 | f
     605 | emaj        | myschema1_mytbl1_log_seq  | M1             |             1 | f
     606 | emaj        | myschema1_mytbl4_log_seq  | M1             |             1 | f
     607 | emaj        | myschema1_mytbl2_log_seq  | M1             |             1 | f
     608 | emajb       | myschema1_mytbl2b_log_seq | M1             |             1 | f
     609 | myschema2   | myseq1                    | M1             |          1000 | f
     610 | emaj        | myschema2_mytbl1_log_seq  | M1             |             1 | f
     611 | emaj        | myschema2_mytbl2_log_seq  | M1             |             1 | f
     612 | emajC       | myschema2_myTbl3_log_seq  | M1             |             1 | f
     613 | myschema2   | myTbl3_col31_seq          | M1             |            10 | t
     614 | emaj        | myschema2_mytbl4_log_seq  | M1             |             1 | f
     615 | emaj        | myschema2_mytbl5_log_seq  | M1             |             1 | f
     616 | emaj        | myschema2_mytbl6_log_seq  | M1             |             1 | f
     617 | myschema1   | myTbl3_col31_seq          | M2             |            20 | t
     618 | emajC       | myschema1_myTbl3_log_seq  | M2             |            10 | t
     619 | emaj        | myschema1_mytbl1_log_seq  | M2             |            15 | t
     620 | emaj        | myschema1_mytbl4_log_seq  | M2             |             1 | f
     621 | emaj        | myschema1_mytbl2_log_seq  | M2             |             2 | t
     622 | emajb       | myschema1_mytbl2b_log_seq | M2             |             1 | f
     623 | myschema1   | myTbl3_col31_seq          | M3             |            20 | t
     624 | emajC       | myschema1_myTbl3_log_seq  | M3             |            10 | t
     625 | emaj        | myschema1_mytbl1_log_seq  | M3             |            18 | t
     626 | emaj        | myschema1_mytbl4_log_seq  | M3             |             8 | t
     627 | emaj        | myschema1_mytbl2_log_seq  | M3             |             2 | t
     628 | emajb       | myschema1_mytbl2b_log_seq | M3             |             1 | f
     629 | myschema2   | myseq1                    | M2             |          1000 | t
     630 | emaj        | myschema2_mytbl1_log_seq  | M2             |            15 | t
     631 | emaj        | myschema2_mytbl2_log_seq  | M2             |             2 | t
     632 | emajC       | myschema2_myTbl3_log_seq  | M2             |            10 | t
     633 | myschema2   | myTbl3_col31_seq          | M2             |            20 | t
     634 | emaj        | myschema2_mytbl4_log_seq  | M2             |             1 | f
     635 | emaj        | myschema2_mytbl5_log_seq  | M2             |             3 | t
     636 | emaj        | myschema2_mytbl6_log_seq  | M2             |            11 | t
     637 | myschema2   | myseq1                    | M3             |          1003 | t
     638 | emaj        | myschema2_mytbl1_log_seq  | M3             |            15 | t
     639 | emaj        | myschema2_mytbl2_log_seq  | M3             |             2 | t
     640 | emajC       | myschema2_myTbl3_log_seq  | M3             |            10 | t
     641 | myschema2   | myTbl3_col31_seq          | M3             |            20 | t
     642 | emaj        | myschema2_mytbl4_log_seq  | M3             |             4 | t
     643 | emaj        | myschema2_mytbl5_log_seq  | M3             |             4 | t
     644 | emaj        | myschema2_mytbl6_log_seq  | M3             |            14 | t
(42 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 01-01-2010
     2 | DEF   | 
(2 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

select * from mySchema2.myTbl5 order by col51;
 col51 |     col52     |  col53  |          col54          
-------+---------------+---------+-------------------------
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010}
(1 row)

select * from mySchema2.myTbl6 order by col61;
 col61 |  col62  |    col63    |   col64   |         col65         |     col66      
-------+---------+-------------+-----------+-----------------------+----------------
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
(5 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    11872
     2 | ABC        | \x0c  | INS       | NEW        |    11873
     3 | ABC        | \x0c  | INS       | NEW        |    11874
     4 | ABC        | \x0c  | INS       | NEW        |    11875
     5 | ABC        | \x0c  | INS       | NEW        |    11876
     6 | ABC        | \x0c  | INS       | NEW        |    11877
     7 | ABC        | \x0c  | INS       | NEW        |    11878
     8 | ABC        | \x0c  | INS       | NEW        |    11879
     9 | ABC        | \x0c  | INS       | NEW        |    11880
    10 | ABC        | \x0c  | INS       | NEW        |    11881
    11 | ABC        | \x0c  | INS       | NEW        |    11882
     1 | ABC        | \x0c  | UPD       | OLD        |    11883
     1 | ABC        | \x1c  | UPD       | NEW        |    11883
     2 | ABC        | \x0c  | UPD       | OLD        |    11884
     2 | ABC        | \x1c  | UPD       | NEW        |    11884
     3 | ABC        | \x0c  | UPD       | OLD        |    11885
     3 | ABC        | \x1c  | UPD       | NEW        |    11885
    11 | ABC        | \x0c  | DEL       | OLD        |    11887
(18 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 01-01-2010 | INS       | NEW        |    11886
     2 | DEF   |            | INS       | NEW        |    11888
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | INS       | NEW        |    11889
    12 | 10.00 | INS       | NEW        |    11890
    13 | 10.00 | INS       | NEW        |    11891
    14 | 10.00 | INS       | NEW        |    11892
    15 | 10.00 | INS       | NEW        |    11893
    16 | 10.00 | INS       | NEW        |    11894
    17 | 10.00 | INS       | NEW        |    11895
    18 | 10.00 | INS       | NEW        |    11896
    19 | 10.00 | INS       | NEW        |    11897
    20 | 10.00 | INS       | NEW        |    11898
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11913
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11914
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11915
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11915
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11916
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11916
(6 rows)

select col51, col52, col53, col54, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl5_log order by emaj_gid, emaj_tuple desc;
 col51 |     col52     |  col53  |          col54          | emaj_verb | emaj_tuple | emaj_gid 
-------+---------------+---------+-------------------------+-----------+------------+----------
     1 | {abc,def,ghi} | {1,2,3} |                         | INS       | NEW        |    11899
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | INS       | NEW        |    11900
     1 | {abc,def,ghi} | {1,2,3} |                         | UPD       | OLD        |    11901
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010} | UPD       | NEW        |    11901
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | DEL       | OLD        |    11917
(5 rows)

select col61, col62, col63, col64, col65, col66, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl6_log order by emaj_gid, emaj_tuple desc;
 col61 |  col62  |    col63    |    col64    |         col65         |     col66      | emaj_verb | emaj_tuple | emaj_gid 
-------+---------+-------------+-------------+-----------------------+----------------+-----------+------------+----------
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11902
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11903
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11904
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11905
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11906
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11907
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11908
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11909
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11910
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11910
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11911
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11911
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11912
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11912
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11918
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11919
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11920
(17 rows)

-----------------------------
-- Step 3 : for myGroup2, double logged rollback then delete first mark 
-----------------------------
reset role;
analyze mytbl4;
set role emaj_regression_tests_adm_user;
select emaj.emaj_logged_rollback_group('myGroup2','M2');
 emaj_logged_rollback_group 
----------------------------
                          5
(1 row)

select emaj.emaj_logged_rollback_group('myGroup2','M3');
 emaj_logged_rollback_group 
----------------------------
                          5
(1 row)

-----------------------------
-- Checking step 3
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace  | mark_global_seq | mark_state |  mark_comment  | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+-----------------+-----------------+------------+----------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1              |           11833 | ACTIVE     |                |                   599 |                   608 |                        27
     602 | myGroup2   | M1              |           11833 | ACTIVE     |                |                   599 |                   616 |                        41
     603 | myGroup1   | M2              |           11860 | ACTIVE     |                |                   599 |                   622 |                        11
     604 | myGroup1   | M3              |           11871 | ACTIVE     | Third mark set |                   599 |                   628 |                          
     605 | myGroup2   | M2              |           11912 | ACTIVE     |                |                   599 |                   636 |                         8
     606 | myGroup2   | M3              |           11920 | ACTIVE     |                |                   599 |                   644 |                         0
     607 | myGroup2   | RLBK_M2_%_START |           11920 | ACTIVE     |                |                   599 |                   652 |                         8
     608 | myGroup2   | RLBK_M2_%_DONE  |           11928 | ACTIVE     |                |                   599 |                   660 |                         0
     609 | myGroup2   | RLBK_M3_%_START |           11928 | ACTIVE     |                |                   599 |                   668 |                         8
     610 | myGroup2   | RLBK_M3_%_DONE  |           11936 | ACTIVE     |                |                   599 |                   676 |                          
(10 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace  | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+-----------------+---------------+----------------
     603 | myschema1   | myTbl3_col31_seq          | M1              |            11 | f
     604 | emajC       | myschema1_myTbl3_log_seq  | M1              |             1 | f
     605 | emaj        | myschema1_mytbl1_log_seq  | M1              |             1 | f
     606 | emaj        | myschema1_mytbl4_log_seq  | M1              |             1 | f
     607 | emaj        | myschema1_mytbl2_log_seq  | M1              |             1 | f
     608 | emajb       | myschema1_mytbl2b_log_seq | M1              |             1 | f
     609 | myschema2   | myseq1                    | M1              |          1000 | f
     610 | emaj        | myschema2_mytbl1_log_seq  | M1              |             1 | f
     611 | emaj        | myschema2_mytbl2_log_seq  | M1              |             1 | f
     612 | emajC       | myschema2_myTbl3_log_seq  | M1              |             1 | f
     613 | myschema2   | myTbl3_col31_seq          | M1              |            10 | t
     614 | emaj        | myschema2_mytbl4_log_seq  | M1              |             1 | f
     615 | emaj        | myschema2_mytbl5_log_seq  | M1              |             1 | f
     616 | emaj        | myschema2_mytbl6_log_seq  | M1              |             1 | f
     617 | myschema1   | myTbl3_col31_seq          | M2              |            20 | t
     618 | emajC       | myschema1_myTbl3_log_seq  | M2              |            10 | t
     619 | emaj        | myschema1_mytbl1_log_seq  | M2              |            15 | t
     620 | emaj        | myschema1_mytbl4_log_seq  | M2              |             1 | f
     621 | emaj        | myschema1_mytbl2_log_seq  | M2              |             2 | t
     622 | emajb       | myschema1_mytbl2b_log_seq | M2              |             1 | f
     623 | myschema1   | myTbl3_col31_seq          | M3              |            20 | t
     624 | emajC       | myschema1_myTbl3_log_seq  | M3              |            10 | t
     625 | emaj        | myschema1_mytbl1_log_seq  | M3              |            18 | t
     626 | emaj        | myschema1_mytbl4_log_seq  | M3              |             8 | t
     627 | emaj        | myschema1_mytbl2_log_seq  | M3              |             2 | t
     628 | emajb       | myschema1_mytbl2b_log_seq | M3              |             1 | f
     629 | myschema2   | myseq1                    | M2              |          1000 | t
     630 | emaj        | myschema2_mytbl1_log_seq  | M2              |            15 | t
     631 | emaj        | myschema2_mytbl2_log_seq  | M2              |             2 | t
     632 | emajC       | myschema2_myTbl3_log_seq  | M2              |            10 | t
     633 | myschema2   | myTbl3_col31_seq          | M2              |            20 | t
     634 | emaj        | myschema2_mytbl4_log_seq  | M2              |             1 | f
     635 | emaj        | myschema2_mytbl5_log_seq  | M2              |             3 | t
     636 | emaj        | myschema2_mytbl6_log_seq  | M2              |            11 | t
     637 | myschema2   | myseq1                    | M3              |          1003 | t
     638 | emaj        | myschema2_mytbl1_log_seq  | M3              |            15 | t
     639 | emaj        | myschema2_mytbl2_log_seq  | M3              |             2 | t
     640 | emajC       | myschema2_myTbl3_log_seq  | M3              |            10 | t
     641 | myschema2   | myTbl3_col31_seq          | M3              |            20 | t
     642 | emaj        | myschema2_mytbl4_log_seq  | M3              |             4 | t
     643 | emaj        | myschema2_mytbl5_log_seq  | M3              |             4 | t
     644 | emaj        | myschema2_mytbl6_log_seq  | M3              |            14 | t
     645 | myschema2   | myseq1                    | RLBK_M2_%_START |          1003 | t
     646 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
     647 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
     648 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
     649 | myschema2   | myTbl3_col31_seq          | RLBK_M2_%_START |            20 | t
     650 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M2_%_START |             4 | t
     651 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M2_%_START |             4 | t
     652 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M2_%_START |            14 | t
     653 | myschema2   | myseq1                    | RLBK_M2_%_DONE  |          1001 | f
     654 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
     655 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
     656 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
     657 | myschema2   | myTbl3_col31_seq          | RLBK_M2_%_DONE  |            20 | t
     658 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M2_%_DONE  |             8 | t
     659 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M2_%_DONE  |             5 | t
     660 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M2_%_DONE  |            17 | t
     661 | myschema2   | myseq1                    | RLBK_M3_%_START |          1001 | f
     662 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_START |            15 | t
     663 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_START |             2 | t
     664 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_START |            10 | t
     665 | myschema2   | myTbl3_col31_seq          | RLBK_M3_%_START |            20 | t
     666 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M3_%_START |             8 | t
     667 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M3_%_START |             5 | t
     668 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M3_%_START |            17 | t
     669 | myschema2   | myseq1                    | RLBK_M3_%_DONE  |          1004 | f
     670 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_DONE  |            15 | t
     671 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_DONE  |             2 | t
     672 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_DONE  |            10 | t
     673 | myschema2   | myTbl3_col31_seq          | RLBK_M3_%_DONE  |            20 | t
     674 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M3_%_DONE  |            12 | t
     675 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M3_%_DONE  |             6 | t
     676 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M3_%_DONE  |            20 | t
(74 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 01-01-2010
     2 | DEF   | 
(2 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

select * from mySchema2.myTbl5 order by col51;
 col51 |     col52     |  col53  |          col54          
-------+---------------+---------+-------------------------
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010}
(1 row)

select * from mySchema2.myTbl6 order by col61;
 col61 |  col62  |    col63    |   col64   |         col65         |     col66      
-------+---------+-------------+-----------+-----------------------+----------------
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
(5 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    11872
     2 | ABC        | \x0c  | INS       | NEW        |    11873
     3 | ABC        | \x0c  | INS       | NEW        |    11874
     4 | ABC        | \x0c  | INS       | NEW        |    11875
     5 | ABC        | \x0c  | INS       | NEW        |    11876
     6 | ABC        | \x0c  | INS       | NEW        |    11877
     7 | ABC        | \x0c  | INS       | NEW        |    11878
     8 | ABC        | \x0c  | INS       | NEW        |    11879
     9 | ABC        | \x0c  | INS       | NEW        |    11880
    10 | ABC        | \x0c  | INS       | NEW        |    11881
    11 | ABC        | \x0c  | INS       | NEW        |    11882
     1 | ABC        | \x0c  | UPD       | OLD        |    11883
     1 | ABC        | \x1c  | UPD       | NEW        |    11883
     2 | ABC        | \x0c  | UPD       | OLD        |    11884
     2 | ABC        | \x1c  | UPD       | NEW        |    11884
     3 | ABC        | \x0c  | UPD       | OLD        |    11885
     3 | ABC        | \x1c  | UPD       | NEW        |    11885
    11 | ABC        | \x0c  | DEL       | OLD        |    11887
(18 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 01-01-2010 | INS       | NEW        |    11886
     2 | DEF   |            | INS       | NEW        |    11888
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | INS       | NEW        |    11889
    12 | 10.00 | INS       | NEW        |    11890
    13 | 10.00 | INS       | NEW        |    11891
    14 | 10.00 | INS       | NEW        |    11892
    15 | 10.00 | INS       | NEW        |    11893
    16 | 10.00 | INS       | NEW        |    11894
    17 | 10.00 | INS       | NEW        |    11895
    18 | 10.00 | INS       | NEW        |    11896
    19 | 10.00 | INS       | NEW        |    11897
    20 | 10.00 | INS       | NEW        |    11898
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11913
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11914
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11915
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11915
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11916
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11916
     2 | FK... |     2 |     1 | ABC        | UPD       | OLD        |    11921
     2 | FK... |     1 |     1 | ABC        | UPD       | NEW        |    11921
     1 | FK... |     2 |     1 | ABC        | UPD       | OLD        |    11922
     1 | FK... |     1 |     1 | ABC        | UPD       | NEW        |    11922
     2 | FK... |     1 |     1 | ABC        | DEL       | OLD        |    11923
     1 | FK... |     1 |     1 | ABC        | DEL       | OLD        |    11924
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11929
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11930
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11931
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11931
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11932
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11932
(18 rows)

select col51, col52, col53, col54, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl5_log order by emaj_gid, emaj_tuple desc;
 col51 |     col52     |  col53  |          col54          | emaj_verb | emaj_tuple | emaj_gid 
-------+---------------+---------+-------------------------+-----------+------------+----------
     1 | {abc,def,ghi} | {1,2,3} |                         | INS       | NEW        |    11899
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | INS       | NEW        |    11900
     1 | {abc,def,ghi} | {1,2,3} |                         | UPD       | OLD        |    11901
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010} | UPD       | NEW        |    11901
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | DEL       | OLD        |    11917
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | INS       | NEW        |    11925
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | DEL       | OLD        |    11933
(7 rows)

select col61, col62, col63, col64, col65, col66, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl6_log order by emaj_gid, emaj_tuple desc;
 col61 |  col62  |    col63    |    col64    |         col65         |     col66      | emaj_verb | emaj_tuple | emaj_gid 
-------+---------+-------------+-------------+-----------------------+----------------+-----------+------------+----------
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11902
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11903
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11904
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11905
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11906
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11907
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11908
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11909
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11910
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11910
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11911
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11911
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11912
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11912
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11918
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11919
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11920
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | INS       | NEW        |    11926
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | INS       | NEW        |    11927
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | INS       | NEW        |    11928
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11934
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11935
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11936
(23 rows)

-----------------------------
-- Step 4 : for myGroup1, rollback then update tables then set 3 marks
-----------------------------
select emaj.emaj_rollback_group('myGroup1','M2');
 emaj_rollback_group 
---------------------
                   3
(1 row)

--
set search_path=myschema1;
insert into myTbl1 select i, 'DEF', E'\\000'::bytea from generate_series (100,110) as i;
insert into myTbl2 values (3,'GHI','2010-01-02');
delete from myTbl1 where col11 = 1;
--
select emaj.emaj_set_mark_group('myGroup1','M4');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

--
update "myTbl3" set col33 = col33 / 2;
--
select emaj.emaj_set_mark_group('myGroup1','M5');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

--
update myTbl1 set col11 = 99 where col11 = 1;
--
select emaj.emaj_set_mark_group('myGroup1','M6');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

-----------------------------
-- Checking step 4
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace  | mark_global_seq | mark_state | mark_comment | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+-----------------+-----------------+------------+--------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1              |           11833 | ACTIVE     |              |                   599 |                   608 |                        27
     602 | myGroup2   | M1              |           11833 | ACTIVE     |              |                   599 |                   616 |                        41
     603 | myGroup1   | M2              |           11860 | ACTIVE     |              |                   599 |                   622 |                        13
     605 | myGroup2   | M2              |           11912 | ACTIVE     |              |                   599 |                   636 |                         8
     606 | myGroup2   | M3              |           11920 | ACTIVE     |              |                   599 |                   644 |                         0
     607 | myGroup2   | RLBK_M2_%_START |           11920 | ACTIVE     |              |                   599 |                   652 |                         8
     608 | myGroup2   | RLBK_M2_%_DONE  |           11928 | ACTIVE     |              |                   599 |                   660 |                         0
     609 | myGroup2   | RLBK_M3_%_START |           11928 | ACTIVE     |              |                   599 |                   668 |                         8
     610 | myGroup2   | RLBK_M3_%_DONE  |           11936 | ACTIVE     |              |                   599 |                   676 |                          
     611 | myGroup1   | M4              |           11949 | ACTIVE     |              |                   601 |                   682 |                        10
     612 | myGroup1   | M5              |           11959 | ACTIVE     |              |                   601 |                   688 |                         0
     613 | myGroup1   | M6              |           11959 | ACTIVE     |              |                   601 |                   694 |                          
(12 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace  | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+-----------------+---------------+----------------
     603 | myschema1   | myTbl3_col31_seq          | M1              |            11 | f
     604 | emajC       | myschema1_myTbl3_log_seq  | M1              |             1 | f
     605 | emaj        | myschema1_mytbl1_log_seq  | M1              |             1 | f
     606 | emaj        | myschema1_mytbl4_log_seq  | M1              |             1 | f
     607 | emaj        | myschema1_mytbl2_log_seq  | M1              |             1 | f
     608 | emajb       | myschema1_mytbl2b_log_seq | M1              |             1 | f
     609 | myschema2   | myseq1                    | M1              |          1000 | f
     610 | emaj        | myschema2_mytbl1_log_seq  | M1              |             1 | f
     611 | emaj        | myschema2_mytbl2_log_seq  | M1              |             1 | f
     612 | emajC       | myschema2_myTbl3_log_seq  | M1              |             1 | f
     613 | myschema2   | myTbl3_col31_seq          | M1              |            10 | t
     614 | emaj        | myschema2_mytbl4_log_seq  | M1              |             1 | f
     615 | emaj        | myschema2_mytbl5_log_seq  | M1              |             1 | f
     616 | emaj        | myschema2_mytbl6_log_seq  | M1              |             1 | f
     617 | myschema1   | myTbl3_col31_seq          | M2              |            20 | t
     618 | emajC       | myschema1_myTbl3_log_seq  | M2              |            10 | t
     619 | emaj        | myschema1_mytbl1_log_seq  | M2              |            15 | t
     620 | emaj        | myschema1_mytbl4_log_seq  | M2              |             1 | f
     621 | emaj        | myschema1_mytbl2_log_seq  | M2              |             2 | t
     622 | emajb       | myschema1_mytbl2b_log_seq | M2              |             1 | f
     624 | emajC       | myschema1_myTbl3_log_seq  | M3              |            10 | t
     627 | emaj        | myschema1_mytbl2_log_seq  | M3              |             2 | t
     628 | emajb       | myschema1_mytbl2b_log_seq | M3              |             1 | f
     629 | myschema2   | myseq1                    | M2              |          1000 | t
     630 | emaj        | myschema2_mytbl1_log_seq  | M2              |            15 | t
     631 | emaj        | myschema2_mytbl2_log_seq  | M2              |             2 | t
     632 | emajC       | myschema2_myTbl3_log_seq  | M2              |            10 | t
     633 | myschema2   | myTbl3_col31_seq          | M2              |            20 | t
     634 | emaj        | myschema2_mytbl4_log_seq  | M2              |             1 | f
     635 | emaj        | myschema2_mytbl5_log_seq  | M2              |             3 | t
     636 | emaj        | myschema2_mytbl6_log_seq  | M2              |            11 | t
     637 | myschema2   | myseq1                    | M3              |          1003 | t
     638 | emaj        | myschema2_mytbl1_log_seq  | M3              |            15 | t
     639 | emaj        | myschema2_mytbl2_log_seq  | M3              |             2 | t
     640 | emajC       | myschema2_myTbl3_log_seq  | M3              |            10 | t
     641 | myschema2   | myTbl3_col31_seq          | M3              |            20 | t
     642 | emaj        | myschema2_mytbl4_log_seq  | M3              |             4 | t
     643 | emaj        | myschema2_mytbl5_log_seq  | M3              |             4 | t
     644 | emaj        | myschema2_mytbl6_log_seq  | M3              |            14 | t
     645 | myschema2   | myseq1                    | RLBK_M2_%_START |          1003 | t
     646 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
     647 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
     648 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
     649 | myschema2   | myTbl3_col31_seq          | RLBK_M2_%_START |            20 | t
     650 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M2_%_START |             4 | t
     651 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M2_%_START |             4 | t
     652 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M2_%_START |            14 | t
     653 | myschema2   | myseq1                    | RLBK_M2_%_DONE  |          1001 | f
     654 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
     655 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
     656 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
     657 | myschema2   | myTbl3_col31_seq          | RLBK_M2_%_DONE  |            20 | t
     658 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M2_%_DONE  |             8 | t
     659 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M2_%_DONE  |             5 | t
     660 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M2_%_DONE  |            17 | t
     661 | myschema2   | myseq1                    | RLBK_M3_%_START |          1001 | f
     662 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_START |            15 | t
     663 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_START |             2 | t
     664 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_START |            10 | t
     665 | myschema2   | myTbl3_col31_seq          | RLBK_M3_%_START |            20 | t
     666 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M3_%_START |             8 | t
     667 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M3_%_START |             5 | t
     668 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M3_%_START |            17 | t
     669 | myschema2   | myseq1                    | RLBK_M3_%_DONE  |          1004 | f
     670 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_DONE  |            15 | t
     671 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_DONE  |             2 | t
     672 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_DONE  |            10 | t
     673 | myschema2   | myTbl3_col31_seq          | RLBK_M3_%_DONE  |            20 | t
     674 | emaj        | myschema2_mytbl4_log_seq  | RLBK_M3_%_DONE  |            12 | t
     675 | emaj        | myschema2_mytbl5_log_seq  | RLBK_M3_%_DONE  |             6 | t
     676 | emaj        | myschema2_mytbl6_log_seq  | RLBK_M3_%_DONE  |            20 | t
     677 | myschema1   | myTbl3_col31_seq          | M4              |            20 | t
     678 | emajC       | myschema1_myTbl3_log_seq  | M4              |            10 | t
     679 | emaj        | myschema1_mytbl1_log_seq  | M4              |            30 | t
     680 | emaj        | myschema1_mytbl4_log_seq  | M4              |             8 | t
     681 | emaj        | myschema1_mytbl2_log_seq  | M4              |             3 | t
     682 | emajb       | myschema1_mytbl2b_log_seq | M4              |             1 | f
     683 | myschema1   | myTbl3_col31_seq          | M5              |            20 | t
     684 | emajC       | myschema1_myTbl3_log_seq  | M5              |            20 | t
     685 | emaj        | myschema1_mytbl1_log_seq  | M5              |            30 | t
     686 | emaj        | myschema1_mytbl4_log_seq  | M5              |             8 | t
     687 | emaj        | myschema1_mytbl2_log_seq  | M5              |             3 | t
     688 | emajb       | myschema1_mytbl2b_log_seq | M5              |             1 | f
     689 | myschema1   | myTbl3_col31_seq          | M6              |            20 | t
     690 | emajC       | myschema1_myTbl3_log_seq  | M6              |            20 | t
     691 | emaj        | myschema1_mytbl1_log_seq  | M6              |            30 | t
     692 | emaj        | myschema1_mytbl4_log_seq  | M6              |             8 | t
     693 | emaj        | myschema1_mytbl2_log_seq  | M6              |             3 | t
     694 | emajb       | myschema1_mytbl2b_log_seq | M6              |             1 | f
(89 rows)

-- user tables
select * from mySchema1.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
   100 | DEF        | \x00
   101 | DEF        | \x00
   102 | DEF        | \x00
   103 | DEF        | \x00
   104 | DEF        | \x00
   105 | DEF        | \x00
   106 | DEF        | \x00
   107 | DEF        | \x00
   108 | DEF        | \x00
   109 | DEF        | \x00
   110 | DEF        | \x00
(20 rows)

select * from mySchema1.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 12-31-2010
     2 | DEF   | 
     3 | GHI   | 01-02-2010
(3 rows)

select * from mySchema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

select col31,col33 from mySchema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 |  5.00
    12 |  5.00
    13 |  5.00
    14 |  5.00
    15 |  5.00
    16 |  5.00
    17 |  5.00
    18 |  5.00
    19 |  5.00
    20 |  5.00
(10 rows)

select * from mySchema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    11834
     2 | ABC        | \x0c  | INS       | NEW        |    11835
     3 | ABC        | \x0c  | INS       | NEW        |    11836
     4 | ABC        | \x0c  | INS       | NEW        |    11837
     5 | ABC        | \x0c  | INS       | NEW        |    11838
     6 | ABC        | \x0c  | INS       | NEW        |    11839
     7 | ABC        | \x0c  | INS       | NEW        |    11840
     8 | ABC        | \x0c  | INS       | NEW        |    11841
     9 | ABC        | \x0c  | INS       | NEW        |    11842
    10 | ABC        | \x0c  | INS       | NEW        |    11843
    11 | ABC        | \x0c  | INS       | NEW        |    11844
     1 | ABC        | \x0c  | UPD       | OLD        |    11845
     1 | ABC        | \x1c  | UPD       | NEW        |    11845
     2 | ABC        | \x0c  | UPD       | OLD        |    11846
     2 | ABC        | \x1c  | UPD       | NEW        |    11846
     3 | ABC        | \x0c  | UPD       | OLD        |    11847
     3 | ABC        | \x1c  | UPD       | NEW        |    11847
    11 | ABC        | \x0c  | DEL       | OLD        |    11849
   100 | DEF        | \x00  | INS       | NEW        |    11937
   101 | DEF        | \x00  | INS       | NEW        |    11938
   102 | DEF        | \x00  | INS       | NEW        |    11939
   103 | DEF        | \x00  | INS       | NEW        |    11940
   104 | DEF        | \x00  | INS       | NEW        |    11941
   105 | DEF        | \x00  | INS       | NEW        |    11942
   106 | DEF        | \x00  | INS       | NEW        |    11943
   107 | DEF        | \x00  | INS       | NEW        |    11944
   108 | DEF        | \x00  | INS       | NEW        |    11945
   109 | DEF        | \x00  | INS       | NEW        |    11946
   110 | DEF        | \x00  | INS       | NEW        |    11947
     1 | ABC        | \x1c  | DEL       | OLD        |    11949
(30 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 12-31-2010 | INS       | NEW        |    11848
     2 | DEF   |            | INS       | NEW        |    11850
     3 | GHI   | 01-02-2010 | INS       | NEW        |    11948
(3 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.mySchema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | INS       | NEW        |    11851
    12 | 10.00 | INS       | NEW        |    11852
    13 | 10.00 | INS       | NEW        |    11853
    14 | 10.00 | INS       | NEW        |    11854
    15 | 10.00 | INS       | NEW        |    11855
    16 | 10.00 | INS       | NEW        |    11856
    17 | 10.00 | INS       | NEW        |    11857
    18 | 10.00 | INS       | NEW        |    11858
    19 | 10.00 | INS       | NEW        |    11859
    20 | 10.00 | INS       | NEW        |    11860
    11 | 10.00 | UPD       | OLD        |    11950
    11 |  5.00 | UPD       | NEW        |    11950
    12 | 10.00 | UPD       | OLD        |    11951
    12 |  5.00 | UPD       | NEW        |    11951
    13 | 10.00 | UPD       | OLD        |    11952
    13 |  5.00 | UPD       | NEW        |    11952
    14 | 10.00 | UPD       | OLD        |    11953
    14 |  5.00 | UPD       | NEW        |    11953
    15 | 10.00 | UPD       | OLD        |    11954
    15 |  5.00 | UPD       | NEW        |    11954
    16 | 10.00 | UPD       | OLD        |    11955
    16 |  5.00 | UPD       | NEW        |    11955
    17 | 10.00 | UPD       | OLD        |    11956
    17 |  5.00 | UPD       | NEW        |    11956
    18 | 10.00 | UPD       | OLD        |    11957
    18 |  5.00 | UPD       | NEW        |    11957
    19 | 10.00 | UPD       | OLD        |    11958
    19 |  5.00 | UPD       | NEW        |    11958
    20 | 10.00 | UPD       | OLD        |    11959
    20 |  5.00 | UPD       | NEW        |    11959
(30 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 | col45 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-------+-----------+------------+----------
(0 rows)

-----------------------------
-- Step 5 : for myGroup2, logged rollback again then unlogged rollback 
-----------------------------
select emaj.emaj_logged_rollback_group('myGroup2','M2');
 emaj_logged_rollback_group 
----------------------------
                          5
(1 row)

--
select emaj.emaj_rollback_group('myGroup2','M3');
 emaj_rollback_group 
---------------------
                   5
(1 row)

-----------------------------
-- Checking step 5
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace | mark_global_seq | mark_state | mark_comment | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+----------------+-----------------+------------+--------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1             |           11833 | ACTIVE     |              |                   599 |                   608 |                        27
     602 | myGroup2   | M1             |           11833 | ACTIVE     |              |                   599 |                   616 |                        41
     603 | myGroup1   | M2             |           11860 | ACTIVE     |              |                   599 |                   622 |                        13
     605 | myGroup2   | M2             |           11912 | ACTIVE     |              |                   599 |                   636 |                         8
     606 | myGroup2   | M3             |           11920 | ACTIVE     |              |                   599 |                   644 |                          
     611 | myGroup1   | M4             |           11949 | ACTIVE     |              |                   601 |                   682 |                        10
     612 | myGroup1   | M5             |           11959 | ACTIVE     |              |                   601 |                   688 |                         0
     613 | myGroup1   | M6             |           11959 | ACTIVE     |              |                   601 |                   694 |                          
(8 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace  | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+-----------------+---------------+----------------
     603 | myschema1   | myTbl3_col31_seq          | M1              |            11 | f
     604 | emajC       | myschema1_myTbl3_log_seq  | M1              |             1 | f
     605 | emaj        | myschema1_mytbl1_log_seq  | M1              |             1 | f
     606 | emaj        | myschema1_mytbl4_log_seq  | M1              |             1 | f
     607 | emaj        | myschema1_mytbl2_log_seq  | M1              |             1 | f
     608 | emajb       | myschema1_mytbl2b_log_seq | M1              |             1 | f
     609 | myschema2   | myseq1                    | M1              |          1000 | f
     610 | emaj        | myschema2_mytbl1_log_seq  | M1              |             1 | f
     611 | emaj        | myschema2_mytbl2_log_seq  | M1              |             1 | f
     612 | emajC       | myschema2_myTbl3_log_seq  | M1              |             1 | f
     613 | myschema2   | myTbl3_col31_seq          | M1              |            10 | t
     614 | emaj        | myschema2_mytbl4_log_seq  | M1              |             1 | f
     615 | emaj        | myschema2_mytbl5_log_seq  | M1              |             1 | f
     616 | emaj        | myschema2_mytbl6_log_seq  | M1              |             1 | f
     617 | myschema1   | myTbl3_col31_seq          | M2              |            20 | t
     618 | emajC       | myschema1_myTbl3_log_seq  | M2              |            10 | t
     619 | emaj        | myschema1_mytbl1_log_seq  | M2              |            15 | t
     620 | emaj        | myschema1_mytbl4_log_seq  | M2              |             1 | f
     621 | emaj        | myschema1_mytbl2_log_seq  | M2              |             2 | t
     622 | emajb       | myschema1_mytbl2b_log_seq | M2              |             1 | f
     624 | emajC       | myschema1_myTbl3_log_seq  | M3              |            10 | t
     627 | emaj        | myschema1_mytbl2_log_seq  | M3              |             2 | t
     628 | emajb       | myschema1_mytbl2b_log_seq | M3              |             1 | f
     629 | myschema2   | myseq1                    | M2              |          1000 | t
     630 | emaj        | myschema2_mytbl1_log_seq  | M2              |            15 | t
     631 | emaj        | myschema2_mytbl2_log_seq  | M2              |             2 | t
     632 | emajC       | myschema2_myTbl3_log_seq  | M2              |            10 | t
     633 | myschema2   | myTbl3_col31_seq          | M2              |            20 | t
     634 | emaj        | myschema2_mytbl4_log_seq  | M2              |             1 | f
     635 | emaj        | myschema2_mytbl5_log_seq  | M2              |             3 | t
     636 | emaj        | myschema2_mytbl6_log_seq  | M2              |            11 | t
     637 | myschema2   | myseq1                    | M3              |          1003 | t
     638 | emaj        | myschema2_mytbl1_log_seq  | M3              |            15 | t
     639 | emaj        | myschema2_mytbl2_log_seq  | M3              |             2 | t
     640 | emajC       | myschema2_myTbl3_log_seq  | M3              |            10 | t
     641 | myschema2   | myTbl3_col31_seq          | M3              |            20 | t
     642 | emaj        | myschema2_mytbl4_log_seq  | M3              |             4 | t
     643 | emaj        | myschema2_mytbl5_log_seq  | M3              |             4 | t
     644 | emaj        | myschema2_mytbl6_log_seq  | M3              |            14 | t
     646 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
     647 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
     648 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
     654 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
     655 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
     656 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
     662 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_START |            15 | t
     663 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_START |             2 | t
     664 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_START |            10 | t
     670 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_DONE  |            15 | t
     671 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_DONE  |             2 | t
     672 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_DONE  |            10 | t
     677 | myschema1   | myTbl3_col31_seq          | M4              |            20 | t
     678 | emajC       | myschema1_myTbl3_log_seq  | M4              |            10 | t
     679 | emaj        | myschema1_mytbl1_log_seq  | M4              |            30 | t
     680 | emaj        | myschema1_mytbl4_log_seq  | M4              |             8 | t
     681 | emaj        | myschema1_mytbl2_log_seq  | M4              |             3 | t
     682 | emajb       | myschema1_mytbl2b_log_seq | M4              |             1 | f
     683 | myschema1   | myTbl3_col31_seq          | M5              |            20 | t
     684 | emajC       | myschema1_myTbl3_log_seq  | M5              |            20 | t
     685 | emaj        | myschema1_mytbl1_log_seq  | M5              |            30 | t
     686 | emaj        | myschema1_mytbl4_log_seq  | M5              |             8 | t
     687 | emaj        | myschema1_mytbl2_log_seq  | M5              |             3 | t
     688 | emajb       | myschema1_mytbl2b_log_seq | M5              |             1 | f
     689 | myschema1   | myTbl3_col31_seq          | M6              |            20 | t
     690 | emajC       | myschema1_myTbl3_log_seq  | M6              |            20 | t
     691 | emaj        | myschema1_mytbl1_log_seq  | M6              |            30 | t
     692 | emaj        | myschema1_mytbl4_log_seq  | M6              |             8 | t
     693 | emaj        | myschema1_mytbl2_log_seq  | M6              |             3 | t
     694 | emajb       | myschema1_mytbl2b_log_seq | M6              |             1 | f
     696 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
     697 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
     698 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
     704 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
     705 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
     706 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
(75 rows)

select * from emaj.emaj_fk order by fk_groups, fk_session, fk_name;
 fk_groups  | fk_session |      fk_name      | fk_schema | fk_table |    fk_action     |                                                                 fk_def                                                                  
------------+------------+-------------------+-----------+----------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------
 {myGroup1} |          1 | mytbl4_col43_fkey | myschema1 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES myschema1.mytbl2(col21) DEFERRABLE
 {myGroup1} |          1 | mytbl4_col44_fkey | myschema1 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES myschema1.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col43_fkey | myschema2 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES myschema2.mytbl2(col21) DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col44_fkey | myschema2 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES myschema2.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE
(4 rows)

select sqhl_id, sqhl_schema, sqhl_table, sqhl_hole_size from emaj.emaj_seq_hole order by sqhl_id;
 sqhl_id | sqhl_schema | sqhl_table | sqhl_hole_size 
---------+-------------+------------+----------------
     600 | myschema1   | mytbl1     |              3
     601 | myschema1   | mytbl4     |              8
     602 | myschema2   | mytbl4     |             20
     603 | myschema2   | mytbl5     |              5
     604 | myschema2   | mytbl6     |             15
(5 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 01-01-2010
     2 | DEF   | 
(2 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

select * from mySchema2.myTbl5 order by col51;
 col51 |     col52     |  col53  |          col54          
-------+---------------+---------+-------------------------
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010}
(1 row)

select * from mySchema2.myTbl6 order by col61;
 col61 |  col62  |    col63    |   col64   |         col65         |     col66      
-------+---------+-------------+-----------+-----------------------+----------------
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8> | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27
(5 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    11872
     2 | ABC        | \x0c  | INS       | NEW        |    11873
     3 | ABC        | \x0c  | INS       | NEW        |    11874
     4 | ABC        | \x0c  | INS       | NEW        |    11875
     5 | ABC        | \x0c  | INS       | NEW        |    11876
     6 | ABC        | \x0c  | INS       | NEW        |    11877
     7 | ABC        | \x0c  | INS       | NEW        |    11878
     8 | ABC        | \x0c  | INS       | NEW        |    11879
     9 | ABC        | \x0c  | INS       | NEW        |    11880
    10 | ABC        | \x0c  | INS       | NEW        |    11881
    11 | ABC        | \x0c  | INS       | NEW        |    11882
     1 | ABC        | \x0c  | UPD       | OLD        |    11883
     1 | ABC        | \x1c  | UPD       | NEW        |    11883
     2 | ABC        | \x0c  | UPD       | OLD        |    11884
     2 | ABC        | \x1c  | UPD       | NEW        |    11884
     3 | ABC        | \x0c  | UPD       | OLD        |    11885
     3 | ABC        | \x1c  | UPD       | NEW        |    11885
    11 | ABC        | \x0c  | DEL       | OLD        |    11887
(18 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 01-01-2010 | INS       | NEW        |    11886
     2 | DEF   |            | INS       | NEW        |    11888
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | INS       | NEW        |    11889
    12 | 10.00 | INS       | NEW        |    11890
    13 | 10.00 | INS       | NEW        |    11891
    14 | 10.00 | INS       | NEW        |    11892
    15 | 10.00 | INS       | NEW        |    11893
    16 | 10.00 | INS       | NEW        |    11894
    17 | 10.00 | INS       | NEW        |    11895
    18 | 10.00 | INS       | NEW        |    11896
    19 | 10.00 | INS       | NEW        |    11897
    20 | 10.00 | INS       | NEW        |    11898
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11913
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |    11914
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11915
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11915
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |    11916
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |    11916
(6 rows)

select col51, col52, col53, col54, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl5_log order by emaj_gid, emaj_tuple desc;
 col51 |     col52     |  col53  |          col54          | emaj_verb | emaj_tuple | emaj_gid 
-------+---------------+---------+-------------------------+-----------+------------+----------
     1 | {abc,def,ghi} | {1,2,3} |                         | INS       | NEW        |    11899
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | INS       | NEW        |    11900
     1 | {abc,def,ghi} | {1,2,3} |                         | UPD       | OLD        |    11901
     1 | {abc,def,ghi} | {1,2,3} | {11-28-2010,12-03-2010} | UPD       | NEW        |    11901
     2 | {abc,def,ghi} | {3,4,5} | {02-01-2000,02-28-2000} | DEL       | OLD        |    11917
(5 rows)

select col61, col62, col63, col64, col65, col66, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl6_log order by emaj_gid, emaj_tuple desc;
 col61 |  col62  |    col63    |    col64    |         col65         |     col66      | emaj_verb | emaj_tuple | emaj_gid 
-------+---------+-------------+-------------+-----------------------+----------------+-----------+------------+----------
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11902
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11903
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11904
     4 | (4,1.3) | (2,2),(0,0) | <(5,5),4>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11905
     5 | (5,1.3) | (2,2),(0,0) | <(5,5),5>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11906
     6 | (6,1.3) | (2,2),(0,0) | <(5,5),6>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11907
     7 | (7,1.3) | (2,2),(0,0) | <(5,5),7>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11908
     8 | (8,1.3) | (2,2),(0,0) | <(5,5),8>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | INS       | NEW        |    11909
     1 | (1,1.3) | (2,2),(0,0) | <(5,5),1>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11910
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11910
     2 | (2,1.3) | (2,2),(0,0) | <(5,5),2>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11911
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11911
     3 | (3,1.3) | (2,2),(0,0) | <(5,5),3>   | ((-2,-2),(3,0),(1,4)) | 10.20.30.40/27 | UPD       | OLD        |    11912
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | UPD       | NEW        |    11912
     1 | (1,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11918
     2 | (2,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11919
     3 | (3,1.3) | (2,2),(0,0) | <(5,6),3.5> |                       | 10.20.30.40/27 | DEL       | OLD        |    11920
(17 rows)

-----------------------------
-- Step 6 : for myGroup1, update tables, rollback, other updates, then logged rollback
-----------------------------
set search_path=myschema1;
--
insert into myTbl1 values (1, 'Step 6', E'\\000'::bytea);
insert into myTbl4 values (11,'FK...',1,1,'Step 6');
insert into myTbl4 values (12,'FK...',1,1,'Step 6');
--
select emaj.emaj_rollback_group('myGroup1','M5');
 emaj_rollback_group 
---------------------
                   3
(1 row)

--
insert into myTbl1 values (1, 'Step 6', E'\\001'::bytea);
insert into myTbl4 values (11,'',1,1,'Step 6');
insert into myTbl4 values (12,'',1,1,'Step 6');
--
select emaj.emaj_logged_rollback_group('myGroup1','M4');
 emaj_logged_rollback_group 
----------------------------
                          4
(1 row)

-----------------------------
-- Checking step 6
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group | regexp_replace  | mark_global_seq | mark_state | mark_comment | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+-----------------+-----------------+------------+--------------+-----------------------+-----------------------+---------------------------
     601 | myGroup1   | M1              |           11833 | ACTIVE     |              |                   599 |                   608 |                        27
     602 | myGroup2   | M1              |           11833 | ACTIVE     |              |                   599 |                   616 |                        41
     603 | myGroup1   | M2              |           11860 | ACTIVE     |              |                   599 |                   622 |                        13
     605 | myGroup2   | M2              |           11912 | ACTIVE     |              |                   599 |                   636 |                         8
     606 | myGroup2   | M3              |           11920 | ACTIVE     |              |                   599 |                   644 |                          
     611 | myGroup1   | M4              |           11949 | ACTIVE     |              |                   601 |                   682 |                        10
     612 | myGroup1   | M5              |           11959 | ACTIVE     |              |                   601 |                   688 |                         3
     616 | myGroup1   | RLBK_M4_%_START |           11989 | ACTIVE     |              |                   606 |                   716 |                        13
     617 | myGroup1   | RLBK_M4_%_DONE  |           12002 | ACTIVE     |              |                   606 |                   722 |                          
(9 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         | regexp_replace  | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+-----------------+---------------+----------------
     603 | myschema1   | myTbl3_col31_seq          | M1              |            11 | f
     604 | emajC       | myschema1_myTbl3_log_seq  | M1              |             1 | f
     605 | emaj        | myschema1_mytbl1_log_seq  | M1              |             1 | f
     606 | emaj        | myschema1_mytbl4_log_seq  | M1              |             1 | f
     607 | emaj        | myschema1_mytbl2_log_seq  | M1              |             1 | f
     608 | emajb       | myschema1_mytbl2b_log_seq | M1              |             1 | f
     609 | myschema2   | myseq1                    | M1              |          1000 | f
     610 | emaj        | myschema2_mytbl1_log_seq  | M1              |             1 | f
     611 | emaj        | myschema2_mytbl2_log_seq  | M1              |             1 | f
     612 | emajC       | myschema2_myTbl3_log_seq  | M1              |             1 | f
     613 | myschema2   | myTbl3_col31_seq          | M1              |            10 | t
     614 | emaj        | myschema2_mytbl4_log_seq  | M1              |             1 | f
     615 | emaj        | myschema2_mytbl5_log_seq  | M1              |             1 | f
     616 | emaj        | myschema2_mytbl6_log_seq  | M1              |             1 | f
     617 | myschema1   | myTbl3_col31_seq          | M2              |            20 | t
     618 | emajC       | myschema1_myTbl3_log_seq  | M2              |            10 | t
     619 | emaj        | myschema1_mytbl1_log_seq  | M2              |            15 | t
     620 | emaj        | myschema1_mytbl4_log_seq  | M2              |             1 | f
     621 | emaj        | myschema1_mytbl2_log_seq  | M2              |             2 | t
     622 | emajb       | myschema1_mytbl2b_log_seq | M2              |             1 | f
     624 | emajC       | myschema1_myTbl3_log_seq  | M3              |            10 | t
     627 | emaj        | myschema1_mytbl2_log_seq  | M3              |             2 | t
     628 | emajb       | myschema1_mytbl2b_log_seq | M3              |             1 | f
     629 | myschema2   | myseq1                    | M2              |          1000 | t
     630 | emaj        | myschema2_mytbl1_log_seq  | M2              |            15 | t
     631 | emaj        | myschema2_mytbl2_log_seq  | M2              |             2 | t
     632 | emajC       | myschema2_myTbl3_log_seq  | M2              |            10 | t
     633 | myschema2   | myTbl3_col31_seq          | M2              |            20 | t
     634 | emaj        | myschema2_mytbl4_log_seq  | M2              |             1 | f
     635 | emaj        | myschema2_mytbl5_log_seq  | M2              |             3 | t
     636 | emaj        | myschema2_mytbl6_log_seq  | M2              |            11 | t
     637 | myschema2   | myseq1                    | M3              |          1003 | t
     638 | emaj        | myschema2_mytbl1_log_seq  | M3              |            15 | t
     639 | emaj        | myschema2_mytbl2_log_seq  | M3              |             2 | t
     640 | emajC       | myschema2_myTbl3_log_seq  | M3              |            10 | t
     641 | myschema2   | myTbl3_col31_seq          | M3              |            20 | t
     642 | emaj        | myschema2_mytbl4_log_seq  | M3              |             4 | t
     643 | emaj        | myschema2_mytbl5_log_seq  | M3              |             4 | t
     644 | emaj        | myschema2_mytbl6_log_seq  | M3              |            14 | t
     646 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
     647 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
     648 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
     654 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
     655 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
     656 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
     662 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_START |            15 | t
     663 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_START |             2 | t
     664 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_START |            10 | t
     670 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_DONE  |            15 | t
     671 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_DONE  |             2 | t
     672 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_DONE  |            10 | t
     677 | myschema1   | myTbl3_col31_seq          | M4              |            20 | t
     678 | emajC       | myschema1_myTbl3_log_seq  | M4              |            10 | t
     679 | emaj        | myschema1_mytbl1_log_seq  | M4              |            30 | t
     680 | emaj        | myschema1_mytbl4_log_seq  | M4              |             8 | t
     681 | emaj        | myschema1_mytbl2_log_seq  | M4              |             3 | t
     682 | emajb       | myschema1_mytbl2b_log_seq | M4              |             1 | f
     683 | myschema1   | myTbl3_col31_seq          | M5              |            20 | t
     684 | emajC       | myschema1_myTbl3_log_seq  | M5              |            20 | t
     685 | emaj        | myschema1_mytbl1_log_seq  | M5              |            30 | t
     686 | emaj        | myschema1_mytbl4_log_seq  | M5              |             8 | t
     687 | emaj        | myschema1_mytbl2_log_seq  | M5              |             3 | t
     688 | emajb       | myschema1_mytbl2b_log_seq | M5              |             1 | f
     690 | emajC       | myschema1_myTbl3_log_seq  | M6              |            20 | t
     693 | emaj        | myschema1_mytbl2_log_seq  | M6              |             3 | t
     694 | emajb       | myschema1_mytbl2b_log_seq | M6              |             1 | f
     696 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START |            15 | t
     697 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START |             2 | t
     698 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START |            10 | t
     704 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE  |            15 | t
     705 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE  |             2 | t
     706 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE  |            10 | t
     711 | myschema1   | myTbl3_col31_seq          | RLBK_M4_%_START |            20 | t
     712 | emajC       | myschema1_myTbl3_log_seq  | RLBK_M4_%_START |            20 | t
     713 | emaj        | myschema1_mytbl1_log_seq  | RLBK_M4_%_START |            32 | t
     714 | emaj        | myschema1_mytbl4_log_seq  | RLBK_M4_%_START |            12 | t
     715 | emaj        | myschema1_mytbl2_log_seq  | RLBK_M4_%_START |             3 | t
     716 | emajb       | myschema1_mytbl2b_log_seq | RLBK_M4_%_START |             1 | f
     717 | myschema1   | myTbl3_col31_seq          | RLBK_M4_%_DONE  |            20 | t
     718 | emajC       | myschema1_myTbl3_log_seq  | RLBK_M4_%_DONE  |            30 | t
     719 | emaj        | myschema1_mytbl1_log_seq  | RLBK_M4_%_DONE  |            33 | t
     720 | emaj        | myschema1_mytbl4_log_seq  | RLBK_M4_%_DONE  |            14 | t
     721 | emaj        | myschema1_mytbl2_log_seq  | RLBK_M4_%_DONE  |             3 | t
     722 | emajb       | myschema1_mytbl2b_log_seq | RLBK_M4_%_DONE  |             1 | f
(84 rows)

-- check that mark_log_stat_before_next column is always equal to either NULL or the emaj_log_stat_rows() function's result
-- this should always return 0 row
select * from 
  (select mark_id, mark_group, mark_name, mark_log_rows_before_next - 
    (select sum(stat_rows) from emaj.emaj_log_stat_group(mark_group, mark_name, 
      (select mark_name from emaj.emaj_mark m2 where m2.mark_group = m1.mark_group and m2.mark_id > m1.mark_id order by mark_id limit 1))
    ) as checked_stat_rows from emaj.emaj_mark m1 where mark_log_rows_before_next is not null
  ) as t 
  where checked_stat_rows <> 0;
 mark_id | mark_group | mark_name | checked_stat_rows 
---------+------------+-----------+-------------------
(0 rows)

--
select * from emaj.emaj_fk order by fk_groups, fk_session, fk_name;
 fk_groups  | fk_session |      fk_name      | fk_schema | fk_table |    fk_action     |                                                            fk_def                                                             
------------+------------+-------------------+-----------+----------+------------------+-------------------------------------------------------------------------------------------------------------------------------
 {myGroup1} |          1 | mytbl4_col43_fkey | myschema1 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES mytbl2(col21) DEFERRABLE
 {myGroup1} |          1 | mytbl4_col44_fkey | myschema1 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col43_fkey | myschema2 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES myschema2.mytbl2(col21) DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col44_fkey | myschema2 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES myschema2.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE
(4 rows)

select sqhl_id, sqhl_schema, sqhl_table, sqhl_hole_size from emaj.emaj_seq_hole order by sqhl_id;
 sqhl_id | sqhl_schema | sqhl_table | sqhl_hole_size 
---------+-------------+------------+----------------
     600 | myschema1   | mytbl1     |              3
     601 | myschema1   | mytbl4     |              8
     602 | myschema2   | mytbl4     |             20
     603 | myschema2   | mytbl5     |              5
     604 | myschema2   | mytbl6     |             15
     605 | myschema1   | mytbl1     |              1
     606 | myschema1   | mytbl4     |              2
(7 rows)

-- user tables
select * from mySchema1.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
   100 | DEF        | \x00
   101 | DEF        | \x00
   102 | DEF        | \x00
   103 | DEF        | \x00
   104 | DEF        | \x00
   105 | DEF        | \x00
   106 | DEF        | \x00
   107 | DEF        | \x00
   108 | DEF        | \x00
   109 | DEF        | \x00
   110 | DEF        | \x00
(20 rows)

select * from mySchema1.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 12-31-2010
     2 | DEF   | 
     3 | GHI   | 01-02-2010
(3 rows)

select * from mySchema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

select col31,col33 from mySchema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |    11834
     2 | ABC        | \x0c  | INS       | NEW        |    11835
     3 | ABC        | \x0c  | INS       | NEW        |    11836
     4 | ABC        | \x0c  | INS       | NEW        |    11837
     5 | ABC        | \x0c  | INS       | NEW        |    11838
     6 | ABC        | \x0c  | INS       | NEW        |    11839
     7 | ABC        | \x0c  | INS       | NEW        |    11840
     8 | ABC        | \x0c  | INS       | NEW        |    11841
     9 | ABC        | \x0c  | INS       | NEW        |    11842
    10 | ABC        | \x0c  | INS       | NEW        |    11843
    11 | ABC        | \x0c  | INS       | NEW        |    11844
     1 | ABC        | \x0c  | UPD       | OLD        |    11845
     1 | ABC        | \x1c  | UPD       | NEW        |    11845
     2 | ABC        | \x0c  | UPD       | OLD        |    11846
     2 | ABC        | \x1c  | UPD       | NEW        |    11846
     3 | ABC        | \x0c  | UPD       | OLD        |    11847
     3 | ABC        | \x1c  | UPD       | NEW        |    11847
    11 | ABC        | \x0c  | DEL       | OLD        |    11849
   100 | DEF        | \x00  | INS       | NEW        |    11937
   101 | DEF        | \x00  | INS       | NEW        |    11938
   102 | DEF        | \x00  | INS       | NEW        |    11939
   103 | DEF        | \x00  | INS       | NEW        |    11940
   104 | DEF        | \x00  | INS       | NEW        |    11941
   105 | DEF        | \x00  | INS       | NEW        |    11942
   106 | DEF        | \x00  | INS       | NEW        |    11943
   107 | DEF        | \x00  | INS       | NEW        |    11944
   108 | DEF        | \x00  | INS       | NEW        |    11945
   109 | DEF        | \x00  | INS       | NEW        |    11946
   110 | DEF        | \x00  | INS       | NEW        |    11947
     1 | ABC        | \x1c  | DEL       | OLD        |    11949
     1 | Step 6     | \x01  | INS       | NEW        |    11987
     1 | Step 6     | \x01  | DEL       | OLD        |    12000
(32 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 12-31-2010 | INS       | NEW        |    11848
     2 | DEF   |            | INS       | NEW        |    11850
     3 | GHI   | 01-02-2010 | INS       | NEW        |    11948
(3 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.mySchema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | INS       | NEW        |    11851
    12 | 10.00 | INS       | NEW        |    11852
    13 | 10.00 | INS       | NEW        |    11853
    14 | 10.00 | INS       | NEW        |    11854
    15 | 10.00 | INS       | NEW        |    11855
    16 | 10.00 | INS       | NEW        |    11856
    17 | 10.00 | INS       | NEW        |    11857
    18 | 10.00 | INS       | NEW        |    11858
    19 | 10.00 | INS       | NEW        |    11859
    20 | 10.00 | INS       | NEW        |    11860
    11 | 10.00 | UPD       | OLD        |    11950
    11 |  5.00 | UPD       | NEW        |    11950
    12 | 10.00 | UPD       | OLD        |    11951
    12 |  5.00 | UPD       | NEW        |    11951
    13 | 10.00 | UPD       | OLD        |    11952
    13 |  5.00 | UPD       | NEW        |    11952
    14 | 10.00 | UPD       | OLD        |    11953
    14 |  5.00 | UPD       | NEW        |    11953
    15 | 10.00 | UPD       | OLD        |    11954
    15 |  5.00 | UPD       | NEW        |    11954
    16 | 10.00 | UPD       | OLD        |    11955
    16 |  5.00 | UPD       | NEW        |    11955
    17 | 10.00 | UPD       | OLD        |    11956
    17 |  5.00 | UPD       | NEW        |    11956
    18 | 10.00 | UPD       | OLD        |    11957
    18 |  5.00 | UPD       | NEW        |    11957
    19 | 10.00 | UPD       | OLD        |    11958
    19 |  5.00 | UPD       | NEW        |    11958
    20 | 10.00 | UPD       | OLD        |    11959
    20 |  5.00 | UPD       | NEW        |    11959
    20 |  5.00 | UPD       | OLD        |    11990
    20 | 10.00 | UPD       | NEW        |    11990
    19 |  5.00 | UPD       | OLD        |    11991
    19 | 10.00 | UPD       | NEW        |    11991
    18 |  5.00 | UPD       | OLD        |    11992
    18 | 10.00 | UPD       | NEW        |    11992
    17 |  5.00 | UPD       | OLD        |    11993
    17 | 10.00 | UPD       | NEW        |    11993
    16 |  5.00 | UPD       | OLD        |    11994
    16 | 10.00 | UPD       | NEW        |    11994
    15 |  5.00 | UPD       | OLD        |    11995
    15 | 10.00 | UPD       | NEW        |    11995
    14 |  5.00 | UPD       | OLD        |    11996
    14 | 10.00 | UPD       | NEW        |    11996
    13 |  5.00 | UPD       | OLD        |    11997
    13 | 10.00 | UPD       | NEW        |    11997
    12 |  5.00 | UPD       | OLD        |    11998
    12 | 10.00 | UPD       | NEW        |    11998
    11 |  5.00 | UPD       | OLD        |    11999
    11 | 10.00 | UPD       | NEW        |    11999
(50 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
    11 |       |     1 |     1 | Step 6     | INS       | NEW        |    11988
    12 |       |     1 |     1 | Step 6     | INS       | NEW        |    11989
    12 |       |     1 |     1 | Step 6     | DEL       | OLD        |    12001
    11 |       |     1 |     1 | Step 6     | DEL       | OLD        |    12002
(4 rows)

-----------------------------
-- Step 7 : for myGroup1, update tables, rename a mark, then delete 2 marks then delete all before a mark 
-----------------------------
set search_path=myschema1;
--
delete from "myTbl3" where col31 = 14;
delete from "myTbl3" where col31 = 15;
delete from "myTbl3" where col31 = 16;
delete from "myTbl3" where col31 = 17;
delete from "myTbl3" where col31 = 18;
--
select emaj.emaj_rename_mark_group('myGroup1',mark_name,'Before logged rollback to M4') from emaj.emaj_mark where mark_name like 'RLBK_M4_%_START';
 emaj_rename_mark_group 
------------------------
 
(1 row)

-- 
select emaj.emaj_delete_mark_group('myGroup1',mark_name) from emaj.emaj_mark where mark_name like 'RLBK_M4_%_DONE';
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

select emaj.emaj_delete_mark_group('myGroup1','M1');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

--
select emaj.emaj_delete_before_mark_group('myGroup1','M4');
 emaj_delete_before_mark_group 
-------------------------------
                             1
(1 row)

-----------------------------
-- Checking step 7
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_global_seq, mark_state, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group |        regexp_replace        | mark_global_seq | mark_state | mark_comment | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+------------------------------+-----------------+------------+--------------+-----------------------+-----------------------+---------------------------
     602 | myGroup2   | M1                           |           11833 | ACTIVE     |              |                   599 |                   616 |                        41
     605 | myGroup2   | M2                           |           11912 | ACTIVE     |              |                   599 |                   636 |                         8
     606 | myGroup2   | M3                           |           11920 | ACTIVE     |              |                   599 |                   644 |                          
     611 | myGroup1   | M4                           |           11949 | ACTIVE     |              |                   601 |                   682 |                        10
     612 | myGroup1   | M5                           |           11959 | ACTIVE     |              |                   601 |                   688 |                         3
     616 | myGroup1   | Before logged rollback to M4 |           11989 | ACTIVE     |              |                   606 |                   716 |                          
(6 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name         |        regexp_replace        | sequ_last_val | sequ_is_called 
---------+-------------+---------------------------+------------------------------+---------------+----------------
     609 | myschema2   | myseq1                    | M1                           |          1000 | f
     610 | emaj        | myschema2_mytbl1_log_seq  | M1                           |             1 | f
     611 | emaj        | myschema2_mytbl2_log_seq  | M1                           |             1 | f
     612 | emajC       | myschema2_myTbl3_log_seq  | M1                           |             1 | f
     613 | myschema2   | myTbl3_col31_seq          | M1                           |            10 | t
     614 | emaj        | myschema2_mytbl4_log_seq  | M1                           |             1 | f
     615 | emaj        | myschema2_mytbl5_log_seq  | M1                           |             1 | f
     616 | emaj        | myschema2_mytbl6_log_seq  | M1                           |             1 | f
     624 | emajC       | myschema1_myTbl3_log_seq  | M3                           |            10 | t
     627 | emaj        | myschema1_mytbl2_log_seq  | M3                           |             2 | t
     628 | emajb       | myschema1_mytbl2b_log_seq | M3                           |             1 | f
     629 | myschema2   | myseq1                    | M2                           |          1000 | t
     630 | emaj        | myschema2_mytbl1_log_seq  | M2                           |            15 | t
     631 | emaj        | myschema2_mytbl2_log_seq  | M2                           |             2 | t
     632 | emajC       | myschema2_myTbl3_log_seq  | M2                           |            10 | t
     633 | myschema2   | myTbl3_col31_seq          | M2                           |            20 | t
     634 | emaj        | myschema2_mytbl4_log_seq  | M2                           |             1 | f
     635 | emaj        | myschema2_mytbl5_log_seq  | M2                           |             3 | t
     636 | emaj        | myschema2_mytbl6_log_seq  | M2                           |            11 | t
     637 | myschema2   | myseq1                    | M3                           |          1003 | t
     638 | emaj        | myschema2_mytbl1_log_seq  | M3                           |            15 | t
     639 | emaj        | myschema2_mytbl2_log_seq  | M3                           |             2 | t
     640 | emajC       | myschema2_myTbl3_log_seq  | M3                           |            10 | t
     641 | myschema2   | myTbl3_col31_seq          | M3                           |            20 | t
     642 | emaj        | myschema2_mytbl4_log_seq  | M3                           |             4 | t
     643 | emaj        | myschema2_mytbl5_log_seq  | M3                           |             4 | t
     644 | emaj        | myschema2_mytbl6_log_seq  | M3                           |            14 | t
     646 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START              |            15 | t
     647 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START              |             2 | t
     648 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START              |            10 | t
     654 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE               |            15 | t
     655 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE               |             2 | t
     656 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE               |            10 | t
     662 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_START              |            15 | t
     663 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_START              |             2 | t
     664 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_START              |            10 | t
     670 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M3_%_DONE               |            15 | t
     671 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M3_%_DONE               |             2 | t
     672 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M3_%_DONE               |            10 | t
     677 | myschema1   | myTbl3_col31_seq          | M4                           |            20 | t
     678 | emajC       | myschema1_myTbl3_log_seq  | M4                           |            10 | t
     679 | emaj        | myschema1_mytbl1_log_seq  | M4                           |            30 | t
     680 | emaj        | myschema1_mytbl4_log_seq  | M4                           |             8 | t
     681 | emaj        | myschema1_mytbl2_log_seq  | M4                           |             3 | t
     682 | emajb       | myschema1_mytbl2b_log_seq | M4                           |             1 | f
     683 | myschema1   | myTbl3_col31_seq          | M5                           |            20 | t
     684 | emajC       | myschema1_myTbl3_log_seq  | M5                           |            20 | t
     685 | emaj        | myschema1_mytbl1_log_seq  | M5                           |            30 | t
     686 | emaj        | myschema1_mytbl4_log_seq  | M5                           |             8 | t
     687 | emaj        | myschema1_mytbl2_log_seq  | M5                           |             3 | t
     688 | emajb       | myschema1_mytbl2b_log_seq | M5                           |             1 | f
     690 | emajC       | myschema1_myTbl3_log_seq  | M6                           |            20 | t
     693 | emaj        | myschema1_mytbl2_log_seq  | M6                           |             3 | t
     694 | emajb       | myschema1_mytbl2b_log_seq | M6                           |             1 | f
     696 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_START              |            15 | t
     697 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_START              |             2 | t
     698 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_START              |            10 | t
     704 | emaj        | myschema2_mytbl1_log_seq  | RLBK_M2_%_DONE               |            15 | t
     705 | emaj        | myschema2_mytbl2_log_seq  | RLBK_M2_%_DONE               |             2 | t
     706 | emajC       | myschema2_myTbl3_log_seq  | RLBK_M2_%_DONE               |            10 | t
     711 | myschema1   | myTbl3_col31_seq          | Before logged rollback to M4 |            20 | t
     712 | emajC       | myschema1_myTbl3_log_seq  | Before logged rollback to M4 |            20 | t
     713 | emaj        | myschema1_mytbl1_log_seq  | Before logged rollback to M4 |            32 | t
     714 | emaj        | myschema1_mytbl4_log_seq  | Before logged rollback to M4 |            12 | t
     715 | emaj        | myschema1_mytbl2_log_seq  | Before logged rollback to M4 |             3 | t
     716 | emajb       | myschema1_mytbl2b_log_seq | Before logged rollback to M4 |             1 | f
(66 rows)

select * from emaj.emaj_fk order by fk_groups, fk_session, fk_name;
 fk_groups  | fk_session |      fk_name      | fk_schema | fk_table |    fk_action     |                                                            fk_def                                                             
------------+------------+-------------------+-----------+----------+------------------+-------------------------------------------------------------------------------------------------------------------------------
 {myGroup1} |          1 | mytbl4_col43_fkey | myschema1 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES mytbl2(col21) DEFERRABLE
 {myGroup1} |          1 | mytbl4_col44_fkey | myschema1 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col43_fkey | myschema2 | mytbl4   | set_fk_immediate | FOREIGN KEY (col43) REFERENCES myschema2.mytbl2(col21) DEFERRABLE INITIALLY DEFERRED
 {myGroup2} |          1 | mytbl4_col44_fkey | myschema2 | mytbl4   | add_fk           | FOREIGN KEY (col44, col45) REFERENCES myschema2.mytbl1(col11, col12) ON UPDATE SET NULL ON DELETE CASCADE
(4 rows)

select sqhl_id, sqhl_schema, sqhl_table, sqhl_hole_size from emaj.emaj_seq_hole order by sqhl_id;
 sqhl_id | sqhl_schema | sqhl_table | sqhl_hole_size 
---------+-------------+------------+----------------
     602 | myschema2   | mytbl4     |             20
     603 | myschema2   | mytbl5     |              5
     604 | myschema2   | mytbl6     |             15
     605 | myschema1   | mytbl1     |              1
     606 | myschema1   | mytbl4     |              2
(5 rows)

select rlbk_operation, rlbk_schema, rlbk_tbl_fk, rlbk_nb_rows from emaj.emaj_rlbk_stat 
  order by rlbk_schema, rlbk_tbl_fk, rlbk_datetime, rlbk_operation;
  rlbk_operation  | rlbk_schema |    rlbk_tbl_fk    | rlbk_nb_rows 
------------------+-------------+-------------------+--------------
 del_log          | myschema1   | mytbl1            |            3
 rlbk             | myschema1   | mytbl1            |            3
 del_log          | myschema1   | mytbl1            |            1
 rlbk             | myschema1   | mytbl1            |            1
 rlbk             | myschema1   | mytbl1            |            1
 rlbk             | myschema1   | myTbl3            |           10
 del_log          | myschema1   | mytbl4            |            8
 rlbk             | myschema1   | mytbl4            |            8
 del_log          | myschema1   | mytbl4            |            2
 rlbk             | myschema1   | mytbl4            |            2
 rlbk             | myschema1   | mytbl4            |            2
 set_fk_immediate | myschema1   | mytbl4_col43_fkey |            8
 set_fk_immediate | myschema1   | mytbl4_col43_fkey |            2
 set_fk_immediate | myschema1   | mytbl4_col43_fkey |            2
 add_fk           | myschema1   | mytbl4_col44_fkey |            0
 add_fk           | myschema1   | mytbl4_col44_fkey |            0
 add_fk           | myschema1   | mytbl4_col44_fkey |            0
 rlbk             | myschema2   | mytbl4            |            4
 rlbk             | myschema2   | mytbl4            |            4
 rlbk             | myschema2   | mytbl4            |           12
 del_log          | myschema2   | mytbl4            |           20
 rlbk             | myschema2   | mytbl4            |           20
 set_fk_immediate | myschema2   | mytbl4_col43_fkey |            4
 set_fk_immediate | myschema2   | mytbl4_col43_fkey |            4
 set_fk_immediate | myschema2   | mytbl4_col43_fkey |           12
 set_fk_immediate | myschema2   | mytbl4_col43_fkey |           20
 add_fk           | myschema2   | mytbl4_col44_fkey |            2
 add_fk           | myschema2   | mytbl4_col44_fkey |            2
 add_fk           | myschema2   | mytbl4_col44_fkey |            2
 add_fk           | myschema2   | mytbl4_col44_fkey |            2
 rlbk             | myschema2   | mytbl5            |            1
 rlbk             | myschema2   | mytbl5            |            1
 rlbk             | myschema2   | mytbl5            |            3
 del_log          | myschema2   | mytbl5            |            5
 rlbk             | myschema2   | mytbl5            |            5
 rlbk             | myschema2   | mytbl6            |            3
 rlbk             | myschema2   | mytbl6            |            3
 rlbk             | myschema2   | mytbl6            |            9
 del_log          | myschema2   | mytbl6            |           15
 rlbk             | myschema2   | mytbl6            |           15
(40 rows)

-- user tables
select * from mySchema1.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
   100 | DEF        | \x00
   101 | DEF        | \x00
   102 | DEF        | \x00
   103 | DEF        | \x00
   104 | DEF        | \x00
   105 | DEF        | \x00
   106 | DEF        | \x00
   107 | DEF        | \x00
   108 | DEF        | \x00
   109 | DEF        | \x00
   110 | DEF        | \x00
(20 rows)

select * from mySchema1.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 12-31-2010
     2 | DEF   | 
     3 | GHI   | 01-02-2010
(3 rows)

select * from mySchema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

select col31,col33 from mySchema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    19 | 10.00
    20 | 10.00
(5 rows)

select * from mySchema1.myTbl4 order by col41;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | Step 6     | \x01  | INS       | NEW        |    11987
     1 | Step 6     | \x01  | DEL       | OLD        |    12000
(2 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | col23 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------+------------+----------
(0 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.mySchema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema1_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | UPD       | OLD        |    11950
    11 |  5.00 | UPD       | NEW        |    11950
    12 | 10.00 | UPD       | OLD        |    11951
    12 |  5.00 | UPD       | NEW        |    11951
    13 | 10.00 | UPD       | OLD        |    11952
    13 |  5.00 | UPD       | NEW        |    11952
    14 | 10.00 | UPD       | OLD        |    11953
    14 |  5.00 | UPD       | NEW        |    11953
    15 | 10.00 | UPD       | OLD        |    11954
    15 |  5.00 | UPD       | NEW        |    11954
    16 | 10.00 | UPD       | OLD        |    11955
    16 |  5.00 | UPD       | NEW        |    11955
    17 | 10.00 | UPD       | OLD        |    11956
    17 |  5.00 | UPD       | NEW        |    11956
    18 | 10.00 | UPD       | OLD        |    11957
    18 |  5.00 | UPD       | NEW        |    11957
    19 | 10.00 | UPD       | OLD        |    11958
    19 |  5.00 | UPD       | NEW        |    11958
    20 | 10.00 | UPD       | OLD        |    11959
    20 |  5.00 | UPD       | NEW        |    11959
    20 |  5.00 | UPD       | OLD        |    11990
    20 | 10.00 | UPD       | NEW        |    11990
    19 |  5.00 | UPD       | OLD        |    11991
    19 | 10.00 | UPD       | NEW        |    11991
    18 |  5.00 | UPD       | OLD        |    11992
    18 | 10.00 | UPD       | NEW        |    11992
    17 |  5.00 | UPD       | OLD        |    11993
    17 | 10.00 | UPD       | NEW        |    11993
    16 |  5.00 | UPD       | OLD        |    11994
    16 | 10.00 | UPD       | NEW        |    11994
    15 |  5.00 | UPD       | OLD        |    11995
    15 | 10.00 | UPD       | NEW        |    11995
    14 |  5.00 | UPD       | OLD        |    11996
    14 | 10.00 | UPD       | NEW        |    11996
    13 |  5.00 | UPD       | OLD        |    11997
    13 | 10.00 | UPD       | NEW        |    11997
    12 |  5.00 | UPD       | OLD        |    11998
    12 | 10.00 | UPD       | NEW        |    11998
    11 |  5.00 | UPD       | OLD        |    11999
    11 | 10.00 | UPD       | NEW        |    11999
    14 | 10.00 | DEL       | OLD        |    12003
    15 | 10.00 | DEL       | OLD        |    12004
    16 | 10.00 | DEL       | OLD        |    12005
    17 | 10.00 | DEL       | OLD        |    12006
    18 | 10.00 | DEL       | OLD        |    12007
(45 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
    11 |       |     1 |     1 | Step 6     | INS       | NEW        |    11988
    12 |       |     1 |     1 | Step 6     | INS       | NEW        |    11989
    12 |       |     1 |     1 | Step 6     | DEL       | OLD        |    12001
    11 |       |     1 |     1 | Step 6     | DEL       | OLD        |    12002
(4 rows)

--
--		grp1									grp2
--1	M1 up M2 up M3 
--2											M1 up M2 up M3
--3											LR-M2 (->M2%S+M2%E) LR-M3 (->M3%S+M3%E)
--4	R-M2 up M4 up M5 up M6
--5											LR-M2 (->M2%S+M2%E) R-M3
--6	up R-M5 up LR-M4(->M4S+M4E)
--7	up M7 REN-M4S DEL-M4E DEL-M1 DELBEF-M4
--
-----------------------------
-- check grants on other functions to emaj_adm role
-----------------------------
select * from emaj.emaj_verify_all();
                  emaj_verify_all                  
---------------------------------------------------
 Global checks: no error detected
 Checking schema emaj: no error detected
 Checking schema emajb: no error detected
 Checking schema "emajC": no error detected
 Checking tables group myGroup1: no error detected
 Checking tables group myGroup2: no error detected
(6 rows)

select emaj.emaj_create_group('dummyGroup');
ERROR:  emaj_create_group: Group dummyGroup is unknown in emaj_group_def table.
CONTEXT:  PL/pgSQL function emaj.emaj_create_group(text) line 7 at RETURN
select emaj.emaj_drop_group('dummyGroup');
ERROR:  _drop_group: group dummyGroup has not been created.
CONTEXT:  SQL statement "SELECT emaj._drop_group(v_groupName, FALSE)"
PL/pgSQL function emaj.emaj_drop_group(text) line 12 at SQL statement
select emaj.emaj_force_drop_group('dummyGroup');
ERROR:  _drop_group: group dummyGroup has not been created.
CONTEXT:  SQL statement "SELECT emaj._drop_group(v_groupName, TRUE)"
PL/pgSQL function emaj.emaj_force_drop_group(text) line 17 at SQL statement
select emaj.emaj_get_previous_mark_group('dummyGroup', '2010-01-01');
ERROR:  emaj_get_previous_mark_group: group dummyGroup has not been created.
select emaj.emaj_get_previous_mark_group('dummyGroup', 'EMAJ_LAST_MARK');
ERROR:  emaj_get_previous_mark_group: group dummyGroup has not been created.
select emaj.emaj_reset_group('dummyGroup');
ERROR:  emaj_reset_group: group dummyGroup has not been created.
select * from emaj.emaj_log_stat_group('dummyGroup', 'dummyMark', NULL); 
ERROR:  emaj_log_stat_group: group dummyGroup has not been created.
select * from emaj.emaj_detailed_log_stat_group('dummyGroup', 'dummyMark', NULL);
ERROR:  emaj_detailed_log_stat_group: group dummyGroup has not been created.
select emaj.emaj_estimate_rollback_duration('dummyGroup', 'dummyMark');
ERROR:  emaj_estimate_rollback_duration: group dummyGroup has not been created or is not in LOGGING state.
select substr(pg_size_pretty(pg_database_size(current_database())),1,0);
 substr 
--------
 
(1 row)

