-- afterRest.sql: Test emaj environment restored from a dump taken at the end of schedule reg tests
--                All operations are executed by super-user
--
-----------------------------
-- Checking restore
-----------------------------
select relname,relkind from pg_class where relname like 'emaj_%';
           relname           | relkind 
-----------------------------+---------
 emaj_detailed_log_stat_type | c
 emaj_global_seq             | S
 emaj_group                  | r
 emaj_group_def              | r
 emaj_group_def_pkey         | i
 emaj_group_pkey             | i
 emaj_hist                   | r
 emaj_hist_hist_id_seq       | S
 emaj_hist_pkey              | i
 emaj_log_stat_type          | c
 emaj_mark                   | r
 emaj_mark_mark_id_seq       | S
 emaj_mark_pkey              | i
 emaj_param                  | r
 emaj_param_pkey             | i
 emaj_relation               | r
 emaj_relation_idx1          | i
 emaj_relation_idx2          | i
 emaj_relation_pkey          | i
 emaj_rlbk                   | r
 emaj_rlbk_idx1              | i
 emaj_rlbk_idx2              | i
 emaj_rlbk_pkey              | i
 emaj_rlbk_plan              | r
 emaj_rlbk_plan_pkey         | i
 emaj_rlbk_rlbk_id_seq       | S
 emaj_rlbk_session           | r
 emaj_rlbk_session_pkey      | i
 emaj_rlbk_stat              | r
 emaj_rlbk_stat_pkey         | i
 emaj_rollback_activity_type | c
 emaj_seq_hole               | r
 emaj_seq_hole_pkey          | i
 emaj_seq_hole_sqhl_id_seq   | S
 emaj_sequence               | r
 emaj_sequence_pkey          | i
 emaj_sequence_sequ_id_seq   | S
 emaj_visible_param          | v
(38 rows)

select * from emaj.emaj_global_seq;
  sequence_name  | last_value | start_value | increment_by |      max_value      | min_value | cache_value | log_cnt | is_cycled | is_called 
-----------------+------------+-------------+--------------+---------------------+-----------+-------------+---------+-----------+-----------
 emaj_global_seq |     100465 |           1 |            1 | 9223372036854775807 |         1 |           1 |       0 | f         | t
(1 row)

-----------------------------
-- Step 1 : for myGroup2, update tables and set a mark 
-----------------------------
set search_path=myschema2;
SET
insert into myTbl1 select 100+i, 'KLM', E'\\000\\014'::bytea from generate_series (1,11) as i;
INSERT 0 11
update myTbl1 set col13=E'\\000\\034'::bytea where col11 >105;
UPDATE 6
insert into myTbl2 values (100,'KLM','2012-12-31');
INSERT 0 1
delete from myTbl1 where col11 > 110;
DELETE 1
select nextval('myschema2.myseq1');
 nextval 
---------
    1004
(1 row)

--
select emaj.emaj_set_mark_group('myGroup2','After restore mark');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

--
-----------------------------
-- Checking step 1
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group |        regexp_replace        | mark_is_deleted | mark_is_rlbk_protected |     mark_comment     | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+------------------------------+-----------------+------------------------+----------------------+-----------------------+-----------------------+---------------------------
     607 | myGroup2   | M3                           | t               | f                      | This mark is deleted |                   599 |                  6051 |                         0
     612 | myGroup1   | M4                           | t               | f                      |                      |                   601 |                  6089 |                        10
     613 | myGroup1   | M5                           | t               | f                      |                      |                   601 |                  6095 |                         3
     617 | myGroup1   | Before logged rollback to M4 | t               | f                      |                      |                   606 |                  6123 |                        28
     619 | myGroup1   | STOP_%                       | t               | f                      |                      |                   606 |                  6143 |                         0
     620 | myGroup2   | STOP_%                       | t               | f                      |                      |                   606 |                  6143 |                         0
     629 | myGroup1   | Stop after rollback          | t               | f                      |                      |                   606 |                  6213 |                         0
     630 | myGroup2   | Stop after rollback          | t               | f                      |                      |                   606 |                  6213 |                         0
     631 | myGroup1   | Multi-1                      | f               | f                      |                      |                   606 |                  6227 |                          
     632 | myGroup2   | Multi-1                      | f               | f                      |                      |                   606 |                  6227 |                        80
    1001 | myGroup2   | RLBK_Multi-1_%_START         | f               | f                      |                      |                   999 |                  1013 |                        32
    1003 | myGroup2   | RLBK_Multi-1_%_DONE          | f               | f                      |                      |                   999 |                  1027 |                        19
    1004 | myGroup2   | After restore mark           | f               | f                      |                      |                  1002 |                  1035 |                          
(13 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name          |        regexp_replace        | sequ_last_val | sequ_is_called 
---------+-------------+----------------------------+------------------------------+---------------+----------------
    1000 | myschema1   | myTbl3_col31_seq           | RLBK_Multi-1_%_START         |            21 | f
    1001 | myschema2   | myseq1                     | RLBK_Multi-1_%_START         |          9999 | f
    1002 | myschema2   | myTbl3_col31_seq           | RLBK_Multi-1_%_START         |            21 | f
    1003 | emajC       | myschema1_myTbl3_log_seq   | RLBK_Multi-1_%_START         |            50 | t
    1004 | emaj        | myschema1_mytbl1_log_seq   | RLBK_Multi-1_%_START         |            73 | t
    1005 | emaj        | myschema1_mytbl4_log_seq   | RLBK_Multi-1_%_START         |            14 | t
    1006 | emaj        | myschema1_mytbl2_log_seq   | RLBK_Multi-1_%_START         |             6 | t
    1007 | emajb       | myschema1_mytbl2b_log_seq  | RLBK_Multi-1_%_START         |             1 | f
    1008 | emaj        | myschema2_mytbl1_log_seq   | RLBK_Multi-1_%_START         |            25 | t
    1009 | emaj        | myschema2_mytbl2_log_seq   | RLBK_Multi-1_%_START         |             4 | t
    1010 | emajC       | myschema2_myTbl3_log_seq   | RLBK_Multi-1_%_START         |            20 | t
    1011 | emaj        | myschema2_mytbl4_log_seq   | RLBK_Multi-1_%_START         |            12 | t
    1012 | emaj        | otherPrefix4mytbl5_log_seq | RLBK_Multi-1_%_START         |            16 | t
    1013 | emaj        | myschema2_mytbl6_log_seq   | RLBK_Multi-1_%_START         |            70 | t
    1014 | myschema1   | myTbl3_col31_seq           | RLBK_Multi-1_%_DONE          |            21 | f
    1015 | myschema2   | myseq1                     | RLBK_Multi-1_%_DONE          |          1004 | f
    1016 | myschema2   | myTbl3_col31_seq           | RLBK_Multi-1_%_DONE          |            21 | f
    1017 | emajC       | myschema1_myTbl3_log_seq   | RLBK_Multi-1_%_DONE          |            55 | t
    1018 | emaj        | myschema1_mytbl1_log_seq   | RLBK_Multi-1_%_DONE          |            93 | t
    1019 | emaj        | myschema1_mytbl4_log_seq   | RLBK_Multi-1_%_DONE          |            14 | t
    1020 | emaj        | myschema1_mytbl2_log_seq   | RLBK_Multi-1_%_DONE          |             9 | t
    1021 | emajb       | myschema1_mytbl2b_log_seq  | RLBK_Multi-1_%_DONE          |             1 | f
    1022 | emaj        | myschema2_mytbl1_log_seq   | RLBK_Multi-1_%_DONE          |            35 | t
    1023 | emaj        | myschema2_mytbl2_log_seq   | RLBK_Multi-1_%_DONE          |             6 | t
    1024 | emajC       | myschema2_myTbl3_log_seq   | RLBK_Multi-1_%_DONE          |            30 | t
    1025 | emaj        | myschema2_mytbl4_log_seq   | RLBK_Multi-1_%_DONE          |            14 | t
    1026 | emaj        | otherPrefix4mytbl5_log_seq | RLBK_Multi-1_%_DONE          |            17 | t
    1027 | emaj        | myschema2_mytbl6_log_seq   | RLBK_Multi-1_%_DONE          |            77 | t
    1028 | myschema2   | myseq1                     | After restore mark           |          1004 | t
    1029 | myschema2   | myTbl3_col31_seq           | After restore mark           |            21 | f
    1030 | emaj        | myschema2_mytbl1_log_seq   | After restore mark           |            53 | t
    1031 | emaj        | myschema2_mytbl2_log_seq   | After restore mark           |             7 | t
    1032 | emajC       | myschema2_myTbl3_log_seq   | After restore mark           |            30 | t
    1033 | emaj        | myschema2_mytbl4_log_seq   | After restore mark           |            14 | t
    1034 | emaj        | otherPrefix4mytbl5_log_seq | After restore mark           |            17 | t
    1035 | emaj        | myschema2_mytbl6_log_seq   | After restore mark           |            77 | t
    6031 | emajC       | myschema1_myTbl3_log_seq   | M3                           |            10 | t
    6034 | emaj        | myschema1_mytbl2_log_seq   | M3                           |             2 | t
    6035 | emajb       | myschema1_mytbl2b_log_seq  | M3                           |             1 | f
    6044 | myschema2   | myseq1                     | M3                           |          1003 | t
    6045 | myschema2   | myTbl3_col31_seq           | M3                           |            20 | t
    6046 | emaj        | myschema2_mytbl1_log_seq   | M3                           |            15 | t
    6047 | emaj        | myschema2_mytbl2_log_seq   | M3                           |             2 | t
    6048 | emajC       | myschema2_myTbl3_log_seq   | M3                           |            10 | t
    6049 | emaj        | myschema2_mytbl4_log_seq   | M3                           |             4 | t
    6050 | emaj        | otherPrefix4mytbl5_log_seq | M3                           |             4 | t
    6051 | emaj        | myschema2_mytbl6_log_seq   | M3                           |            14 | t
    6054 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M2_%_START              |            15 | t
    6055 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M2_%_START              |             2 | t
    6056 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M2_%_START              |            10 | t
    6062 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M2_%_DONE               |            15 | t
    6063 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M2_%_DONE               |             2 | t
    6064 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M2_%_DONE               |            10 | t
    6070 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M3_%_START              |            15 | t
    6071 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M3_%_START              |             2 | t
    6072 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M3_%_START              |            10 | t
    6078 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M3_%_DONE               |            15 | t
    6079 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M3_%_DONE               |             2 | t
    6080 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M3_%_DONE               |            10 | t
    6084 | myschema1   | myTbl3_col31_seq           | M4                           |            20 | t
    6085 | emajC       | myschema1_myTbl3_log_seq   | M4                           |            10 | t
    6086 | emaj        | myschema1_mytbl1_log_seq   | M4                           |            30 | t
    6087 | emaj        | myschema1_mytbl4_log_seq   | M4                           |             8 | t
    6088 | emaj        | myschema1_mytbl2_log_seq   | M4                           |             3 | t
    6089 | emajb       | myschema1_mytbl2b_log_seq  | M4                           |             1 | f
    6090 | myschema1   | myTbl3_col31_seq           | M5                           |            20 | t
    6091 | emajC       | myschema1_myTbl3_log_seq   | M5                           |            20 | t
    6092 | emaj        | myschema1_mytbl1_log_seq   | M5                           |            30 | t
    6093 | emaj        | myschema1_mytbl4_log_seq   | M5                           |             8 | t
    6094 | emaj        | myschema1_mytbl2_log_seq   | M5                           |             3 | t
    6095 | emajb       | myschema1_mytbl2b_log_seq  | M5                           |             1 | f
    6097 | emajC       | myschema1_myTbl3_log_seq   | M6                           |            20 | t
    6100 | emaj        | myschema1_mytbl2_log_seq   | M6                           |             3 | t
    6101 | emajb       | myschema1_mytbl2b_log_seq  | M6                           |             1 | f
    6104 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M2_%_START              |            15 | t
    6105 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M2_%_START              |             2 | t
    6106 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M2_%_START              |            10 | t
    6112 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M2_%_DONE               |            15 | t
    6113 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M2_%_DONE               |             2 | t
    6114 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M2_%_DONE               |            10 | t
    6118 | myschema1   | myTbl3_col31_seq           | Before logged rollback to M4 |            20 | t
    6119 | emajC       | myschema1_myTbl3_log_seq   | Before logged rollback to M4 |            20 | t
    6120 | emaj        | myschema1_mytbl1_log_seq   | Before logged rollback to M4 |            32 | t
    6121 | emaj        | myschema1_mytbl4_log_seq   | Before logged rollback to M4 |            12 | t
    6122 | emaj        | myschema1_mytbl2_log_seq   | Before logged rollback to M4 |             3 | t
    6123 | emajb       | myschema1_mytbl2b_log_seq  | Before logged rollback to M4 |             1 | f
    6130 | myschema1   | myTbl3_col31_seq           | STOP_%                       |            20 | t
    6131 | myschema2   | myseq1                     | STOP_%                       |          1004 | f
    6132 | myschema2   | myTbl3_col31_seq           | STOP_%                       |            20 | t
    6133 | emajC       | myschema1_myTbl3_log_seq   | STOP_%                       |            45 | t
    6134 | emaj        | myschema1_mytbl1_log_seq   | STOP_%                       |            33 | t
    6135 | emaj        | myschema1_mytbl4_log_seq   | STOP_%                       |            14 | t
    6136 | emaj        | myschema1_mytbl2_log_seq   | STOP_%                       |             3 | t
    6137 | emajb       | myschema1_mytbl2b_log_seq  | STOP_%                       |             1 | f
    6138 | emaj        | myschema2_mytbl1_log_seq   | STOP_%                       |            15 | t
    6139 | emaj        | myschema2_mytbl2_log_seq   | STOP_%                       |             2 | t
    6140 | emajC       | myschema2_myTbl3_log_seq   | STOP_%                       |            10 | t
    6141 | emaj        | myschema2_mytbl4_log_seq   | STOP_%                       |            10 | t
    6142 | emaj        | otherPrefix4mytbl5_log_seq | STOP_%                       |             7 | t
    6143 | emaj        | myschema2_mytbl6_log_seq   | STOP_%                       |            23 | t
    6161 | emajC       | myschema1_myTbl3_log_seq   | Multi-2                      |            45 | t
    6162 | emaj        | myschema1_mytbl1_log_seq   | Multi-2                      |            33 | t
    6163 | emaj        | myschema1_mytbl4_log_seq   | Multi-2                      |            14 | t
    6164 | emaj        | myschema1_mytbl2_log_seq   | Multi-2                      |             3 | t
    6165 | emajb       | myschema1_mytbl2b_log_seq  | Multi-2                      |             1 | f
    6166 | emaj        | myschema2_mytbl1_log_seq   | Multi-2                      |            15 | t
    6167 | emaj        | myschema2_mytbl2_log_seq   | Multi-2                      |             2 | t
    6168 | emajC       | myschema2_myTbl3_log_seq   | Multi-2                      |            10 | t
    6169 | emaj        | myschema2_mytbl4_log_seq   | Multi-2                      |            10 | t
    6170 | emaj        | otherPrefix4mytbl5_log_seq | Multi-2                      |             7 | t
    6171 | emaj        | myschema2_mytbl6_log_seq   | Multi-2                      |            23 | t
    6175 | emajC       | myschema1_myTbl3_log_seq   | RLBK_Multi-1_%_START         |            45 | t
    6176 | emaj        | myschema1_mytbl1_log_seq   | RLBK_Multi-1_%_START         |            33 | t
    6177 | emaj        | myschema1_mytbl4_log_seq   | RLBK_Multi-1_%_START         |            14 | t
    6178 | emaj        | myschema1_mytbl2_log_seq   | RLBK_Multi-1_%_START         |             3 | t
    6179 | emajb       | myschema1_mytbl2b_log_seq  | RLBK_Multi-1_%_START         |             1 | f
    6180 | emaj        | myschema2_mytbl1_log_seq   | RLBK_Multi-1_%_START         |            15 | t
    6181 | emaj        | myschema2_mytbl2_log_seq   | RLBK_Multi-1_%_START         |             2 | t
    6182 | emajC       | myschema2_myTbl3_log_seq   | RLBK_Multi-1_%_START         |            10 | t
    6183 | emaj        | myschema2_mytbl4_log_seq   | RLBK_Multi-1_%_START         |            10 | t
    6184 | emaj        | otherPrefix4mytbl5_log_seq | RLBK_Multi-1_%_START         |             7 | t
    6185 | emaj        | myschema2_mytbl6_log_seq   | RLBK_Multi-1_%_START         |            23 | t
    6189 | emajC       | myschema1_myTbl3_log_seq   | RLBK_Multi-1_%_DONE          |            45 | t
    6190 | emaj        | myschema1_mytbl1_log_seq   | RLBK_Multi-1_%_DONE          |            33 | t
    6191 | emaj        | myschema1_mytbl4_log_seq   | RLBK_Multi-1_%_DONE          |            14 | t
    6192 | emaj        | myschema1_mytbl2_log_seq   | RLBK_Multi-1_%_DONE          |             3 | t
    6193 | emajb       | myschema1_mytbl2b_log_seq  | RLBK_Multi-1_%_DONE          |             1 | f
    6194 | emaj        | myschema2_mytbl1_log_seq   | RLBK_Multi-1_%_DONE          |            15 | t
    6195 | emaj        | myschema2_mytbl2_log_seq   | RLBK_Multi-1_%_DONE          |             2 | t
    6196 | emajC       | myschema2_myTbl3_log_seq   | RLBK_Multi-1_%_DONE          |            10 | t
    6197 | emaj        | myschema2_mytbl4_log_seq   | RLBK_Multi-1_%_DONE          |            10 | t
    6198 | emaj        | otherPrefix4mytbl5_log_seq | RLBK_Multi-1_%_DONE          |             7 | t
    6199 | emaj        | myschema2_mytbl6_log_seq   | RLBK_Multi-1_%_DONE          |            23 | t
    6200 | myschema1   | myTbl3_col31_seq           | Stop after rollback          |            20 | t
    6201 | myschema2   | myseq1                     | Stop after rollback          |          1004 | f
    6202 | myschema2   | myTbl3_col31_seq           | Stop after rollback          |            20 | t
    6203 | emajC       | myschema1_myTbl3_log_seq   | Stop after rollback          |            45 | t
    6204 | emaj        | myschema1_mytbl1_log_seq   | Stop after rollback          |            33 | t
    6205 | emaj        | myschema1_mytbl4_log_seq   | Stop after rollback          |            14 | t
    6206 | emaj        | myschema1_mytbl2_log_seq   | Stop after rollback          |             3 | t
    6207 | emajb       | myschema1_mytbl2b_log_seq  | Stop after rollback          |             1 | f
    6208 | emaj        | myschema2_mytbl1_log_seq   | Stop after rollback          |            15 | t
    6209 | emaj        | myschema2_mytbl2_log_seq   | Stop after rollback          |             2 | t
    6210 | emajC       | myschema2_myTbl3_log_seq   | Stop after rollback          |            10 | t
    6211 | emaj        | myschema2_mytbl4_log_seq   | Stop after rollback          |            10 | t
    6212 | emaj        | otherPrefix4mytbl5_log_seq | Stop after rollback          |             7 | t
    6213 | emaj        | myschema2_mytbl6_log_seq   | Stop after rollback          |            23 | t
    6214 | myschema1   | myTbl3_col31_seq           | Multi-1                      |            20 | t
    6215 | myschema2   | myseq1                     | Multi-1                      |          1004 | f
    6216 | myschema2   | myTbl3_col31_seq           | Multi-1                      |            20 | t
    6217 | emajC       | myschema1_myTbl3_log_seq   | Multi-1                      |            45 | t
    6218 | emaj        | myschema1_mytbl1_log_seq   | Multi-1                      |            33 | t
    6219 | emaj        | myschema1_mytbl4_log_seq   | Multi-1                      |            14 | t
    6220 | emaj        | myschema1_mytbl2_log_seq   | Multi-1                      |             3 | t
    6221 | emajb       | myschema1_mytbl2b_log_seq  | Multi-1                      |             1 | f
    6222 | emaj        | myschema2_mytbl1_log_seq   | Multi-1                      |            15 | t
    6223 | emaj        | myschema2_mytbl2_log_seq   | Multi-1                      |             2 | t
    6224 | emajC       | myschema2_myTbl3_log_seq   | Multi-1                      |            10 | t
    6225 | emaj        | myschema2_mytbl4_log_seq   | Multi-1                      |            10 | t
    6226 | emaj        | otherPrefix4mytbl5_log_seq | Multi-1                      |             7 | t
    6227 | emaj        | myschema2_mytbl6_log_seq   | Multi-1                      |            23 | t
(161 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13  
-------+------------+--------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
   101 | KLM        | \x000c
   102 | KLM        | \x000c
   103 | KLM        | \x000c
   104 | KLM        | \x000c
   105 | KLM        | \x000c
   106 | KLM        | \x001c
   107 | KLM        | \x001c
   108 | KLM        | \x001c
   109 | KLM        | \x001c
   110 | KLM        | \x001c
(20 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 2010-01-01
     2 | DEF   | 
   100 | KLM   | 2012-12-31
(3 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13  | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+--------+-----------+------------+----------
     4 | ABC        | \x0c   | DEL       | OLD        |   100368
     5 | ABC        | \x0c   | DEL       | OLD        |   100369
     6 | ABC        | \x0c   | DEL       | OLD        |   100370
     7 | ABC        | \x0c   | DEL       | OLD        |   100371
     8 | ABC        | \x0c   | DEL       | OLD        |   100372
     9 | ABC        | \x0c   | DEL       | OLD        |   100373
    10 | ABC        | \x0c   | DEL       | OLD        |   100374
     1 | ABC        | \x1c   | DEL       | OLD        |   100375
     2 | ABC        | \x1c   | DEL       | OLD        |   100376
     3 | ABC        | \x1c   | DEL       | OLD        |   100377
     4 | ABC        | \x0c   | INS       | NEW        |   100406
    10 | ABC        | \x0c   | INS       | NEW        |   100407
     7 | ABC        | \x0c   | INS       | NEW        |   100428
     9 | ABC        | \x0c   | INS       | NEW        |   100429
     5 | ABC        | \x0c   | INS       | NEW        |   100430
     2 | ABC        | \x1c   | INS       | NEW        |   100431
     6 | ABC        | \x0c   | INS       | NEW        |   100432
     3 | ABC        | \x1c   | INS       | NEW        |   100433
     1 | ABC        | \x1c   | INS       | NEW        |   100434
     8 | ABC        | \x0c   | INS       | NEW        |   100435
   101 | KLM        | \x000c | INS       | NEW        |   100466
   102 | KLM        | \x000c | INS       | NEW        |   100467
   103 | KLM        | \x000c | INS       | NEW        |   100468
   104 | KLM        | \x000c | INS       | NEW        |   100469
   105 | KLM        | \x000c | INS       | NEW        |   100470
   106 | KLM        | \x000c | INS       | NEW        |   100471
   107 | KLM        | \x000c | INS       | NEW        |   100472
   108 | KLM        | \x000c | INS       | NEW        |   100473
   109 | KLM        | \x000c | INS       | NEW        |   100474
   110 | KLM        | \x000c | INS       | NEW        |   100475
   111 | KLM        | \x000c | INS       | NEW        |   100476
   106 | KLM        | \x000c | UPD       | OLD        |   100477
   106 | KLM        | \x001c | UPD       | NEW        |   100477
   107 | KLM        | \x000c | UPD       | OLD        |   100478
   107 | KLM        | \x001c | UPD       | NEW        |   100478
   108 | KLM        | \x000c | UPD       | OLD        |   100479
   108 | KLM        | \x001c | UPD       | NEW        |   100479
   109 | KLM        | \x000c | UPD       | OLD        |   100480
   109 | KLM        | \x001c | UPD       | NEW        |   100480
   110 | KLM        | \x000c | UPD       | OLD        |   100481
   110 | KLM        | \x001c | UPD       | NEW        |   100481
   111 | KLM        | \x000c | UPD       | OLD        |   100482
   111 | KLM        | \x001c | UPD       | NEW        |   100482
   111 | KLM        | \x001c | DEL       | OLD        |   100484
(44 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 2010-01-01 | DEL       | OLD        |   100378
     2 | DEF   |            | DEL       | OLD        |   100379
     1 | ABC   | 2010-01-01 | INS       | NEW        |   100446
     2 | DEF   |            | INS       | NEW        |   100447
   100 | KLM   | 2012-12-31 | INS       | NEW        |   100483
(5 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
    11 | 10.00 | DEL       | OLD        |   100380
    12 | 10.00 | DEL       | OLD        |   100381
    13 | 10.00 | DEL       | OLD        |   100382
    14 | 10.00 | DEL       | OLD        |   100383
    15 | 10.00 | DEL       | OLD        |   100384
    16 | 10.00 | DEL       | OLD        |   100385
    17 | 10.00 | DEL       | OLD        |   100386
    18 | 10.00 | DEL       | OLD        |   100387
    19 | 10.00 | DEL       | OLD        |   100388
    20 | 10.00 | DEL       | OLD        |   100389
    11 | 10.00 | INS       | NEW        |   100448
    16 | 10.00 | INS       | NEW        |   100449
    14 | 10.00 | INS       | NEW        |   100450
    17 | 10.00 | INS       | NEW        |   100451
    15 | 10.00 | INS       | NEW        |   100452
    19 | 10.00 | INS       | NEW        |   100453
    20 | 10.00 | INS       | NEW        |   100454
    12 | 10.00 | INS       | NEW        |   100455
    18 | 10.00 | INS       | NEW        |   100456
    13 | 10.00 | INS       | NEW        |   100457
(20 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     2 |     1 | ABC        | DEL       | OLD        |   100366
     2 | FK... |     2 |     1 | ABC        | DEL       | OLD        |   100367
     1 | FK... |     2 |     1 | ABC        | INS       | NEW        |   100458
     2 | FK... |     2 |     1 | ABC        | INS       | NEW        |   100459
(4 rows)

--
-----------------------------
-- Step 2 : for myGroup2, rollback to mark Multi-1 (set before dump/restore) 
-----------------------------
select * from emaj.emaj_log_stat_group('myGroup2','Multi-1',NULL);
 stat_group | stat_schema | stat_table | stat_rows 
------------+-------------+------------+-----------
 myGroup2   | myschema2   | mytbl1     |        38
 myGroup2   | myschema2   | mytbl2     |         5
 myGroup2   | myschema2   | myTbl3     |        20
 myGroup2   | myschema2   | mytbl4     |         4
 myGroup2   | myschema2   | mytbl5     |        10
 myGroup2   | myschema2   | mytbl6     |        54
(6 rows)

select emaj.emaj_rollback_group('myGroup2','Multi-1');
WARNING:  _check_fk_groups: Foreign key mytbl6_col61_fkey, from table myschema2.mytbl6, references myschema2.mytbl7 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean) line 66 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean) line 20 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text) line 7 at RETURN
WARNING:  _check_fk_groups: table myschema2.mytbl6 is referenced by foreign key mytbl8_col81_fkey from table myschema2.mytbl8 that is outside groups (myGroup2).
CONTEXT:  SQL statement "SELECT emaj._check_fk_groups(v_groupNames)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean) line 66 at PERFORM
SQL statement "SELECT emaj._rlbk_init(v_groupNames, v_mark, v_isLoggedRlbk, 1, v_multiGroup)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean) line 20 at SQL statement
PL/pgSQL function emaj.emaj_rollback_group(text,text) line 7 at RETURN
 emaj_rollback_group 
---------------------
                   8
(1 row)

--
-----------------------------
-- Checking step 2
-----------------------------
-- emaj tables
select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_last_seq_hole_id, mark_last_sequence_id, mark_log_rows_before_next from emaj.emaj_mark order by mark_id;
 mark_id | mark_group |        regexp_replace        | mark_is_deleted | mark_is_rlbk_protected |     mark_comment     | mark_last_seq_hole_id | mark_last_sequence_id | mark_log_rows_before_next 
---------+------------+------------------------------+-----------------+------------------------+----------------------+-----------------------+-----------------------+---------------------------
     607 | myGroup2   | M3                           | t               | f                      | This mark is deleted |                   599 |                  6051 |                         0
     612 | myGroup1   | M4                           | t               | f                      |                      |                   601 |                  6089 |                        10
     613 | myGroup1   | M5                           | t               | f                      |                      |                   601 |                  6095 |                         3
     617 | myGroup1   | Before logged rollback to M4 | t               | f                      |                      |                   606 |                  6123 |                        28
     619 | myGroup1   | STOP_%                       | t               | f                      |                      |                   606 |                  6143 |                         0
     620 | myGroup2   | STOP_%                       | t               | f                      |                      |                   606 |                  6143 |                         0
     629 | myGroup1   | Stop after rollback          | t               | f                      |                      |                   606 |                  6213 |                         0
     630 | myGroup2   | Stop after rollback          | t               | f                      |                      |                   606 |                  6213 |                         0
     631 | myGroup1   | Multi-1                      | f               | f                      |                      |                   606 |                  6227 |                          
     632 | myGroup2   | Multi-1                      | f               | f                      |                      |                   606 |                  6227 |                          
(10 rows)

select sequ_id,sequ_schema, sequ_name, regexp_replace(sequ_mark,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_id;
 sequ_id | sequ_schema |         sequ_name          |        regexp_replace        | sequ_last_val | sequ_is_called 
---------+-------------+----------------------------+------------------------------+---------------+----------------
    1000 | myschema1   | myTbl3_col31_seq           | RLBK_Multi-1_%_START         |            21 | f
    1001 | myschema2   | myseq1                     | RLBK_Multi-1_%_START         |          9999 | f
    1002 | myschema2   | myTbl3_col31_seq           | RLBK_Multi-1_%_START         |            21 | f
    1003 | emajC       | myschema1_myTbl3_log_seq   | RLBK_Multi-1_%_START         |            50 | t
    1004 | emaj        | myschema1_mytbl1_log_seq   | RLBK_Multi-1_%_START         |            73 | t
    1005 | emaj        | myschema1_mytbl4_log_seq   | RLBK_Multi-1_%_START         |            14 | t
    1006 | emaj        | myschema1_mytbl2_log_seq   | RLBK_Multi-1_%_START         |             6 | t
    1007 | emajb       | myschema1_mytbl2b_log_seq  | RLBK_Multi-1_%_START         |             1 | f
    1008 | emaj        | myschema2_mytbl1_log_seq   | RLBK_Multi-1_%_START         |            25 | t
    1009 | emaj        | myschema2_mytbl2_log_seq   | RLBK_Multi-1_%_START         |             4 | t
    1010 | emajC       | myschema2_myTbl3_log_seq   | RLBK_Multi-1_%_START         |            20 | t
    1011 | emaj        | myschema2_mytbl4_log_seq   | RLBK_Multi-1_%_START         |            12 | t
    1012 | emaj        | otherPrefix4mytbl5_log_seq | RLBK_Multi-1_%_START         |            16 | t
    1013 | emaj        | myschema2_mytbl6_log_seq   | RLBK_Multi-1_%_START         |            70 | t
    1014 | myschema1   | myTbl3_col31_seq           | RLBK_Multi-1_%_DONE          |            21 | f
    1015 | myschema2   | myseq1                     | RLBK_Multi-1_%_DONE          |          1004 | f
    1016 | myschema2   | myTbl3_col31_seq           | RLBK_Multi-1_%_DONE          |            21 | f
    1017 | emajC       | myschema1_myTbl3_log_seq   | RLBK_Multi-1_%_DONE          |            55 | t
    1018 | emaj        | myschema1_mytbl1_log_seq   | RLBK_Multi-1_%_DONE          |            93 | t
    1019 | emaj        | myschema1_mytbl4_log_seq   | RLBK_Multi-1_%_DONE          |            14 | t
    1020 | emaj        | myschema1_mytbl2_log_seq   | RLBK_Multi-1_%_DONE          |             9 | t
    1021 | emajb       | myschema1_mytbl2b_log_seq  | RLBK_Multi-1_%_DONE          |             1 | f
    1022 | emaj        | myschema2_mytbl1_log_seq   | RLBK_Multi-1_%_DONE          |            35 | t
    1023 | emaj        | myschema2_mytbl2_log_seq   | RLBK_Multi-1_%_DONE          |             6 | t
    1024 | emajC       | myschema2_myTbl3_log_seq   | RLBK_Multi-1_%_DONE          |            30 | t
    1025 | emaj        | myschema2_mytbl4_log_seq   | RLBK_Multi-1_%_DONE          |            14 | t
    1026 | emaj        | otherPrefix4mytbl5_log_seq | RLBK_Multi-1_%_DONE          |            17 | t
    1027 | emaj        | myschema2_mytbl6_log_seq   | RLBK_Multi-1_%_DONE          |            77 | t
    1028 | myschema2   | myseq1                     | After restore mark           |          1004 | t
    1029 | myschema2   | myTbl3_col31_seq           | After restore mark           |            21 | f
    1030 | emaj        | myschema2_mytbl1_log_seq   | After restore mark           |            53 | t
    1031 | emaj        | myschema2_mytbl2_log_seq   | After restore mark           |             7 | t
    1032 | emajC       | myschema2_myTbl3_log_seq   | After restore mark           |            30 | t
    1033 | emaj        | myschema2_mytbl4_log_seq   | After restore mark           |            14 | t
    1034 | emaj        | otherPrefix4mytbl5_log_seq | After restore mark           |            17 | t
    1035 | emaj        | myschema2_mytbl6_log_seq   | After restore mark           |            77 | t
    6031 | emajC       | myschema1_myTbl3_log_seq   | M3                           |            10 | t
    6034 | emaj        | myschema1_mytbl2_log_seq   | M3                           |             2 | t
    6035 | emajb       | myschema1_mytbl2b_log_seq  | M3                           |             1 | f
    6044 | myschema2   | myseq1                     | M3                           |          1003 | t
    6045 | myschema2   | myTbl3_col31_seq           | M3                           |            20 | t
    6046 | emaj        | myschema2_mytbl1_log_seq   | M3                           |            15 | t
    6047 | emaj        | myschema2_mytbl2_log_seq   | M3                           |             2 | t
    6048 | emajC       | myschema2_myTbl3_log_seq   | M3                           |            10 | t
    6049 | emaj        | myschema2_mytbl4_log_seq   | M3                           |             4 | t
    6050 | emaj        | otherPrefix4mytbl5_log_seq | M3                           |             4 | t
    6051 | emaj        | myschema2_mytbl6_log_seq   | M3                           |            14 | t
    6054 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M2_%_START              |            15 | t
    6055 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M2_%_START              |             2 | t
    6056 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M2_%_START              |            10 | t
    6062 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M2_%_DONE               |            15 | t
    6063 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M2_%_DONE               |             2 | t
    6064 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M2_%_DONE               |            10 | t
    6070 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M3_%_START              |            15 | t
    6071 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M3_%_START              |             2 | t
    6072 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M3_%_START              |            10 | t
    6078 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M3_%_DONE               |            15 | t
    6079 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M3_%_DONE               |             2 | t
    6080 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M3_%_DONE               |            10 | t
    6084 | myschema1   | myTbl3_col31_seq           | M4                           |            20 | t
    6085 | emajC       | myschema1_myTbl3_log_seq   | M4                           |            10 | t
    6086 | emaj        | myschema1_mytbl1_log_seq   | M4                           |            30 | t
    6087 | emaj        | myschema1_mytbl4_log_seq   | M4                           |             8 | t
    6088 | emaj        | myschema1_mytbl2_log_seq   | M4                           |             3 | t
    6089 | emajb       | myschema1_mytbl2b_log_seq  | M4                           |             1 | f
    6090 | myschema1   | myTbl3_col31_seq           | M5                           |            20 | t
    6091 | emajC       | myschema1_myTbl3_log_seq   | M5                           |            20 | t
    6092 | emaj        | myschema1_mytbl1_log_seq   | M5                           |            30 | t
    6093 | emaj        | myschema1_mytbl4_log_seq   | M5                           |             8 | t
    6094 | emaj        | myschema1_mytbl2_log_seq   | M5                           |             3 | t
    6095 | emajb       | myschema1_mytbl2b_log_seq  | M5                           |             1 | f
    6097 | emajC       | myschema1_myTbl3_log_seq   | M6                           |            20 | t
    6100 | emaj        | myschema1_mytbl2_log_seq   | M6                           |             3 | t
    6101 | emajb       | myschema1_mytbl2b_log_seq  | M6                           |             1 | f
    6104 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M2_%_START              |            15 | t
    6105 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M2_%_START              |             2 | t
    6106 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M2_%_START              |            10 | t
    6112 | emaj        | myschema2_mytbl1_log_seq   | RLBK_M2_%_DONE               |            15 | t
    6113 | emaj        | myschema2_mytbl2_log_seq   | RLBK_M2_%_DONE               |             2 | t
    6114 | emajC       | myschema2_myTbl3_log_seq   | RLBK_M2_%_DONE               |            10 | t
    6118 | myschema1   | myTbl3_col31_seq           | Before logged rollback to M4 |            20 | t
    6119 | emajC       | myschema1_myTbl3_log_seq   | Before logged rollback to M4 |            20 | t
    6120 | emaj        | myschema1_mytbl1_log_seq   | Before logged rollback to M4 |            32 | t
    6121 | emaj        | myschema1_mytbl4_log_seq   | Before logged rollback to M4 |            12 | t
    6122 | emaj        | myschema1_mytbl2_log_seq   | Before logged rollback to M4 |             3 | t
    6123 | emajb       | myschema1_mytbl2b_log_seq  | Before logged rollback to M4 |             1 | f
    6130 | myschema1   | myTbl3_col31_seq           | STOP_%                       |            20 | t
    6131 | myschema2   | myseq1                     | STOP_%                       |          1004 | f
    6132 | myschema2   | myTbl3_col31_seq           | STOP_%                       |            20 | t
    6133 | emajC       | myschema1_myTbl3_log_seq   | STOP_%                       |            45 | t
    6134 | emaj        | myschema1_mytbl1_log_seq   | STOP_%                       |            33 | t
    6135 | emaj        | myschema1_mytbl4_log_seq   | STOP_%                       |            14 | t
    6136 | emaj        | myschema1_mytbl2_log_seq   | STOP_%                       |             3 | t
    6137 | emajb       | myschema1_mytbl2b_log_seq  | STOP_%                       |             1 | f
    6138 | emaj        | myschema2_mytbl1_log_seq   | STOP_%                       |            15 | t
    6139 | emaj        | myschema2_mytbl2_log_seq   | STOP_%                       |             2 | t
    6140 | emajC       | myschema2_myTbl3_log_seq   | STOP_%                       |            10 | t
    6141 | emaj        | myschema2_mytbl4_log_seq   | STOP_%                       |            10 | t
    6142 | emaj        | otherPrefix4mytbl5_log_seq | STOP_%                       |             7 | t
    6143 | emaj        | myschema2_mytbl6_log_seq   | STOP_%                       |            23 | t
    6161 | emajC       | myschema1_myTbl3_log_seq   | Multi-2                      |            45 | t
    6162 | emaj        | myschema1_mytbl1_log_seq   | Multi-2                      |            33 | t
    6163 | emaj        | myschema1_mytbl4_log_seq   | Multi-2                      |            14 | t
    6164 | emaj        | myschema1_mytbl2_log_seq   | Multi-2                      |             3 | t
    6165 | emajb       | myschema1_mytbl2b_log_seq  | Multi-2                      |             1 | f
    6166 | emaj        | myschema2_mytbl1_log_seq   | Multi-2                      |            15 | t
    6167 | emaj        | myschema2_mytbl2_log_seq   | Multi-2                      |             2 | t
    6168 | emajC       | myschema2_myTbl3_log_seq   | Multi-2                      |            10 | t
    6169 | emaj        | myschema2_mytbl4_log_seq   | Multi-2                      |            10 | t
    6170 | emaj        | otherPrefix4mytbl5_log_seq | Multi-2                      |             7 | t
    6171 | emaj        | myschema2_mytbl6_log_seq   | Multi-2                      |            23 | t
    6175 | emajC       | myschema1_myTbl3_log_seq   | RLBK_Multi-1_%_START         |            45 | t
    6176 | emaj        | myschema1_mytbl1_log_seq   | RLBK_Multi-1_%_START         |            33 | t
    6177 | emaj        | myschema1_mytbl4_log_seq   | RLBK_Multi-1_%_START         |            14 | t
    6178 | emaj        | myschema1_mytbl2_log_seq   | RLBK_Multi-1_%_START         |             3 | t
    6179 | emajb       | myschema1_mytbl2b_log_seq  | RLBK_Multi-1_%_START         |             1 | f
    6180 | emaj        | myschema2_mytbl1_log_seq   | RLBK_Multi-1_%_START         |            15 | t
    6181 | emaj        | myschema2_mytbl2_log_seq   | RLBK_Multi-1_%_START         |             2 | t
    6182 | emajC       | myschema2_myTbl3_log_seq   | RLBK_Multi-1_%_START         |            10 | t
    6183 | emaj        | myschema2_mytbl4_log_seq   | RLBK_Multi-1_%_START         |            10 | t
    6184 | emaj        | otherPrefix4mytbl5_log_seq | RLBK_Multi-1_%_START         |             7 | t
    6185 | emaj        | myschema2_mytbl6_log_seq   | RLBK_Multi-1_%_START         |            23 | t
    6189 | emajC       | myschema1_myTbl3_log_seq   | RLBK_Multi-1_%_DONE          |            45 | t
    6190 | emaj        | myschema1_mytbl1_log_seq   | RLBK_Multi-1_%_DONE          |            33 | t
    6191 | emaj        | myschema1_mytbl4_log_seq   | RLBK_Multi-1_%_DONE          |            14 | t
    6192 | emaj        | myschema1_mytbl2_log_seq   | RLBK_Multi-1_%_DONE          |             3 | t
    6193 | emajb       | myschema1_mytbl2b_log_seq  | RLBK_Multi-1_%_DONE          |             1 | f
    6194 | emaj        | myschema2_mytbl1_log_seq   | RLBK_Multi-1_%_DONE          |            15 | t
    6195 | emaj        | myschema2_mytbl2_log_seq   | RLBK_Multi-1_%_DONE          |             2 | t
    6196 | emajC       | myschema2_myTbl3_log_seq   | RLBK_Multi-1_%_DONE          |            10 | t
    6197 | emaj        | myschema2_mytbl4_log_seq   | RLBK_Multi-1_%_DONE          |            10 | t
    6198 | emaj        | otherPrefix4mytbl5_log_seq | RLBK_Multi-1_%_DONE          |             7 | t
    6199 | emaj        | myschema2_mytbl6_log_seq   | RLBK_Multi-1_%_DONE          |            23 | t
    6200 | myschema1   | myTbl3_col31_seq           | Stop after rollback          |            20 | t
    6201 | myschema2   | myseq1                     | Stop after rollback          |          1004 | f
    6202 | myschema2   | myTbl3_col31_seq           | Stop after rollback          |            20 | t
    6203 | emajC       | myschema1_myTbl3_log_seq   | Stop after rollback          |            45 | t
    6204 | emaj        | myschema1_mytbl1_log_seq   | Stop after rollback          |            33 | t
    6205 | emaj        | myschema1_mytbl4_log_seq   | Stop after rollback          |            14 | t
    6206 | emaj        | myschema1_mytbl2_log_seq   | Stop after rollback          |             3 | t
    6207 | emajb       | myschema1_mytbl2b_log_seq  | Stop after rollback          |             1 | f
    6208 | emaj        | myschema2_mytbl1_log_seq   | Stop after rollback          |            15 | t
    6209 | emaj        | myschema2_mytbl2_log_seq   | Stop after rollback          |             2 | t
    6210 | emajC       | myschema2_myTbl3_log_seq   | Stop after rollback          |            10 | t
    6211 | emaj        | myschema2_mytbl4_log_seq   | Stop after rollback          |            10 | t
    6212 | emaj        | otherPrefix4mytbl5_log_seq | Stop after rollback          |             7 | t
    6213 | emaj        | myschema2_mytbl6_log_seq   | Stop after rollback          |            23 | t
    6214 | myschema1   | myTbl3_col31_seq           | Multi-1                      |            20 | t
    6215 | myschema2   | myseq1                     | Multi-1                      |          1004 | f
    6216 | myschema2   | myTbl3_col31_seq           | Multi-1                      |            20 | t
    6217 | emajC       | myschema1_myTbl3_log_seq   | Multi-1                      |            45 | t
    6218 | emaj        | myschema1_mytbl1_log_seq   | Multi-1                      |            33 | t
    6219 | emaj        | myschema1_mytbl4_log_seq   | Multi-1                      |            14 | t
    6220 | emaj        | myschema1_mytbl2_log_seq   | Multi-1                      |             3 | t
    6221 | emajb       | myschema1_mytbl2b_log_seq  | Multi-1                      |             1 | f
    6222 | emaj        | myschema2_mytbl1_log_seq   | Multi-1                      |            15 | t
    6223 | emaj        | myschema2_mytbl2_log_seq   | Multi-1                      |             2 | t
    6224 | emajC       | myschema2_myTbl3_log_seq   | Multi-1                      |            10 | t
    6225 | emaj        | myschema2_mytbl4_log_seq   | Multi-1                      |            10 | t
    6226 | emaj        | otherPrefix4mytbl5_log_seq | Multi-1                      |             7 | t
    6227 | emaj        | myschema2_mytbl6_log_seq   | Multi-1                      |            23 | t
(161 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 2010-01-01
     2 | DEF   | 
(2 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 | col12 | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------+------------+----------
(0 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | col23 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------+------------+----------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from "emajC"."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 | col45 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-------+-----------+------------+----------
(0 rows)

--
-----------------------------
-- Step 3 : stop myGroup2
-----------------------------
select emaj.emaj_stop_group('myGroup2');
 emaj_stop_group 
-----------------
               8
(1 row)

--
-----------------------------
-- test end: check and reset history
-----------------------------
select hist_id, hist_function, hist_event, hist_object, regexp_replace(regexp_replace(hist_wording,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'),E'\\[.+\\]','(timestamp)','g'), hist_user from 
  (select * from emaj.emaj_hist order by hist_id) as t;
 hist_id |   hist_function    |  hist_event  |         hist_object          |                         regexp_replace                         | hist_user 
---------+--------------------+--------------+------------------------------+----------------------------------------------------------------+-----------
       1 | EMAJ_INSTALL       |              | E-Maj <NEXT_VERSION>         | Initialisation completed                                       | postgres
   10002 | ROLLBACK_GROUPS    | BEGIN        | myGroup1,myGroup2            | Logged rollback to mark Multi-1 (timestamp)                    | postgres
   10003 | DBLINK_OPEN_CNX    |              | rlbk#1                       | Status = 1                                                     | postgres
   10004 | LOCK_GROUP         | BEGIN        | myGroup1,myGroup2            | Rollback session #1                                            | postgres
   10005 | LOCK_GROUP         | END          | myGroup1,myGroup2            | Rollback session #1: 2 tables locked, 0 deadlock(s)            | postgres
   10006 | DBLINK_OPEN_CNX    |              | rlbk#2                       | Status = 1                                                     | postgres
   10007 | LOCK_GROUP         | BEGIN        | myGroup1,myGroup2            | Rollback session #2                                            | postgres
   10008 | LOCK_GROUP         | END          | myGroup1,myGroup2            | Rollback session #2: 5 tables locked, 0 deadlock(s)            | postgres
   10009 | DBLINK_OPEN_CNX    |              | rlbk#3                       | Status = 1                                                     | postgres
   10010 | LOCK_GROUP         | BEGIN        | myGroup1,myGroup2            | Rollback session #3                                            | postgres
   10011 | LOCK_GROUP         | END          | myGroup1,myGroup2            | Rollback session #3: 4 tables locked, 0 deadlock(s)            | postgres
   10012 | SET_MARK_GROUPS    | BEGIN        | myGroup1,myGroup2            | RLBK_Multi-1_%_START                                           | postgres
   10013 | SET_MARK_GROUPS    | END          | myGroup1,myGroup2            | RLBK_Multi-1_%_START                                           | postgres
   10014 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl1             | All log rows with emaj_gid > 100161                            | postgres
   10015 | ROLLBACK_TABLE     | BEGIN        | myschema1.mytbl1             | All log rows with emaj_gid > 100161                            | postgres
   10016 | ROLLBACK_TABLE     | END          | myschema1.mytbl1             | 20 rolled back primary keys                                    | postgres
   10017 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl6             | All log rows with emaj_gid > 100161                            | postgres
   10018 | ROLLBACK_TABLE     | BEGIN        | myschema1.mytbl2             | All log rows with emaj_gid > 100161                            | postgres
   10019 | ROLLBACK_TABLE     | END          | myschema2.mytbl1             | 10 rolled back primary keys                                    | postgres
   10020 | ROLLBACK_TABLE     | END          | myschema1.mytbl2             | 3 rolled back primary keys                                     | postgres
   10021 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl2             | All log rows with emaj_gid > 100161                            | postgres
   10022 | ROLLBACK_TABLE     | END          | myschema2.mytbl6             | 14 rolled back primary keys                                    | postgres
   10023 | ROLLBACK_TABLE     | END          | myschema2.mytbl2             | 2 rolled back primary keys                                     | postgres
   10024 | ROLLBACK_TABLE     | BEGIN        | myschema2."myTbl3"           | All log rows with emaj_gid > 100161                            | postgres
   10025 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl4             | All log rows with emaj_gid > 100161                            | postgres
   10026 | ROLLBACK_TABLE     | END          | myschema2."myTbl3"           | 10 rolled back primary keys                                    | postgres
   10027 | ROLLBACK_TABLE     | END          | myschema2.mytbl4             | 2 rolled back primary keys                                     | postgres
   10028 | ROLLBACK_TABLE     | BEGIN        | myschema1."myTbl3"           | All log rows with emaj_gid > 100161                            | postgres
   10029 | ROLLBACK_TABLE     | END          | myschema1."myTbl3"           | 5 rolled back primary keys                                     | postgres
   10030 | DBLINK_CLOSE_CNX   |              | rlbk#2                       |                                                                | postgres
   10031 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl5             | All log rows with emaj_gid > 100161                            | postgres
   10032 | ROLLBACK_TABLE     | END          | myschema2.mytbl5             | 3 rolled back primary keys                                     | postgres
   10033 | DBLINK_CLOSE_CNX   |              | rlbk#3                       |                                                                | postgres
   10034 | ROLLBACK_SEQUENCE  |              | myschema1."myTbl3_col31_seq" | RESTART 21                                                     | postgres
   10035 | ROLLBACK_SEQUENCE  |              | myschema2.myseq1             | RESTART 1004                                                   | postgres
   10036 | ROLLBACK_SEQUENCE  |              | myschema2."myTbl3_col31_seq" | RESTART 21                                                     | postgres
   10037 | SET_MARK_GROUPS    | BEGIN        | myGroup1,myGroup2            | RLBK_Multi-1_%_DONE                                            | postgres
   10038 | SET_MARK_GROUPS    | END          | myGroup1,myGroup2            | RLBK_Multi-1_%_DONE                                            | postgres
   10039 | ROLLBACK_GROUPS    | END          | myGroup1,myGroup2            | Rollback_id 37, 9 tables and 3 sequences effectively processed | postgres
   10040 | DBLINK_CLOSE_CNX   |              | rlbk#1                       |                                                                | postgres
   10041 | CLEANUP_RLBK_STATE |              | rollback id 37               | set to COMMITTED                                               | postgres
   10042 | ROLLBACK_GROUP     | BEGIN        | myGroup1                     | Unlogged rollback to mark Multi-1 (timestamp)                  | postgres
   10043 | DBLINK_OPEN_CNX    |              | rlbk#1                       | Status = 1                                                     | postgres
   10044 | LOCK_GROUP         | BEGIN        | myGroup1                     | Rollback session #1                                            | postgres
   10045 | LOCK_GROUP         | END          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)            | postgres
   10046 | ROLLBACK_TABLE     | BEGIN        | myschema1.mytbl1             | All log rows with emaj_gid > 100161                            | postgres
   10047 | ROLLBACK_TABLE     | END          | myschema1.mytbl1             | 20 rolled back primary keys                                    | postgres
   10048 | ROLLBACK_TABLE     | BEGIN        | myschema1.mytbl2             | All log rows with emaj_gid > 100161                            | postgres
   10049 | ROLLBACK_TABLE     | END          | myschema1.mytbl2             | 3 rolled back primary keys                                     | postgres
   10050 | ROLLBACK_TABLE     | BEGIN        | myschema1."myTbl3"           | All log rows with emaj_gid > 100161                            | postgres
   10051 | ROLLBACK_TABLE     | END          | myschema1."myTbl3"           | 5 rolled back primary keys                                     | postgres
   10052 | ROLLBACK_GROUP     | MARK DELETED | myGroup1                     | mark RLBK_Multi-1_%_START is deleted                           | postgres
   10053 | ROLLBACK_GROUP     | MARK DELETED | myGroup1                     | mark RLBK_Multi-1_%_DONE is deleted                            | postgres
   10054 | ROLLBACK_SEQUENCE  |              | myschema1."myTbl3_col31_seq" | RESTART 21                                                     | postgres
   10055 | ROLLBACK_GROUP     | END          | myGroup1                     | Rollback_id 38, 3 tables and 1 sequences effectively processed | postgres
   10056 | DBLINK_CLOSE_CNX   |              | rlbk#1                       |                                                                | postgres
   10057 | CLEANUP_RLBK_STATE |              | rollback id 38               | set to COMMITTED                                               | postgres
   10058 | SET_MARK_GROUP     | BEGIN        | myGroup2                     |                                                                | postgres
   10059 | LOCK_GROUP         | BEGIN        | myGroup2                     |                                                                | postgres
   10060 | LOCK_GROUP         | END          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                 | postgres
   10061 | SET_MARK_GROUP     | END          | myGroup2                     | After restore mark                                             | postgres
   10062 | ROLLBACK_GROUP     | BEGIN        | myGroup2                     | Unlogged rollback to mark Multi-1 (timestamp)                  | postgres
   10063 | DBLINK_OPEN_CNX    |              | rlbk#1                       | Status = -2                                                    | postgres
   10064 | LOCK_GROUP         | BEGIN        | myGroup2                     | Rollback session #1                                            | postgres
   10065 | LOCK_GROUP         | END          | myGroup2                     | Rollback session #1: 6 tables locked, 0 deadlock(s)            | postgres
   10066 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl6             | All log rows with emaj_gid > 100161                            | postgres
   10067 | ROLLBACK_TABLE     | END          | myschema2.mytbl6             | 14 rolled back primary keys                                    | postgres
   10068 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl1             | All log rows with emaj_gid > 100161                            | postgres
   10069 | ROLLBACK_TABLE     | END          | myschema2.mytbl1             | 21 rolled back primary keys                                    | postgres
   10070 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl2             | All log rows with emaj_gid > 100161                            | postgres
   10071 | ROLLBACK_TABLE     | END          | myschema2.mytbl2             | 3 rolled back primary keys                                     | postgres
   10072 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl4             | All log rows with emaj_gid > 100161                            | postgres
   10073 | ROLLBACK_TABLE     | END          | myschema2.mytbl4             | 2 rolled back primary keys                                     | postgres
   10074 | ROLLBACK_TABLE     | BEGIN        | myschema2."myTbl3"           | All log rows with emaj_gid > 100161                            | postgres
   10075 | ROLLBACK_TABLE     | END          | myschema2."myTbl3"           | 10 rolled back primary keys                                    | postgres
   10076 | ROLLBACK_TABLE     | BEGIN        | myschema2.mytbl5             | All log rows with emaj_gid > 100161                            | postgres
   10077 | ROLLBACK_TABLE     | END          | myschema2.mytbl5             | 3 rolled back primary keys                                     | postgres
   10078 | ROLLBACK_GROUP     | MARK DELETED | myGroup2                     | mark RLBK_Multi-1_%_START is deleted                           | postgres
   10079 | ROLLBACK_GROUP     | MARK DELETED | myGroup2                     | mark RLBK_Multi-1_%_DONE is deleted                            | postgres
   10080 | ROLLBACK_GROUP     | MARK DELETED | myGroup2                     | mark After restore mark is deleted                             | postgres
   10081 | ROLLBACK_SEQUENCE  |              | myschema2.myseq1             | RESTART 1004                                                   | postgres
   10082 | ROLLBACK_SEQUENCE  |              | myschema2."myTbl3_col31_seq" | RESTART 21                                                     | postgres
   10083 | ROLLBACK_GROUP     | END          | myGroup2                     | Rollback_id 39, 6 tables and 2 sequences effectively processed | postgres
   10084 | STOP_GROUP         | BEGIN        | myGroup2                     |                                                                | postgres
   10085 | LOCK_GROUP         | BEGIN        | myGroup2                     |                                                                | postgres
   10086 | LOCK_GROUP         | END          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                 | postgres
   10087 | SET_MARK_GROUP     | BEGIN        | myGroup2                     | STOP_%                                                         | postgres
   10088 | SET_MARK_GROUP     | END          | myGroup2                     | STOP_%                                                         | postgres
   10089 | STOP_GROUP         | END          | myGroup2                     | 8 tables/sequences processed                                   | postgres
(89 rows)

--
truncate emaj.emaj_hist;
TRUNCATE TABLE
alter sequence emaj.emaj_hist_hist_id_seq restart 10000;
ALTER SEQUENCE
